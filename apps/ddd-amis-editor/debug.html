<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDDå¹³å° - è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .btn { padding: 10px 20px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px; }
        .result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; }
        .card { background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .panel-card { border-left: 4px solid #1890ff; }
        .service-card { background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>ğŸ› DDDå¹³å°è°ƒè¯•é¡µé¢</h1>
    
    <button class="btn" onclick="testConnection()">ğŸ”Œ æµ‹è¯•åç«¯è¿æ¥</button>
    <button class="btn" onclick="testRender()">ğŸ¨ æµ‹è¯•æ¸²æŸ“ç»„ä»¶</button>
    
    <div id="result" class="result"></div>
    <div id="preview"></div>

    <script>
        async function testConnection() {
            const result = document.getElementById('result');
            try {
                result.textContent = 'æ­£åœ¨è¿æ¥åç«¯...';
                
                const response = await fetch('http://localhost:8100/amis/dashboard');
                if (response.ok) {
                    const data = await response.json();
                    result.textContent = `âœ… è¿æ¥æˆåŠŸï¼\nçŠ¶æ€ç : ${response.status}\nå“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                    
                    // ä¿å­˜æ•°æ®ç”¨äºæµ‹è¯•æ¸²æŸ“
                    window.testData = data;
                } else {
                    result.textContent = `âŒ è¿æ¥å¤±è´¥\nçŠ¶æ€ç : ${response.status}\nçŠ¶æ€æ–‡æœ¬: ${response.statusText}`;
                }
            } catch (error) {
                result.textContent = `âŒ è¿æ¥é”™è¯¯: ${error.message}`;
                console.error('è¿æ¥é”™è¯¯:', error);
            }
        }

        function testRender() {
            const preview = document.getElementById('preview');
            const result = document.getElementById('result');
            
            if (!window.testData) {
                result.textContent = 'âŒ è¯·å…ˆæµ‹è¯•åç«¯è¿æ¥è·å–æ•°æ®';
                return;
            }
            
            try {
                result.textContent = 'æ­£åœ¨æµ‹è¯•æ¸²æŸ“...';
                preview.innerHTML = '';
                
                const schema = window.testData.data || window.testData;
                console.log('å¼€å§‹æ¸²æŸ“schema:', schema);
                
                const element = renderComponent(schema);
                if (element) {
                    preview.appendChild(element);
                    result.textContent = 'âœ… æ¸²æŸ“æˆåŠŸï¼';
                } else {
                    result.textContent = 'âŒ æ¸²æŸ“å¤±è´¥ï¼šè¿”å›ç©ºå…ƒç´ ';
                }
            } catch (error) {
                result.textContent = `âŒ æ¸²æŸ“é”™è¯¯: ${error.message}`;
                console.error('æ¸²æŸ“é”™è¯¯:', error);
            }
        }

        function renderComponent(component) {
            console.log('renderComponent è¾“å…¥:', component);
            
            if (!component) {
                console.error('ç»„ä»¶ä¸ºç©º');
                return null;
            }
            
            const div = document.createElement('div');
            div.style.marginBottom = '16px';
            
            console.log('ç»„ä»¶ç±»å‹:', component.type);
            
            switch (component.type) {
                case 'page':
                    console.log('æ¸²æŸ“é¡µé¢ç»„ä»¶');
                    if (component.title) {
                        const title = document.createElement('h1');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 20px; color: #333; font-size: 24px;';
                        div.appendChild(title);
                    }
                    if (component.body && Array.isArray(component.body)) {
                        console.log('æ¸²æŸ“é¡µé¢bodyï¼Œé¡¹ç›®æ•°:', component.body.length);
                        component.body.forEach((item, index) => {
                            console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªå­ç»„ä»¶:`, item.type);
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'grid':
                    console.log('æ¸²æŸ“ç½‘æ ¼ç»„ä»¶');
                    div.style.cssText = 'display: grid; gap: 16px;';
                    if (component.columns) {
                        div.style.gridTemplateColumns = `repeat(${component.columns.length}, 1fr)`;
                        component.columns.forEach((col, index) => {
                            console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªç½‘æ ¼åˆ—:`, col);
                            if (col.body) {
                                if (Array.isArray(col.body)) {
                                    col.body.forEach(item => {
                                        const child = renderComponent(item);
                                        if (child) div.appendChild(child);
                                    });
                                } else {
                                    const child = renderComponent(col.body);
                                    if (child) div.appendChild(child);
                                }
                            }
                        });
                    }
                    break;
                    
                case 'card':
                    console.log('æ¸²æŸ“å¡ç‰‡ç»„ä»¶');
                    div.className = 'card';
                    if (component.header && component.header.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.header.title;
                        header.style.cssText = 'margin-bottom: 16px; color: #333; font-size: 18px;';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) div.appendChild(child);
                            });
                        } else {
                            const child = renderComponent(component.body);
                            if (child) div.appendChild(child);
                        }
                    }
                    break;
                    
                case 'panel':
                    console.log('æ¸²æŸ“é¢æ¿ç»„ä»¶');
                    div.className = 'card panel-card';
                    if (component.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.title;
                        header.style.cssText = 'margin-bottom: 16px; color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 8px;';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) div.appendChild(child);
                            });
                        } else {
                            const child = renderComponent(component.body);
                            if (child) div.appendChild(child);
                        }
                    }
                    break;
                    
                case 'service':
                    console.log('æ¸²æŸ“æœåŠ¡ç»„ä»¶');
                    div.className = 'service-card';
                    div.innerHTML = `
                        <div style="padding: 16px; border-radius: 6px; border-left: 4px solid #52c41a; margin-bottom: 12px;">
                            <h4 style="margin: 0 0 8px 0; color: #52c41a;">ğŸ“¡ æ•°æ®æœåŠ¡</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">API: ${component.api || 'æœªæŒ‡å®š'}</p>
                        </div>
                    `;
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'tpl':
                    console.log('æ¸²æŸ“æ¨¡æ¿ç»„ä»¶');
                    div.innerHTML = component.tpl || '';
                    break;
                    
                case 'chart':
                    console.log('æ¸²æŸ“å›¾è¡¨ç»„ä»¶');
                    div.className = 'card';
                    const chartType = (component.config && component.config.type) || 'unknown';
                    div.innerHTML = `
                        <h3 style="margin-bottom: 16px;">ğŸ“Š ${chartType.toUpperCase()} å›¾è¡¨</h3>
                        <div style="height: 300px; background: linear-gradient(45deg, #f0f9ff, #e0f2fe); 
                                    border-radius: 8px; display: flex; align-items: center; 
                                    justify-content: center; color: #0369a1; font-size: 16px; text-align: center;">
                            å›¾è¡¨æ•°æ®å¯è§†åŒ–åŒºåŸŸ<br>
                            <small style="opacity: 0.7;">ç±»å‹: ${chartType}<br>ï¼ˆç®€æ˜“ç¼–è¾‘å™¨æš‚ä¸æ”¯æŒå›¾è¡¨æ¸²æŸ“ï¼‰</small>
                        </div>
                    `;
                    break;
                    
                default:
                    console.log('ä¸æ”¯æŒçš„ç»„ä»¶ç±»å‹:', component.type);
                    div.innerHTML = `
                        <div style="padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; margin: 8px 0;">
                            <strong>ç»„ä»¶ç±»å‹:</strong> ${component.type}<br>
                            <small>è°ƒè¯•é¡µé¢æš‚ä¸æ”¯æŒæ­¤ç»„ä»¶ç±»å‹</small>
                        </div>
                    `;
            }
            
            return div;
        }
    </script>
</body>
</html>
