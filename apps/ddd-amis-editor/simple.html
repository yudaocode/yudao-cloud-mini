<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDDå¹³å° - ç®€æ˜“ç¼–è¾‘å™¨</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .header .actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            border-color: #40a9ff;
            color: #40a9ff;
        }

        .btn.primary {
            background: #1890ff;
            border-color: #1890ff;
            color: #fff;
        }

        .btn.primary:hover {
            background: #40a9ff;
        }

        .container {
            height: calc(100vh - 65px);
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e8e8e8;
            padding: 20px;
            overflow-y: auto;
        }

        .content {
            flex: 1;
            background: #fff;
            padding: 20px;
            overflow-y: auto;
        }

        .component-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .component-item:hover {
            background: #e9ecef;
            border-color: #1890ff;
        }

        .schema-editor {
            width: 100%;
            height: 200px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-top: 10px;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }

        .status.show {
            opacity: 1;
            transform: translateX(0);
        }

        .status.success {
            background: #52c41a;
        }

        .status.error {
            background: #ff4d4f;
        }

        .page-content {
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .alert.info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }

        .alert.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* æ–°å¢ç»„ä»¶æ ·å¼ */
        .panel-card { border-left: 4px solid #1890ff; }
        .service-card { background: #f8f9fa; }
        .action-button .btn { 
            width: 100%; margin: 4px 0; padding: 8px 16px; 
            border: none; border-radius: 4px; cursor: pointer; 
        }
        .action-button .btn.primary { background: #1890ff; color: white; }
        .action-button .btn.info { background: #13c2c2; color: white; }
        .action-button .btn.success { background: #52c41a; color: white; }
        .action-button .btn.warning { background: #faad14; color: white; }
        .property-list { background: #fafafa; padding: 16px; border-radius: 6px; }
        .list-container { margin: 8px 0; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .badge-success { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .badge-default { background: #fafafa; color: #666; border: 1px solid #d9d9d9; }
        .badge-warning { background: #fffbe6; color: #faad14; border: 1px solid #ffe58f; }
        .chart-card { min-height: 400px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ DDDå¹³å°ç®€æ˜“ç¼–è¾‘å™¨</h1>
        <div class="actions">
            <button class="btn" onclick="loadDashboard()">ğŸ“Š ä»ªè¡¨æ¿</button>
            <button class="btn" onclick="loadForm()">ğŸ“ è¡¨å•</button>
            <button class="btn" onclick="clearContent()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <button class="btn primary" onclick="connectBackend()">ğŸ”Œ è¿æ¥åç«¯</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h3>ğŸ“¦ ç»„ä»¶åº“</h3>
            <div class="component-item" onclick="addAlert()">âš ï¸ æç¤ºæ¡†</div>
            <div class="component-item" onclick="addCard()">ğŸ“„ å¡ç‰‡</div>
            <div class="component-item" onclick="addStatCard()">ğŸ“Š ç»Ÿè®¡å¡ç‰‡</div>
            <div class="component-item" onclick="addGrid()">ğŸ“ ç½‘æ ¼å¸ƒå±€</div>
            
            <h3 style="margin-top: 20px;">âš™ï¸ Schemaç¼–è¾‘å™¨</h3>
            <textarea id="schema-editor" class="schema-editor" placeholder="åœ¨æ­¤æŸ¥çœ‹å’Œç¼–è¾‘JSON Schema..."></textarea>
            <button class="btn" onclick="applySchema()" style="width: 100%; margin-top: 10px;">ğŸ”„ åº”ç”¨Schema</button>
        </div>

        <div class="content" id="content">
            <div class="page-content">
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 12px;">
                        <h1 style="margin-bottom: 20px; font-size: 2.5rem;">ğŸ¨ DDDå¹³å°å¯è§†åŒ–ç¼–è¾‘å™¨</h1>
                        <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px;">ç®€æ˜“ç‰ˆæœ¬ï¼Œä¸“æ³¨äºé¡µé¢å¸ƒå±€å’Œç»„ä»¶ç®¡ç†</p>
                        <p style="opacity: 0.8;">ç‚¹å‡»å·¦ä¾§ç»„ä»¶åº“å¼€å§‹æ„å»ºä½ çš„é¡µé¢</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script>
        let currentSchema = {
            type: 'page',
            title: 'DDDå¹³å°æ¬¢è¿é¡µ',
            body: []
        };

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type} show`;
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // æ›´æ–°Schemaç¼–è¾‘å™¨
        function updateSchemaEditor() {
            document.getElementById('schema-editor').value = JSON.stringify(currentSchema, null, 2);
        }

        // æ¸²æŸ“å†…å®¹
        function renderContent() {
            const content = document.getElementById('content');
            content.innerHTML = '';
            
            console.log('renderContent - currentSchema:', currentSchema);
            console.log('renderContent - schemaç±»å‹:', typeof currentSchema);
            
            // å¦‚æœcurrentSchemaæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ç»„ä»¶
            if (currentSchema.type === 'page') {
                console.log('æ¸²æŸ“é¡µé¢ç»„ä»¶');
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // å¦‚æœæœ‰bodyæ•°ç»„
            else if (currentSchema.body && Array.isArray(currentSchema.body)) {
                console.log('æ¸²æŸ“bodyæ•°ç»„ï¼Œé•¿åº¦:', currentSchema.body.length);
                currentSchema.body.forEach((item, index) => {
                    console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªç»„ä»¶:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        content.appendChild(element);
                    }
                });
            }
            // å¦‚æœcurrentSchemaæ˜¯ä¸€ä¸ªæ•°ç»„
            else if (Array.isArray(currentSchema)) {
                console.log('æ¸²æŸ“schemaæ•°ç»„ï¼Œé•¿åº¦:', currentSchema.length);
                currentSchema.forEach((item, index) => {
                    console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªç»„ä»¶:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        content.appendChild(element);
                    }
                });
            }
            // å¦‚æœæ˜¯å•ä¸ªç»„ä»¶
            else if (currentSchema.type) {
                console.log('æ¸²æŸ“å•ä¸ªç»„ä»¶:', currentSchema.type);
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // ç©ºç™½é¡µé¢
            else {
                console.log('æ˜¾ç¤ºç©ºç™½é¡µé¢');
                content.innerHTML = `
                    <div class="page-content">
                        <div style="text-align: center; padding: 60px 20px; color: #666;">
                            <h2>é¡µé¢ä¸ºç©º</h2>
                            <p>ç‚¹å‡»å·¦ä¾§ç»„ä»¶åº“æ·»åŠ å†…å®¹</p>
                        </div>
                    </div>
                `;
            }
            
            updateSchemaEditor();
        }

        // æ¸²æŸ“ç»„ä»¶
        function renderComponent(component) {
            console.log('renderComponent - è¾“å…¥ç»„ä»¶:', component);
            console.log('renderComponent - ç»„ä»¶ç±»å‹:', component ? component.type : 'ç»„ä»¶ä¸ºç©º');
            
            // æ£€æŸ¥ç»„ä»¶æ˜¯å¦æœ‰æ•ˆ
            if (!component) {
                console.error('renderComponent - ç»„ä»¶ä¸ºç©ºæˆ–undefined');
                return null;
            }
            
            // å¦‚æœç»„ä»¶æ²¡æœ‰typeå­—æ®µï¼Œå°è¯•æ¨æ–­
            if (!component.type && component.body) {
                console.log('renderComponent - ç»„ä»¶æ²¡æœ‰typeå­—æ®µï¼Œä½†æœ‰bodyï¼Œæ¨æ–­ä¸ºcontainer');
                component.type = 'container';
            }
            
            const div = document.createElement('div');
            
            switch (component.type) {
                case 'page':
                    // é¡µé¢ç±»å‹ï¼Œæ¸²æŸ“å…¶bodyå†…å®¹
                    if (component.title) {
                        const title = document.createElement('h1');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 20px; color: #333; font-size: 24px;';
                        div.appendChild(title);
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'alert':
                    div.className = `alert ${component.level || 'info'}`;
                    div.textContent = component.body || '';
                    break;
                    
                case 'card':
                    div.className = 'card';
                    if (component.header && component.header.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.header.title;
                        header.style.marginBottom = '16px';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        const body = document.createElement('div');
                        if (typeof component.body === 'string') {
                            body.textContent = component.body;
                        } else if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) body.appendChild(child);
                            });
                        } else if (typeof component.body === 'object') {
                            const child = renderComponent(component.body);
                            if (child) body.appendChild(child);
                        }
                        div.appendChild(body);
                    }
                    break;
                    
                case 'grid':
                    div.className = 'grid';
                    if (component.columns && Array.isArray(component.columns)) {
                        component.columns.forEach(col => {
                            if (col.body) {
                                // å¤„ç†col.bodyå¯èƒ½æ˜¯æ•°ç»„çš„æƒ…å†µ
                                if (Array.isArray(col.body)) {
                                    // å¦‚æœcol.bodyæ˜¯æ•°ç»„ï¼Œéå†æ¸²æŸ“æ¯ä¸ªå­ç»„ä»¶
                                    col.body.forEach(item => {
                                        const childElement = renderComponent(item);
                                        if (childElement) div.appendChild(childElement);
                                    });
                                } else {
                                    // å¦‚æœcol.bodyæ˜¯å•ä¸ªå¯¹è±¡ï¼Œç›´æ¥æ¸²æŸ“
                                    const colElement = renderComponent(col.body);
                                    if (colElement) div.appendChild(colElement);
                                }
                            }
                        });
                    }
                    break;
                    
                case 'flex':
                    div.style.cssText = 'display: flex; gap: 16px; align-items: center; flex-wrap: wrap;';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'container':
                    div.className = 'page-content';
                    if (component.style) {
                        const styleStr = Object.entries(component.style)
                            .map(([k, v]) => `${k.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${v}`)
                            .join('; ');
                        div.style.cssText += styleStr;
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'stat-card':
                    div.className = 'card stat-card';
                    div.innerHTML = `
                        <div class="stat-number" style="color: ${component.color || '#1890ff'};">
                            ${component.number || '0'}
                        </div>
                        <div class="stat-label">${component.label || 'ç»Ÿè®¡é¡¹'}</div>
                    `;
                    break;
                    
                case 'tpl':
                    // å¤„ç†AMISæ¨¡æ¿è¯­æ³•ï¼Œç®€åŒ–æ¸²æŸ“
                    let tplContent = component.tpl || '';
                    
                    // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®æ¥æ›¿æ¢æ¨¡æ¿å˜é‡
                    const mockData = {
                        total: Math.floor(Math.random() * 1000) + 100,
                        growth: (Math.random() * 20 - 10).toFixed(1),
                        name: 'ç¤ºä¾‹é¡¹ç›®',
                        description: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æè¿°',
                        status: 'ACTIVE',
                        createdAt: '2025-01-01',
                        version: 'v1.0.0',
                        environment: 'development',
                        startTime: '2025-01-01 08:00:00',
                        memoryUsage: '256MB',
                        cpuUsage: '15%',
                        icon: 'ğŸ¯',
                        title: 'ç¤ºä¾‹æ ‡é¢˜',
                        time: 'åˆšåˆš'
                    };
                    
                    // æ›¿æ¢å¸¸è§çš„æ¨¡æ¿å˜é‡
                    tplContent = tplContent.replace(/\$\{([^}]+)\}/g, (match, expression) => {
                        try {
                            // ç®€å•å¤„ç†ä¸€äº›å¸¸è§è¡¨è¾¾å¼
                            if (expression.includes('total || 0')) return mockData.total;
                            if (expression.includes('growth')) {
                                if (expression.includes('>=')) {
                                    return mockData.growth >= 0 ? 
                                        (expression.includes('text-green-500') ? 'text-green-500' : 'â†—') : 
                                        (expression.includes('text-red-500') ? 'text-red-500' : 'â†˜');
                                }
                                return mockData.growth;
                            }
                            if (expression.includes('Math.abs(growth)')) return Math.abs(mockData.growth);
                            
                            // ç›´æ¥å±æ€§è®¿é—®
                            const prop = expression.trim();
                            if (mockData[prop] !== undefined) return mockData[prop];
                            
                            return expression; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›åŸè¡¨è¾¾å¼
                        } catch (e) {
                            return expression;
                        }
                    });
                    
                    div.innerHTML = tplContent;
                    break;
                    
                case 'divider':
                    div.innerHTML = '<hr style="margin: 20px 0; border: none; border-top: 1px solid #e8e8e8;">';
                    break;
                    
                case 'panel':
                    div.className = 'card panel-card';
                    if (component.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.title;
                        header.style.cssText = 'margin-bottom: 16px; color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 8px;';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) div.appendChild(child);
                            });
                        } else {
                            const child = renderComponent(component.body);
                            if (child) div.appendChild(child);
                        }
                    }
                    break;
                    
                case 'service':
                    // Serviceç»„ä»¶åœ¨ç®€æ˜“ç¼–è¾‘å™¨ä¸­ç›´æ¥æ¸²æŸ“å…¶bodyå†…å®¹ï¼Œä¸æ˜¾ç¤ºAPIå ä½ç¬¦
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    } else {
                        // å¦‚æœæ²¡æœ‰bodyï¼Œæ˜¾ç¤ºç®€å•çš„å ä½
                        div.innerHTML = `
                            <div style="padding: 8px; background: #f0f9ff; border-radius: 4px; color: #1890ff; font-size: 12px;">
                                ğŸ“¡ ${component.api || 'æ•°æ®åŠ è½½ä¸­...'}
                            </div>
                        `;
                    }
                    break;
                    
                case 'action':
                    div.className = 'action-button';
                    const button = document.createElement('button');
                    button.className = `btn ${component.level || 'primary'} ${component.size || ''}`;
                    button.innerHTML = `${component.icon ? `<i class="${component.icon}"></i> ` : ''}${component.label || 'æŒ‰é’®'}`;
                    button.style.cssText = 'width: 100%; margin: 4px 0;';
                    div.appendChild(button);
                    break;
                    
                case 'property':
                    div.className = 'property-list';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const propDiv = document.createElement('div');
                            propDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;';
                            propDiv.innerHTML = `
                                <span style="font-weight: 500; color: #333;">${item.label || 'å±æ€§'}:</span>
                                <span style="color: #666;">${item.content || 'å€¼'}</span>
                            `;
                            div.appendChild(propDiv);
                        });
                    }
                    break;
                    
                case 'list':
                    div.className = 'list-container';
                    if (component.source && Array.isArray(component.source)) {
                        component.source.forEach(item => {
                            if (component.listItem && component.listItem.body) {
                                const listItemDiv = document.createElement('div');
                                listItemDiv.style.cssText = 'padding: 12px; margin: 8px 0; background: #fafafa; border-radius: 6px; border-left: 3px solid #1890ff;';
                                
                                // ç®€å•çš„æ¨¡æ¿æ¸²æŸ“
                                let content = JSON.stringify(item);
                                if (item.title) content = `<strong>${item.title}</strong><br>${item.description || ''}`;
                                if (item.name) content = `<strong>${item.name}</strong><br>${item.description || ''}`;
                                
                                listItemDiv.innerHTML = content;
                                div.appendChild(listItemDiv);
                            }
                        });
                    } else {
                        div.innerHTML = `
                            <div style="padding: 16px; background: #f0f9ff; border-radius: 6px; color: #1890ff;">
                                ğŸ“‹ åˆ—è¡¨ç»„ä»¶ (æ•°æ®åŠ è½½ä¸­...)
                            </div>
                        `;
                    }
                    break;
                    
                case 'status':
                    div.className = 'status-badge';
                    const status = component.source || 'default';
                    const statusMap = component.map || {};
                    const statusInfo = statusMap[status] || { status: 'default', text: status };
                    
                    div.innerHTML = `
                        <span class="badge badge-${statusInfo.status}" style="padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                            ${statusInfo.text}
                        </span>
                    `;
                    break;
                    
                case 'chart':
                    div.className = 'card chart-card';
                    const chartType = component.config?.type || 'unknown';
                    div.innerHTML = `
                        <h3 style="margin-bottom: 16px;">ğŸ“Š ${chartType.toUpperCase()} å›¾è¡¨</h3>
                        <div style="height: 300px; background: linear-gradient(45deg, #f0f9ff, #e0f2fe); 
                                    border-radius: 8px; display: flex; align-items: center; 
                                    justify-content: center; color: #0369a1; font-size: 16px; text-align: center;">
                            å›¾è¡¨æ•°æ®å¯è§†åŒ–åŒºåŸŸ<br>
                            <small style="opacity: 0.7;">ç±»å‹: ${chartType}<br>ï¼ˆç®€æ˜“ç¼–è¾‘å™¨æš‚ä¸æ”¯æŒå›¾è¡¨æ¸²æŸ“ï¼‰</small>
                        </div>
                    `;
                    break;
                    
                default:
                    div.innerHTML = `
                        <div style="padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; margin: 8px 0;">
                            <strong>ç»„ä»¶ç±»å‹:</strong> ${component.type}<br>
                            <small>ç®€æ˜“ç¼–è¾‘å™¨æš‚ä¸æ”¯æŒæ­¤ç»„ä»¶ç±»å‹</small>
                        </div>
                    `;
                    console.log('ä¸æ”¯æŒçš„ç»„ä»¶ç±»å‹:', component.type, component);
            }
            
            return div;
        }

        // æ·»åŠ æç¤ºæ¡†
        function addAlert() {
            const alert = {
                type: 'alert',
                level: 'info',
                body: 'è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æç¤ºæ¡†'
            };
            currentSchema.body.push(alert);
            renderContent();
            showStatus('æç¤ºæ¡†å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ å¡ç‰‡
        function addCard() {
            const card = {
                type: 'card',
                header: { title: 'æ–°å¡ç‰‡' },
                body: 'è¿™æ˜¯ä¸€ä¸ªæ–°çš„å¡ç‰‡å†…å®¹'
            };
            currentSchema.body.push(card);
            renderContent();
            showStatus('å¡ç‰‡å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ ç»Ÿè®¡å¡ç‰‡
        function addStatCard() {
            const statCard = {
                type: 'stat-card',
                number: Math.floor(Math.random() * 1000),
                label: 'éšæœºæ•°æ®',
                color: ['#1890ff', '#52c41a', '#fa8c16', '#722ed1'][Math.floor(Math.random() * 4)]
            };
            currentSchema.body.push(statCard);
            renderContent();
            showStatus('ç»Ÿè®¡å¡ç‰‡å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ ç½‘æ ¼å¸ƒå±€
        function addGrid() {
            const grid = {
                type: 'grid',
                columns: [
                    {
                        body: {
                            type: 'stat-card',
                            number: '24',
                            label: 'é¡¹ç›®æ•°',
                            color: '#1890ff'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '156',
                            label: 'æ¨¡å‹æ•°',
                            color: '#52c41a'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '89',
                            label: 'èšåˆæ ¹',
                            color: '#fa8c16'
                        }
                    }
                ]
            };
            currentSchema.body.push(grid);
            renderContent();
            showStatus('ç½‘æ ¼å¸ƒå±€å·²æ·»åŠ ', 'success');
        }

        // åŠ è½½ä»ªè¡¨æ¿æ¨¡æ¿
        function loadDashboard() {
            currentSchema = {
                type: 'page',
                title: 'DDDæ•°æ®ä»ªè¡¨æ¿',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'ğŸ¯ æ¬¢è¿ä½¿ç”¨DDDå¹³å°æ•°æ®ä»ªè¡¨æ¿'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '24',
                                    label: 'ğŸ“ æ´»è·ƒé¡¹ç›®',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '156',
                                    label: 'ğŸ—ï¸ é¢†åŸŸæ¨¡å‹',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '89',
                                    label: 'âš¡ èšåˆæ ¹',
                                    color: '#fa8c16'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '234',
                                    label: 'ğŸ’ å€¼å¯¹è±¡',
                                    color: '#722ed1'
                                }
                            }
                        ]
                    },
                    {
                        type: 'card',
                        header: { title: 'ğŸ“ˆ é¡¹ç›®æ´»è·ƒåº¦è¶‹åŠ¿' },
                        body: 'è¿™é‡Œæ˜¯å›¾è¡¨åŒºåŸŸï¼ˆå ä½ç¬¦ï¼‰'
                    }
                ]
            };
            renderContent();
            showStatus('ä»ªè¡¨æ¿æ¨¡æ¿å·²åŠ è½½ï¼', 'success');
        }

        // åŠ è½½è¡¨å•æ¨¡æ¿
        function loadForm() {
            currentSchema = {
                type: 'page',
                title: 'ğŸ“ DDDå®ä½“é…ç½®è¡¨å•',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'è¯·å¡«å†™é¢†åŸŸå®ä½“çš„åŸºæœ¬ä¿¡æ¯'
                    },
                    {
                        type: 'card',
                        header: { title: 'åŸºæœ¬ä¿¡æ¯' },
                        body: 'è¡¨å•å­—æ®µåŒºåŸŸï¼ˆå ä½ç¬¦ï¼‰'
                    }
                ]
            };
            renderContent();
            showStatus('è¡¨å•æ¨¡æ¿å·²åŠ è½½ï¼', 'success');
        }

        // æ¸…ç©ºå†…å®¹
        function clearContent() {
            currentSchema.body = [];
            renderContent();
            showStatus('å†…å®¹å·²æ¸…ç©º', 'success');
        }

        // åº”ç”¨Schema
        function applySchema() {
            try {
                const schemaText = document.getElementById('schema-editor').value;
                const newSchema = JSON.parse(schemaText);
                currentSchema = newSchema;
                renderContent();
                showStatus('Schemaå·²åº”ç”¨ï¼', 'success');
            } catch (error) {
                showStatus('Schemaæ ¼å¼é”™è¯¯: ' + error.message, 'error');
            }
        }

        // è¿æ¥åç«¯
        async function connectBackend() {
            try {
                showStatus('æ­£åœ¨è¿æ¥åç«¯...', 'success');
                
                const response = await fetch('http://localhost:8100/amis/dashboard');
                if (response.ok) {
                    const result = await response.json();
                    showStatus('åç«¯è¿æ¥æˆåŠŸï¼', 'success');
                    console.log('åç«¯è¿”å›æ•°æ®:', result);
                    
                    // æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
                    console.log('å®Œæ•´åç«¯å“åº”:', JSON.stringify(result, null, 2));
                    
                    if (result.code === 200 && result.data) {
                        currentSchema = result.data;
                        console.log('ä½¿ç”¨result.dataä½œä¸ºschema:', JSON.stringify(currentSchema, null, 2));
                        
                        // æ›´æ–°schemaç¼–è¾‘å™¨
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('åç«¯æ•°æ®å·²åŠ è½½ï¼', 'success');
                    } else if (result.schema) {
                        // å…¼å®¹ç›´æ¥è¿”å›schemaçš„æ ¼å¼
                        currentSchema = result.schema;
                        console.log('ä½¿ç”¨result.schemaä½œä¸ºschema:', JSON.stringify(currentSchema, null, 2));
                        
                        // æ›´æ–°schemaç¼–è¾‘å™¨
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('åç«¯æ•°æ®å·²åŠ è½½ï¼', 'success');
                    } else {
                        showStatus('åç«¯è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®', 'error');
                        console.log('æ•°æ®æ ¼å¼é”™è¯¯:', result);
                    }
                } else {
                    showStatus('åç«¯æœåŠ¡æœªå“åº”', 'error');
                }
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showStatus('æ— æ³•è¿æ¥åç«¯: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç®€æ˜“ç¼–è¾‘å™¨åŠ è½½å®Œæˆ');
            renderContent();
            showStatus('ç¼–è¾‘å™¨åŠ è½½å®Œæˆï¼', 'success');
        });
    </script>
</body>
</html>
