<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDDå¹³å° - AMISæµ‹è¯•ç¼–è¾‘å™¨</title>
    
    <!-- AMISæ ·å¼ -->
    <link rel="stylesheet" href="https://unpkg.com/amis@6.3.0/lib/themes/cxd.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .actions {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .btn {
            margin: 0 5px;
            padding: 8px 16px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn:hover {
            background: #40a9ff;
        }
        
        #amis-root {
            min-height: 400px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: white;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            display: none;
        }
        
        .status.success { background: #52c41a; }
        .status.error { background: #ff4d4f; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ DDDå¹³å° AMIS æµ‹è¯•ç¼–è¾‘å™¨</h1>
            <p>ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸“æ³¨äºAMISé¡µé¢æ¸²æŸ“åŠŸèƒ½</p>
        </div>
        
        <div class="actions">
            <button class="btn" onclick="loadDashboard()">ğŸ“Š åŠ è½½ä»ªè¡¨æ¿</button>
            <button class="btn" onclick="loadForm()">ğŸ“ åŠ è½½è¡¨å•</button>
            <button class="btn" onclick="loadTable()">ğŸ“‹ åŠ è½½è¡¨æ ¼</button>
            <button class="btn" onclick="connectBackend()">ğŸ”Œ è¿æ¥åç«¯</button>
        </div>
        
        <div id="amis-root"></div>
    </div>
    
    <div id="status" class="status"></div>

    <!-- åªåŠ è½½AMISæ ¸å¿ƒåº“ -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/amis@6.3.0/lib/index.js"></script>

    <script>
        let amisInstance = null;
        
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        function renderSchema(schema) {
            try {
                const root = document.getElementById('amis-root');
                
                // æ¸…é™¤ä¹‹å‰çš„å®ä¾‹
                if (amisInstance) {
                    amisInstance.unmount();
                }
                
                // åˆ›å»ºæ–°çš„AMISå®ä¾‹
                amisInstance = amis.embed(root, schema, {
                    theme: 'cxd',
                    locale: 'zh-CN'
                });
                
                showStatus('é¡µé¢æ¸²æŸ“æˆåŠŸï¼', 'success');
                console.log('AMISå®ä¾‹åˆ›å»ºæˆåŠŸ:', amisInstance);
                
            } catch (error) {
                console.error('æ¸²æŸ“å¤±è´¥:', error);
                showStatus('é¡µé¢æ¸²æŸ“å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function loadDashboard() {
            const schema = {
                type: 'page',
                title: 'DDDæ•°æ®ä»ªè¡¨æ¿',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'ğŸ¯ æ¬¢è¿ä½¿ç”¨DDDå¹³å°æ•°æ®ä»ªè¡¨æ¿'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                md: 3,
                                body: {
                                    type: 'card',
                                    header: { title: 'ğŸ“ é¡¹ç›®æ€»æ•°' },
                                    body: [
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; font-size: 3rem; font-weight: bold; color: #1890ff;">24</div>'
                                        },
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; color: #666; margin-top: 8px;">ä¸ªæ´»è·ƒé¡¹ç›®</div>'
                                        }
                                    ]
                                }
                            },
                            {
                                md: 3,
                                body: {
                                    type: 'card',
                                    header: { title: 'ğŸ—ï¸ é¢†åŸŸæ¨¡å‹' },
                                    body: [
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; font-size: 3rem; font-weight: bold; color: #52c41a;">156</div>'
                                        },
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; color: #666; margin-top: 8px;">ä¸ªé¢†åŸŸæ¨¡å‹</div>'
                                        }
                                    ]
                                }
                            },
                            {
                                md: 3,
                                body: {
                                    type: 'card',
                                    header: { title: 'âš¡ èšåˆæ ¹' },
                                    body: [
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; font-size: 3rem; font-weight: bold; color: #fa8c16;">89</div>'
                                        },
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; color: #666; margin-top: 8px;">ä¸ªèšåˆæ ¹</div>'
                                        }
                                    ]
                                }
                            },
                            {
                                md: 3,
                                body: {
                                    type: 'card',
                                    header: { title: 'ğŸ’ å€¼å¯¹è±¡' },
                                    body: [
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; font-size: 3rem; font-weight: bold; color: #722ed1;">234</div>'
                                        },
                                        {
                                            type: 'tpl',
                                            tpl: '<div style="text-align: center; color: #666; margin-top: 8px;">ä¸ªå€¼å¯¹è±¡</div>'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'divider'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                md: 6,
                                body: {
                                    type: 'card',
                                    header: { title: 'ğŸ“ˆ é¡¹ç›®æ´»è·ƒåº¦è¶‹åŠ¿' },
                                    body: {
                                        type: 'tpl',
                                        tpl: '<div style="height: 200px; background: linear-gradient(45deg, #f0f9ff, #e0f2fe); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #0369a1; font-size: 16px;">ğŸ“Š å›¾è¡¨å ä½ç¬¦</div>'
                                    }
                                }
                            },
                            {
                                md: 6,
                                body: {
                                    type: 'card',
                                    header: { title: 'ğŸ† æœ€è¿‘æ›´æ–°' },
                                    body: [
                                        {
                                            type: 'list',
                                            source: [
                                                { title: 'ç”¨æˆ·ç®¡ç†æ¨¡å—', time: '2å°æ—¶å‰', status: 'å·²å®Œæˆ' },
                                                { title: 'è®¢å•èšåˆæ ¹', time: '4å°æ—¶å‰', status: 'è¿›è¡Œä¸­' },
                                                { title: 'æ”¯ä»˜é¢†åŸŸæœåŠ¡', time: '1å¤©å‰', status: 'å·²å®Œæˆ' }
                                            ],
                                            listItem: {
                                                body: [
                                                    {
                                                        type: 'flex',
                                                        justify: 'space-between',
                                                        alignItems: 'center',
                                                        items: [
                                                            {
                                                                type: 'tpl',
                                                                tpl: '<strong>${title}</strong>'
                                                            },
                                                            {
                                                                type: 'status',
                                                                map: {
                                                                    'å·²å®Œæˆ': 'success',
                                                                    'è¿›è¡Œä¸­': 'warning'
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        type: 'tpl',
                                                        tpl: '<small style="color: #999;">${time}</small>'
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                ]
            };
            
            renderSchema(schema);
        }
        
        function loadForm() {
            const schema = {
                type: 'page',
                title: 'ğŸ“ DDDå®ä½“é…ç½®è¡¨å•',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'è¯·å¡«å†™é¢†åŸŸå®ä½“çš„åŸºæœ¬ä¿¡æ¯'
                    },
                    {
                        type: 'form',
                        api: 'http://localhost:7001/api/entity/save',
                        body: [
                            {
                                type: 'input-text',
                                name: 'name',
                                label: 'å®ä½“åç§°',
                                required: true,
                                placeholder: 'è¯·è¾“å…¥å®ä½“åç§°ï¼Œå¦‚ï¼šUser'
                            },
                            {
                                type: 'textarea',
                                name: 'description',
                                label: 'å®ä½“æè¿°',
                                placeholder: 'è¯·æè¿°è¯¥å®ä½“çš„ä¸šåŠ¡å«ä¹‰'
                            },
                            {
                                type: 'select',
                                name: 'type',
                                label: 'å®ä½“ç±»å‹',
                                options: [
                                    { label: 'èšåˆæ ¹', value: 'aggregate-root' },
                                    { label: 'å®ä½“', value: 'entity' },
                                    { label: 'å€¼å¯¹è±¡', value: 'value-object' }
                                ],
                                value: 'entity'
                            },
                            {
                                type: 'input-text',
                                name: 'package',
                                label: 'åŒ…è·¯å¾„',
                                placeholder: 'com.example.domain.model'
                            },
                            {
                                type: 'switch',
                                name: 'enabled',
                                label: 'æ˜¯å¦å¯ç”¨',
                                value: true
                            }
                        ],
                        actions: [
                            {
                                type: 'button',
                                actionType: 'submit',
                                label: 'ä¿å­˜é…ç½®',
                                level: 'primary'
                            },
                            {
                                type: 'button',
                                actionType: 'reset',
                                label: 'é‡ç½®'
                            }
                        ]
                    }
                ]
            };
            
            renderSchema(schema);
        }
        
        function loadTable() {
            const schema = {
                type: 'page',
                title: 'ğŸ“‹ DDDå®ä½“åˆ—è¡¨',
                body: [
                    {
                        type: 'crud',
                        api: 'http://localhost:7001/api/entities',
                        columns: [
                            {
                                name: 'id',
                                label: 'ID',
                                type: 'text'
                            },
                            {
                                name: 'name',
                                label: 'å®ä½“åç§°',
                                type: 'text'
                            },
                            {
                                name: 'type',
                                label: 'ç±»å‹',
                                type: 'mapping',
                                map: {
                                    'aggregate-root': '<span class="label label-info">èšåˆæ ¹</span>',
                                    'entity': '<span class="label label-success">å®ä½“</span>',
                                    'value-object': '<span class="label label-warning">å€¼å¯¹è±¡</span>'
                                }
                            },
                            {
                                name: 'description',
                                label: 'æè¿°',
                                type: 'text'
                            },
                            {
                                name: 'enabled',
                                label: 'çŠ¶æ€',
                                type: 'status'
                            },
                            {
                                type: 'operation',
                                label: 'æ“ä½œ',
                                buttons: [
                                    {
                                        type: 'button',
                                        label: 'ç¼–è¾‘',
                                        level: 'link'
                                    },
                                    {
                                        type: 'button',
                                        label: 'åˆ é™¤',
                                        level: 'link',
                                        className: 'text-danger'
                                    }
                                ]
                            }
                        ],
                        data: {
                            items: [
                                {
                                    id: 1,
                                    name: 'User',
                                    type: 'aggregate-root',
                                    description: 'ç”¨æˆ·èšåˆæ ¹',
                                    enabled: 1
                                },
                                {
                                    id: 2,
                                    name: 'Order',
                                    type: 'aggregate-root',
                                    description: 'è®¢å•èšåˆæ ¹',
                                    enabled: 1
                                },
                                {
                                    id: 3,
                                    name: 'Address',
                                    type: 'value-object',
                                    description: 'åœ°å€å€¼å¯¹è±¡',
                                    enabled: 1
                                }
                            ],
                            total: 3
                        }
                    }
                ]
            };
            
            renderSchema(schema);
        }
        
        async function connectBackend() {
            try {
                showStatus('æ­£åœ¨è¿æ¥åç«¯...', 'success');
                
                const response = await fetch('http://localhost:7001/amis/dashboard');
                if (response.ok) {
                    const data = await response.json();
                    showStatus('åç«¯è¿æ¥æˆåŠŸï¼æ•°æ®å·²åŠ è½½', 'success');
                    
                    if (data.schema) {
                        renderSchema(data.schema);
                    }
                } else {
                    showStatus('åç«¯æœåŠ¡æœªå¯åŠ¨ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'error');
                }
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showStatus('æ— æ³•è¿æ¥åç«¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºæ¬¢è¿é¡µé¢
        window.onload = function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼ŒAMISç‰ˆæœ¬:', window.amis?.version || 'æœªçŸ¥');
            
            const welcomeSchema = {
                type: 'page',
                body: [
                    {
                        type: 'container',
                        style: {
                            textAlign: 'center',
                            padding: '60px 20px',
                            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            color: '#fff',
                            borderRadius: '12px'
                        },
                        body: [
                            {
                                type: 'tpl',
                                tpl: '<h1 style="margin-bottom: 20px; font-size: 2.5rem;">ğŸ¨ DDDå¹³å°å¯è§†åŒ–ç¼–è¾‘å™¨</h1>'
                            },
                            {
                                type: 'tpl',
                                tpl: '<p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px;">åŸºäºAMISçš„é¢†åŸŸé©±åŠ¨è®¾è®¡å¯è§†åŒ–å·¥å…·</p>'
                            },
                            {
                                type: 'tpl',
                                tpl: '<p style="opacity: 0.8;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ä½“éªŒä¸åŒçš„é¡µé¢ç±»å‹</p>'
                            }
                        ]
                    }
                ]
            };
            
            renderSchema(welcomeSchema);
            showStatus('ç¼–è¾‘å™¨åŠ è½½å®Œæˆï¼', 'success');
        };
    </script>
</body>
</html>
