<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDDå¹³å° - ç®€æ˜“ç¼–è¾‘å™¨</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e8e8e8;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .header .actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn:hover {
            border-color: #40a9ff;
            color: #40a9ff;
        }

        .btn.primary {
            background: #1890ff;
            border-color: #1890ff;
            color: #fff;
        }

        .btn.primary:hover {
            background: #40a9ff;
        }

        .container {
            height: calc(100vh - 65px);
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: #fff;
            border-right: 1px solid #e8e8e8;
            padding: 20px;
            overflow-y: auto;
        }

        .content {
            flex: 1;
            background: #fff;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .property-panel {
            width: 280px;
            background: #fff;
            border-left: 1px solid #e8e8e8;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .property-panel.active {
            display: block;
        }

        .component-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .component-item:hover {
            background: #e9ecef;
            border-color: #1890ff;
        }

        .schema-editor {
            width: 100%;
            height: 200px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            margin-top: 10px;
        }

        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }

        .status.show {
            opacity: 1;
            transform: translateX(0);
        }

        .status.success {
            background: #52c41a;
        }

        .status.error {
            background: #ff4d4f;
        }

        .page-content {
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .component-btn {
            display: block;
            width: 100%;
            padding: 4px 8px;
            margin: 2px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .component-btn:hover {
            background: #f0f8ff;
            border-color: #1890ff;
        }

        #loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #666;
            font-size: 14px;
        }

        /* æ‹–æ‹½ç›¸å…³æ ·å¼ */
        .drag-placeholder {
            border: 2px dashed #1890ff;
            background: rgba(24, 144, 255, 0.1);
            min-height: 40px;
            margin: 4px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1890ff;
            font-size: 12px;
            border-radius: 4px;
        }

        .drag-over {
            background: rgba(24, 144, 255, 0.2);
            border-color: #1890ff;
        }

        .component-item[draggable="true"] {
            cursor: grab;
        }

        .component-item[draggable="true"]:active {
            cursor: grabbing;
        }

        .component-editable.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .drop-zone {
            min-height: 100px;
            border: 2px dashed transparent;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .drop-zone.drag-over {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.1);
        }

        .drop-zone:empty::before {
            content: 'æ‹–æ‹½ç»„ä»¶åˆ°æ­¤å¤„';
            color: #999;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 80px;
        }

        /* è¡¨å•æ„å»ºå™¨æ ·å¼ */
        .form-builder-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
        }

        .form-builder-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-builder-modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            height: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .form-builder-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-builder-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #666;
        }

        .form-builder-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .form-builder-sidebar {
            width: 250px;
            border-right: 1px solid #e8e8e8;
            padding: 16px;
            overflow-y: auto;
        }

        .form-builder-sidebar h4 {
            margin: 0 0 12px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .field-types {
            margin-bottom: 24px;
        }

        .field-type {
            padding: 8px 12px;
            margin: 4px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: grab;
            font-size: 14px;
            transition: all 0.2s;
        }

        .field-type:hover {
            background: #e9ecef;
            border-color: #1890ff;
        }

        .field-type:active {
            cursor: grabbing;
        }

        .validation-rules {
            margin-bottom: 16px;
        }

        .rule-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rule-item label {
            font-size: 13px;
            cursor: pointer;
        }

        .rule-value {
            width: 60px;
            padding: 2px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }

        .form-builder-main {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .form-preview {
            min-height: 400px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 16px;
        }

        .form-drop-zone {
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-drop-zone.drag-over {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.1);
            color: #1890ff;
        }

        .form-field {
            margin: 12px 0;
            padding: 12px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            background: white;
            transition: all 0.2s;
        }

        .form-field:hover {
            border-color: #1890ff;
        }

        .form-field.selected {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .field-header label {
            font-weight: 600;
            color: #333;
        }

        .field-actions {
            display: flex;
            gap: 4px;
        }

        .field-btn {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
        }

        .field-btn:hover {
            background: #f0f0f0;
        }

        .field-content input,
        .field-content textarea,
        .field-content select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-builder-properties {
            width: 280px;
            border-left: 1px solid #e8e8e8;
            padding: 16px;
            overflow-y: auto;
        }

        .form-builder-properties h4 {
            margin: 0 0 16px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .property-group {
            margin-bottom: 16px;
        }

        .property-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .property-group input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
        }

        .property-actions {
            margin-top: 20px;
        }

        .form-builder-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .code-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 4000;
        }

        .code-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .code-modal {
            background: white;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80%;
            display: flex;
            flex-direction: column;
        }

        .code-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-body {
            padding: 20px;
            flex: 1;
            overflow: auto;
        }

        .code-footer {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            text-align: right;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1890ff;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* å±æ€§æ£€æŸ¥å™¨æ ·å¼ */
        .property-inspector {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 350px;
            height: calc(100vh - 20px);
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .property-inspector.show {
            display: flex;
        }

        .inspector-header {
            padding: 16px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inspector-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
        }

        .inspector-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .inspector-section {
            margin-bottom: 20px;
        }

        .inspector-section h4 {
            margin: 0 0 12px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #eee;
            padding-bottom: 6px;
        }

        .property-item {
            margin-bottom: 12px;
        }

        .property-item label {
            display: block;
            margin-bottom: 4px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .property-item input,
        .property-item select,
        .property-item textarea {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 13px;
        }

        .property-item textarea {
            min-height: 60px;
            resize: vertical;
        }

        .property-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .property-checkbox input {
            width: auto;
        }

        .property-tabs {
            display: flex;
            border-bottom: 1px solid #e8e8e8;
            margin-bottom: 16px;
        }

        .property-tab {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 13px;
            color: #666;
        }

        .property-tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
        }

        .property-tab:hover {
            color: #1890ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .json-editor {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            min-height: 120px;
            font-size: 12px;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-preview {
            width: 24px;
            height: 24px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .binding-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 8px;
            margin: 4px 0;
        }

        .binding-item h5 {
            margin: 0 0 6px;
            font-size: 12px;
            color: #666;
        }

        .binding-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .mini-btn {
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 3px;
            background: white;
            cursor: pointer;
        }

        .mini-btn:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        /* ä»£ç ç”Ÿæˆå™¨æ ·å¼ */
        .code-generator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3500;
            display: none;
        }

        .code-generator.show {
            display: flex;
        }

        .generator-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .generator-modal {
            background: white;
            border-radius: 12px;
            width: 95%;
            height: 95%;
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
        }

        .generator-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .generator-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .generator-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .generator-sidebar {
            width: 280px;
            border-right: 1px solid #e8e8e8;
            background: #fafafa;
            overflow-y: auto;
        }

        .generator-config {
            padding: 20px;
        }

        .config-section {
            margin-bottom: 24px;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .config-section h4 {
            margin: 0 0 16px;
            color: #333;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 8px;
        }

        .config-item {
            margin-bottom: 12px;
        }

        .config-item label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .config-item select,
        .config-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .config-item select:focus,
        .config-item input:focus {
            border-color: #1890ff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .generator-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .generator-tabs {
            display: flex;
            border-bottom: 1px solid #e8e8e8;
            background: #f8f9fa;
        }

        .generator-tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }

        .generator-tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
            background: white;
        }

        .generator-tab:hover {
            color: #1890ff;
            background: #f0f0f0;
        }

        .generator-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .code-output {
            flex: 1;
            overflow: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            min-height: 400px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            border-radius: 8px;
            padding: 20px;
            resize: none;
        }

        .generation-options {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            background: white;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .generate-btn {
            background: linear-gradient(135deg, #52c41a 0%, #73d13d 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(82, 196, 26, 0.3);
        }

        .validation-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 900px;
            height: 80%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
            z-index: 4000;
            display: none;
            flex-direction: column;
        }

        .validation-panel.show {
            display: flex;
        }

        .validation-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .validation-body {
            flex: 1;
            overflow: auto;
            padding: 24px;
        }

        .validation-result {
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #52c41a;
            background: #f6ffed;
        }

        .validation-result.error {
            border-left-color: #ff4d4f;
            background: #fff2f0;
        }

        .validation-result.warning {
            border-left-color: #faad14;
            background: #fffbe6;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .result-message {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .validation-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .grid {
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .alert {
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }

        .alert.info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }

        .alert.success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }

        .stat-card {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* æ–°å¢ç»„ä»¶æ ·å¼ */
        .panel-card { border-left: 4px solid #1890ff; }
        .service-card { background: #f8f9fa; }
        .action-button .btn { 
            width: 100%; margin: 4px 0; padding: 8px 16px; 
            border: none; border-radius: 4px; cursor: pointer; 
        }
        .action-button .btn.primary { background: #1890ff; color: white; }
        .action-button .btn.info { background: #13c2c2; color: white; }
        .action-button .btn.success { background: #52c41a; color: white; }
        .action-button .btn.warning { background: #faad14; color: white; }
        .property-list { background: #fafafa; padding: 16px; border-radius: 6px; }
        .list-container { margin: 8px 0; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; }
        .badge-success { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .badge-default { background: #fafafa; color: #666; border: 1px solid #d9d9d9; }
        .badge-warning { background: #fffbe6; color: #faad14; border: 1px solid #ffe58f; }
        .chart-card { min-height: 400px; }

        /* å®æ—¶é¢„è§ˆå¢å¼ºæ ·å¼ */
        .component-editable {
            position: relative;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .component-editable:hover {
            border-color: #1890ff;
            cursor: pointer;
        }

        .component-editable.selected {
            border-color: #1890ff;
            background: rgba(24, 144, 255, 0.05);
        }

        .component-toolbar {
            position: absolute;
            top: -30px;
            right: 0;
            display: none;
            background: #1890ff;
            border-radius: 4px;
            padding: 4px;
            z-index: 1000;
        }

        .component-editable:hover .component-toolbar,
        .component-editable.selected .component-toolbar {
            display: flex;
        }

        .toolbar-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 4px 8px;
            margin: 0 2px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 12px;
        }

        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .property-form {
            margin-bottom: 16px;
        }

        .property-form label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #333;
        }

        .property-form input,
        .property-form select,
        .property-form textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ DDDå¹³å°ç®€æ˜“ç¼–è¾‘å™¨</h1>
        <div class="actions">
            <button class="btn" onclick="loadDashboard()">ğŸ“Š ä»ªè¡¨æ¿</button>
            <button class="btn" onclick="loadForm()">ğŸ“ è¡¨å•æ¨¡æ¿</button>
            <button class="btn" onclick="loadCrudTemplate()">ğŸ”§ CRUDæ¨¡æ¿</button>
            <button class="btn" onclick="openFormBuilder()">ğŸ—ï¸ è¡¨å•æ„å»ºå™¨</button>
            <button class="btn" onclick="openPropertyInspector()">ğŸ”§ å±æ€§æ£€æŸ¥å™¨</button>
            <button class="btn" onclick="exportSchema()">ğŸ“¤ å¯¼å‡ºSchema</button>
            <button class="btn" onclick="openImportDialog()">ğŸ“¥ å¯¼å…¥Schema</button>
            <button class="btn" onclick="openCodeGenerator()">âš™ï¸ ä»£ç ç”Ÿæˆå™¨</button>
            <button class="btn" onclick="openValidationPanel()">âœ… æ¨¡å‹éªŒè¯</button>
            <button class="btn" onclick="togglePropertyPanel()">âš™ï¸ å±æ€§é¢æ¿</button>
            <button class="btn" onclick="clearContent()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <button class="btn primary" onclick="connectBackend()">ğŸ”Œ è¿æ¥åç«¯</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h3>ğŸ“¦ ç»„ä»¶åº“</h3>
            
            <!-- å¿«é€Ÿæ·»åŠ å·¥å…·æ  -->
            <div class="component-toolbar-main" style="margin-bottom: 16px; padding: 8px; background: #f9f9f9; border-radius: 4px;">
                <!-- è¿™é‡Œå°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
            </div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">åŸºç¡€ç»„ä»¶</h4>
            <div class="component-item" draggable="true" data-component-type="alert" onclick="addAlert()">âš ï¸ æç¤ºæ¡†</div>
            <div class="component-item" draggable="true" data-component-type="card" onclick="addCard()">ğŸ“„ å¡ç‰‡</div>
            <div class="component-item" draggable="true" data-component-type="stat" onclick="addStatCard()">ğŸ“Š ç»Ÿè®¡å¡ç‰‡</div>
            <div class="component-item" draggable="true" data-component-type="grid" onclick="addGrid()">ğŸ“ ç½‘æ ¼å¸ƒå±€</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">è¡¨å•ç»„ä»¶</h4>
            <div class="component-item" draggable="true" data-component-type="form" onclick="addForm()">ğŸ“ è¡¨å•</div>
            <div class="component-item" draggable="true" data-component-type="input-text" onclick="addInputText()">ğŸ”¤ æ–‡æœ¬è¾“å…¥</div>
            <div class="component-item" draggable="true" data-component-type="textarea" onclick="addTextarea()">ğŸ“ å¤šè¡Œæ–‡æœ¬</div>
            <div class="component-item" draggable="true" data-component-type="select" onclick="addSelect()">ğŸ“‹ ä¸‹æ‹‰é€‰æ‹©</div>
            <div class="component-item" draggable="true" data-component-type="date-picker" onclick="addDatePicker()">ğŸ“… æ—¥æœŸé€‰æ‹©å™¨</div>
            <div class="component-item" draggable="true" data-component-type="upload" onclick="addUpload()">ğŸ“ æ–‡ä»¶ä¸Šä¼ </div>
            <div class="component-item" draggable="true" data-component-type="rich-text" onclick="addRichText()">ğŸ“ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</div>
            <div class="component-item" draggable="true" data-component-type="cascader" onclick="addCascader()">ğŸ“‚ çº§è”é€‰æ‹©å™¨</div>
            <div class="component-item" draggable="true" data-component-type="number" onclick="addNumberInput()">ğŸ”¢ æ•°å­—è¾“å…¥</div>
            <div class="component-item" draggable="true" data-component-type="switch" onclick="addSwitch()">ğŸ”˜ å¼€å…³</div>
            <div class="component-item" draggable="true" data-component-type="checkbox" onclick="addCheckbox()">â˜‘ï¸ å¤é€‰æ¡†</div>
            <div class="component-item" draggable="true" data-component-type="radio" onclick="addRadio()">ğŸ”˜ å•é€‰æ¡†</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">æ•°æ®ç»„ä»¶</h4>
            <div class="component-item" draggable="true" data-component-type="table" onclick="addTable()">ğŸ“‹ æ•°æ®è¡¨æ ¼</div>
            <div class="component-item" draggable="true" data-component-type="crud" onclick="addCrud()">ğŸ”§ CRUDç®¡ç†</div>
            <div class="component-item" draggable="true" data-component-type="tree" onclick="addTree()">ğŸŒ³ æ ‘å½¢ç»“æ„</div>
            <div class="component-item" draggable="true" data-component-type="timeline" onclick="addTimeline()">â° æ—¶é—´è½´</div>
            <div class="component-item" draggable="true" data-component-type="list" onclick="addList()">ğŸ“„ åˆ—è¡¨</div>
            <div class="component-item" draggable="true" data-component-type="pagination" onclick="addPagination()">ğŸ“– åˆ†é¡µå™¨</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">å±•ç¤ºç»„ä»¶</h4>
            <div class="component-item" draggable="true" data-component-type="tag" onclick="addTag()">ğŸ·ï¸ æ ‡ç­¾</div>
            <div class="component-item" draggable="true" data-component-type="progress" onclick="addProgress()">ğŸ“Š è¿›åº¦æ¡</div>
            <div class="component-item" draggable="true" data-component-type="image" onclick="addImage()">ğŸ–¼ï¸ å›¾ç‰‡</div>
            <div class="component-item" draggable="true" data-component-type="divider" onclick="addDivider()">â– åˆ†å‰²çº¿</div>
            <div class="component-item" draggable="true" data-component-type="status" onclick="addStatus()">ğŸŸ¢ çŠ¶æ€æ ‡è¯†</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">äº¤äº’ç»„ä»¶</h4>
            <div class="component-item" draggable="true" data-component-type="button" onclick="addButton()">ğŸ”˜ æŒ‰é’®</div>
            <div class="component-item" draggable="true" data-component-type="button-group" onclick="addButtonGroup()">ğŸ”˜ æŒ‰é’®ç»„</div>
            <div class="component-item" draggable="true" data-component-type="dropdown-button" onclick="addDropdownButton()">ğŸ“¥ ä¸‹æ‹‰æŒ‰é’®</div>
            <div class="component-item" draggable="true" data-component-type="tabs" onclick="addTabs()">ğŸ“‚ æ ‡ç­¾é¡µ</div>
            <div class="component-item" draggable="true" data-component-type="collapse" onclick="addCollapse()">ğŸ“ æŠ˜å é¢æ¿</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">ğŸ¯ å®Œæ•´CRUDç¤ºä¾‹</h4>
            <div class="component-item" onclick="loadUserManagementDemo()" style="background: #fff0f6; border: 2px solid #f759ab; font-weight: bold;">ğŸ”¥ ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</div>
            <div class="component-item" onclick="loadProjectManagementDemo()" style="background: #f0f9ff; border: 1px solid #69c0ff;">ğŸ“‚ é¡¹ç›®ç®¡ç†ç³»ç»Ÿ</div>
            <div class="component-item" onclick="loadOrderManagementDemo()" style="background: #fcffe6; border: 1px solid #95de64;">ğŸ“‹ è®¢å•ç®¡ç†ç³»ç»Ÿ</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">ğŸ”¥ DDDå±å¹•ç”Ÿæˆå™¨</h4>
            <div class="component-item" onclick="generateListScreen()" style="background: #e6f7ff; border: 1px solid #91d5ff;">ğŸ“„ åˆ—è¡¨å±å¹•</div>
            <div class="component-item" onclick="generateDetailScreen()" style="background: #f6ffed; border: 1px solid #b7eb8f;">ğŸ‘ï¸ è¯¦æƒ…å±å¹•</div>
            <div class="component-item" onclick="generateEditScreen()" style="background: #fff2e8; border: 1px solid #ffd591;">âœï¸ ç¼–è¾‘å±å¹•</div>
            <div class="component-item" onclick="generateDashboardScreen()" style="background: #f9f0ff; border: 1px solid #d3adf7;">ğŸ“Š ä»ªè¡¨æ¿å±å¹•</div>
            <div class="component-item" onclick="generateWorkflowScreen()" style="background: #fff1f0; border: 1px solid #ffa39e;">ğŸ”„ å·¥ä½œæµå±å¹•</div>
            
            <h4 style="margin: 16px 0 8px; color: #666; font-size: 12px;">DDDæ¨¡æ¿</h4>
            <div class="component-item" onclick="loadTemplate('entity-management')">ğŸ—ï¸ å®ä½“ç®¡ç†</div>
            <div class="component-item" onclick="loadTemplate('domain-design')">ğŸ¨ é¢†åŸŸè®¾è®¡</div>
            <div class="component-item" onclick="loadTemplate('project-overview')">ğŸ“Š é¡¹ç›®æ¦‚è§ˆ</div>
            <div class="component-item" onclick="loadTemplate('entity-configuration')">ğŸ“ å®ä½“é…ç½®</div>
            <div class="component-item" onclick="loadTemplate('model-analysis')">ğŸ“Š æ¨¡å‹åˆ†æ</div>
            
            <h3 style="margin-top: 20px;">âš™ï¸ Schemaç¼–è¾‘å™¨</h3>
            <textarea id="schema-editor" class="schema-editor" placeholder="åœ¨æ­¤æŸ¥çœ‹å’Œç¼–è¾‘JSON Schema..."></textarea>
            <button class="btn" onclick="applySchema()" style="width: 100%; margin-top: 10px;">ğŸ”„ åº”ç”¨Schema</button>
        </div>

        <div class="content" id="content">
            <div class="drop-zone" id="main-drop-zone">
                <div class="page-content">
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 12px;">
                            <h1 style="margin-bottom: 20px; font-size: 2.5rem;">ğŸ¨ DDDå¹³å°å¯è§†åŒ–ç¼–è¾‘å™¨</h1>
                        <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px;">ç®€æ˜“ç‰ˆæœ¬ï¼Œä¸“æ³¨äºé¡µé¢å¸ƒå±€å’Œç»„ä»¶ç®¡ç†</p>
                        <p style="opacity: 0.8;">ç‚¹å‡»å·¦ä¾§ç»„ä»¶åº“å¼€å§‹æ„å»ºä½ çš„é¡µé¢</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="property-panel" id="property-panel">
            <h3>âš™ï¸ å±æ€§ç¼–è¾‘</h3>
            <div id="property-content">
                <p style="color: #666; text-align: center; margin-top: 40px;">é€‰æ‹©ä¸€ä¸ªç»„ä»¶æ¥ç¼–è¾‘å…¶å±æ€§</p>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script>
        let currentSchema = {
            type: 'page',
            title: 'DDDå¹³å° - é¢†åŸŸé©±åŠ¨è®¾è®¡ç¼–è¾‘å™¨',
            body: [
                {
                    type: 'tpl',
                    tpl: `<div style="text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; margin-bottom: 20px;">
                        <h1 style="margin: 0 0 10px 0; font-size: 28px;">ğŸ—ï¸ DDDå¹³å°æ¬¢è¿æ‚¨</h1>
                        <p style="margin: 0; font-size: 16px; opacity: 0.9;">Domain-Driven Design é¢†åŸŸé©±åŠ¨è®¾è®¡å¯è§†åŒ–ç¼–è¾‘å™¨</p>
                        <p style="margin: 10px 0 0 0; font-size: 14px; opacity: 0.8;">ä½¿ç”¨å·¦ä¾§å·¥å…·æ æ·»åŠ DDDç»„ä»¶ï¼Œæ„å»ºæ‚¨çš„é¢†åŸŸæ¨¡å‹</p>
                    </div>`
                },
                {
                    type: 'grid',
                    columns: [
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: 'ğŸ—ï¸ å®ä½“ç®¡ç†', subTitle: 'Entity Management' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>ç®¡ç†æ‚¨çš„é¢†åŸŸå®ä½“ã€èšåˆæ ¹å’Œå€¼å¯¹è±¡</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>å®šä¹‰å®ä½“å±æ€§</li>
                                        <li>è®¾ç½®ä¸šåŠ¡è§„åˆ™</li>
                                        <li>ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
                                    </ul>`
                                }
                            }
                        },
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: 'âš™ï¸ æœåŠ¡ç¼–æ’', subTitle: 'Service Orchestration' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>è®¾è®¡å’Œç®¡ç†é¢†åŸŸæœåŠ¡</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>åº”ç”¨æœåŠ¡</li>
                                        <li>é¢†åŸŸæœåŠ¡</li>
                                        <li>åŸºç¡€è®¾æ–½æœåŠ¡</li>
                                    </ul>`
                                }
                            }
                        },
                        {
                            md: 4,
                            body: {
                                type: 'card',
                                header: { title: 'ğŸ—ƒï¸ ä»“å‚¨æ¨¡å¼', subTitle: 'Repository Pattern' },
                                body: {
                                    type: 'tpl',
                                    tpl: `<p>æ•°æ®è®¿é—®å±‚æŠ½è±¡</p>
                                    <ul style="margin: 10px 0; padding-left: 20px;">
                                        <li>æ¥å£å®šä¹‰</li>
                                        <li>å®ç°åˆ†ç¦»</li>
                                        <li>æµ‹è¯•å‹å¥½</li>
                                    </ul>`
                                }
                            }
                        }
                    ]
                },
                {
                    type: 'divider',
                    style: { margin: '20px 0' }
                },
                {
                    type: 'tpl',
                    tpl: `<div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #28a745;">
                        <h3 style="margin: 0 0 10px 0; color: #495057;">ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                        <p style="margin: 0; color: #6c757d;">ç‚¹å‡»å·¦ä¾§å·¥å…·æ ä¸­çš„DDDç»„ä»¶å¼€å§‹æ„å»ºæ‚¨çš„é¢†åŸŸæ¨¡å‹ï¼Œæˆ–ä½¿ç”¨é¡¶éƒ¨èœå•å¯¼å…¥ç°æœ‰çš„Schemaé…ç½®ã€‚</p>
                    </div>`
                }
            ]
        };

        // å®æ—¶é¢„è§ˆå¢å¼ºå˜é‡
        let selectedComponent = null;
        let selectedComponentIndex = -1;
        let componentCounter = 0;

        // ç»„ä»¶å±æ€§æ£€æŸ¥å™¨åŠŸèƒ½
        let propertyInspectorVisible = false;
        let currentInspectedComponent = null;
        let componentBindings = new Map(); // å­˜å‚¨ç»„ä»¶æ•°æ®ç»‘å®šä¿¡æ¯

        // åˆ›å»ºå¸¦é€‰é¡¹çš„selectå…ƒç´  - è¾…åŠ©å‡½æ•°
        function createSelectWithOptions(options, id) {
            const select = document.createElement('select');
            select.id = id;
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.text;
                if (option.selected) {
                    optionElement.selected = true;
                }
                select.appendChild(optionElement);
            });
            
            return select;
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type} show`;
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // æ›´æ–°Schemaç¼–è¾‘å™¨
        function updateSchemaEditor() {
            document.getElementById('schema-editor').value = JSON.stringify(currentSchema, null, 2);
        }

        // ä½¿ç»„ä»¶å¯ç¼–è¾‘
        function makeComponentEditable(element, componentData, index) {
            element.classList.add('component-editable');
            element.setAttribute('data-component-index', index);
            
            // æ·»åŠ å·¥å…·æ 
            const toolbar = document.createElement('div');
            toolbar.className = 'component-toolbar';
            toolbar.innerHTML = `
                <button class="toolbar-btn" title="ç¼–è¾‘">âœï¸</button>
                <button class="toolbar-btn" title="åˆ é™¤">ğŸ—‘ï¸</button>
                <button class="toolbar-btn" title="ä¸Šç§»">â¬†ï¸</button>
                <button class="toolbar-btn" title="ä¸‹ç§»">â¬‡ï¸</button>
            `;
            
            // ç»‘å®šå·¥å…·æ äº‹ä»¶
            const buttons = toolbar.querySelectorAll('.toolbar-btn');
            buttons[0].onclick = (e) => { e.stopPropagation(); selectComponent(element, componentData, index); };
            buttons[1].onclick = (e) => { e.stopPropagation(); deleteComponent(index); };
            buttons[2].onclick = (e) => { e.stopPropagation(); moveComponent(index, -1); };
            buttons[3].onclick = (e) => { e.stopPropagation(); moveComponent(index, 1); };
            
            element.style.position = 'relative';
            element.appendChild(toolbar);
            
            // ç‚¹å‡»é€‰æ‹©
            element.addEventListener('click', (e) => {
                e.stopPropagation();
                selectComponent(element, componentData, index);
            });
        }

        // æ·»åŠ æ–°ç»„ä»¶
        function addComponent(type) {
            const newComponent = createComponentTemplate(type);
            currentSchema.body = currentSchema.body || [];
            currentSchema.body.push(newComponent);
            renderContent();
            showStatus(`å·²æ·»åŠ ${type}ç»„ä»¶`, 'success');
        }

        // è·å–æ‰€æœ‰ç»„ä»¶æ–¹æ³•
        function getAllComponents() {
            const allComponents = [];
            
            function traverseSchema(schema, path = '') {
                if (schema && typeof schema === 'object') {
                    if (schema.type) {
                        allComponents.push({
                            type: schema.type,
                            name: schema.name || schema.title || schema.label,
                            path: path,
                            schema: schema
                        });
                    }
                    
                    // é€’å½’éå†å­ç»„ä»¶
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach((item, index) => {
                                traverseSchema(item, `${path}.body[${index}]`);
                            });
                        } else {
                            traverseSchema(schema.body, `${path}.body`);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach((item, index) => {
                            traverseSchema(item, `${path}.columns[${index}]`);
                        });
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return allComponents;
        }

        // è·å–æ‰€æœ‰å®ä½“
        function getAllEntities() {
            const entities = [];
            
            function traverseSchema(schema) {
                if (schema && typeof schema === 'object') {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯å®ä½“ç»„ä»¶
                    if (schema.type === 'card' && schema.header && schema.header.title && 
                        (schema.header.title.includes('å®ä½“') || schema.header.title.includes('Entity'))) {
                        const formBody = schema.body && schema.body.body;
                        if (formBody && Array.isArray(formBody)) {
                            const nameField = formBody.find(field => field.name === 'name');
                            const typeField = formBody.find(field => field.name === 'type');
                            if (nameField) {
                                entities.push({
                                    name: nameField.value || 'æœªå‘½åå®ä½“',
                                    type: typeField ? typeField.value : 'entity',
                                    schema: schema
                                });
                            }
                        }
                    }
                    
                    // é€’å½’éå†
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach(item => traverseSchema(item));
                        } else {
                            traverseSchema(schema.body);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach(item => traverseSchema(item));
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return entities;
        }

        // è·å–æ‰€æœ‰æœåŠ¡
        function getAllServices() {
            const services = [];
            
            function traverseSchema(schema) {
                if (schema && typeof schema === 'object') {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯æœåŠ¡ç»„ä»¶
                    if (schema.type === 'card' && schema.header && schema.header.title && 
                        (schema.header.title.includes('æœåŠ¡') || schema.header.title.includes('Service'))) {
                        const formBody = schema.body && schema.body.body;
                        if (formBody && Array.isArray(formBody)) {
                            const nameField = formBody.find(field => field.name === 'serviceName');
                            const typeField = formBody.find(field => field.name === 'serviceType');
                            if (nameField) {
                                services.push({
                                    name: nameField.value || 'æœªå‘½åæœåŠ¡',
                                    type: typeField ? typeField.value : 'domain_service',
                                    schema: schema
                                });
                            }
                        }
                    }
                    
                    // é€’å½’éå†
                    if (schema.body) {
                        if (Array.isArray(schema.body)) {
                            schema.body.forEach(item => traverseSchema(item));
                        } else {
                            traverseSchema(schema.body);
                        }
                    }
                    
                    if (schema.columns && Array.isArray(schema.columns)) {
                        schema.columns.forEach(item => traverseSchema(item));
                    }
                }
            }
            
            traverseSchema(currentSchema);
            return services;
        }

        // åˆ›å»ºå®ä½“é€‰æ‹©å™¨å¯¹è¯æ¡†
        function showEntitySelector(callback, fieldName) {
            const entities = getAllEntities();
            
            if (entities.length === 0) {
                showStatus('å½“å‰é¡µé¢æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å®ä½“ç»„ä»¶ï¼Œè¯·å…ˆæ·»åŠ å®ä½“ç»„ä»¶', 'warning');
                return;
            }
            
            const entitiesHtml = entities.map((entity, index) => `
                <div class="entity-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectEntity(${index})">
                    <div style="font-weight: bold; color: #1890ff; margin-bottom: 4px;">${entity.name}</div>
                    <div style="color: #666; font-size: 12px;">ç±»å‹: ${entity.type === 'aggregate_root' ? 'èšåˆæ ¹' : entity.type === 'entity' ? 'å®ä½“' : 'å€¼å¯¹è±¡'}</div>
                </div>
            `).join('');
            
            const modalHtml = `
                <div class="entity-selector-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #1890ff;">ğŸ¯ é€‰æ‹©å…³è”å®ä½“</h3>
                            <button onclick="closeEntitySelector()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <input type="text" placeholder="æœç´¢å®ä½“..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeyup="filterEntities(this.value)">
                        </div>
                        <div id="entitiesContainer">
                            ${entitiesHtml}
                        </div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // å­˜å‚¨å›è°ƒå‡½æ•°å’Œå­—æ®µå
            window.entitySelectorCallback = callback;
            window.currentFieldName = fieldName;
            window.availableEntities = entities;
        }

        // é€‰æ‹©å®ä½“
        function selectEntity(index) {
            const entity = window.availableEntities[index];
            if (window.entitySelectorCallback) {
                window.entitySelectorCallback(entity);
            } else if (window.currentFieldName) {
                // åå¤‡æ–¹æ¡ˆï¼šç›´æ¥è®¾ç½®å­—æ®µå€¼
                const input = document.querySelector(`[name="${window.currentFieldName}"]`);
                if (input) {
                    if (input.tagName === 'TEXTAREA' && window.currentFieldName === 'childEntities') {
                        // å¯¹äºå­å®ä½“åˆ—è¡¨ï¼Œè¿½åŠ è€Œä¸æ˜¯æ›¿æ¢
                        const current = input.value || '';
                        const newValue = current ? current + '\n' + entity.name : entity.name;
                        input.value = newValue;
                    } else {
                        input.value = entity.name;
                    }
                }
            }
            closeEntitySelector();
        }

        // å…³é—­å®ä½“é€‰æ‹©å™¨
        function closeEntitySelector() {
            const modal = document.querySelector('.entity-selector-modal');
            if (modal) {
                modal.remove();
            }
            delete window.entitySelectorCallback;
            delete window.currentFieldName;
            delete window.availableEntities;
        }

        // è¿‡æ»¤å®ä½“
        function filterEntities(keyword) {
            const entities = document.querySelectorAll('.entity-item');
            entities.forEach(entity => {
                const name = entity.querySelector('div').textContent.toLowerCase();
                if (name.includes(keyword.toLowerCase())) {
                    entity.style.display = 'block';
                } else {
                    entity.style.display = 'none';
                }
            });
        }

        // åˆ›å»ºæœåŠ¡é€‰æ‹©å™¨å¯¹è¯æ¡†
        function showServiceSelector(callback) {
            const services = getAllServices();
            
            if (services.length === 0) {
                showStatus('å½“å‰é¡µé¢æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœåŠ¡ç»„ä»¶ï¼Œè¯·å…ˆæ·»åŠ æœåŠ¡ç»„ä»¶', 'warning');
                return;
            }
            
            const servicesHtml = services.map((service, index) => `
                <div class="service-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectService(${index})">
                    <div style="font-weight: bold; color: #52c41a; margin-bottom: 4px;">${service.name}</div>
                    <div style="color: #666; font-size: 12px;">ç±»å‹: ${service.type === 'application_service' ? 'åº”ç”¨æœåŠ¡' : service.type === 'domain_service' ? 'é¢†åŸŸæœåŠ¡' : 'åŸºç¡€è®¾æ–½æœåŠ¡'}</div>
                </div>
            `).join('');
            
            const modalHtml = `
                <div class="service-selector-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0; color: #52c41a;">âš™ï¸ é€‰æ‹©å…³è”æœåŠ¡</h3>
                            <button onclick="closeServiceSelector()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <input type="text" placeholder="æœç´¢æœåŠ¡..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeyup="filterServices(this.value)">
                        </div>
                        <div id="servicesContainer">
                            ${servicesHtml}
                        </div>
                    </div>
                </div>
            `;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // å­˜å‚¨å›è°ƒå‡½æ•°
            window.serviceSelectorCallback = callback;
            window.availableServices = services;
        }

        // é€‰æ‹©æœåŠ¡
        function selectService(index) {
            const service = window.availableServices[index];
            if (window.serviceSelectorCallback) {
                window.serviceSelectorCallback(service);
            }
            closeServiceSelector();
        }

        // å…³é—­æœåŠ¡é€‰æ‹©å™¨
        function closeServiceSelector() {
            const modal = document.querySelector('.service-selector-modal');
            if (modal) {
                modal.remove();
            }
            delete window.serviceSelectorCallback;
            delete window.availableServices;
        }

        // è¿‡æ»¤æœåŠ¡
        function filterServices(keyword) {
            const services = document.querySelectorAll('.service-item');
            services.forEach(service => {
                const name = service.querySelector('div').textContent.toLowerCase();
                if (name.includes(keyword.toLowerCase())) {
                    service.style.display = 'block';
                } else {
                    service.style.display = 'none';
                }
            });
        }

        // ç®€åŒ–çš„é€‰æ‹©å™¨è°ƒç”¨å‡½æ•°
        function selectEntityForField(fieldName) {
            showEntitySelector(null, fieldName);
        }

        function selectEntityForRepository() {
            selectEntityForField('entityType');
        }

        function selectEntityForService() {
            selectEntityForField('dependentEntities');
        }

        function selectEntityForAggregateRoot() {
            selectEntityForField('rootEntity');
        }

        function addEntityToAggregate() {
            selectEntityForField('childEntities');
        }

        // åˆ›å»ºç»„ä»¶æ¨¡æ¿
        function createComponentTemplate(type) {
            const templates = {
                // DDDæ ¸å¿ƒç»„ä»¶
                'entity': {
                    type: 'card',
                    header: { title: 'å®ä½“ - Entity', subTitle: 'DDDæ ¸å¿ƒä¸šåŠ¡å¯¹è±¡' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'name', label: 'å®ä½“åç§°', required: true },
                            { type: 'textarea', name: 'description', label: 'å®ä½“æè¿°', rows: 3 },
                            { type: 'select', name: 'type', label: 'å®ä½“ç±»å‹', options: [
                                { label: 'èšåˆæ ¹', value: 'aggregate_root' },
                                { label: 'å®ä½“', value: 'entity' },
                                { label: 'å€¼å¯¹è±¡', value: 'value_object' }
                            ]}
                        ]
                    }
                },
                'service': {
                    type: 'card',
                    header: { title: 'é¢†åŸŸæœåŠ¡ - Domain Service', subTitle: 'DDDä¸šåŠ¡é€»è¾‘æœåŠ¡' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'serviceName', label: 'æœåŠ¡åç§°', required: true },
                            { type: 'textarea', name: 'description', label: 'æœåŠ¡æè¿°', rows: 3 },
                            { type: 'select', name: 'serviceType', label: 'æœåŠ¡ç±»å‹', options: [
                                { label: 'åº”ç”¨æœåŠ¡', value: 'application_service' },
                                { label: 'é¢†åŸŸæœåŠ¡', value: 'domain_service' },
                                { label: 'åŸºç¡€è®¾æ–½æœåŠ¡', value: 'infrastructure_service' }
                            ]},
                            { 
                                type: 'group',
                                label: 'ä¾èµ–å®ä½“',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'dependentEntities', 
                                        placeholder: 'ç‚¹å‡»é€‰æ‹©æŒ‰é’®é€‰æ‹©ä¾èµ–çš„å®ä½“',
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: 'é€‰æ‹©å®ä½“', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForService()'
                                    }
                                ]
                            }
                        ]
                    }
                },
                'repository': {
                    type: 'card',
                    header: { title: 'ä»“å‚¨ - Repository', subTitle: 'DDDæ•°æ®è®¿é—®æŠ½è±¡' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'repositoryName', label: 'ä»“å‚¨åç§°', required: true },
                            { 
                                type: 'group',
                                label: 'å…³è”å®ä½“',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'entityType', 
                                        placeholder: 'ç‚¹å‡»é€‰æ‹©å®ä½“æŒ‰é’®é€‰æ‹©å…³è”çš„å®ä½“',
                                        required: true,
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: 'é€‰æ‹©å®ä½“', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForRepository()'
                                    }
                                ]
                            },
                            { type: 'textarea', name: 'methods', label: 'ä»“å‚¨æ–¹æ³•', rows: 4, placeholder: 'å¦‚ï¼šfindById, save, delete ç­‰' }
                        ]
                    }
                },
                'aggregate': {
                    type: 'card',
                    header: { title: 'èšåˆæ ¹ - Aggregate Root', subTitle: 'DDDèšåˆè¾¹ç•Œå®šä¹‰' },
                    body: {
                        type: 'form',
                        mode: 'horizontal',
                        body: [
                            { type: 'input-text', name: 'aggregateName', label: 'èšåˆåç§°', required: true },
                            { type: 'textarea', name: 'description', label: 'èšåˆæè¿°', rows: 3 },
                            { 
                                type: 'group',
                                label: 'èšåˆæ ¹å®ä½“',
                                body: [
                                    { 
                                        type: 'input-text', 
                                        name: 'rootEntity', 
                                        placeholder: 'ç‚¹å‡»é€‰æ‹©æŒ‰é’®é€‰æ‹©èšåˆæ ¹å®ä½“',
                                        required: true,
                                        readOnly: true
                                    },
                                    { 
                                        type: 'button', 
                                        label: 'é€‰æ‹©èšåˆæ ¹', 
                                        level: 'primary',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:selectEntityForAggregateRoot()'
                                    }
                                ]
                            },
                            { 
                                type: 'group',
                                label: 'åŒ…å«å®ä½“',
                                body: [
                                    { 
                                        type: 'textarea', 
                                        name: 'childEntities', 
                                        placeholder: 'èšåˆå†…çš„å­å®ä½“åˆ—è¡¨ï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰',
                                        rows: 3
                                    },
                                    { 
                                        type: 'button', 
                                        label: 'æ·»åŠ å®ä½“', 
                                        level: 'info',
                                        size: 'sm',
                                        actionType: 'url',
                                        url: 'javascript:addEntityToAggregate()'
                                    }
                                ]
                            },
                            { type: 'textarea', name: 'businessRules', label: 'ä¸šåŠ¡è§„åˆ™', rows: 3, placeholder: 'æè¿°èšåˆçš„ä¸šåŠ¡ä¸å˜é‡å’Œè§„åˆ™' }
                        ]
                    }
                },
                'form': {
                    type: 'form',
                    title: 'æ–°å»ºè¡¨å•',
                    mode: 'horizontal',
                    body: [
                        { type: 'input-text', name: 'name', label: 'åç§°', required: true },
                        { type: 'textarea', name: 'description', label: 'æè¿°', rows: 3 }
                    ],
                    actions: [
                        { type: 'submit', label: 'æäº¤', level: 'primary' },
                        { type: 'reset', label: 'é‡ç½®' }
                    ]
                },
                'crud': {
                    type: 'crud',
                    api: '/api/sample',
                    syncLocation: false,
                    title: 'CRUDæ•°æ®ç®¡ç†',
                    headerToolbar: [
                        { type: 'button', label: 'æ–°å¢', actionType: 'dialog', level: 'primary' }
                    ],
                    columns: [
                        { name: 'id', label: 'ID', sortable: true },
                        { name: 'name', label: 'åç§°', searchable: true },
                        { name: 'status', label: 'çŠ¶æ€', type: 'status' },
                        { name: 'createTime', label: 'åˆ›å»ºæ—¶é—´', type: 'datetime' },
                        { type: 'operation', label: 'æ“ä½œ', buttons: [
                            { label: 'ç¼–è¾‘', level: 'link' },
                            { label: 'åˆ é™¤', level: 'link', className: 'text-danger' }
                        ]}
                    ]
                },
                'table': {
                    type: 'table',
                    title: 'æ•°æ®è¡¨æ ¼',
                    data: {
                        items: [
                            { id: 1, name: 'ç¤ºä¾‹æ•°æ®1', status: 'æ­£å¸¸', createTime: '2024-01-01 10:00:00' },
                            { id: 2, name: 'ç¤ºä¾‹æ•°æ®2', status: 'å¼‚å¸¸', createTime: '2024-01-02 11:00:00' }
                        ]
                    },
                    columns: [
                        { name: 'id', label: 'ID' },
                        { name: 'name', label: 'åç§°' },
                        { name: 'status', label: 'çŠ¶æ€', type: 'status' },
                        { name: 'createTime', label: 'åˆ›å»ºæ—¶é—´' }
                    ]
                },
                'chart': {
                    type: 'chart',
                    title: 'å›¾è¡¨ç»Ÿè®¡',
                    api: '/api/chart',
                    config: {
                        type: 'line',
                        data: {
                            labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                            datasets: [{
                                label: 'æ•°æ®è¶‹åŠ¿',
                                data: [12, 19, 3, 5, 2, 3],
                                borderColor: 'rgb(75, 192, 192)',
                                tension: 0.1
                            }]
                        }
                    }
                },
                'tpl': {
                    type: 'tpl',
                    tpl: '<div class="alert alert-info">æ¨¡æ¿å†…å®¹ï¼š<strong>${title | default: "é»˜è®¤æ ‡é¢˜"}</strong><br>æè¿°ï¼š${description | default: "æš‚æ— æè¿°"}</div>'
                },
                'input-text': {
                    type: 'input-text',
                    name: 'textInput',
                    label: 'æ–‡æœ¬è¾“å…¥',
                    placeholder: 'è¯·è¾“å…¥æ–‡æœ¬'
                },
                'textarea': {
                    type: 'textarea',
                    name: 'textareaInput',
                    label: 'å¤šè¡Œæ–‡æœ¬',
                    placeholder: 'è¯·è¾“å…¥å¤šè¡Œæ–‡æœ¬'
                },
                'select': {
                    type: 'select',
                    name: 'selectInput',
                    label: 'é€‰æ‹©å™¨',
                    options: [
                        { label: 'é€‰é¡¹1', value: 'option1' },
                        { label: 'é€‰é¡¹2', value: 'option2' }
                    ]
                },
                'button': {
                    type: 'button',
                    label: 'æŒ‰é’®',
                    level: 'primary'
                },
                'divider': {
                    type: 'divider'
                }
            };
            
            return templates[type] || { type: type, label: 'æœªçŸ¥ç»„ä»¶' };
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(message = 'æ­£åœ¨åŠ è½½...') {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv) {
                loadingDiv.querySelector('.loading-text').textContent = message;
                loadingDiv.style.display = 'flex';
            }
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            try {
                showLoading('åˆå§‹åŒ–ç¼–è¾‘å™¨...');
                
                // è®¾ç½®é»˜è®¤Schema
                if (!currentSchema.body) {
                    currentSchema.body = [];
                }
                
                // åˆå§‹åŒ–ç»„ä»¶å·¥å…·æ 
                initializeComponentToolbar();
                
                // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
                initializeDragAndDrop();
                
                // æ¸²æŸ“å†…å®¹
                renderContent();
                
                hideLoading();
                showStatus('ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                hideLoading();
                showStatus('åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åˆå§‹åŒ–ç»„ä»¶å·¥å…·æ 
        function initializeComponentToolbar() {
            const toolbar = document.querySelector('.component-toolbar-main');
            if (!toolbar) return;
            
            const components = [
                // DDDæ ¸å¿ƒç»„ä»¶
                { type: 'entity', label: 'å®ä½“', icon: 'ğŸ—ï¸', category: 'DDDæ ¸å¿ƒ' },
                { type: 'aggregate', label: 'èšåˆæ ¹', icon: 'ğŸ¯', category: 'DDDæ ¸å¿ƒ' },
                { type: 'service', label: 'é¢†åŸŸæœåŠ¡', icon: 'âš™ï¸', category: 'DDDæ ¸å¿ƒ' },
                { type: 'repository', label: 'ä»“å‚¨', icon: 'ï¿½ï¸', category: 'DDDæ ¸å¿ƒ' },
                
                // ç•Œé¢ç»„ä»¶
                { type: 'form', label: 'è¡¨å•', icon: 'ğŸ“', category: 'ç•Œé¢ç»„ä»¶' },
                { type: 'crud', label: 'CRUD', icon: 'ğŸ“Š', category: 'ç•Œé¢ç»„ä»¶' },
                { type: 'table', label: 'è¡¨æ ¼', icon: 'ğŸ“‹', category: 'ç•Œé¢ç»„ä»¶' },
                { type: 'chart', label: 'å›¾è¡¨', icon: 'ï¿½', category: 'ç•Œé¢ç»„ä»¶' },
                
                // è¾“å…¥ç»„ä»¶
                { type: 'input-text', label: 'æ–‡æœ¬æ¡†', icon: 'âœï¸', category: 'è¾“å…¥ç»„ä»¶' },
                { type: 'textarea', label: 'æ–‡æœ¬åŸŸ', icon: 'ğŸ“', category: 'è¾“å…¥ç»„ä»¶' },
                { type: 'select', label: 'é€‰æ‹©å™¨', icon: 'ğŸ“‹', category: 'è¾“å…¥ç»„ä»¶' },
                { type: 'button', label: 'æŒ‰é’®', icon: 'ğŸ”˜', category: 'è¾“å…¥ç»„ä»¶' },
                
                // å¸ƒå±€ç»„ä»¶
                { type: 'tpl', label: 'æ¨¡æ¿', icon: 'ğŸ“„', category: 'å¸ƒå±€ç»„ä»¶' },
                { type: 'divider', label: 'åˆ†å‰²çº¿', icon: 'â–', category: 'å¸ƒå±€ç»„ä»¶' }
            ];
            
            // æŒ‰åˆ†ç±»ç»„ç»‡ç»„ä»¶
            const categories = {};
            components.forEach(comp => {
                if (!categories[comp.category]) {
                    categories[comp.category] = [];
                }
                categories[comp.category].push(comp);
            });
            
            let toolbarHTML = '';
            Object.keys(categories).forEach(category => {
                toolbarHTML += `<div style="margin-bottom: 12px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 6px; font-weight: bold;">${category}</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">`;
                
                categories[category].forEach(comp => {
                    toolbarHTML += `<button class="component-btn" onclick="addComponent('${comp.type}')" title="æ·»åŠ ${comp.label}" 
                        style="padding: 4px 8px; margin: 0; font-size: 12px; min-width: auto;">
                        ${comp.icon} ${comp.label}
                    </button>`;
                });
                
                toolbarHTML += '</div></div>';
            });
            
            toolbar.innerHTML = toolbarHTML;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);

        // æ‹–æ‹½åŠŸèƒ½ç›¸å…³
        let draggedElement = null;
        let draggedComponentType = null;

        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        function initializeDragAndDrop() {
            // ä¸ºç»„ä»¶é¡¹æ·»åŠ æ‹–æ‹½äº‹ä»¶
            document.querySelectorAll('.component-item[draggable="true"]').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            // ä¸ºæ‹–æ‹½åŒºåŸŸæ·»åŠ äº‹ä»¶
            const dropZone = document.getElementById('main-drop-zone');
            if (dropZone) {
                dropZone.addEventListener('dragover', handleDragOver);
                dropZone.addEventListener('drop', handleDrop);
                dropZone.addEventListener('dragenter', handleDragEnter);
                dropZone.addEventListener('dragleave', handleDragLeave);
            }
        }

        // æ‹–æ‹½å¼€å§‹
        function handleDragStart(e) {
            draggedElement = e.target;
            draggedComponentType = e.target.getAttribute('data-component-type');
            e.target.classList.add('dragging');
            
            // è®¾ç½®æ‹–æ‹½æ•°æ®
            e.dataTransfer.setData('text/plain', draggedComponentType);
            e.dataTransfer.effectAllowed = 'copy';
        }

        // æ‹–æ‹½ç»“æŸ
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedElement = null;
            draggedComponentType = null;
        }

        // æ‹–æ‹½ç»è¿‡
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        }

        // æ‹–æ‹½è¿›å…¥
        function handleDragEnter(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        // æ‹–æ‹½ç¦»å¼€
        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        // æ‹–æ‹½æ”¾ç½®
        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const componentType = e.dataTransfer.getData('text/plain');
            if (componentType) {
                addComponent(componentType);
                showStatus(`å·²é€šè¿‡æ‹–æ‹½æ·»åŠ ${componentType}ç»„ä»¶`, 'success');
            }
        }

        // ç»„ä»¶å†…éƒ¨æ‹–æ‹½ï¼ˆé‡æ–°æ’åºï¼‰
        function enableComponentReordering() {
            const components = document.querySelectorAll('.component-editable');
            components.forEach(comp => {
                comp.draggable = true;
                comp.addEventListener('dragstart', handleComponentDragStart);
                comp.addEventListener('dragover', handleComponentDragOver);
                comp.addEventListener('drop', handleComponentDrop);
            });
        }

        // ç»„ä»¶æ‹–æ‹½å¼€å§‹
        function handleComponentDragStart(e) {
            e.dataTransfer.setData('text/component-index', e.target.getAttribute('data-component-index'));
            e.target.style.opacity = '0.5';
        }

        // ç»„ä»¶æ‹–æ‹½ç»è¿‡
        function handleComponentDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        // ç»„ä»¶æ‹–æ‹½æ”¾ç½®
        function handleComponentDrop(e) {
            e.preventDefault();
            e.target.style.opacity = '';
            
            const fromIndex = parseInt(e.dataTransfer.getData('text/component-index'));
            const toIndex = parseInt(e.target.getAttribute('data-component-index'));
            
            if (fromIndex !== toIndex && !isNaN(fromIndex) && !isNaN(toIndex)) {
                reorderComponents(fromIndex, toIndex);
            }
        }

        // è¡¨å•æ„å»ºå™¨åŠŸèƒ½
        function openFormBuilder() {
            showFormBuilderDialog();
        }

        // æ˜¾ç¤ºè¡¨å•æ„å»ºå™¨å¯¹è¯æ¡†
        function showFormBuilderDialog() {
            const dialog = document.createElement('div');
            dialog.className = 'form-builder-dialog';
            dialog.innerHTML = `
                <div class="form-builder-overlay">
                    <div class="form-builder-modal">
                        <div class="form-builder-header">
                            <h3>ğŸ—ï¸ é«˜çº§è¡¨å•æ„å»ºå™¨</h3>
                            <button class="close-btn" onclick="closeFormBuilder()">&times;</button>
                        </div>
                        <div class="form-builder-body">
                            <div class="form-builder-sidebar">
                                <h4>å­—æ®µç±»å‹</h4>
                                <div class="field-types">
                                    <div class="field-type" data-type="input-text">ğŸ“ æ–‡æœ¬è¾“å…¥</div>
                                    <div class="field-type" data-type="input-email">âœ‰ï¸ é‚®ç®±</div>
                                    <div class="field-type" data-type="input-password">ğŸ”’ å¯†ç </div>
                                    <div class="field-type" data-type="input-number">ğŸ”¢ æ•°å­—</div>
                                    <div class="field-type" data-type="textarea">ğŸ“„ å¤šè¡Œæ–‡æœ¬</div>
                                    <div class="field-type" data-type="select">ğŸ“‹ ä¸‹æ‹‰é€‰æ‹©</div>
                                    <div class="field-type" data-type="checkbox">â˜‘ï¸ å¤é€‰æ¡†</div>
                                    <div class="field-type" data-type="radio">ğŸ”˜ å•é€‰æ¡†</div>
                                    <div class="field-type" data-type="switch">ğŸ”€ å¼€å…³</div>
                                    <div class="field-type" data-type="date">ğŸ“… æ—¥æœŸ</div>
                                    <div class="field-type" data-type="datetime">â° æ—¥æœŸæ—¶é—´</div>
                                    <div class="field-type" data-type="file">ğŸ“ æ–‡ä»¶ä¸Šä¼ </div>
                                </div>
                                <h4>éªŒè¯è§„åˆ™</h4>
                                <div class="validation-rules">
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="required"> å¿…å¡«</label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="email"> é‚®ç®±æ ¼å¼</label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="phone"> æ‰‹æœºå·ç </label>
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="minLength"> æœ€å°é•¿åº¦</label>
                                        <input type="number" placeholder="é•¿åº¦" class="rule-value">
                                    </div>
                                    <div class="rule-item">
                                        <label><input type="checkbox" value="maxLength"> æœ€å¤§é•¿åº¦</label>
                                        <input type="number" placeholder="é•¿åº¦" class="rule-value">
                                    </div>
                                </div>
                            </div>
                            <div class="form-builder-main">
                                <div class="form-preview" id="form-preview">
                                    <div class="form-drop-zone">
                                        <p>æ‹–æ‹½å­—æ®µåˆ°æ­¤å¤„æ„å»ºè¡¨å•</p>
                                    </div>
                                </div>
                            </div>
                            <div class="form-builder-properties">
                                <h4>å­—æ®µå±æ€§</h4>
                                <div id="field-properties">
                                    <p>é€‰æ‹©ä¸€ä¸ªå­—æ®µæŸ¥çœ‹å±æ€§</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-builder-footer">
                            <button class="btn" onclick="previewForm()">ğŸ‘€ é¢„è§ˆè¡¨å•</button>
                            <button class="btn" onclick="generateFormCode()">ğŸ’¾ ç”Ÿæˆä»£ç </button>
                            <button class="btn primary" onclick="applyFormToEditor()">âœ… åº”ç”¨åˆ°ç¼–è¾‘å™¨</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            initializeFormBuilder();
        }

        // åˆå§‹åŒ–è¡¨å•æ„å»ºå™¨
        function initializeFormBuilder() {
            const fieldTypes = document.querySelectorAll('.field-type');
            const dropZone = document.querySelector('.form-drop-zone');
            
            // ä¸ºå­—æ®µç±»å‹æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            fieldTypes.forEach(fieldType => {
                fieldType.draggable = true;
                fieldType.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('field-type', e.target.getAttribute('data-type'));
                });
            });
            
            // ä¸ºæ”¾ç½®åŒºåŸŸæ·»åŠ æ‹–æ‹½æ¥æ”¶åŠŸèƒ½
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const fieldType = e.dataTransfer.getData('field-type');
                if (fieldType) {
                    addFieldToForm(fieldType);
                }
            });
        }

        // æ·»åŠ å­—æ®µåˆ°è¡¨å•
        function addFieldToForm(fieldType) {
            const formPreview = document.getElementById('form-preview');
            const fieldId = 'field_' + Date.now();
            
            const fieldConfig = getFieldConfig(fieldType);
            const fieldElement = createFieldElement(fieldId, fieldConfig);
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ¸…ç©ºæç¤ºæ–‡æœ¬
            const dropZone = formPreview.querySelector('.form-drop-zone');
            if (dropZone && dropZone.querySelector('p')) {
                dropZone.innerHTML = '';
            }
            
            formPreview.appendChild(fieldElement);
            
            // ä¸ºå­—æ®µæ·»åŠ ç‚¹å‡»é€‰æ‹©åŠŸèƒ½
            fieldElement.addEventListener('click', () => {
                selectFormField(fieldId, fieldConfig);
            });
        }

        // è·å–å­—æ®µé…ç½®
        function getFieldConfig(fieldType) {
            const configs = {
                'input-text': { label: 'æ–‡æœ¬è¾“å…¥', placeholder: 'è¯·è¾“å…¥æ–‡æœ¬', type: 'input-text' },
                'input-email': { label: 'é‚®ç®±', placeholder: 'è¯·è¾“å…¥é‚®ç®±', type: 'input-email' },
                'input-password': { label: 'å¯†ç ', placeholder: 'è¯·è¾“å…¥å¯†ç ', type: 'input-password' },
                'input-number': { label: 'æ•°å­—', placeholder: 'è¯·è¾“å…¥æ•°å­—', type: 'input-number' },
                'textarea': { label: 'å¤šè¡Œæ–‡æœ¬', placeholder: 'è¯·è¾“å…¥å†…å®¹', type: 'textarea', rows: 3 },
                'select': { label: 'ä¸‹æ‹‰é€‰æ‹©', type: 'select', options: [
                    { label: 'é€‰é¡¹1', value: 'option1' },
                    { label: 'é€‰é¡¹2', value: 'option2' }
                ]},
                'checkbox': { label: 'å¤é€‰æ¡†', type: 'checkbox' },
                'radio': { label: 'å•é€‰æ¡†', type: 'radio', options: [
                    { label: 'é€‰é¡¹1', value: 'option1' },
                    { label: 'é€‰é¡¹2', value: 'option2' }
                ]},
                'switch': { label: 'å¼€å…³', type: 'switch' },
                'date': { label: 'æ—¥æœŸ', type: 'input-date' },
                'datetime': { label: 'æ—¥æœŸæ—¶é—´', type: 'input-datetime' },
                'file': { label: 'æ–‡ä»¶ä¸Šä¼ ', type: 'input-file' }
            };
            
            return configs[fieldType] || configs['input-text'];
        }

        // åˆ›å»ºå­—æ®µå…ƒç´ 
        function createFieldElement(fieldId, config) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-field';
            fieldDiv.setAttribute('data-field-id', fieldId);
            
            fieldDiv.innerHTML = `
                <div class="field-header">
                    <label>${config.label}</label>
                    <div class="field-actions">
                        <button class="field-btn" onclick="editField('${fieldId}')" title="ç¼–è¾‘">âœï¸</button>
                        <button class="field-btn" onclick="deleteField('${fieldId}')" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="field-content">
                    ${renderFieldPreview(config)}
                </div>
            `;
            
            return fieldDiv;
        }

        // æ¸²æŸ“å­—æ®µé¢„è§ˆ
        function renderFieldPreview(config) {
            switch (config.type) {
                case 'input-text':
                case 'input-email':
                case 'input-password':
                case 'input-number':
                    return `<input type="${config.type.replace('input-', '')}" placeholder="${config.placeholder}" disabled>`;
                case 'textarea':
                    return `<textarea placeholder="${config.placeholder}" rows="${config.rows || 3}" disabled></textarea>`;
                case 'select':
                    const options = config.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('');
                    return `<select disabled>${options}</select>`;
                case 'checkbox':
                    return `<input type="checkbox" disabled> ${config.label}`;
                case 'radio':
                    return config.options.map(opt => 
                        `<label><input type="radio" name="radio_${Date.now()}" value="${opt.value}" disabled> ${opt.label}</label>`
                    ).join('<br>');
                case 'switch':
                    return `<label class="switch"><input type="checkbox" disabled><span class="slider"></span></label>`;
                case 'input-date':
                case 'input-datetime':
                    return `<input type="${config.type.replace('input-', '')}" disabled>`;
                case 'input-file':
                    return `<input type="file" disabled>`;
                default:
                    return `<input type="text" placeholder="${config.placeholder}" disabled>`;
            }
        }

        // é€‰æ‹©è¡¨å•å­—æ®µ
        function selectFormField(fieldId, config) {
            // ç§»é™¤å…¶ä»–å­—æ®µçš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.form-field').forEach(field => {
                field.classList.remove('selected');
            });
            
            // æ·»åŠ å½“å‰å­—æ®µçš„é€‰ä¸­çŠ¶æ€
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            fieldElement.classList.add('selected');
            
            // æ˜¾ç¤ºå­—æ®µå±æ€§
            showFieldProperties(fieldId, config);
        }

        // æ˜¾ç¤ºå­—æ®µå±æ€§
        function showFieldProperties(fieldId, config) {
            const propertiesPanel = document.getElementById('field-properties');
            
            // é¢„è®¡ç®—checkedçŠ¶æ€
            const checkedState = config.required ? ' checked="checked"' : '';
            
            propertiesPanel.innerHTML = `
                <div class="property-group">
                    <label>å­—æ®µåç§°</label>
                    <input type="text" id="field-name-${fieldId}" value="${config.name || ''}" placeholder="å­—æ®µåç§°">
                </div>
                <div class="property-group">
                    <label>æ ‡ç­¾æ–‡æœ¬</label>
                    <input type="text" id="field-label-${fieldId}" value="${config.label}" placeholder="æ ‡ç­¾æ–‡æœ¬">
                </div>
                <div class="property-group">
                    <label>å ä½ç¬¦</label>
                    <input type="text" id="field-placeholder-${fieldId}" value="${config.placeholder || ''}" placeholder="å ä½ç¬¦">
                </div>
                <div class="property-group">
                    <label><input type="checkbox" id="field-required-${fieldId}"${checkedState}> å¿…å¡«å­—æ®µ</label>
                </div>
                <div class="property-actions">
                    <button class="btn" onclick="updateFieldProperties('${fieldId}')">æ›´æ–°å±æ€§</button>
                </div>
            `;
        }

        // æ›´æ–°å­—æ®µå±æ€§
        function updateFieldProperties(fieldId) {
            const name = document.getElementById(`field-name-${fieldId}`).value;
            const label = document.getElementById(`field-label-${fieldId}`).value;
            const placeholder = document.getElementById(`field-placeholder-${fieldId}`).value;
            const required = document.getElementById(`field-required-${fieldId}`).checked;
            
            // æ›´æ–°å­—æ®µæ˜¾ç¤º
            const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
            const labelElement = fieldElement.querySelector('label');
            labelElement.textContent = label + (required ? ' *' : '');
            
            showStatus('å­—æ®µå±æ€§å·²æ›´æ–°', 'success');
        }

        // åˆ é™¤å­—æ®µ
        function deleteField(fieldId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­—æ®µå—ï¼Ÿ')) {
                const fieldElement = document.querySelector(`[data-field-id="${fieldId}"]`);
                fieldElement.remove();
                
                // æ¸…ç©ºå±æ€§é¢æ¿
                document.getElementById('field-properties').innerHTML = '<p>é€‰æ‹©ä¸€ä¸ªå­—æ®µæŸ¥çœ‹å±æ€§</p>';
                
                showStatus('å­—æ®µå·²åˆ é™¤', 'info');
            }
        }

        // ç”Ÿæˆè¡¨å•ä»£ç 
        function generateFormCode() {
            const fields = Array.from(document.querySelectorAll('.form-field')).map(fieldElement => {
                const fieldId = fieldElement.getAttribute('data-field-id');
                const label = fieldElement.querySelector('label').textContent.replace(' *', '');
                const type = fieldElement.querySelector('input, textarea, select').type || 'text';
                
                return {
                    type: type === 'text' ? 'input-text' : type,
                    name: fieldId,
                    label: label,
                    required: label.includes('*')
                };
            });
            
            const formSchema = {
                type: 'form',
                title: 'è‡ªå®šä¹‰è¡¨å•',
                body: fields
            };
            
            // æ˜¾ç¤ºç”Ÿæˆçš„ä»£ç 
            const codeDialog = document.createElement('div');
            codeDialog.className = 'code-dialog';
            codeDialog.innerHTML = `
                <div class="code-overlay">
                    <div class="code-modal">
                        <div class="code-header">
                            <h3>ç”Ÿæˆçš„è¡¨å•ä»£ç </h3>
                            <button onclick="this.closest('.code-dialog').remove()">&times;</button>
                        </div>
                        <div class="code-body">
                            <textarea readonly style="width: 100%; height: 300px; font-family: monospace;">${JSON.stringify(formSchema, null, 2)}</textarea>
                        </div>
                        <div class="code-footer">
                            <button class="btn" onclick="copyToClipboard(this)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(codeDialog);
        }

        // åº”ç”¨è¡¨å•åˆ°ç¼–è¾‘å™¨
        function applyFormToEditor() {
            const fields = Array.from(document.querySelectorAll('.form-field')).map(fieldElement => {
                const fieldId = fieldElement.getAttribute('data-field-id');
                const label = fieldElement.querySelector('label').textContent.replace(' *', '');
                const type = fieldElement.querySelector('input, textarea, select').type || 'text';
                
                return {
                    type: type === 'text' ? 'input-text' : type,
                    name: fieldId,
                    label: label,
                    required: label.includes('*')
                };
            });
            
            if (fields.length === 0) {
                showStatus('è¯·å…ˆæ·»åŠ å­—æ®µåˆ°è¡¨å•', 'error');
                return;
            }
            
            // ç”Ÿæˆå®Œæ•´çš„è¡¨å•Schema
            const formSchema = {
                type: 'form',
                title: 'è‡ªå®šä¹‰è¡¨å•',
                mode: 'horizontal',
                body: fields,
                actions: [
                    {
                        type: 'submit',
                        label: 'æäº¤',
                        level: 'primary'
                    },
                    {
                        type: 'reset',
                        label: 'é‡ç½®'
                    }
                ]
            };
            
            // æ·»åŠ åˆ°å½“å‰Schema
            currentSchema.body = currentSchema.body || [];
            currentSchema.body.push(formSchema);
            
            // å…³é—­è¡¨å•æ„å»ºå™¨
            closeFormBuilder();
            
            // é‡æ–°æ¸²æŸ“
            renderContent();
            
            showStatus('è¡¨å•å·²æ·»åŠ åˆ°ç¼–è¾‘å™¨', 'success');
        }

        // å…³é—­è¡¨å•æ„å»ºå™¨
        function closeFormBuilder() {
            const dialog = document.querySelector('.form-builder-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(button) {
            const textarea = button.closest('.code-modal').querySelector('textarea');
            textarea.select();
            document.execCommand('copy');
            showStatus('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        // å±æ€§æ£€æŸ¥å™¨åŠŸèƒ½
        function openPropertyInspector() {
            const inspector = document.getElementById('propertyInspector');
            inspector.classList.add('show');
            propertyInspectorVisible = true;
            
            if (selectedComponent) {
                loadComponentProperties(selectedComponent);
            } else {
                showStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç»„ä»¶', 'warning');
            }
        }

        function closePropertyInspector() {
            const inspector = document.getElementById('propertyInspector');
            inspector.classList.remove('show');
            propertyInspectorVisible = false;
        }

        function switchInspectorTab(tabElement, tabName) {
            // åˆ‡æ¢æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.property-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function loadComponentProperties(component) {
            currentInspectedComponent = component;
            
            // åŠ è½½åŸºç¡€å±æ€§
            document.getElementById('component-type').value = component.type || '';
            document.getElementById('component-name').value = component.name || '';
            document.getElementById('component-title').value = component.title || component.label || '';
            document.getElementById('component-description').value = component.description || '';
            
            // åŠ è½½æ˜¾ç¤ºæ§åˆ¶
            document.getElementById('component-visible').checked = component.visible !== false;
            document.getElementById('component-disabled').checked = component.disabled === true;
            document.getElementById('component-hidden').checked = component.hidden === true;
            
            // åŠ è½½æ ·å¼å±æ€§
            document.getElementById('component-class').value = component.className || '';
            document.getElementById('component-style').value = component.style ? JSON.stringify(component.style) : '';
            document.getElementById('component-width').value = component.width || '';
            document.getElementById('component-height').value = component.height || '';
            
            // åŠ è½½å¤–è§‚è®¾ç½®
            if (component.style) {
                document.getElementById('component-bg-color').value = component.style.backgroundColor || '#ffffff';
                document.getElementById('component-text-color').value = component.style.color || '#333333';
                document.getElementById('component-border').value = component.style.border || '';
                document.getElementById('component-radius').value = component.style.borderRadius || '';
            }
            
            // åŠ è½½æ•°æ®ç»‘å®š
            document.getElementById('component-api').value = component.api || '';
            document.getElementById('component-source').value = component.source || '';
            document.getElementById('component-data').value = component.data ? JSON.stringify(component.data) : '';
            
            // åŠ è½½äº‹ä»¶å¤„ç†
            document.getElementById('component-onclick').value = component.onClick || '';
            document.getElementById('component-ondblclick').value = component.onDoubleClick || '';
            document.getElementById('component-onhover').value = component.onHover || '';
            document.getElementById('component-onchange').value = component.onChange || '';
            document.getElementById('component-onfocus').value = component.onFocus || '';
            document.getElementById('component-onblur').value = component.onBlur || '';
            
            // åŠ è½½å­—æ®µç»‘å®š
            loadFieldBindings(component);
            
            showStatus('ç»„ä»¶å±æ€§å·²åŠ è½½', 'success');
        }

        function loadFieldBindings(component) {
            const bindingsContainer = document.getElementById('field-bindings');
            bindingsContainer.innerHTML = '';
            
            const bindings = componentBindings.get(component) || [];
            
            if (bindings.length === 0) {
                bindingsContainer.innerHTML = '<p style="color: #999; font-size: 13px;">æš‚æ— å­—æ®µç»‘å®š</p>';
                return;
            }
            
            bindings.forEach((binding, index) => {
                const bindingElement = document.createElement('div');
                bindingElement.className = 'binding-item';
                
                // é¢„å…ˆè®¡ç®—é€‰æ‹©çŠ¶æ€
                const textSelected = binding.type === 'text' ? ' selected="selected"' : '';
                const numberSelected = binding.type === 'number' ? ' selected="selected"' : '';
                const dateSelected = binding.type === 'date' ? ' selected="selected"' : '';
                const imageSelected = binding.type === 'image' ? ' selected="selected"' : '';
                const linkSelected = binding.type === 'link' ? ' selected="selected"' : '';
                
                bindingElement.innerHTML = `
                    <h5>ç»‘å®š ${index + 1}</h5>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <input type="text" placeholder="å­—æ®µå" value="${binding.field}" 
                               onchange="updateBinding(${index}, 'field', this.value)" style="flex: 1;">
                        <input type="text" placeholder="ç»‘å®šè·¯å¾„" value="${binding.path}" 
                               onchange="updateBinding(${index}, 'path', this.value)" style="flex: 1;">
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <select onchange="updateBinding(${index}, 'type', this.value)" style="flex: 1;">
                            <option value="text"${textSelected}>æ–‡æœ¬</option>
                            <option value="number"${numberSelected}>æ•°å­—</option>
                            <option value="date"${dateSelected}>æ—¥æœŸ</option>
                            <option value="image"${imageSelected}>å›¾ç‰‡</option>
                            <option value="link"${linkSelected}>é“¾æ¥</option>
                        </select>
                        <button class="mini-btn" onclick="removeBinding(${index})" style="color: #ff4d4f;">åˆ é™¤</button>
                    </div>
                `;
                bindingsContainer.appendChild(bindingElement);
            });
        }

        function addFieldBinding() {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            bindings.push({
                field: '',
                path: '',
                type: 'text'
            });
            componentBindings.set(currentInspectedComponent, bindings);
            
            loadFieldBindings(currentInspectedComponent);
        }

        function updateBinding(index, property, value) {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            if (bindings[index]) {
                bindings[index][property] = value;
                componentBindings.set(currentInspectedComponent, bindings);
            }
        }

        function removeBinding(index) {
            if (!currentInspectedComponent) return;
            
            const bindings = componentBindings.get(currentInspectedComponent) || [];
            bindings.splice(index, 1);
            componentBindings.set(currentInspectedComponent, bindings);
            
            loadFieldBindings(currentInspectedComponent);
        }

        function clearBindings() {
            if (!currentInspectedComponent) return;
            
            componentBindings.set(currentInspectedComponent, []);
            loadFieldBindings(currentInspectedComponent);
        }

        function applyInspectorChanges() {
            if (!currentInspectedComponent) {
                showStatus('æ²¡æœ‰é€‰ä¸­çš„ç»„ä»¶', 'error');
                return;
            }
            
            try {
                // åº”ç”¨åŸºç¡€å±æ€§
                currentInspectedComponent.name = document.getElementById('component-name').value;
                currentInspectedComponent.title = document.getElementById('component-title').value;
                currentInspectedComponent.description = document.getElementById('component-description').value;
                
                // åº”ç”¨æ˜¾ç¤ºæ§åˆ¶
                currentInspectedComponent.visible = document.getElementById('component-visible').checked;
                currentInspectedComponent.disabled = document.getElementById('component-disabled').checked;
                currentInspectedComponent.hidden = document.getElementById('component-hidden').checked;
                
                // åº”ç”¨æ ·å¼å±æ€§
                currentInspectedComponent.className = document.getElementById('component-class').value;
                
                const styleText = document.getElementById('component-style').value;
                if (styleText) {
                    try {
                        currentInspectedComponent.style = JSON.parse(styleText);
                    } catch (e) {
                        console.warn('æ ·å¼JSONæ ¼å¼é”™è¯¯:', e);
                    }
                } else {
                    currentInspectedComponent.style = {};
                }
                
                currentInspectedComponent.width = document.getElementById('component-width').value;
                currentInspectedComponent.height = document.getElementById('component-height').value;
                
                // åº”ç”¨å¤–è§‚è®¾ç½®
                if (!currentInspectedComponent.style) currentInspectedComponent.style = {};
                currentInspectedComponent.style.backgroundColor = document.getElementById('component-bg-color').value;
                currentInspectedComponent.style.color = document.getElementById('component-text-color').value;
                currentInspectedComponent.style.border = document.getElementById('component-border').value;
                currentInspectedComponent.style.borderRadius = document.getElementById('component-radius').value;
                
                // åº”ç”¨æ•°æ®ç»‘å®š
                currentInspectedComponent.api = document.getElementById('component-api').value;
                currentInspectedComponent.source = document.getElementById('component-source').value;
                
                const dataText = document.getElementById('component-data').value;
                if (dataText) {
                    try {
                        currentInspectedComponent.data = JSON.parse(dataText);
                    } catch (e) {
                        console.warn('æ•°æ®JSONæ ¼å¼é”™è¯¯:', e);
                    }
                }
                
                // åº”ç”¨äº‹ä»¶å¤„ç†
                currentInspectedComponent.onClick = document.getElementById('component-onclick').value;
                currentInspectedComponent.onDoubleClick = document.getElementById('component-ondblclick').value;
                currentInspectedComponent.onHover = document.getElementById('component-onhover').value;
                currentInspectedComponent.onChange = document.getElementById('component-onchange').value;
                currentInspectedComponent.onFocus = document.getElementById('component-onfocus').value;
                currentInspectedComponent.onBlur = document.getElementById('component-onblur').value;
                
                // é‡æ–°æ¸²æŸ“é¡µé¢
                renderContent();
                
                showStatus('ç»„ä»¶å±æ€§å·²åº”ç”¨', 'success');
            } catch (error) {
                console.error('åº”ç”¨å±æ€§å¤±è´¥:', error);
                showStatus('åº”ç”¨å±æ€§å¤±è´¥: ' + error.message, 'error');
            }
        }

        function resetInspectorProperties() {
            if (!currentInspectedComponent) return;
            
            // é‡ç½®ä¸ºé»˜è®¤å€¼
            const defaultComponent = getDefaultComponentProps(currentInspectedComponent.type);
            Object.assign(currentInspectedComponent, defaultComponent);
            
            // é‡æ–°åŠ è½½å±æ€§
            loadComponentProperties(currentInspectedComponent);
            
            // é‡æ–°æ¸²æŸ“
            renderContent();
            
            showStatus('ç»„ä»¶å±æ€§å·²é‡ç½®', 'success');
        }

        function getDefaultComponentProps(type) {
            const defaults = {
                'page': { type: 'page', title: 'é¡µé¢', body: [] },
                'card': { type: 'card', header: { title: 'å¡ç‰‡æ ‡é¢˜' }, body: 'å¡ç‰‡å†…å®¹' },
                'form': { type: 'form', title: 'è¡¨å•', body: [] },
                'input-text': { type: 'input-text', label: 'æ–‡æœ¬', name: 'text' },
                'textarea': { type: 'textarea', label: 'å¤šè¡Œæ–‡æœ¬', name: 'textarea' },
                'select': { type: 'select', label: 'é€‰æ‹©å™¨', name: 'select', options: [] },
                'table': { type: 'table', title: 'æ•°æ®è¡¨æ ¼', columns: [] },
                'alert': { type: 'alert', body: 'æç¤ºä¿¡æ¯', level: 'info' },
                'button': { type: 'button', label: 'æŒ‰é’®', actionType: 'button' },
                'crud': { type: 'crud', api: '/api/data', columns: [] }
            };
            return defaults[type] || { type: type };
        }

        // Schemaå¯¼å‡ºå¯¼å…¥åŠŸèƒ½
        let schemaVersions = JSON.parse(localStorage.getItem('ddd-schema-versions') || '[]');

        function exportSchema() {
            const exportData = {
                version: generateVersion(),
                timestamp: new Date().toISOString(),
                schema: currentSchema,
                metadata: {
                    title: currentSchema.title || 'æœªå‘½åé¡µé¢',
                    description: 'ç”±DDDå¹³å°ç¼–è¾‘å™¨ç”Ÿæˆ',
                    components: countComponents(currentSchema),
                    bindings: Array.from(componentBindings.entries())
                }
            };

            // ä¿å­˜åˆ°å†å²ç‰ˆæœ¬
            schemaVersions.unshift(exportData);
            if (schemaVersions.length > 10) {
                schemaVersions = schemaVersions.slice(0, 10);
            }
            localStorage.setItem('ddd-schema-versions', JSON.stringify(schemaVersions));

            // ä¸‹è½½JSONæ–‡ä»¶
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ddd-schema-${exportData.version}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showStatus(`Schemaå·²å¯¼å‡º (ç‰ˆæœ¬: ${exportData.version})`, 'success');
        }

        function generateVersion() {
            const now = new Date();
            return `v${now.getFullYear()}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')}-${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function countComponents(schema) {
            let count = 0;
            if (schema.body && Array.isArray(schema.body)) {
                count += schema.body.length;
                schema.body.forEach(component => {
                    if (component.body && Array.isArray(component.body)) {
                        count += countComponents(component);
                    }
                });
            }
            return count;
        }

        function openImportDialog() {
            const importDialog = document.createElement('div');
            importDialog.className = 'form-builder-dialog';
            importDialog.innerHTML = `
                <div class="form-builder-overlay">
                    <div class="form-builder-modal" style="height: 70%; max-width: 900px;">
                        <div class="form-builder-header">
                            <h3>ğŸ“¥ å¯¼å…¥Schema</h3>
                            <button class="close-btn" onclick="closeImportDialog()">Ã—</button>
                        </div>
                        <div class="form-builder-body" style="flex-direction: column;">
                            <div class="property-tabs">
                                <div class="property-tab active" onclick="switchImportTab(this, 'file')">æ–‡ä»¶å¯¼å…¥</div>
                                <div class="property-tab" onclick="switchImportTab(this, 'history')">å†å²ç‰ˆæœ¬</div>
                                <div class="property-tab" onclick="switchImportTab(this, 'template')">æ¨¡æ¿åº“</div>
                            </div>
                            
                            <!-- æ–‡ä»¶å¯¼å…¥ -->
                            <div class="tab-content active" id="import-file-tab" style="padding: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">é€‰æ‹©JSONæ–‡ä»¶</label>
                                    <input type="file" id="schema-file-input" accept=".json" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">æˆ–ç²˜è´´JSONå†…å®¹</label>
                                    <textarea id="schema-text-input" placeholder="åœ¨æ­¤ç²˜è´´Schema JSONå†…å®¹..." style="width: 100%; height: 200px; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 13px;"></textarea>
                                </div>
                                <div>
                                    <div class="property-checkbox">
                                        <input type="checkbox" id="merge-schema">
                                        <label for="merge-schema">åˆå¹¶åˆ°å½“å‰Schemaï¼ˆä¸é€‰æ‹©åˆ™æ›¿æ¢ï¼‰</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å†å²ç‰ˆæœ¬ -->
                            <div class="tab-content" id="import-history-tab" style="padding: 20px;">
                                <div id="version-list">
                                    <p style="color: #999;">åŠ è½½å†å²ç‰ˆæœ¬ä¸­...</p>
                                </div>
                            </div>
                            
                            <!-- æ¨¡æ¿åº“ -->
                            <div class="tab-content" id="import-template-tab" style="padding: 20px;">
                                <div id="template-list">
                                    <p style="color: #999;">åŠ è½½æ¨¡æ¿åº“ä¸­...</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-builder-footer">
                            <button class="btn" onclick="importSchema()" style="background: #52c41a; color: white;">å¯¼å…¥Schema</button>
                            <button class="btn" onclick="closeImportDialog()">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(importDialog);
            
            // åŠ è½½å†å²ç‰ˆæœ¬å’Œæ¨¡æ¿
            setTimeout(() => {
                loadVersionHistory();
                loadTemplateLibrary();
                setupFileInput();
            }, 100);
        }

        function switchImportTab(tabElement, tabName) {
            document.querySelectorAll('.property-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('import-' + tabName + '-tab').classList.add('active');
        }

        function setupFileInput() {
            const fileInput = document.getElementById('schema-file-input');
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('schema-text-input').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
        }

        function loadVersionHistory() {
            const versionList = document.getElementById('version-list');
            if (schemaVersions.length === 0) {
                versionList.innerHTML = '<p style="color: #999;">æš‚æ— å†å²ç‰ˆæœ¬</p>';
                return;
            }
            
            const versionsHtml = schemaVersions.map((version, index) => `
                <div class="version-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectVersion(${index})">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 6px;">
                        <strong style="color: #1890ff;">${version.version}</strong>
                        <span style="color: #999; font-size: 12px;">${new Date(version.timestamp).toLocaleString()}</span>
                    </div>
                    <div style="color: #666; font-size: 13px; margin-bottom: 4px;">${version.metadata.title}</div>
                    <div style="color: #999; font-size: 12px;">ç»„ä»¶æ•°é‡: ${version.metadata.components}</div>
                </div>
            `).join('');
            
            versionList.innerHTML = versionsHtml;
        }

        function loadTemplateLibrary() {
            const templateList = document.getElementById('template-list');
            const templates = [
                {
                    name: 'DDDç”¨æˆ·èšåˆ',
                    description: 'ç”¨æˆ·é¢†åŸŸèšåˆæ ¹è®¾è®¡ç¤ºä¾‹',
                    schema: {
                        type: 'page',
                        title: 'ç”¨æˆ·èšåˆ - User Aggregate',
                        body: [
                            {
                                type: 'card',
                                header: { title: 'ğŸ‘¤ ç”¨æˆ·èšåˆæ ¹', subTitle: 'User Aggregate Root' },
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    body: [
                                        { type: 'input-text', name: 'userId', label: 'ç”¨æˆ·ID', required: true, disabled: true },
                                        { type: 'input-text', name: 'username', label: 'ç”¨æˆ·å', required: true },
                                        { type: 'input-email', name: 'email', label: 'é‚®ç®±', required: true },
                                        { type: 'select', name: 'status', label: 'çŠ¶æ€', options: [
                                            { label: 'æ´»è·ƒ', value: 'active' },
                                            { label: 'ç¦ç”¨', value: 'disabled' },
                                            { label: 'å¾…æ¿€æ´»', value: 'pending' }
                                        ]},
                                        { type: 'datetime', name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´', disabled: true },
                                        { type: 'datetime', name: 'lastLoginAt', label: 'æœ€åç™»å½•', disabled: true }
                                    ]
                                }
                            },
                            {
                                type: 'card',
                                header: { title: 'ğŸ¯ ç”¨æˆ·è¡Œä¸ºäº‹ä»¶', subTitle: 'Domain Events' },
                                body: {
                                    type: 'table',
                                    data: {
                                        items: [
                                            { event: 'UserCreated', description: 'ç”¨æˆ·åˆ›å»ºäº‹ä»¶', status: 'å·²å¤„ç†' },
                                            { event: 'UserActivated', description: 'ç”¨æˆ·æ¿€æ´»äº‹ä»¶', status: 'å·²å¤„ç†' },
                                            { event: 'UserLoggedIn', description: 'ç”¨æˆ·ç™»å½•äº‹ä»¶', status: 'å·²å¤„ç†' }
                                        ]
                                    },
                                    columns: [
                                        { name: 'event', label: 'äº‹ä»¶ç±»å‹' },
                                        { name: 'description', label: 'äº‹ä»¶æè¿°' },
                                        { name: 'status', label: 'çŠ¶æ€', type: 'status' }
                                    ]
                                }
                            }
                        ]
                    }
                },
                {
                    name: 'DDDè®¢å•å¤„ç†',
                    description: 'è®¢å•é¢†åŸŸå®Œæ•´ä¸šåŠ¡æµç¨‹',
                    schema: {
                        type: 'page',
                        title: 'è®¢å•å¤„ç†ç³»ç»Ÿ',
                        body: [
                            {
                                type: 'grid',
                                columns: [
                                    {
                                        md: 6,
                                        body: {
                                            type: 'card',
                                            header: { title: 'ğŸ“‹ è®¢å•ä¿¡æ¯', subTitle: 'Order Entity' },
                                            body: {
                                                type: 'form',
                                                body: [
                                                    { type: 'input-text', name: 'orderId', label: 'è®¢å•ID', disabled: true },
                                                    { type: 'input-text', name: 'customerId', label: 'å®¢æˆ·ID', required: true },
                                                    { type: 'input-number', name: 'totalAmount', label: 'è®¢å•é‡‘é¢', required: true },
                                                    { type: 'select', name: 'status', label: 'è®¢å•çŠ¶æ€', options: [
                                                        { label: 'å¾…æ”¯ä»˜', value: 'pending' },
                                                        { label: 'å·²æ”¯ä»˜', value: 'paid' },
                                                        { label: 'å·²å‘è´§', value: 'shipped' },
                                                        { label: 'å·²å®Œæˆ', value: 'completed' },
                                                        { label: 'å·²å–æ¶ˆ', value: 'cancelled' }
                                                    ]}
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        md: 6,
                                        body: {
                                            type: 'card',
                                            header: { title: 'ğŸ›ï¸ è®¢å•æ˜ç»†', subTitle: 'Order Items' },
                                            body: {
                                                type: 'table',
                                                data: {
                                                    items: [
                                                        { productId: 'P001', productName: 'å•†å“A', quantity: 2, price: 99.99 },
                                                        { productId: 'P002', productName: 'å•†å“B', quantity: 1, price: 149.99 }
                                                    ]
                                                },
                                                columns: [
                                                    { name: 'productId', label: 'å•†å“ID' },
                                                    { name: 'productName', label: 'å•†å“åç§°' },
                                                    { name: 'quantity', label: 'æ•°é‡' },
                                                    { name: 'price', label: 'å•ä»·', type: 'number' }
                                                ]
                                            }
                                        }
                                    }
                                ]
                            },
                            {
                                type: 'card',
                                header: { title: 'âš™ï¸ è®¢å•æœåŠ¡', subTitle: 'Order Domain Services' },
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    body: [
                                        { type: 'input-text', name: 'serviceName', label: 'æœåŠ¡åç§°', value: 'OrderProcessingService' },
                                        { type: 'textarea', name: 'methods', label: 'æœåŠ¡æ–¹æ³•', rows: 4, value: 'createOrder()\nprocessPayment()\nshipOrder()\ncancelOrder()' },
                                        { type: 'input-text', name: 'repository', label: 'ä»“å‚¨æ¥å£', value: 'OrderRepository' }
                                    ]
                                }
                            }
                        ]
                    }
                },
                {
                    name: 'DDDåº“å­˜ç®¡ç†',
                    description: 'åº“å­˜é¢†åŸŸè¾¹ç•Œä¸Šä¸‹æ–‡',
                    schema: {
                        type: 'page',
                        title: 'åº“å­˜ç®¡ç†ç³»ç»Ÿ',
                        body: [
                            {
                                type: 'crud',
                                api: '/api/inventory',
                                title: 'åº“å­˜ç®¡ç†',
                                headerToolbar: [
                                    { type: 'button', label: 'å…¥åº“', actionType: 'dialog', level: 'primary' },
                                    { type: 'button', label: 'å‡ºåº“', actionType: 'dialog', level: 'warning' }
                                ],
                                columns: [
                                    { name: 'productId', label: 'å•†å“ID', sortable: true },
                                    { name: 'productName', label: 'å•†å“åç§°', searchable: true },
                                    { name: 'currentStock', label: 'å½“å‰åº“å­˜', type: 'number' },
                                    { name: 'reservedStock', label: 'é¢„å åº“å­˜', type: 'number' },
                                    { name: 'availableStock', label: 'å¯ç”¨åº“å­˜', type: 'number' },
                                    { name: 'minThreshold', label: 'æœ€ä½é˜ˆå€¼', type: 'number' },
                                    { name: 'status', label: 'çŠ¶æ€', type: 'status' },
                                    { type: 'operation', label: 'æ“ä½œ', buttons: [
                                        { label: 'è°ƒæ•´åº“å­˜', level: 'link' },
                                        { label: 'åº“å­˜æ˜ç»†', level: 'link' }
                                    ]}
                                ]
                            }
                        ]
                    }
                },
                {
                    name: 'DDDæ•°æ®ä»ªè¡¨æ¿',
                    description: 'é¢†åŸŸæ•°æ®ç»Ÿè®¡å’Œå¯è§†åŒ–',
                    schema: {
                        type: 'page',
                        title: 'DDDä¸šåŠ¡ä»ªè¡¨æ¿',
                        body: [
                            {
                                type: 'grid',
                                columns: [
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: 'æ€»å®ä½“æ•°',
                                            value: '156',
                                            description: 'ç³»ç»Ÿä¸­çš„é¢†åŸŸå®ä½“æ€»æ•°',
                                            trend: '12.5%',
                                            trendValue: '+20'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: 'æ´»è·ƒèšåˆ',
                                            value: '42',
                                            description: 'å½“å‰æ´»è·ƒçš„èšåˆæ ¹',
                                            trend: '8.2%',
                                            trendValue: '+3'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: 'é¢†åŸŸäº‹ä»¶',
                                            value: '1,234',
                                            description: 'æœ¬æœˆå¤„ç†çš„é¢†åŸŸäº‹ä»¶',
                                            trend: '15.6%',
                                            trendValue: '+189'
                                        }
                                    },
                                    {
                                        md: 3,
                                        body: {
                                            type: 'stat',
                                            title: 'è¾¹ç•Œä¸Šä¸‹æ–‡',
                                            value: '8',
                                            description: 'å®šä¹‰çš„è¾¹ç•Œä¸Šä¸‹æ–‡æ•°é‡',
                                            trend: '0%',
                                            trendValue: '0'
                                        }
                                    }
                                ]
                            },
                            {
                                type: 'chart',
                                title: 'é¢†åŸŸäº‹ä»¶å¤„ç†è¶‹åŠ¿',
                                config: {
                                    type: 'line',
                                    data: {
                                        labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                                        datasets: [{
                                            label: 'äº‹ä»¶æ•°é‡',
                                            data: [120, 190, 300, 500, 200, 300],
                                            borderColor: 'rgb(75, 192, 192)',
                                            tension: 0.1
                                        }]
                                    }
                                }
                            }
                        ]
                    }
                }
            ];
            
            const templatesHtml = templates.map((template, index) => `
                <div class="template-item" style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="selectTemplate(${index})">
                    <div style="font-weight: bold; color: #1890ff; margin-bottom: 6px;">${template.name}</div>
                    <div style="color: #666; font-size: 13px;">${template.description}</div>
                </div>
            `).join('');
            
            templateList.innerHTML = templatesHtml;
            
            // å­˜å‚¨æ¨¡æ¿æ•°æ®
            window.templateLibrary = templates;
        }

        function selectVersion(index) {
            const version = schemaVersions[index];
            document.getElementById('schema-text-input').value = JSON.stringify(version.schema, null, 2);
            
            // åˆ‡æ¢åˆ°æ–‡ä»¶å¯¼å…¥æ ‡ç­¾
            document.querySelector('.property-tab').click();
        }

        function selectTemplate(index) {
            const template = window.templateLibrary[index];
            document.getElementById('schema-text-input').value = JSON.stringify(template.schema, null, 2);
            
            // åˆ‡æ¢åˆ°æ–‡ä»¶å¯¼å…¥æ ‡ç­¾
            document.querySelector('.property-tab').click();
        }

        function importSchema() {
            const schemaText = document.getElementById('schema-text-input').value;
            const mergeMode = document.getElementById('merge-schema').checked;
            
            if (!schemaText.trim()) {
                showStatus('è¯·è¾“å…¥æˆ–é€‰æ‹©Schemaå†…å®¹', 'error');
                return;
            }
            
            try {
                const importedData = JSON.parse(schemaText);
                let newSchema;
                
                // åˆ¤æ–­æ˜¯å¦æ˜¯å¯¼å‡ºçš„å®Œæ•´æ ¼å¼
                if (importedData.schema && importedData.version) {
                    newSchema = importedData.schema;
                    // æ¢å¤ç»„ä»¶ç»‘å®š
                    if (importedData.metadata && importedData.metadata.bindings) {
                        componentBindings = new Map(importedData.metadata.bindings);
                    }
                } else {
                    newSchema = importedData;
                }
                
                if (mergeMode && currentSchema.body) {
                    // åˆå¹¶æ¨¡å¼ï¼šæ·»åŠ åˆ°ç°æœ‰Schema
                    if (newSchema.body && Array.isArray(newSchema.body)) {
                        currentSchema.body.push(...newSchema.body);
                    }
                } else {
                    // æ›¿æ¢æ¨¡å¼ï¼šå®Œå…¨æ›¿æ¢å½“å‰Schema
                    currentSchema = newSchema;
                }
                
                // é‡æ–°æ¸²æŸ“
                renderContent();
                
                // å…³é—­å¯¹è¯æ¡†
                closeImportDialog();
                
                showStatus('Schemaå¯¼å…¥æˆåŠŸï¼', 'success');
                
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                showStatus('Schemaæ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼', 'error');
            }
        }

        function closeImportDialog() {
            const dialog = document.querySelector('.form-builder-dialog');
            if (dialog) {
                dialog.remove();
            }
        }

        // ä»£ç ç”Ÿæˆå™¨åŠŸèƒ½
        let currentGeneratorTab = 'component';
        let generatedCodeCache = {};

        function openCodeGenerator() {
            const generator = document.getElementById('codeGenerator');
            generator.classList.add('show');
            
            // åˆå§‹åŒ–ä»£ç ç”Ÿæˆå™¨
            updateGeneratorOptions();
        }

        function closeCodeGenerator() {
            const generator = document.getElementById('codeGenerator');
            generator.classList.remove('show');
        }

        function switchGeneratorTab(tabElement, tabName) {
            // åˆ‡æ¢æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.generator-tab').forEach(tab => tab.classList.remove('active'));
            tabElement.classList.add('active');
            
            currentGeneratorTab = tabName;
            
            // æ˜¾ç¤ºå¯¹åº”çš„ä»£ç 
            if (generatedCodeCache[tabName]) {
                document.getElementById('generated-code').value = generatedCodeCache[tabName];
                updateCodeStats();
            }
        }

        function updateGeneratorOptions() {
            const outputType = document.getElementById('output-type').value;
            const frameworkVersion = document.getElementById('framework-version');
            
            // æ ¹æ®è¾“å‡ºç±»å‹æ›´æ–°æ¡†æ¶ç‰ˆæœ¬é€‰é¡¹
            frameworkVersion.innerHTML = '';
            
            switch (outputType) {
                case 'react':
                    frameworkVersion.innerHTML = `
                        <option value="18">React 18</option>
                        <option value="17">React 17</option>
                        <option value="16">React 16</option>
                    `;
                    break;
                case 'vue':
                    frameworkVersion.innerHTML = `
                        <option value="3">Vue 3</option>
                        <option value="2">Vue 2</option>
                    `;
                    break;
                case 'angular':
                    frameworkVersion.innerHTML = `
                        <option value="16">Angular 16</option>
                        <option value="15">Angular 15</option>
                        <option value="14">Angular 14</option>
                    `;
                    break;
                default:
                    frameworkVersion.innerHTML = `
                        <option value="latest">æœ€æ–°ç‰ˆæœ¬</option>
                        <option value="stable">ç¨³å®šç‰ˆæœ¬</option>
                    `;
            }
        }

        function generateCode() {
            const config = getGeneratorConfig();
            showLoading('æ­£åœ¨ç”Ÿæˆä»£ç ...');
            
            try {
                // ç”Ÿæˆä¸åŒç±»å‹çš„ä»£ç 
                generatedCodeCache = {
                    component: generateComponentCode(config),
                    style: generateStyleCode(config),
                    test: generateTestCode(config),
                    story: generateStoryCode(config),
                    api: generateApiCode(config)
                };
                
                // æ˜¾ç¤ºå½“å‰æ ‡ç­¾çš„ä»£ç 
                const currentCode = generatedCodeCache[currentGeneratorTab];
                document.getElementById('generated-code').value = currentCode;
                
                updateCodeStats();
                hideLoading();
                showStatus('ä»£ç ç”Ÿæˆå®Œæˆï¼', 'success');
                
            } catch (error) {
                console.error('ä»£ç ç”Ÿæˆå¤±è´¥:', error);
                hideLoading();
                showStatus('ä»£ç ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
            }
        }

        function getGeneratorConfig() {
            return {
                outputType: document.getElementById('output-type').value,
                frameworkVersion: document.getElementById('framework-version').value,
                namingStyle: document.getElementById('naming-style').value,
                typescript: document.getElementById('typescript-enabled').value === 'true',
                styling: document.getElementById('styling-solution').value,
                includeTests: document.getElementById('include-tests').checked,
                includeStories: document.getElementById('include-stories').checked,
                includeDocs: document.getElementById('include-docs').checked,
                responsive: document.getElementById('responsive-design').checked,
                schema: currentSchema
            };
        }

        function generateComponentCode(config) {
            if (config.outputType === 'react') {
                return generateReactComponent(config);
            } else if (config.outputType === 'vue') {
                return generateVueComponent(config);
            } else if (config.outputType === 'angular') {
                return generateAngularComponent(config);
            } else if (config.outputType === 'html') {
                return generateHtmlPage(config);
            } else if (config.outputType === 'api') {
                return generateApiCode(config);
            } else if (config.outputType === 'model') {
                return generateModelCode(config);
            }
            return '// æš‚ä¸æ”¯æŒè¯¥ç±»å‹çš„ä»£ç ç”Ÿæˆ';
        }

        function generateReactComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            const isTypescript = config.typescript;
            
            let imports = 'import React from \'react\';\n';
            
            if (config.styling === 'styled-components') {
                imports += 'import styled from \'styled-components\';\n';
            } else if (config.styling === 'emotion') {
                imports += 'import styled from \'@emotion/styled\';\n';
            }
            
            const interfaceCode = generateInterfaceCode(config);
            const className = config.styling === 'tailwind' ? 'bg-white p-6 rounded-lg shadow-lg' : 'ddd-component';
            const titleClassName = config.styling === 'tailwind' ? 'text-2xl font-bold mb-4' : 'title';
            const title = config.schema.title || 'DDD Component';
            const jsxContent = generateJSXFromSchema(config.schema, config);
            const typeAnnotation = isTypescript ? ': React.FC<' + componentName + 'Props>' : '';
            const params = isTypescript ? '{ data }' : 'props';
            
            let componentCode = '\n' +
                imports + '\n' +
                interfaceCode + '\n\n' +
                'const ' + componentName + typeAnnotation + ' = (' + params + ') => {\n' +
                '  return (\n' +
                '    <div className="' + className + '">\n' +
                '      <h1 className="' + titleClassName + '">' + title + '</h1>\n' +
                '      ' + jsxContent + '\n' +
                '    </div>\n' +
                '  );\n' +
                '};\n\n' +
                'export default ' + componentName + ';\n';
            
            return componentCode;
        }

        function generateVueComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'kebab-case');
            const scriptLang = config.typescript ? ' lang="ts"' : '';
            const title = config.schema.title || 'DDD Component';
            const vueTemplate = generateVueTemplateFromSchema(config.schema);
            
            return '<template>' +
                '<div class="ddd-component">' +
                '<h1>' + title + '</h1>' +
                vueTemplate +
                '</div>' +
                '</template>' +
                '<script' + scriptLang + '>' +
                'import { defineComponent } from "vue";' +
                'export default defineComponent({' +
                'name: "' + componentName + '",' +
                'props: { data: { type: Object, default: () => ({}) } },' +
                'setup(props) { return {}; }' +
                '});' +
                '<' + '/script>' +
                '<style scoped>' +
                '.ddd-component { padding: 24px; background: white; border-radius: 8px; }' +
                '<' + '/style>';
        }

        function generateAngularComponent(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'PascalCase');
            const selector = formatName(config.schema.title || 'ddd-component', 'kebab-case');
            const title = config.schema.title || 'DDD Component';
            const angularTemplate = generateAngularTemplateFromSchema(config.schema);
            
            return 'import { Component, Input } from \'@angular/core\';\n\n' +
                '@Component({\n' +
                '  selector: \'' + selector + '\',\n' +
                '  template: `\n' +
                '    <div class="ddd-component">\n' +
                '      <h1>{{ title }}</h1>\n' +
                '      ' + angularTemplate + '\n' +
                '    </div>\n' +
                '  `,\n' +
                '  styleUrls: [\'./' + selector + '.component.css\']\n' +
                '})\n' +
                'export class ' + componentName + 'Component {\n' +
                '  @Input() title: string = \'' + title + '\';\n' +
                '  @Input() data: any = {};\n' +
                '  \n' +
                '  constructor() { }\n' +
                '}';
        }

        function generateHtmlPage(config) {
            const schemaJsonString = JSON.stringify(config.schema);
            const tailwindScript = config.styling === 'tailwind' ? '<script src="https://cdn.tailwindcss.com"><' + '/script>' : '';
            
            return '<!DOCTYPE html>' +
                '<html lang="zh-CN">' +
                '<head>' +
                '<meta charset="UTF-8">' +
                '<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
                '<title>' + (config.schema.title || 'DDDé¡µé¢') + '</title>' +
                '<link rel="stylesheet" href="https://unpkg.com/amis@6.3.0/sdk/antd.css">' +
                '<script src="https://unpkg.com/amis@6.3.0/sdk/sdk.js"><' + '/script>' +
                tailwindScript +
                '</head>' +
                '<body>' +
                '<div id="root"></div>' +
                '<script>' +
                'const schema = ' + schemaJsonString + ';' +
                'const amisScoped = amis.embed("#root", schema);' +
                '<' + '/script>' +
                '</body>' +
                '</html>';
        }

        function generateStyleCode(config) {
            if (config.styling === 'css-modules') {
                return generateCSSModules(config);
            } else if (config.styling === 'styled-components') {
                return generateStyledComponents(config);
            } else if (config.styling === 'tailwind') {
                return generateTailwindConfig(config);
            } else if (config.styling === 'antd') {
                return generateAntdStyles(config);
            }
            return generateRegularCSS(config);
        }

        function generateTestCode(config) {
            if (config.outputType === 'react') {
                return generateReactTests(config);
            } else if (config.outputType === 'vue') {
                return generateVueTests(config);
            } else if (config.outputType === 'angular') {
                return generateAngularTests(config);
            }
            return '// æµ‹è¯•æ–‡ä»¶';
        }

        function generateStoryCode(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            
            return `import type { Meta, StoryObj } from '@storybook/react';
import { ${componentName} } from './${componentName}';

const meta: Meta<typeof ${componentName}> = {
  title: 'DDD Components/${componentName}',
  component: ${componentName},
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
  argTypes: {
    data: { control: 'object' },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    data: ${JSON.stringify(generateMockData(config.schema), null, 2)}
  },
};

export const Empty: Story = {
  args: {
    data: {}
  },
};`;
        }

        function generateApiCode(config) {
            return generateRestAPICode(config);
        }

        function updateCodeStats() {
            const code = document.getElementById('generated-code').value;
            const lines = code.split('\n').length;
            const size = (new Blob([code]).size / 1024).toFixed(2);
            
            document.getElementById('code-line-count').textContent = lines;
            document.getElementById('code-size').textContent = size;
        }

        function copyGeneratedCode() {
            const textarea = document.getElementById('generated-code');
            textarea.select();
            document.execCommand('copy');
            showStatus('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        function downloadGeneratedCode() {
            const code = document.getElementById('generated-code').value;
            const config = getGeneratorConfig();
            const fileName = getFileName(config);
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('æ–‡ä»¶å·²ä¸‹è½½', 'success');
        }

        function previewGenerated() {
            const code = document.getElementById('generated-code').value;
            const config = getGeneratorConfig();
            
            if (config.outputType === 'html') {
                // æ‰“å¼€æ–°çª—å£é¢„è§ˆHTML
                const newWindow = window.open('', '_blank');
                newWindow.document.write(code);
                newWindow.document.close();
            } else {
                showStatus('è¯¥ä»£ç ç±»å‹æš‚ä¸æ”¯æŒé¢„è§ˆ', 'warning');
            }
        }

        // æ¨¡å‹éªŒè¯å™¨åŠŸèƒ½
        function openValidationPanel() {
            const panel = document.getElementById('validationPanel');
            panel.classList.add('show');
        }

        function closeValidationPanel() {
            const panel = document.getElementById('validationPanel');
            panel.classList.remove('show');
        }

        function validateSchema() {
            showLoading('æ­£åœ¨éªŒè¯Schema...');
            
            setTimeout(() => {
                const results = performValidation(currentSchema);
                displayValidationResults(results);
                updateValidationStats(results);
                hideLoading();
            }, 1000);
        }

        function performValidation(schema) {
            const results = [];
            let errors = 0;
            let warnings = 0;
            
            // æ£€æŸ¥åŸºæœ¬ç»“æ„
            if (!schema.type) {
                results.push({
                    type: 'error',
                    title: 'ç¼ºå°‘ç±»å‹å®šä¹‰',
                    message: 'Schemaå¿…é¡»åŒ…å«typeå±æ€§'
                });
                errors++;
            }
            
            if (!schema.title) {
                results.push({
                    type: 'warning',
                    title: 'ç¼ºå°‘é¡µé¢æ ‡é¢˜',
                    message: 'å»ºè®®ä¸ºé¡µé¢æ·»åŠ titleå±æ€§ä»¥æå‡ç”¨æˆ·ä½“éªŒ'
                });
                warnings++;
            }
            
            // æ£€æŸ¥ç»„ä»¶ç»“æ„
            if (schema.body && Array.isArray(schema.body)) {
                schema.body.forEach((component, index) => {
                    const componentResults = validateComponent(component, index);
                    results.push(...componentResults.results);
                    errors += componentResults.errors;
                    warnings += componentResults.warnings;
                });
            }
            
            // æ£€æŸ¥æ€§èƒ½é—®é¢˜
            const componentCount = countComponents(schema);
            if (componentCount > 50) {
                results.push({
                    type: 'warning',
                    title: 'ç»„ä»¶æ•°é‡è¿‡å¤š',
                    message: `å½“å‰é¡µé¢åŒ…å«${componentCount}ä¸ªç»„ä»¶ï¼Œå¯èƒ½å½±å“æ€§èƒ½`
                });
                warnings++;
            }
            
            // æ£€æŸ¥å¯è®¿é—®æ€§
            const accessibilityIssues = checkAccessibility(schema);
            results.push(...accessibilityIssues.results);
            warnings += accessibilityIssues.warnings;
            
            return {
                results,
                errors,
                warnings,
                totalComponents: componentCount,
                score: Math.max(0, 100 - errors * 10 - warnings * 5)
            };
        }

        function validateComponent(component, index) {
            const results = [];
            let errors = 0;
            let warnings = 0;
            
            if (!component.type) {
                results.push({
                    type: 'error',
                    title: `ç»„ä»¶ ${index + 1} ç¼ºå°‘ç±»å‹`,
                    message: 'æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»æœ‰typeå±æ€§'
                });
                errors++;
            }
            
            // æ£€æŸ¥è¡¨å•ç»„ä»¶
            if (component.type === 'form' && component.body) {
                const formFieldsWithoutName = component.body.filter(field => 
                    field.type && field.type.includes('input') && !field.name
                );
                
                if (formFieldsWithoutName.length > 0) {
                    results.push({
                        type: 'error',
                        title: 'è¡¨å•å­—æ®µç¼ºå°‘nameå±æ€§',
                        message: 'è¡¨å•ä¸­çš„è¾“å…¥å­—æ®µå¿…é¡»æœ‰nameå±æ€§'
                    });
                    errors++;
                }
            }
            
            // æ£€æŸ¥APIé…ç½®
            if (component.api && typeof component.api === 'string' && !component.api.startsWith('/')) {
                results.push({
                    type: 'warning',
                    title: 'APIè·¯å¾„ä¸è§„èŒƒ',
                    message: 'APIè·¯å¾„å»ºè®®ä»¥/å¼€å¤´'
                });
                warnings++;
            }
            
            return { results, errors, warnings };
        }

        function checkAccessibility(schema) {
            const results = [];
            let warnings = 0;
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å›¾ç‰‡ç¼ºå°‘altå±æ€§
            const checkImageAlt = (obj) => {
                if (obj && typeof obj === 'object') {
                    if (obj.type === 'image' && !obj.alt) {
                        results.push({
                            type: 'warning',
                            title: 'å›¾ç‰‡ç¼ºå°‘altå±æ€§',
                            message: 'ä¸ºäº†æå‡å¯è®¿é—®æ€§ï¼Œå»ºè®®ä¸ºå›¾ç‰‡æ·»åŠ altæè¿°'
                        });
                        warnings++;
                    }
                    
                    Object.values(obj).forEach(value => {
                        if (Array.isArray(value)) {
                            value.forEach(checkImageAlt);
                        } else if (typeof value === 'object') {
                            checkImageAlt(value);
                        }
                    });
                }
            };
            
            checkImageAlt(schema);
            
            return { results, warnings };
        }

        function displayValidationResults(validationData) {
            const container = document.getElementById('validation-results');
            
            if (validationData.results.length === 0) {
                container.innerHTML = `
                    <div class="validation-result">
                        <div class="result-title">âœ… éªŒè¯é€šè¿‡</div>
                        <div class="result-message">Schemaç»“æ„å®Œå…¨æ­£ç¡®ï¼Œæ²¡æœ‰å‘ç°ä»»ä½•é—®é¢˜ï¼</div>
                    </div>
                `;
                return;
            }
            
            const resultsHtml = validationData.results.map(result => `
                <div class="validation-result ${result.type}">
                    <div class="result-title">${result.type === 'error' ? 'âŒ' : 'âš ï¸'} ${result.title}</div>
                    <div class="result-message">${result.message}</div>
                </div>
            `).join('');
            
            container.innerHTML = resultsHtml;
        }

        function updateValidationStats(validationData) {
            document.getElementById('total-components').textContent = validationData.totalComponents;
            document.getElementById('validation-errors').textContent = validationData.errors;
            document.getElementById('validation-warnings').textContent = validationData.warnings;
            document.getElementById('validation-score').textContent = validationData.score;
        }

        function exportValidationReport() {
            const stats = {
                totalComponents: document.getElementById('total-components').textContent,
                errors: document.getElementById('validation-errors').textContent,
                warnings: document.getElementById('validation-warnings').textContent,
                score: document.getElementById('validation-score').textContent
            };
            
            const report = {
                timestamp: new Date().toISOString(),
                schema: currentSchema,
                validation: stats,
                results: Array.from(document.querySelectorAll('.validation-result')).map(el => ({
                    title: el.querySelector('.result-title').textContent,
                    message: el.querySelector('.result-message').textContent,
                    type: el.classList.contains('error') ? 'error' : 'warning'
                }))
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `validation-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('éªŒè¯æŠ¥å‘Šå·²å¯¼å‡º', 'success');
        }

        function autoFixIssues() {
            showLoading('æ­£åœ¨è‡ªåŠ¨ä¿®å¤é—®é¢˜...');
            
            setTimeout(() => {
                // è‡ªåŠ¨ä¿®å¤ä¸€äº›å¸¸è§é—®é¢˜
                fixCommonIssues(currentSchema);
                renderContent();
                hideLoading();
                showStatus('å·²è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†é—®é¢˜', 'success');
                
                // é‡æ–°éªŒè¯
                setTimeout(() => {
                    validateSchema();
                }, 500);
            }, 1000);
        }

        function fixCommonIssues(schema) {
            // æ·»åŠ ç¼ºå°‘çš„title
            if (!schema.title) {
                schema.title = 'DDDé¡µé¢';
            }
            
            // ä¿®å¤è¡¨å•å­—æ®µnameé—®é¢˜
            const fixFormFields = (obj) => {
                if (obj && typeof obj === 'object') {
                    if (obj.type === 'form' && obj.body) {
                        obj.body.forEach((field, index) => {
                            if (field.type && field.type.includes('input') && !field.name) {
                                field.name = `field_${index}`;
                            }
                        });
                    }
                    
                    Object.values(obj).forEach(value => {
                        if (Array.isArray(value)) {
                            value.forEach(fixFormFields);
                        } else if (typeof value === 'object') {
                            fixFormFields(value);
                        }
                    });
                }
            };
            
            fixFormFields(schema);
        }

        // è¾…åŠ©å‡½æ•°
        function formatName(name, style, isComponent = false) {
            const cleanName = name.replace(/[^a-zA-Z0-9]/g, '');
            
            switch (style) {
                case 'camelCase':
                    return cleanName.charAt(0).toLowerCase() + cleanName.slice(1);
                case 'PascalCase':
                    return cleanName.charAt(0).toUpperCase() + cleanName.slice(1);
                case 'kebab-case':
                    return cleanName.replace(/([A-Z])/g, '-$1').toLowerCase();
                case 'snake_case':
                    return cleanName.replace(/([A-Z])/g, '_$1').toLowerCase();
                default:
                    return isComponent ? 
                        cleanName.charAt(0).toUpperCase() + cleanName.slice(1) :
                        cleanName.toLowerCase();
            }
        }

        function getFileName(config) {
            const name = formatName(config.schema.title || 'DDDComponent', config.namingStyle);
            const ext = config.typescript ? '.tsx' : '.jsx';
            
            switch (currentGeneratorTab) {
                case 'component':
                    return `${name}${config.outputType === 'vue' ? '.vue' : ext}`;
                case 'style':
                    return `${name}.${config.styling === 'css-modules' ? 'module.' : ''}css`;
                case 'test':
                    return `${name}.test${ext}`;
                case 'story':
                    return `${name}.stories${ext}`;
                case 'api':
                    return `${name}.api.ts`;
                default:
                    return `${name}.${currentGeneratorTab}`;
            }
        }

        // ä»£ç ç”Ÿæˆè¾…åŠ©å‡½æ•°
        function generateInterfaceCode(config) {
            if (!config.typescript) return '';
            
            return `interface ${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}Props {
  data?: any;
  className?: string;
  style?: React.CSSProperties;
}`;
        }

        function generateJSXFromSchema(schema, config) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>æš‚æ— å†…å®¹</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div className="card">
          <h3>${component.header?.title || 'å¡ç‰‡æ ‡é¢˜'}</h3>
          <p>${component.body || 'å¡ç‰‡å†…å®¹'}</p>
        </div>`;
                    case 'form':
                        return '<form className="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div className="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" name="${field.name}" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    case 'table':
                        return '<table className="ddd-table"><thead><tr><th>åˆ—æ ‡é¢˜</th></tr></thead><tbody><tr><td>æ•°æ®</td></tr></tbody></table>';
                    default:
                        return `<div className="component-${component.type}">${component.title || component.label || 'ç»„ä»¶å†…å®¹'}</div>`;
                }
            }).join('\n      ');
        }

        function generateVueTemplateFromSchema(schema) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>æš‚æ— å†…å®¹</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div class="card">
      <h3>${component.header?.title || 'å¡ç‰‡æ ‡é¢˜'}</h3>
      <p>${component.body || 'å¡ç‰‡å†…å®¹'}</p>
    </div>`;
                    case 'form':
                        return '<form class="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div class="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" :name="'${field.name}'" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    default:
                        return `<div class="component-${component.type}">${component.title || component.label || 'ç»„ä»¶å†…å®¹'}</div>`;
                }
            }).join('\n    ');
        }

        function generateAngularTemplateFromSchema(schema) {
            if (!schema.body || !Array.isArray(schema.body)) {
                return '<div>æš‚æ— å†…å®¹</div>';
            }
            
            return schema.body.map(component => {
                switch (component.type) {
                    case 'card':
                        return `<div class="card">
      <h3>${component.header?.title || 'å¡ç‰‡æ ‡é¢˜'}</h3>
      <p>${component.body || 'å¡ç‰‡å†…å®¹'}</p>
    </div>`;
                    case 'form':
                        return '<form class="ddd-form">' + 
                            (component.body || []).map(field => 
                                `<div class="form-field">
                                    <label>${field.label}</label>
                                    <input type="${field.type === 'input-text' ? 'text' : 'text'}" name="${field.name}" />
                                </div>`
                            ).join('\n') + 
                        '</form>';
                    default:
                        return `<div class="component-${component.type}">{{ data.${component.name || 'content'} }}</div>`;
                }
            }).join('\n    ');
        }

        function generateCSSModules(config) {
            return `.dddComponent {
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
}

.card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.dddForm {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.formField {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.formField label {
  font-weight: 500;
  color: #555;
}

.formField input {
  padding: 8px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
}`;
        }

        function generateStyledComponents(config) {
            return `import styled from 'styled-components';

export const StyledContainer = styled.div\`
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
\`;

export const StyledTitle = styled.h1\`
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
\`;

export const StyledCard = styled.div\`
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
\`;

export const StyledForm = styled.form\`
  display: flex;
  flex-direction: column;
  gap: 16px;
\`;`;
        }

        function generateRegularCSS(config) {
            return `.ddd-component {
  padding: 24px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  ${config.responsive ? `
  
  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 768px) {
    padding: 16px;
  }
  
  @media (max-width: 480px) {
    padding: 12px;
  }` : ''}
}

.title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 16px;
  color: #333;
  ${config.responsive ? `
  
  @media (max-width: 768px) {
    font-size: 20px;
  }` : ''}
}

.card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.ddd-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.form-field label {
  font-weight: 500;
  color: #555;
}

.form-field input {
  padding: 8px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  transition: border-color 0.3s;
}

.form-field input:focus {
  border-color: #1890ff;
  outline: none;
  box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
}

.ddd-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
}

.ddd-table th,
.ddd-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e9ecef;
}

.ddd-table th {
  background: #f8f9fa;
  font-weight: 600;
}`;
        }

        function generateTailwindConfig(config) {
            return `/* Tailwind CSS é…ç½® */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .ddd-component {
    @apply p-6 bg-white rounded-lg shadow-lg;
  }
  
  .ddd-title {
    @apply text-2xl font-bold mb-4 text-gray-800;
  }
  
  .ddd-card {
    @apply bg-gray-50 border border-gray-200 rounded-md p-4 mb-4;
  }
  
  .ddd-form {
    @apply flex flex-col space-y-4;
  }
  
  .ddd-form-field {
    @apply flex flex-col space-y-1;
  }
  
  .ddd-form-label {
    @apply font-medium text-gray-700;
  }
  
  .ddd-form-input {
    @apply px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
  }
}`;
        }

        function generateReactTests(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', config.namingStyle, true);
            
            return `import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { ${componentName} } from './${componentName}';

describe('${componentName}', () => {
  const mockData = ${JSON.stringify(generateMockData(config.schema), null, 2)};

  test('renders without crashing', () => {
    render(React.createElement(${componentName}, { data: mockData }));
  });

  test('displays the correct title', () => {
    render(React.createElement(${componentName}, { data: mockData }));
    expect(screen.getByText('${config.schema.title || 'DDD Component'}')).toBeInTheDocument();
  });

  test('handles user interactions', async () => {
    const user = userEvent.setup();
    render(React.createElement(${componentName}, { data: mockData }));
    
    // Add specific interaction tests based on component type
  });

  test('matches snapshot', () => {
    const { container } = render(React.createElement(${componentName}, { data: mockData }));
    expect(container.firstChild).toMatchSnapshot();
  });
});`;
        }

        function generateVueTests(config) {
            const componentName = formatName(config.schema.title || 'DDDComponent', 'kebab-case');
            
            return `import { mount } from '@vue/test-utils';
import ${formatName(config.schema.title || 'DDDComponent', 'PascalCase')} from './${componentName}.vue';

describe('${componentName}', () => {
  const mockData = ${JSON.stringify(generateMockData(config.schema), null, 2)};

  test('renders correctly', () => {
    const wrapper = mount(${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}, {
      props: {
        data: mockData
      }
    });

    expect(wrapper.text()).toContain('${config.schema.title || 'DDD Component'}');
  });

  test('emits events correctly', async () => {
    const wrapper = mount(${formatName(config.schema.title || 'DDDComponent', 'PascalCase')}, {
      props: {
        data: mockData
      }
    });

    // Add event testing logic
  });
});`;
        }

        function generateRestAPICode(config) {
            return `// REST API æ¥å£å®šä¹‰
import express from 'express';
import { Request, Response } from 'express';

const router = express.Router();

// æ•°æ®ç±»å‹å®šä¹‰
interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data {
  id: string;
  name: string;
  description?: string;
  createdAt: Date;
  updatedAt: Date;
}

// GET - è·å–åˆ—è¡¨
router.get('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}', async (req: Request, res: Response) => {
  try {
    // å®ç°è·å–åˆ—è¡¨é€»è¾‘
    const data: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data[] = [];
    
    res.json({
      code: 200,
      message: 'success',
      data: {
        items: data,
        total: data.length
      }
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Internal server error',
      data: null
    });
  }
});

// POST - åˆ›å»ºæ–°è®°å½•
router.post('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}', async (req: Request, res: Response) => {
  try {
    const newData = req.body as any; // Avoiding TypeScript generics in HTML
    
    // å®ç°åˆ›å»ºé€»è¾‘
    const createdData: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data = {
      id: Date.now().toString(),
      ...newData,
      createdAt: new Date(),
      updatedAt: new Date()
    } as ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data;
    
    res.json({
      code: 200,
      message: 'Created successfully',
      data: createdData
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to create',
      data: null
    });
  }
});

// PUT - æ›´æ–°è®°å½•
router.put('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    const updateData = req.body as any; // Avoiding TypeScript generics in HTML
    
    // å®ç°æ›´æ–°é€»è¾‘
    const updatedData: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data = {
      id,
      ...updateData,
      updatedAt: new Date()
    } as ${formatName(config.schema.title || 'DDD', 'PascalCase')}Data;
    
    res.json({
      code: 200,
      message: 'Updated successfully',
      data: updatedData
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to update',
      data: null
    });
  }
});

// DELETE - åˆ é™¤è®°å½•
router.delete('/api/${formatName(config.schema.title || 'ddd', 'kebab-case')}/:id', async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    
    // å®ç°åˆ é™¤é€»è¾‘
    
    res.json({
      code: 200,
      message: 'Deleted successfully',
      data: null
    });
  } catch (error) {
    res.status(500).json({
      code: 500,
      message: 'Failed to delete',
      data: null
    });
  }
});

export default router;`;
        }

        function generateModelCode(config) {
            return `// æ•°æ®æ¨¡å‹å®šä¹‰
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model {
  id: string;
  name: string;
  description?: string;
  status: 'active' | 'inactive';
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}

// åˆ›å»ºæ•°æ®ä¼ è¾“å¯¹è±¡
export interface Create${formatName(config.schema.title || 'DDD', 'PascalCase')}DTO {
  name: string;
  description?: string;
  metadata?: Record<string, any>;
}

// æ›´æ–°æ•°æ®ä¼ è¾“å¯¹è±¡
export interface Update${formatName(config.schema.title || 'DDD', 'PascalCase')}DTO {
  name?: string;
  description?: string;
  status?: 'active' | 'inactive';
  metadata?: Record<string, any>;
}

// æŸ¥è¯¢å‚æ•°å¯¹è±¡
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}QueryParams {
  page?: number;
  pageSize?: number;
  name?: string;
  status?: 'active' | 'inactive';
  sortBy?: keyof ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model;
  sortOrder?: 'asc' | 'desc';
}

// å“åº”æ•°æ®å¯¹è±¡
export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}Response {
  code: number;
  message: string;
  data: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model | null;
}

export interface ${formatName(config.schema.title || 'DDD', 'PascalCase')}ListResponse {
  code: number;
  message: string;
  data: {
    items: ${formatName(config.schema.title || 'DDD', 'PascalCase')}Model[];
    total: number;
    page: number;
    pageSize: number;
  };
}`;
        }

        function generateMockData(schema) {
            const mockData = {
                id: '1',
                name: 'Mock Data',
                title: schema.title || 'Mock Title',
                description: 'This is mock data for testing',
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // æ ¹æ®schemaæ·»åŠ æ›´å¤šå­—æ®µ
            if (schema.body && Array.isArray(schema.body)) {
                schema.body.forEach(component => {
                    if (component.name) {
                        mockData[component.name] = 'Mock Value';
                    }
                });
            }
            
            return mockData;
        }

        // è¿æ¥åç«¯åŠŸèƒ½
        async function connectBackend() {
            try {
                showLoading('è¿æ¥åç«¯ä¸­...');
                
                // æµ‹è¯•åç«¯è¿æ¥
                const response = await fetch('/amis/health');
                const result = await response.json();
                
                if (result.code === 200) {
                    hideLoading();
                    showStatus('åç«¯è¿æ¥æˆåŠŸï¼', 'success');
                    
                    // å¯ç”¨åç«¯æ•°æ®åŠ è½½
                    await loadBackendData();
                } else {
                    throw new Error('åç«¯å“åº”å¼‚å¸¸');
                }
            } catch (error) {
                console.error('è¿æ¥åç«¯å¤±è´¥:', error);
                hideLoading();
                showStatus('åç«¯è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'error');
            }
        }

        // åŠ è½½åç«¯æ•°æ®
        async function loadBackendData() {
            try {
                // åŠ è½½é¡¹ç›®æ•°æ®
                const projectsResponse = await fetch('/amis/api/projects');
                const projectsData = await projectsResponse.json();
                
                if (projectsData.code === 200) {
                    console.log('é¡¹ç›®æ•°æ®åŠ è½½æˆåŠŸ:', projectsData.data);
                    
                    // æ›´æ–°Schemaä»¥æ˜¾ç¤ºçœŸå®æ•°æ®
                    currentSchema = {
                        type: 'page',
                        title: 'DDDå¹³å° - é¡¹ç›®ç®¡ç†',
                        body: [
                            {
                                type: 'crud',
                                api: '/amis/api/projects',
                                syncLocation: false,
                                title: 'é¡¹ç›®åˆ—è¡¨',
                                columns: [
                                    { name: 'id', label: 'ID', type: 'text', width: 60 },
                                    { name: 'name', label: 'é¡¹ç›®åç§°', type: 'text' },
                                    { name: 'description', label: 'æè¿°', type: 'text' },
                                    { name: 'status', label: 'çŠ¶æ€', type: 'mapping', map: {
                                        'active': '<span class="label label-success">æ´»è·ƒ</span>',
                                        'development': '<span class="label label-warning">å¼€å‘ä¸­</span>',
                                        'testing': '<span class="label label-info">æµ‹è¯•ä¸­</span>'
                                    }},
                                    { name: 'domainCount', label: 'é¢†åŸŸæ•°', type: 'text', width: 80 },
                                    { name: 'aggregateCount', label: 'èšåˆæ•°', type: 'text', width: 80 },
                                    { name: 'entityCount', label: 'å®ä½“æ•°', type: 'text', width: 80 },
                                    { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´', type: 'datetime' }
                                ],
                                headerToolbar: [
                                    {
                                        type: 'button',
                                        label: 'æ–°å»ºé¡¹ç›®',
                                        level: 'primary',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: 'æ–°å»ºé¡¹ç›®',
                                            size: 'lg',
                                            body: {
                                                type: 'form',
                                                api: 'post:/amis/api/projects',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: 'é¡¹ç›®åç§°',
                                                        required: true,
                                                        placeholder: 'è¯·è¾“å…¥é¡¹ç›®åç§°'
                                                    },
                                                    {
                                                        type: 'textarea',
                                                        name: 'description',
                                                        label: 'é¡¹ç›®æè¿°',
                                                        placeholder: 'è¯·è¾“å…¥é¡¹ç›®æè¿°',
                                                        rows: 3
                                                    }
                                                ]
                                            }
                                        }
                                    }
                                ],
                                itemActions: [
                                    {
                                        type: 'button',
                                        icon: 'fa fa-eye',
                                        tooltip: 'æŸ¥çœ‹è¯¦æƒ…',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: 'é¡¹ç›®è¯¦æƒ…',
                                            body: {
                                                type: 'service',
                                                api: '/amis/api/projects/${id}',
                                                body: [
                                                    {
                                                        type: 'property',
                                                        title: 'åŸºæœ¬ä¿¡æ¯',
                                                        items: [
                                                            { label: 'é¡¹ç›®åç§°', content: '${name}' },
                                                            { label: 'é¡¹ç›®æè¿°', content: '${description}' },
                                                            { label: 'çŠ¶æ€', content: '${status}' },
                                                            { label: 'é¢†åŸŸæ•°é‡', content: '${domainCount}' },
                                                            { label: 'èšåˆæ•°é‡', content: '${aggregateCount}' },
                                                            { label: 'å®ä½“æ•°é‡', content: '${entityCount}' },
                                                            { label: 'åˆ›å»ºæ—¶é—´', content: '${createdAt}' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        icon: 'fa fa-edit',
                                        tooltip: 'ç¼–è¾‘',
                                        actionType: 'dialog',
                                        dialog: {
                                            title: 'ç¼–è¾‘é¡¹ç›®',
                                            body: {
                                                type: 'form',
                                                api: 'put:/amis/api/projects/${id}',
                                                initApi: '/amis/api/projects/${id}',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: 'é¡¹ç›®åç§°',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'textarea',
                                                        name: 'description',
                                                        label: 'é¡¹ç›®æè¿°',
                                                        rows: 3
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'status',
                                                        label: 'çŠ¶æ€',
                                                        options: [
                                                            { label: 'æ´»è·ƒ', value: 'active' },
                                                            { label: 'å¼€å‘ä¸­', value: 'development' },
                                                            { label: 'æµ‹è¯•ä¸­', value: 'testing' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        icon: 'fa fa-trash',
                                        tooltip: 'åˆ é™¤',
                                        level: 'danger',
                                        confirmText: 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ',
                                        actionType: 'ajax',
                                        api: 'delete:/amis/api/projects/${id}'
                                    }
                                ]
                            }
                        ]
                    };
                    
                    renderContent();
                    showStatus('åç«¯æ•°æ®åŠ è½½å®Œæˆ', 'success');
                }
            } catch (error) {
                console.error('åŠ è½½åç«¯æ•°æ®å¤±è´¥:', error);
                showStatus('åŠ è½½åç«¯æ•°æ®å¤±è´¥', 'error');
            }
        }

        // é‡æ–°æ’åºç»„ä»¶
        function reorderComponents(fromIndex, toIndex) {
            if (!currentSchema.body || fromIndex === toIndex) return;
            
            const component = currentSchema.body.splice(fromIndex, 1)[0];
            currentSchema.body.splice(toIndex, 0, component);
            
            renderContent();
            showStatus('ç»„ä»¶é¡ºåºå·²è°ƒæ•´', 'info');
        }

        // æ¸²æŸ“å†…å®¹
        function renderContent() {
            const content = document.getElementById('content');
            content.innerHTML = '';
            
            console.log('renderContent - currentSchema:', currentSchema);
            console.log('renderContent - schemaç±»å‹:', typeof currentSchema);
            
            // å¦‚æœcurrentSchemaæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ç»„ä»¶
            if (currentSchema.type === 'page') {
                console.log('æ¸²æŸ“é¡µé¢ç»„ä»¶');
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // å¦‚æœæœ‰bodyæ•°ç»„
            else if (currentSchema.body && Array.isArray(currentSchema.body)) {
                console.log('æ¸²æŸ“bodyæ•°ç»„ï¼Œé•¿åº¦:', currentSchema.body.length);
                currentSchema.body.forEach((item, index) => {
                    console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªç»„ä»¶:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        // æ·»åŠ å®æ—¶é¢„è§ˆåŠŸèƒ½
                        makeComponentEditable(element, item, index);
                        content.appendChild(element);
                    }
                });
            }
            // å¦‚æœcurrentSchemaæ˜¯ä¸€ä¸ªæ•°ç»„
            else if (Array.isArray(currentSchema)) {
                console.log('æ¸²æŸ“schemaæ•°ç»„ï¼Œé•¿åº¦:', currentSchema.length);
                currentSchema.forEach((item, index) => {
                    console.log(`æ¸²æŸ“ç¬¬${index}ä¸ªç»„ä»¶:`, item);
                    const element = renderComponent(item);
                    if (element) {
                        content.appendChild(element);
                    }
                });
            }
            // å¦‚æœæ˜¯å•ä¸ªç»„ä»¶
            else if (currentSchema.type) {
                console.log('æ¸²æŸ“å•ä¸ªç»„ä»¶:', currentSchema.type);
                const element = renderComponent(currentSchema);
                if (element) {
                    content.appendChild(element);
                }
            }
            // ç©ºç™½é¡µé¢
            else {
                console.log('æ˜¾ç¤ºç©ºç™½é¡µé¢');
                content.innerHTML = `
                    <div class="page-content">
                        <div style="text-align: center; padding: 60px 20px; color: #666;">
                            <h2>é¡µé¢ä¸ºç©º</h2>
                            <p>ç‚¹å‡»å·¦ä¾§ç»„ä»¶åº“æ·»åŠ å†…å®¹</p>
                        </div>
                    </div>
                `;
            }
            
            updateSchemaEditor();
            
            // å¯ç”¨ç»„ä»¶é‡æ–°æ’åºåŠŸèƒ½
            setTimeout(() => {
                enableComponentReordering();
            }, 100);
        }

        // æ¸²æŸ“ç»„ä»¶
        function renderComponent(component) {
            console.log('renderComponent - è¾“å…¥ç»„ä»¶:', component);
            console.log('renderComponent - ç»„ä»¶ç±»å‹:', component ? component.type : 'ç»„ä»¶ä¸ºç©º');
            
            // æ£€æŸ¥ç»„ä»¶æ˜¯å¦æœ‰æ•ˆ
            if (!component) {
                console.error('renderComponent - ç»„ä»¶ä¸ºç©ºæˆ–undefined');
                return null;
            }
            
            // å¦‚æœç»„ä»¶æ²¡æœ‰typeå­—æ®µï¼Œå°è¯•æ¨æ–­
            if (!component.type && component.body) {
                console.log('renderComponent - ç»„ä»¶æ²¡æœ‰typeå­—æ®µï¼Œä½†æœ‰bodyï¼Œæ¨æ–­ä¸ºcontainer');
                component.type = 'container';
            }
            
            const div = document.createElement('div');
            
            switch (component.type) {
                case 'page':
                    // é¡µé¢ç±»å‹ï¼Œæ¸²æŸ“å…¶bodyå†…å®¹
                    if (component.title) {
                        const title = document.createElement('h1');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 20px; color: #333; font-size: 24px;';
                        div.appendChild(title);
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'alert':
                    div.className = `alert ${component.level || 'info'}`;
                    div.textContent = component.body || '';
                    break;
                    
                case 'card':
                    div.className = 'card';
                    if (component.header && component.header.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.header.title;
                        header.style.marginBottom = '16px';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        const body = document.createElement('div');
                        if (typeof component.body === 'string') {
                            body.textContent = component.body;
                        } else if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) body.appendChild(child);
                            });
                        } else if (typeof component.body === 'object') {
                            const child = renderComponent(component.body);
                            if (child) body.appendChild(child);
                        }
                        div.appendChild(body);
                    }
                    break;
                    
                case 'grid':
                    div.className = 'grid';
                    if (component.columns && Array.isArray(component.columns)) {
                        component.columns.forEach(col => {
                            if (col.body) {
                                // å¤„ç†col.bodyå¯èƒ½æ˜¯æ•°ç»„çš„æƒ…å†µ
                                if (Array.isArray(col.body)) {
                                    // å¦‚æœcol.bodyæ˜¯æ•°ç»„ï¼Œéå†æ¸²æŸ“æ¯ä¸ªå­ç»„ä»¶
                                    col.body.forEach(item => {
                                        const childElement = renderComponent(item);
                                        if (childElement) div.appendChild(childElement);
                                    });
                                } else {
                                    // å¦‚æœcol.bodyæ˜¯å•ä¸ªå¯¹è±¡ï¼Œç›´æ¥æ¸²æŸ“
                                    const colElement = renderComponent(col.body);
                                    if (colElement) div.appendChild(colElement);
                                }
                            }
                        });
                    }
                    break;
                    
                case 'flex':
                    div.style.cssText = 'display: flex; gap: 16px; align-items: center; flex-wrap: wrap;';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'container':
                    div.className = 'page-content';
                    if (component.style) {
                        const styleStr = Object.entries(component.style)
                            .map(([k, v]) => `${k.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${v}`)
                            .join('; ');
                        div.style.cssText += styleStr;
                    }
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    }
                    break;
                    
                case 'stat-card':
                    div.className = 'card stat-card';
                    div.innerHTML = `
                        <div class="stat-number" style="color: ${component.color || '#1890ff'};">
                            ${component.number || '0'}
                        </div>
                        <div class="stat-label">${component.label || 'ç»Ÿè®¡é¡¹'}</div>
                    `;
                    break;
                    
                case 'tpl':
                    // å¤„ç†AMISæ¨¡æ¿è¯­æ³•ï¼Œç®€åŒ–æ¸²æŸ“
                    let tplContent = component.tpl || '';
                    
                    // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®æ¥æ›¿æ¢æ¨¡æ¿å˜é‡
                    const mockData = {
                        total: Math.floor(Math.random() * 1000) + 100,
                        growth: (Math.random() * 20 - 10).toFixed(1),
                        name: 'ç¤ºä¾‹é¡¹ç›®',
                        description: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æè¿°',
                        status: 'ACTIVE',
                        createdAt: '2025-01-01',
                        version: 'v1.0.0',
                        environment: 'development',
                        startTime: '2025-01-01 08:00:00',
                        memoryUsage: '256MB',
                        cpuUsage: '15%',
                        icon: 'ğŸ¯',
                        title: 'ç¤ºä¾‹æ ‡é¢˜',
                        time: 'åˆšåˆš'
                    };
                    
                    // æ›¿æ¢å¸¸è§çš„æ¨¡æ¿å˜é‡
                    tplContent = tplContent.replace(/\$\{([^}]+)\}/g, (match, expression) => {
                        try {
                            // ç®€å•å¤„ç†ä¸€äº›å¸¸è§è¡¨è¾¾å¼
                            if (expression.includes('total || 0')) return mockData.total;
                            if (expression.includes('growth')) {
                                if (expression.includes('>=')) {
                                    return mockData.growth >= 0 ? 
                                        (expression.includes('text-green-500') ? 'text-green-500' : 'â†—') : 
                                        (expression.includes('text-red-500') ? 'text-red-500' : 'â†˜');
                                }
                                return mockData.growth;
                            }
                            if (expression.includes('Math.abs(growth)')) return Math.abs(mockData.growth);
                            
                            // ç›´æ¥å±æ€§è®¿é—®
                            const prop = expression.trim();
                            if (mockData[prop] !== undefined) return mockData[prop];
                            
                            return expression; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿”å›åŸè¡¨è¾¾å¼
                        } catch (e) {
                            return expression;
                        }
                    });
                    
                    div.innerHTML = tplContent;
                    break;
                    
                case 'divider':
                    div.innerHTML = '<hr style="margin: 20px 0; border: none; border-top: 1px solid #e8e8e8;">';
                    break;
                    
                case 'panel':
                    div.className = 'card panel-card';
                    if (component.title) {
                        const header = document.createElement('h3');
                        header.textContent = component.title;
                        header.style.cssText = 'margin-bottom: 16px; color: #333; border-bottom: 2px solid #1890ff; padding-bottom: 8px;';
                        div.appendChild(header);
                    }
                    if (component.body) {
                        if (Array.isArray(component.body)) {
                            component.body.forEach(item => {
                                const child = renderComponent(item);
                                if (child) div.appendChild(child);
                            });
                        } else {
                            const child = renderComponent(component.body);
                            if (child) div.appendChild(child);
                        }
                    }
                    break;
                    
                case 'service':
                    // Serviceç»„ä»¶åœ¨ç®€æ˜“ç¼–è¾‘å™¨ä¸­ç›´æ¥æ¸²æŸ“å…¶bodyå†…å®¹ï¼Œä¸æ˜¾ç¤ºAPIå ä½ç¬¦
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(item => {
                            const child = renderComponent(item);
                            if (child) div.appendChild(child);
                        });
                    } else {
                        // å¦‚æœæ²¡æœ‰bodyï¼Œæ˜¾ç¤ºç®€å•çš„å ä½
                        div.innerHTML = `
                            <div style="padding: 8px; background: #f0f9ff; border-radius: 4px; color: #1890ff; font-size: 12px;">
                                ğŸ“¡ ${component.api || 'æ•°æ®åŠ è½½ä¸­...'}
                            </div>
                        `;
                    }
                    break;
                    
                case 'action':
                    div.className = 'action-button';
                    const button = document.createElement('button');
                    button.className = `btn ${component.level || 'primary'} ${component.size || ''}`;
                    button.innerHTML = `${component.icon ? `<i class="${component.icon}"></i> ` : ''}${component.label || 'æŒ‰é’®'}`;
                    button.style.cssText = 'width: 100%; margin: 4px 0;';
                    div.appendChild(button);
                    break;
                    
                case 'property':
                    div.className = 'property-list';
                    if (component.items && Array.isArray(component.items)) {
                        component.items.forEach(item => {
                            const propDiv = document.createElement('div');
                            propDiv.style.cssText = 'display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;';
                            propDiv.innerHTML = `
                                <span style="font-weight: 500; color: #333;">${item.label || 'å±æ€§'}:</span>
                                <span style="color: #666;">${item.content || 'å€¼'}</span>
                            `;
                            div.appendChild(propDiv);
                        });
                    }
                    break;
                    
                case 'list':
                    div.className = 'list-container';
                    if (component.source && Array.isArray(component.source)) {
                        component.source.forEach(item => {
                            if (component.listItem && component.listItem.body) {
                                const listItemDiv = document.createElement('div');
                                listItemDiv.style.cssText = 'padding: 12px; margin: 8px 0; background: #fafafa; border-radius: 6px; border-left: 3px solid #1890ff;';
                                
                                // ç®€å•çš„æ¨¡æ¿æ¸²æŸ“
                                let content = JSON.stringify(item);
                                if (item.title) content = `<strong>${item.title}</strong><br>${item.description || ''}`;
                                if (item.name) content = `<strong>${item.name}</strong><br>${item.description || ''}`;
                                
                                listItemDiv.innerHTML = content;
                                div.appendChild(listItemDiv);
                            }
                        });
                    } else {
                        div.innerHTML = `
                            <div style="padding: 16px; background: #f0f9ff; border-radius: 6px; color: #1890ff;">
                                ğŸ“‹ åˆ—è¡¨ç»„ä»¶ (æ•°æ®åŠ è½½ä¸­...)
                            </div>
                        `;
                    }
                    break;
                    
                case 'status':
                    div.className = 'status-badge';
                    const status = component.source || 'default';
                    const statusMap = component.map || {};
                    const statusInfo = statusMap[status] || { status: 'default', text: status };
                    
                    div.innerHTML = `
                        <span class="badge badge-${statusInfo.status}" style="padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                            ${statusInfo.text}
                        </span>
                    `;
                    break;
                    
                case 'chart':
                    div.className = 'card chart-card';
                    const chartType = component.config?.type || 'unknown';
                    div.innerHTML = `
                        <h3 style="margin-bottom: 16px;">ğŸ“Š ${chartType.toUpperCase()} å›¾è¡¨</h3>
                        <div style="height: 300px; background: linear-gradient(45deg, #f0f9ff, #e0f2fe); 
                                    border-radius: 8px; display: flex; align-items: center; 
                                    justify-content: center; color: #0369a1; font-size: 16px; text-align: center;">
                            å›¾è¡¨æ•°æ®å¯è§†åŒ–åŒºåŸŸ<br>
                            <small style="opacity: 0.7;">ç±»å‹: ${chartType}<br>ï¼ˆç®€æ˜“ç¼–è¾‘å™¨æš‚ä¸æ”¯æŒå›¾è¡¨æ¸²æŸ“ï¼‰</small>
                        </div>
                    `;
                    break;
                    
                case 'form':
                    div.className = 'card form-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0;';
                    
                    if (component.title) {
                        const title = document.createElement('h3');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 16px; color: #333;';
                        div.appendChild(title);
                    }
                    
                    const formElement = document.createElement('form');
                    formElement.style.cssText = 'display: flex; flex-direction: column; gap: 16px;';
                    
                    if (component.body && Array.isArray(component.body)) {
                        component.body.forEach(field => {
                            const fieldElement = renderComponent(field);
                            if (fieldElement) formElement.appendChild(fieldElement);
                        });
                    } else {
                        // ç¤ºä¾‹è¡¨å•å­—æ®µ
                        const demoFields = [
                            { type: 'input-text', label: 'å§“å', name: 'name', required: true },
                            { type: 'input-email', label: 'é‚®ç®±', name: 'email' },
                            { type: 'select', label: 'éƒ¨é—¨', name: 'dept', options: [
                                { label: 'æŠ€æœ¯éƒ¨', value: 'tech' },
                                { label: 'äº§å“éƒ¨', value: 'product' },
                                { label: 'è¿è¥éƒ¨', value: 'ops' }
                            ]},
                            { type: 'textarea', label: 'å¤‡æ³¨', name: 'note', rows: 3 }
                        ];
                        demoFields.forEach(field => {
                            const fieldElement = renderComponent(field);
                            if (fieldElement) formElement.appendChild(fieldElement);
                        });
                    }
                    
                    const submitBtn = document.createElement('button');
                    submitBtn.textContent = 'æäº¤';
                    submitBtn.style.cssText = 'padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; align-self: flex-start;';
                    formElement.appendChild(submitBtn);
                    
                    div.appendChild(formElement);
                    break;
                    
                case 'input-text':
                case 'input-email':
                case 'input-password':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const input = document.createElement('input');
                    input.type = component.type === 'input-email' ? 'email' : component.type === 'input-password' ? 'password' : 'text';
                    input.placeholder = component.placeholder || '';
                    input.value = component.value || '';
                    input.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px;';
                    if (component.required) input.required = true;
                    if (component.name) input.name = component.name;
                    div.appendChild(input);
                    break;
                    
                case 'textarea':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const textarea = document.createElement('textarea');
                    textarea.placeholder = component.placeholder || '';
                    textarea.value = component.value || '';
                    textarea.rows = component.rows || 4;
                    textarea.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; resize: vertical;';
                    if (component.required) textarea.required = true;
                    if (component.name) textarea.name = component.name;
                    div.appendChild(textarea);
                    break;
                    
                case 'select':
                    div.className = 'form-field';
                    if (component.label) {
                        const label = document.createElement('label');
                        label.textContent = component.label + (component.required ? ' *' : '');
                        label.style.cssText = 'display: block; margin-bottom: 4px; font-weight: 500; color: #333;';
                        div.appendChild(label);
                    }
                    
                    const select = document.createElement('select');
                    select.style.cssText = 'width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; background: white;';
                    if (component.required) select.required = true;
                    if (component.name) select.name = component.name;
                    
                    if (component.placeholder) {
                        const placeholderOption = document.createElement('option');
                        placeholderOption.value = '';
                        placeholderOption.textContent = component.placeholder;
                        placeholderOption.disabled = true;
                        placeholderOption.selected = true;
                        select.appendChild(placeholderOption);
                    }
                    
                    if (component.options && Array.isArray(component.options)) {
                        component.options.forEach(option => {
                            const optionElement = document.createElement('option');
                            optionElement.value = option.value || option;
                            optionElement.textContent = option.label || option;
                            if (component.value && (option.value === component.value || option === component.value)) {
                                optionElement.selected = true;
                            }
                            select.appendChild(optionElement);
                        });
                    }
                    div.appendChild(select);
                    break;
                    
                case 'table':
                    div.className = 'card table-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0; overflow-x: auto;';
                    
                    if (component.title) {
                        const title = document.createElement('h3');
                        title.textContent = component.title;
                        title.style.cssText = 'margin-bottom: 16px; color: #333;';
                        div.appendChild(title);
                    }
                    
                    const table = document.createElement('table');
                    table.style.cssText = 'width: 100%; border-collapse: collapse; border: 1px solid #e8e8e8;';
                    
                    // è¡¨å¤´
                    if (component.columns && Array.isArray(component.columns)) {
                        const thead = document.createElement('thead');
                        const headerRow = document.createElement('tr');
                        headerRow.style.cssText = 'background: #fafafa;';
                        
                        component.columns.forEach(col => {
                            const th = document.createElement('th');
                            th.textContent = col.label || col.name || '';
                            th.style.cssText = 'padding: 12px; text-align: left; border: 1px solid #e8e8e8; font-weight: 500;';
                            headerRow.appendChild(th);
                        });
                        thead.appendChild(headerRow);
                        table.appendChild(thead);
                        
                        // è¡¨ä½“ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
                        const tbody = document.createElement('tbody');
                        const sampleData = component.data || [];
                        const rowsToShow = sampleData.length > 0 ? sampleData : [
                            { id: 1, name: 'ç”¨æˆ· 1', email: 'user1@example.com', status: 'æ¿€æ´»' },
                            { id: 2, name: 'ç”¨æˆ· 2', email: 'user2@example.com', status: 'ç¦ç”¨' },
                            { id: 3, name: 'ç”¨æˆ· 3', email: 'user3@example.com', status: 'æ¿€æ´»' }
                        ];
                        
                        rowsToShow.slice(0, 5).forEach((rowData, index) => {
                            const row = document.createElement('tr');
                            component.columns.forEach(col => {
                                const td = document.createElement('td');
                                const fieldName = col.name || col.key;
                                td.textContent = rowData[fieldName] || `ç¤ºä¾‹æ•°æ® ${index + 1}`;
                                td.style.cssText = 'padding: 12px; border: 1px solid #e8e8e8;';
                                row.appendChild(td);
                            });
                            tbody.appendChild(row);
                        });
                        table.appendChild(tbody);
                    }
                    
                    div.appendChild(table);
                    break;
                    
                case 'crud':
                    div.className = 'card crud-card';
                    div.style.cssText = 'background: white; border: 1px solid #e8e8e8; border-radius: 8px; padding: 20px; margin: 10px 0;';
                    
                    const crudTitle = document.createElement('div');
                    crudTitle.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;';
                    
                    const title = document.createElement('h3');
                    title.textContent = component.title || 'CRUD æ•°æ®ç®¡ç†';
                    title.style.cssText = 'margin: 0; color: #333; flex: 1;';
                    
                    const toolbar = document.createElement('div');
                    toolbar.style.cssText = 'display: flex; gap: 8px;';
                    
                    const addBtn = document.createElement('button');
                    addBtn.textContent = '+ æ–°å¢';
                    addBtn.style.cssText = 'padding: 6px 12px; background: #52c41a; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    const refreshBtn = document.createElement('button');
                    refreshBtn.textContent = 'ğŸ”„ åˆ·æ–°';
                    refreshBtn.style.cssText = 'padding: 6px 12px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'ğŸ—‘ï¸ åˆ é™¤';
                    deleteBtn.style.cssText = 'padding: 6px 12px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
                    
                    toolbar.appendChild(addBtn);
                    toolbar.appendChild(refreshBtn);
                    toolbar.appendChild(deleteBtn);
                    crudTitle.appendChild(title);
                    crudTitle.appendChild(toolbar);
                    div.appendChild(crudTitle);
                    
                    // æ¸²æŸ“æœç´¢æ 
                    const searchBar = document.createElement('div');
                    searchBar.style.cssText = 'margin-bottom: 16px; display: flex; gap: 8px;';
                    
                    const searchInput = document.createElement('input');
                    searchInput.type = 'text';
                    searchInput.placeholder = 'è¯·è¾“å…¥æœç´¢å…³é”®è¯...';
                    searchInput.style.cssText = 'flex: 1; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px;';
                    
                    const searchBtn = document.createElement('button');
                    searchBtn.textContent = 'æœç´¢';
                    searchBtn.style.cssText = 'padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer;';
                    
                    searchBar.appendChild(searchInput);
                    searchBar.appendChild(searchBtn);
                    div.appendChild(searchBar);
                    
                    // é‡ç”¨tableç»„ä»¶æ¸²æŸ“æ•°æ®è¡¨æ ¼
                    const tableComponent = { 
                        ...component, 
                        type: 'table',
                        columns: component.columns || [
                            { name: 'id', label: 'ID' },
                            { name: 'name', label: 'åç§°' },
                            { name: 'status', label: 'çŠ¶æ€' },
                            { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´' },
                            { name: 'action', label: 'æ“ä½œ' }
                        ]
                    };
                    const tableElement = renderComponent(tableComponent);
                    if (tableElement) div.appendChild(tableElement);
                    break;
                    
                default:
                    div.innerHTML = `
                        <div style="padding: 10px; background: #f0f0f0; border-radius: 4px; color: #666; margin: 8px 0;">
                            <strong>ç»„ä»¶ç±»å‹:</strong> ${component.type}<br>
                            <small>ç®€æ˜“ç¼–è¾‘å™¨æš‚ä¸æ”¯æŒæ­¤ç»„ä»¶ç±»å‹</small>
                        </div>
                    `;
                    console.log('ä¸æ”¯æŒçš„ç»„ä»¶ç±»å‹:', component.type, component);
            }
            
            return div;
        }

        // æ·»åŠ æç¤ºæ¡†
        function addAlert() {
            const alert = {
                type: 'alert',
                level: 'info',
                body: 'è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æç¤ºæ¡†'
            };
            currentSchema.body.push(alert);
            renderContent();
            showStatus('æç¤ºæ¡†å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ å¡ç‰‡
        function addCard() {
            const card = {
                type: 'card',
                header: { title: 'æ–°å¡ç‰‡' },
                body: 'è¿™æ˜¯ä¸€ä¸ªæ–°çš„å¡ç‰‡å†…å®¹'
            };
            currentSchema.body.push(card);
            renderContent();
            showStatus('å¡ç‰‡å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ ç»Ÿè®¡å¡ç‰‡
        function addStatCard() {
            const statCard = {
                type: 'stat-card',
                number: Math.floor(Math.random() * 1000),
                label: 'éšæœºæ•°æ®',
                color: ['#1890ff', '#52c41a', '#fa8c16', '#722ed1'][Math.floor(Math.random() * 4)]
            };
            currentSchema.body.push(statCard);
            renderContent();
            showStatus('ç»Ÿè®¡å¡ç‰‡å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ ç½‘æ ¼å¸ƒå±€
        function addGrid() {
            const grid = {
                type: 'grid',
                columns: [
                    {
                        body: {
                            type: 'stat-card',
                            number: '24',
                            label: 'é¡¹ç›®æ•°',
                            color: '#1890ff'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '156',
                            label: 'æ¨¡å‹æ•°',
                            color: '#52c41a'
                        }
                    },
                    {
                        body: {
                            type: 'stat-card',
                            number: '89',
                            label: 'èšåˆæ ¹',
                            color: '#fa8c16'
                        }
                    }
                ]
            };
            currentSchema.body.push(grid);
            renderContent();
            showStatus('ç½‘æ ¼å¸ƒå±€å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ è¡¨å•
        function addForm() {
            const form = {
                type: 'form',
                title: 'ç”¨æˆ·ä¿¡æ¯è¡¨å•',
                body: [
                    { type: 'input-text', label: 'å§“å', name: 'name', required: true },
                    { type: 'input-email', label: 'é‚®ç®±', name: 'email', required: true },
                    { type: 'select', label: 'éƒ¨é—¨', name: 'department', options: [
                        { label: 'æŠ€æœ¯éƒ¨', value: 'tech' },
                        { label: 'äº§å“éƒ¨', value: 'product' },
                        { label: 'è¿è¥éƒ¨', value: 'ops' }
                    ]},
                    { type: 'textarea', label: 'ä¸ªäººç®€ä»‹', name: 'bio', rows: 4 }
                ]
            };
            currentSchema.body.push(form);
            renderContent();
            showStatus('è¡¨å•å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ æ–‡æœ¬è¾“å…¥
        function addInputText() {
            const input = {
                type: 'input-text',
                label: 'æ–‡æœ¬è¾“å…¥',
                name: 'textInput',
                placeholder: 'è¯·è¾“å…¥æ–‡æœ¬...'
            };
            currentSchema.body.push(input);
            renderContent();
            showStatus('æ–‡æœ¬è¾“å…¥å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ å¤šè¡Œæ–‡æœ¬
        function addTextarea() {
            const textarea = {
                type: 'textarea',
                label: 'å¤šè¡Œæ–‡æœ¬',
                name: 'textareaInput',
                placeholder: 'è¯·è¾“å…¥å¤šè¡Œæ–‡æœ¬...',
                rows: 4
            };
            currentSchema.body.push(textarea);
            renderContent();
            showStatus('å¤šè¡Œæ–‡æœ¬å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ ä¸‹æ‹‰é€‰æ‹©
        function addSelect() {
            const select = {
                type: 'select',
                label: 'ä¸‹æ‹‰é€‰æ‹©',
                name: 'selectInput',
                placeholder: 'è¯·é€‰æ‹©é€‰é¡¹...',
                options: [
                    { label: 'é€‰é¡¹ä¸€', value: 'option1' },
                    { label: 'é€‰é¡¹äºŒ', value: 'option2' },
                    { label: 'é€‰é¡¹ä¸‰', value: 'option3' }
                ]
            };
            currentSchema.body.push(select);
            renderContent();
            showStatus('ä¸‹æ‹‰é€‰æ‹©å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ æ•°æ®è¡¨æ ¼
        function addTable() {
            const table = {
                type: 'table',
                title: 'æ•°æ®è¡¨æ ¼',
                columns: [
                    { name: 'id', label: 'ID' },
                    { name: 'name', label: 'å§“å' },
                    { name: 'email', label: 'é‚®ç®±' },
                    { name: 'status', label: 'çŠ¶æ€' },
                    { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´' }
                ],
                data: [
                    { id: 1, name: 'å¼ ä¸‰', email: 'zhang@example.com', status: 'æ¿€æ´»', createdAt: '2025-01-01' },
                    { id: 2, name: 'æå››', email: 'li@example.com', status: 'ç¦ç”¨', createdAt: '2025-01-02' },
                    { id: 3, name: 'ç‹äº”', email: 'wang@example.com', status: 'æ¿€æ´»', createdAt: '2025-01-03' }
                ]
            };
            currentSchema.body.push(table);
            renderContent();
            showStatus('æ•°æ®è¡¨æ ¼å·²æ·»åŠ ', 'success');
        }

        // æ·»åŠ CRUDç®¡ç†
        function addCrud() {
            const crud = {
                type: 'crud',
                title: 'ç”¨æˆ·ç®¡ç†',
                columns: [
                    { name: 'id', label: 'ID' },
                    { name: 'name', label: 'ç”¨æˆ·å' },
                    { name: 'email', label: 'é‚®ç®±' },
                    { name: 'role', label: 'è§’è‰²' },
                    { name: 'status', label: 'çŠ¶æ€' },
                    { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´' },
                    { name: 'action', label: 'æ“ä½œ' }
                ]
            };
            currentSchema.body.push(crud);
            renderContent();
            showStatus('CRUDç®¡ç†å·²æ·»åŠ ', 'success');
        }

        // ========== æ–°å¢ç»„ä»¶å‡½æ•° ==========
        
        // è¡¨å•ç»„ä»¶
        function addDatePicker() {
            const datePicker = {
                type: 'input-date',
                name: 'date',
                label: 'é€‰æ‹©æ—¥æœŸ',
                format: 'YYYY-MM-DD',
                placeholder: 'è¯·é€‰æ‹©æ—¥æœŸ'
            };
            currentSchema.body.push(datePicker);
            renderContent();
            showStatus('æ—¥æœŸé€‰æ‹©å™¨å·²æ·»åŠ ', 'success');
        }

        function addUpload() {
            const upload = {
                type: 'input-file',
                name: 'file',
                label: 'æ–‡ä»¶ä¸Šä¼ ',
                accept: '.jpg,.png,.pdf,.doc,.docx',
                multiple: true,
                maxSize: 10485760,
                placeholder: 'ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ '
            };
            currentSchema.body.push(upload);
            renderContent();
            showStatus('æ–‡ä»¶ä¸Šä¼ ç»„ä»¶å·²æ·»åŠ ', 'success');
        }

        function addRichText() {
            const richText = {
                type: 'input-rich-text',
                name: 'content',
                label: 'å¯Œæ–‡æœ¬å†…å®¹',
                placeholder: 'è¯·è¾“å…¥å¯Œæ–‡æœ¬å†…å®¹...',
                options: {
                    height: 300,
                    toolbar: 'bold italic underline strikethrough | alignleft aligncenter alignright | bullist numlist | link image'
                }
            };
            currentSchema.body.push(richText);
            renderContent();
            showStatus('å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å·²æ·»åŠ ', 'success');
        }

        function addCascader() {
            const cascader = {
                type: 'input-cascader',
                name: 'cascader',
                label: 'çº§è”é€‰æ‹©',
                options: [
                    {
                        label: 'æµ™æ±Ÿçœ',
                        value: 'zhejiang',
                        children: [
                            { label: 'æ­å·å¸‚', value: 'hangzhou' },
                            { label: 'å®æ³¢å¸‚', value: 'ningbo' }
                        ]
                    },
                    {
                        label: 'æ±Ÿè‹çœ',
                        value: 'jiangsu',
                        children: [
                            { label: 'å—äº¬å¸‚', value: 'nanjing' },
                            { label: 'è‹å·å¸‚', value: 'suzhou' }
                        ]
                    }
                ]
            };
            currentSchema.body.push(cascader);
            renderContent();
            showStatus('çº§è”é€‰æ‹©å™¨å·²æ·»åŠ ', 'success');
        }

        function addNumberInput() {
            const numberInput = {
                type: 'input-number',
                name: 'number',
                label: 'æ•°å­—è¾“å…¥',
                min: 0,
                max: 100,
                step: 1,
                placeholder: 'è¯·è¾“å…¥æ•°å­—'
            };
            currentSchema.body.push(numberInput);
            renderContent();
            showStatus('æ•°å­—è¾“å…¥æ¡†å·²æ·»åŠ ', 'success');
        }

        function addSwitch() {
            const switchComp = {
                type: 'switch',
                name: 'enabled',
                label: 'å¯ç”¨çŠ¶æ€',
                option: 'å¼€å¯'
            };
            currentSchema.body.push(switchComp);
            renderContent();
            showStatus('å¼€å…³ç»„ä»¶å·²æ·»åŠ ', 'success');
        }

        function addCheckbox() {
            const checkbox = {
                type: 'checkboxes',
                name: 'hobby',
                label: 'å…´è¶£çˆ±å¥½',
                options: [
                    { label: 'è¯»ä¹¦', value: 'reading' },
                    { label: 'éŸ³ä¹', value: 'music' },
                    { label: 'è¿åŠ¨', value: 'sports' },
                    { label: 'æ—…æ¸¸', value: 'travel' }
                ]
            };
            currentSchema.body.push(checkbox);
            renderContent();
            showStatus('å¤é€‰æ¡†å·²æ·»åŠ ', 'success');
        }

        function addRadio() {
            const radio = {
                type: 'radios',
                name: 'gender',
                label: 'æ€§åˆ«',
                options: [
                    { label: 'ç”·', value: 'male' },
                    { label: 'å¥³', value: 'female' },
                    { label: 'å…¶ä»–', value: 'other' }
                ]
            };
            currentSchema.body.push(radio);
            renderContent();
            showStatus('å•é€‰æ¡†å·²æ·»åŠ ', 'success');
        }

        // æ•°æ®å±•ç¤ºç»„ä»¶
        function addTree() {
            const tree = {
                type: 'tree-select',
                name: 'tree',
                label: 'ç»„ç»‡æ¶æ„',
                options: [
                    {
                        label: 'æ€»éƒ¨',
                        value: 'headquarters',
                        children: [
                            {
                                label: 'æŠ€æœ¯éƒ¨',
                                value: 'tech',
                                children: [
                                    { label: 'å‰ç«¯ç»„', value: 'frontend' },
                                    { label: 'åç«¯ç»„', value: 'backend' }
                                ]
                            },
                            { label: 'äº§å“éƒ¨', value: 'product' }
                        ]
                    }
                ]
            };
            currentSchema.body.push(tree);
            renderContent();
            showStatus('æ ‘å½¢ç»“æ„å·²æ·»åŠ ', 'success');
        }

        function addTimeline() {
            const timeline = {
                type: 'steps',
                name: 'timeline',
                label: 'é¡¹ç›®æ—¶é—´çº¿',
                value: 1,
                steps: [
                    {
                        title: 'é¡¹ç›®å¯åŠ¨',
                        description: 'DDDå¹³å°é¡¹ç›®æ­£å¼å¯åŠ¨ (2024-01-01)'
                    },
                    {
                        title: 'éœ€æ±‚åˆ†æ',
                        description: 'å®Œæˆéœ€æ±‚åˆ†æå’ŒæŠ€æœ¯é€‰å‹ (2024-02-15)'
                    },
                    {
                        title: 'å¼€å‘å®Œæˆ',
                        description: 'æ ¸å¿ƒåŠŸèƒ½å¼€å‘å®Œæˆ (2024-03-30)'
                    }
                ]
            };
            currentSchema.body.push(timeline);
            renderContent();
            showStatus('æ—¶é—´è½´å·²æ·»åŠ ', 'success');
        }

        function addList() {
            const list = {
                type: 'list',
                source: '$items',
                listItem: {
                    title: '$title',
                    subTitle: '$subTitle',
                    desc: '$desc',
                    avatar: '$avatar'
                }
            };
            currentSchema.body.push(list);
            renderContent();
            showStatus('åˆ—è¡¨ç»„ä»¶å·²æ·»åŠ ', 'success');
        }

        function addPagination() {
            const pagination = {
                type: 'pagination',
                total: 100,
                perPage: 10,
                showSizeChanger: true,
                showQuickJumper: true
            };
            currentSchema.body.push(pagination);
            renderContent();
            showStatus('åˆ†é¡µå™¨å·²æ·»åŠ ', 'success');
        }

        // å±•ç¤ºç»„ä»¶
        function addTag() {
            const tag = {
                type: 'tag',
                label: 'æ ‡ç­¾æ–‡æœ¬',
                color: 'primary',
                closable: true
            };
            currentSchema.body.push(tag);
            renderContent();
            showStatus('æ ‡ç­¾å·²æ·»åŠ ', 'success');
        }

        function addProgress() {
            const progress = {
                type: 'progress',
                value: 75,
                showLabel: true,
                stripe: true,
                animate: true
            };
            currentSchema.body.push(progress);
            renderContent();
            showStatus('è¿›åº¦æ¡å·²æ·»åŠ ', 'success');
        }

        function addImage() {
            const image = {
                type: 'image',
                src: 'https://via.placeholder.com/300x200/4f46e5/ffffff?text=DDD+Platform',
                alt: 'DDDå¹³å°ç¤ºä¾‹å›¾ç‰‡',
                title: 'ç¤ºä¾‹å›¾ç‰‡',
                imageMode: 'thumb'
            };
            currentSchema.body.push(image);
            renderContent();
            showStatus('å›¾ç‰‡ç»„ä»¶å·²æ·»åŠ ', 'success');
        }

        function addDivider() {
            const divider = {
                type: 'divider',
                title: 'åˆ†å‰²çº¿'
            };
            currentSchema.body.push(divider);
            renderContent();
            showStatus('åˆ†å‰²çº¿å·²æ·»åŠ ', 'success');
        }

        function addStatus() {
            const status = {
                type: 'status',
                value: 1,
                map: {
                    0: 'ç¦»çº¿',
                    1: 'åœ¨çº¿',
                    2: 'å¿™ç¢Œ'
                }
            };
            currentSchema.body.push(status);
            renderContent();
            showStatus('çŠ¶æ€æ ‡è¯†å·²æ·»åŠ ', 'success');
        }

        // äº¤äº’ç»„ä»¶
        function addButton() {
            const button = {
                type: 'button',
                label: 'æŒ‰é’®',
                level: 'primary',
                actionType: 'dialog',
                dialog: {
                    title: 'æç¤º',
                    body: 'è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æŒ‰é’®'
                }
            };
            currentSchema.body.push(button);
            renderContent();
            showStatus('æŒ‰é’®å·²æ·»åŠ ', 'success');
        }

        function addButtonGroup() {
            const buttonGroup = {
                type: 'button-group',
                buttons: [
                    { type: 'button', label: 'æ–°å»º', level: 'primary' },
                    { type: 'button', label: 'ç¼–è¾‘', level: 'info' },
                    { type: 'button', label: 'åˆ é™¤', level: 'danger' }
                ]
            };
            currentSchema.body.push(buttonGroup);
            renderContent();
            showStatus('æŒ‰é’®ç»„å·²æ·»åŠ ', 'success');
        }

        function addDropdownButton() {
            const dropdownButton = {
                type: 'dropdown-button',
                label: 'ä¸‹æ‹‰æŒ‰é’®',
                level: 'primary',
                buttons: [
                    { type: 'button', label: 'é€‰é¡¹1' },
                    { type: 'button', label: 'é€‰é¡¹2' },
                    { type: 'button', label: 'é€‰é¡¹3' }
                ]
            };
            currentSchema.body.push(dropdownButton);
            renderContent();
            showStatus('ä¸‹æ‹‰æŒ‰é’®å·²æ·»åŠ ', 'success');
        }

        function addTabs() {
            const tabs = {
                type: 'tabs',
                tabs: [
                    {
                        title: 'åŸºæœ¬ä¿¡æ¯',
                        body: {
                            type: 'tpl',
                            tpl: '<p>åŸºæœ¬ä¿¡æ¯å†…å®¹</p>'
                        }
                    },
                    {
                        title: 'è¯¦ç»†é…ç½®',
                        body: {
                            type: 'tpl',
                            tpl: '<p>è¯¦ç»†é…ç½®å†…å®¹</p>'
                        }
                    },
                    {
                        title: 'æƒé™è®¾ç½®',
                        body: {
                            type: 'tpl',
                            tpl: '<p>æƒé™è®¾ç½®å†…å®¹</p>'
                        }
                    }
                ]
            };
            currentSchema.body.push(tabs);
            renderContent();
            showStatus('æ ‡ç­¾é¡µå·²æ·»åŠ ', 'success');
        }

        function addCollapse() {
            const collapse = {
                type: 'collapse',
                accordion: false,
                body: [
                    {
                        title: 'é¢æ¿1',
                        body: 'è¿™æ˜¯é¢æ¿1çš„å†…å®¹'
                    },
                    {
                        title: 'é¢æ¿2',
                        body: 'è¿™æ˜¯é¢æ¿2çš„å†…å®¹'
                    },
                    {
                        title: 'é¢æ¿3',
                        body: 'è¿™æ˜¯é¢æ¿3çš„å†…å®¹'
                    }
                ]
            };
            currentSchema.body.push(collapse);
            renderContent();
            showStatus('æŠ˜å é¢æ¿å·²æ·»åŠ ', 'success');
        }

        // ========== å®Œæ•´CRUDç¤ºä¾‹ ==========
        
        // å®Œæ•´ç”¨æˆ·ç®¡ç†CRUDç¤ºä¾‹
        function loadUserManagementDemo() {
            currentSchema = {
                type: 'page',
                title: 'ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ - å®Œæ•´CRUDç¤ºä¾‹',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·ç®¡ç†CRUDåº”ç”¨ç¤ºä¾‹ï¼Œè¿æ¥åˆ°åç«¯API http://localhost:8100/api/users'
                    },
                    {
                        type: 'crud',
                        api: 'http://localhost:8100/api/users',
                        syncLocation: false,
                        title: 'ç”¨æˆ·åˆ—è¡¨',
                        headerToolbar: [
                            'bulkActions',
                            {
                                type: 'button',
                                label: 'æ–°å¢ç”¨æˆ·',
                                actionType: 'dialog',
                                icon: 'fa fa-plus',
                                primary: true,
                                dialog: {
                                    title: 'æ–°å¢ç”¨æˆ·',
                                    body: {
                                        type: 'form',
                                        api: 'post:http://localhost:8100/api/users',
                                        body: [
                                            {
                                                type: 'input-text',
                                                name: 'name',
                                                label: 'ç”¨æˆ·å',
                                                required: true,
                                                placeholder: 'è¯·è¾“å…¥ç”¨æˆ·å'
                                            },
                                            {
                                                type: 'input-email',
                                                name: 'email',
                                                label: 'é‚®ç®±',
                                                required: true,
                                                placeholder: 'è¯·è¾“å…¥é‚®ç®±åœ°å€'
                                            },
                                            {
                                                type: 'input-text',
                                                name: 'phone',
                                                label: 'æ‰‹æœºå·',
                                                placeholder: 'è¯·è¾“å…¥æ‰‹æœºå·'
                                            },
                                            {
                                                type: 'select',
                                                name: 'role',
                                                label: 'è§’è‰²',
                                                value: 'user',
                                                options: [
                                                    { label: 'ç®¡ç†å‘˜', value: 'admin' },
                                                    { label: 'ç”¨æˆ·', value: 'user' },
                                                    { label: 'è®¿å®¢', value: 'guest' }
                                                ]
                                            },
                                            {
                                                type: 'select',
                                                name: 'status',
                                                label: 'çŠ¶æ€',
                                                value: 'active',
                                                options: [
                                                    { label: 'å¯ç”¨', value: 'active' },
                                                    { label: 'ç¦ç”¨', value: 'inactive' }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            },
                            'reload'
                        ],
                        footerToolbar: ['statistics', 'pagination'],
                        columns: [
                            {
                                name: 'id',
                                label: 'ID',
                                width: 60,
                                type: 'text'
                            },
                            {
                                name: 'avatar',
                                label: 'å¤´åƒ',
                                type: 'image',
                                width: 60,
                                height: 40
                            },
                            {
                                name: 'name',
                                label: 'ç”¨æˆ·å',
                                searchable: true,
                                type: 'text'
                            },
                            {
                                name: 'email',
                                label: 'é‚®ç®±',
                                searchable: true,
                                type: 'text'
                            },
                            {
                                name: 'role',
                                label: 'è§’è‰²',
                                type: 'mapping',
                                map: {
                                    'admin': '<span class="label label-info">ç®¡ç†å‘˜</span>',
                                    'user': '<span class="label label-success">ç”¨æˆ·</span>',
                                    'guest': '<span class="label label-default">è®¿å®¢</span>'
                                }
                            },
                            {
                                name: 'status',
                                label: 'çŠ¶æ€',
                                type: 'mapping',
                                map: {
                                    'active': '<span class="label label-success">å¯ç”¨</span>',
                                    'inactive': '<span class="label label-danger">ç¦ç”¨</span>'
                                }
                            },
                            {
                                name: 'createdAt',
                                label: 'åˆ›å»ºæ—¶é—´',
                                type: 'datetime',
                                format: 'YYYY-MM-DD HH:mm:ss',
                                sortable: true
                            },
                            {
                                type: 'operation',
                                label: 'æ“ä½œ',
                                width: 150,
                                buttons: [
                                    {
                                        type: 'button',
                                        label: 'è¯¦æƒ…',
                                        actionType: 'dialog',
                                        level: 'info',
                                        dialog: {
                                            title: 'ç”¨æˆ·è¯¦æƒ…',
                                            body: {
                                                type: 'form',
                                                body: [
                                                    {
                                                        type: 'static',
                                                        name: 'name',
                                                        label: 'ç”¨æˆ·å'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'email',
                                                        label: 'é‚®ç®±'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'role',
                                                        label: 'è§’è‰²'
                                                    },
                                                    {
                                                        type: 'static',
                                                        name: 'createdAt',
                                                        label: 'åˆ›å»ºæ—¶é—´'
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: 'ç¼–è¾‘',
                                        actionType: 'dialog',
                                        level: 'primary',
                                        dialog: {
                                            title: 'ç¼–è¾‘ç”¨æˆ·',
                                            body: {
                                                type: 'form',
                                                api: 'put:http://localhost:8100/api/users/${id}',
                                                body: [
                                                    {
                                                        type: 'input-text',
                                                        name: 'name',
                                                        label: 'ç”¨æˆ·å',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'input-email',
                                                        name: 'email',
                                                        label: 'é‚®ç®±',
                                                        required: true
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'role',
                                                        label: 'è§’è‰²',
                                                        options: [
                                                            { label: 'ç®¡ç†å‘˜', value: 'admin' },
                                                            { label: 'ç”¨æˆ·', value: 'user' },
                                                            { label: 'è®¿å®¢', value: 'guest' }
                                                        ]
                                                    },
                                                    {
                                                        type: 'select',
                                                        name: 'status',
                                                        label: 'çŠ¶æ€',
                                                        options: [
                                                            { label: 'å¯ç”¨', value: 'active' },
                                                            { label: 'ç¦ç”¨', value: 'inactive' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: 'åˆ é™¤',
                                        actionType: 'ajax',
                                        level: 'danger',
                                        confirmText: 'ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ',
                                        api: 'delete:http://localhost:8100/api/users/${id}'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå·²åŠ è½½ - è¿æ¥åç«¯API', 'success');
        }

        function loadProjectManagementDemo() {
            showStatus('é¡¹ç›®ç®¡ç†ç³»ç»Ÿå¼€å‘ä¸­...', 'info');
        }

        function loadOrderManagementDemo() {
            showStatus('è®¢å•ç®¡ç†ç³»ç»Ÿå¼€å‘ä¸­...', 'info');
        }

        // ========== DDDå±å¹•ç±»å‹ç”Ÿæˆå™¨ ==========
        
        // ç”Ÿæˆåˆ—è¡¨å±å¹•
        function generateListScreen() {
            currentSchema = {
                type: 'page',
                title: 'ç”¨æˆ·åˆ—è¡¨',
                body: [
                    {
                        type: 'crud',
                        title: 'ç”¨æˆ·ç®¡ç†',
                        api: '/api/users',
                        filter: {
                            title: 'æœç´¢ç­›é€‰',
                            body: [
                                {
                                    type: 'input-text',
                                    name: 'keyword',
                                    label: 'å…³é”®è¯',
                                    placeholder: 'æœç´¢ç”¨æˆ·åã€é‚®ç®±'
                                },
                                {
                                    type: 'select',
                                    name: 'status',
                                    label: 'çŠ¶æ€',
                                    options: [
                                        { label: 'å…¨éƒ¨', value: '' },
                                        { label: 'å¯ç”¨', value: 'active' },
                                        { label: 'ç¦ç”¨', value: 'inactive' }
                                    ]
                                },
                                {
                                    type: 'input-date-range',
                                    name: 'dateRange',
                                    label: 'åˆ›å»ºæ—¶é—´'
                                }
                            ]
                        },
                        headerToolbar: [
                            {
                                type: 'button',
                                label: 'æ–°å»ºç”¨æˆ·',
                                level: 'primary',
                                icon: 'fa fa-plus',
                                actionType: 'drawer',
                                drawer: {
                                    title: 'æ–°å»ºç”¨æˆ·',
                                    body: {
                                        type: 'form',
                                        api: 'POST:/api/users',
                                        body: [
                                            { type: 'input-text', name: 'name', label: 'ç”¨æˆ·å', required: true },
                                            { type: 'input-email', name: 'email', label: 'é‚®ç®±', required: true },
                                            { type: 'input-password', name: 'password', label: 'å¯†ç ', required: true },
                                            { type: 'select', name: 'role', label: 'è§’è‰²', options: [
                                                { label: 'ç®¡ç†å‘˜', value: 'admin' },
                                                { label: 'æ™®é€šç”¨æˆ·', value: 'user' }
                                            ]}
                                        ]
                                    }
                                }
                            },
                            {
                                type: 'button',
                                label: 'æ‰¹é‡åˆ é™¤',
                                level: 'danger',
                                icon: 'fa fa-trash'
                            },
                            'reload'
                        ],
                        columns: [
                            { name: 'id', label: 'ID', sortable: true, width: 80 },
                            { name: 'avatar', label: 'å¤´åƒ', type: 'avatar', width: 60 },
                            { name: 'name', label: 'ç”¨æˆ·å', sortable: true },
                            { name: 'email', label: 'é‚®ç®±', sortable: true },
                            { name: 'role', label: 'è§’è‰²', type: 'mapping', map: {
                                'admin': '<span class="label label-success">ç®¡ç†å‘˜</span>',
                                'user': '<span class="label label-info">æ™®é€šç”¨æˆ·</span>'
                            }},
                            { name: 'status', label: 'çŠ¶æ€', type: 'status', map: {
                                'active': 'success',
                                'inactive': 'danger'
                            }},
                            { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´', type: 'datetime', sortable: true },
                            {
                                name: 'operation',
                                label: 'æ“ä½œ',
                                type: 'operation',
                                buttons: [
                                    {
                                        type: 'button',
                                        label: 'æŸ¥çœ‹',
                                        level: 'info',
                                        size: 'xs',
                                        actionType: 'drawer',
                                        drawer: {
                                            title: 'ç”¨æˆ·è¯¦æƒ…',
                                            body: {
                                                type: 'service',
                                                api: '/api/users/${id}',
                                                body: [
                                                    {
                                                        type: 'form',
                                                        mode: 'horizontal',
                                                        static: true,
                                                        body: [
                                                            { type: 'static', name: 'name', label: 'ç”¨æˆ·å' },
                                                            { type: 'static', name: 'email', label: 'é‚®ç®±' },
                                                            { type: 'static', name: 'role', label: 'è§’è‰²' },
                                                            { type: 'static', name: 'status', label: 'çŠ¶æ€' },
                                                            { type: 'static', name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´' }
                                                        ]
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: 'ç¼–è¾‘',
                                        level: 'primary',
                                        size: 'xs',
                                        actionType: 'drawer',
                                        drawer: {
                                            title: 'ç¼–è¾‘ç”¨æˆ·',
                                            body: {
                                                type: 'form',
                                                api: 'PUT:/api/users/${id}',
                                                initApi: '/api/users/${id}',
                                                body: [
                                                    { type: 'input-text', name: 'name', label: 'ç”¨æˆ·å', required: true },
                                                    { type: 'input-email', name: 'email', label: 'é‚®ç®±', required: true },
                                                    { type: 'select', name: 'role', label: 'è§’è‰²', options: [
                                                        { label: 'ç®¡ç†å‘˜', value: 'admin' },
                                                        { label: 'æ™®é€šç”¨æˆ·', value: 'user' }
                                                    ]},
                                                    { type: 'switch', name: 'status', label: 'å¯ç”¨çŠ¶æ€' }
                                                ]
                                            }
                                        }
                                    },
                                    {
                                        type: 'button',
                                        label: 'åˆ é™¤',
                                        level: 'danger',
                                        size: 'xs',
                                        actionType: 'ajax',
                                        api: 'DELETE:/api/users/${id}',
                                        confirmText: 'ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('åˆ—è¡¨å±å¹•å·²ç”Ÿæˆ', 'success');
        }

        // ç”Ÿæˆè¯¦æƒ…å±å¹•
        function generateDetailScreen() {
            currentSchema = {
                type: 'page',
                title: 'ç”¨æˆ·è¯¦æƒ…',
                body: [
                    {
                        type: 'service',
                        api: '/api/users/1',
                        body: [
                            {
                                type: 'panel',
                                title: 'åŸºæœ¬ä¿¡æ¯',
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    static: true,
                                    body: [
                                        { name: 'avatar', label: 'å¤´åƒ', type: 'static-image' },
                                        { name: 'name', label: 'ç”¨æˆ·å', type: 'static' },
                                        { name: 'email', label: 'é‚®ç®±', type: 'static' },
                                        { name: 'phone', label: 'æ‰‹æœºå·', type: 'static' },
                                        { name: 'role', label: 'è§’è‰²', type: 'static' },
                                        { name: 'status', label: 'çŠ¶æ€', type: 'static' },
                                        { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´', type: 'static' },
                                        { name: 'lastLoginAt', label: 'æœ€åç™»å½•', type: 'static' }
                                    ]
                                }
                            },
                            {
                                type: 'tabs',
                                tabs: [
                                    {
                                        title: 'æƒé™ä¿¡æ¯',
                                        body: {
                                            type: 'service',
                                            api: '/api/users/1/permissions',
                                            body: [
                                                {
                                                    type: 'table',
                                                    source: '${permissions}',
                                                    columns: [
                                                        { name: 'module', label: 'æ¨¡å—' },
                                                        { name: 'permission', label: 'æƒé™' },
                                                        { name: 'granted', label: 'æ˜¯å¦æˆæƒ', type: 'status' }
                                                    ]
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        title: 'æ“ä½œæ—¥å¿—',
                                        body: {
                                            type: 'service',
                                            api: '/api/users/1/logs',
                                            body: [
                                                {
                                                    type: 'timeline',
                                                    source: '${logs}',
                                                    itemTitleTpl: '${action}',
                                                    itemDetailTpl: '${description}<br/><small>${createdAt}</small>'
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ],
                aside: {
                    type: 'wrapper',
                    size: 'xs',
                    body: [
                        {
                            type: 'button',
                            label: 'ç¼–è¾‘ç”¨æˆ·',
                            level: 'primary',
                            block: true,
                            actionType: 'url',
                            url: '/user/edit/1'
                        },
                        {
                            type: 'button',
                            label: 'åˆ é™¤ç”¨æˆ·',
                            level: 'danger',
                            block: true,
                            actionType: 'ajax',
                            api: 'DELETE:/api/users/1',
                            confirmText: 'ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿ'
                        },
                        {
                            type: 'button',
                            label: 'è¿”å›åˆ—è¡¨',
                            block: true,
                            actionType: 'url',
                            url: '/user/list'
                        }
                    ]
                }
            };
            renderContent();
            showStatus('è¯¦æƒ…å±å¹•å·²ç”Ÿæˆ', 'success');
        }

        // ç”Ÿæˆç¼–è¾‘å±å¹•
        function generateEditScreen() {
            currentSchema = {
                type: 'page',
                title: 'ç¼–è¾‘ç”¨æˆ·',
                body: [
                    {
                        type: 'form',
                        title: 'ç”¨æˆ·ä¿¡æ¯',
                        api: 'PUT:/api/users/1',
                        initApi: '/api/users/1',
                        redirect: '/user/list',
                        body: [
                            {
                                type: 'tabs',
                                tabs: [
                                    {
                                        title: 'åŸºæœ¬ä¿¡æ¯',
                                        body: [
                                            {
                                                type: 'grid',
                                                columns: [
                                                    {
                                                        body: [
                                                            {
                                                                type: 'input-text',
                                                                name: 'name',
                                                                label: 'ç”¨æˆ·å',
                                                                required: true,
                                                                validations: {
                                                                    minLength: 2,
                                                                    maxLength: 20
                                                                }
                                                            },
                                                            {
                                                                type: 'input-email',
                                                                name: 'email',
                                                                label: 'é‚®ç®±',
                                                                required: true,
                                                                validations: 'isEmail'
                                                            },
                                                            {
                                                                type: 'input-text',
                                                                name: 'phone',
                                                                label: 'æ‰‹æœºå·',
                                                                validations: 'isPhoneNumber'
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        body: [
                                                            {
                                                                type: 'input-file',
                                                                name: 'avatar',
                                                                label: 'å¤´åƒ',
                                                                accept: '.jpg,.jpeg,.png',
                                                                receiver: '/api/upload/avatar',
                                                                autoUpload: true
                                                            },
                                                            {
                                                                type: 'select',
                                                                name: 'role',
                                                                label: 'è§’è‰²',
                                                                required: true,
                                                                options: [
                                                                    { label: 'ç®¡ç†å‘˜', value: 'admin' },
                                                                    { label: 'æ™®é€šç”¨æˆ·', value: 'user' },
                                                                    { label: 'è®¿å®¢', value: 'guest' }
                                                                ]
                                                            },
                                                            {
                                                                type: 'switch',
                                                                name: 'status',
                                                                label: 'å¯ç”¨çŠ¶æ€',
                                                                option: 'å¯ç”¨'
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        title: 'æ‰©å±•ä¿¡æ¯',
                                        body: [
                                            {
                                                type: 'input-date',
                                                name: 'birthday',
                                                label: 'ç”Ÿæ—¥',
                                                format: 'YYYY-MM-DD'
                                            },
                                            {
                                                type: 'radios',
                                                name: 'gender',
                                                label: 'æ€§åˆ«',
                                                options: [
                                                    { label: 'ç”·', value: 'male' },
                                                    { label: 'å¥³', value: 'female' },
                                                    { label: 'å…¶ä»–', value: 'other' }
                                                ]
                                            },
                                            {
                                                type: 'textarea',
                                                name: 'bio',
                                                label: 'ä¸ªäººç®€ä»‹',
                                                rows: 4,
                                                maxLength: 500
                                            },
                                            {
                                                type: 'checkboxes',
                                                name: 'interests',
                                                label: 'å…´è¶£çˆ±å¥½',
                                                options: [
                                                    { label: 'ç¼–ç¨‹', value: 'programming' },
                                                    { label: 'é˜…è¯»', value: 'reading' },
                                                    { label: 'è¿åŠ¨', value: 'sports' },
                                                    { label: 'éŸ³ä¹', value: 'music' },
                                                    { label: 'æ—…æ¸¸', value: 'travel' }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        actions: [
                            {
                                type: 'button',
                                label: 'ä¿å­˜',
                                level: 'primary',
                                actionType: 'submit'
                            },
                            {
                                type: 'button',
                                label: 'ä¿å­˜å¹¶ç»§ç»­',
                                level: 'info',
                                actionType: 'submit',
                                reload: 'window'
                            },
                            {
                                type: 'button',
                                label: 'å–æ¶ˆ',
                                actionType: 'cancel'
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('ç¼–è¾‘å±å¹•å·²ç”Ÿæˆ', 'success');
        }

        // ç”Ÿæˆä»ªè¡¨æ¿å±å¹•
        function generateDashboardScreen() {
            currentSchema = {
                type: 'page',
                title: 'ç”¨æˆ·ç®¡ç†ä»ªè¡¨æ¿',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'ğŸ“Š ç”¨æˆ·ç®¡ç†æ•°æ®ç»Ÿè®¡æ¦‚è§ˆ'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '1,234',
                                    label: 'ğŸ‘¥ æ€»ç”¨æˆ·æ•°',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '987',
                                    label: 'âœ… æ´»è·ƒç”¨æˆ·',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '123',
                                    label: 'ğŸ”´ ä»Šæ—¥æ–°å¢',
                                    color: '#fa8c16'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '45',
                                    label: 'ğŸ‘¤ åœ¨çº¿ç”¨æˆ·',
                                    color: '#722ed1'
                                }
                            }
                        ]
                    },
                    {
                        type: 'divider'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'chart',
                                    title: 'ç”¨æˆ·æ³¨å†Œè¶‹åŠ¿',
                                    api: '/api/charts/user-registration-trend',
                                    config: {
                                        type: 'line',
                                        xField: 'date',
                                        yField: 'count',
                                        color: '#1890ff'
                                    }
                                }
                            },
                            {
                                body: {
                                    type: 'chart',
                                    title: 'è§’è‰²åˆ†å¸ƒ',
                                    api: '/api/charts/role-distribution',
                                    config: {
                                        type: 'pie',
                                        angleField: 'value',
                                        colorField: 'type'
                                    }
                                }
                            }
                        ]
                    },
                    {
                        type: 'divider'
                    },
                    {
                        type: 'panel',
                        title: 'å¿«é€Ÿæ“ä½œ',
                        body: [
                            {
                                type: 'button-group',
                                buttons: [
                                    {
                                        type: 'button',
                                        label: 'æ–°å»ºç”¨æˆ·',
                                        level: 'primary',
                                        icon: 'fa fa-plus',
                                        actionType: 'url',
                                        url: '/user/create'
                                    },
                                    {
                                        type: 'button',
                                        label: 'ç”¨æˆ·åˆ—è¡¨',
                                        level: 'info',
                                        icon: 'fa fa-list',
                                        actionType: 'url',
                                        url: '/user/list'
                                    },
                                    {
                                        type: 'button',
                                        label: 'å¯¼å‡ºæ•°æ®',
                                        level: 'success',
                                        icon: 'fa fa-download',
                                        actionType: 'ajax',
                                        api: '/api/users/export'
                                    },
                                    {
                                        type: 'button',
                                        label: 'æ•°æ®åˆ†æ',
                                        level: 'warning',
                                        icon: 'fa fa-chart-bar',
                                        actionType: 'url',
                                        url: '/analytics/users'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        type: 'panel',
                        title: 'æœ€è¿‘æ´»åŠ¨',
                        body: {
                            type: 'service',
                            api: '/api/users/recent-activities',
                            body: [
                                {
                                    type: 'list',
                                    source: '${activities}',
                                    listItem: {
                                        title: '${user.name} ${action}',
                                        subTitle: '${createdAt}',
                                        desc: '${description}',
                                        avatar: '${user.avatar}'
                                    }
                                }
                            ]
                        }
                    }
                ]
            };
            renderContent();
            showStatus('ä»ªè¡¨æ¿å±å¹•å·²ç”Ÿæˆ', 'success');
        }

        // ç”Ÿæˆå·¥ä½œæµå±å¹•
        function generateWorkflowScreen() {
            currentSchema = {
                type: 'page',
                title: 'ç”¨æˆ·å®¡æ‰¹å·¥ä½œæµ',
                body: [
                    {
                        type: 'service',
                        api: '/api/workflow/user-approval/1',
                        body: [
                            {
                                type: 'panel',
                                title: 'ç”³è¯·ä¿¡æ¯',
                                body: {
                                    type: 'form',
                                    mode: 'horizontal',
                                    static: true,
                                    body: [
                                        { name: 'applicant', label: 'ç”³è¯·äºº', type: 'static' },
                                        { name: 'requestType', label: 'ç”³è¯·ç±»å‹', type: 'static' },
                                        { name: 'reason', label: 'ç”³è¯·ç†ç”±', type: 'static' },
                                        { name: 'createdAt', label: 'ç”³è¯·æ—¶é—´', type: 'static' }
                                    ]
                                }
                            },
                            {
                                type: 'steps',
                                source: '${steps}',
                                status: 'process',
                                labelPlacement: 'vertical'
                            },
                            {
                                type: 'panel',
                                title: 'å½“å‰å¤„ç†ä»»åŠ¡',
                                body: [
                                    {
                                        type: 'form',
                                        title: 'å®¡æ‰¹æ„è§',
                                        api: 'POST:/api/workflow/user-approval/1/process',
                                        body: [
                                            {
                                                type: 'radios',
                                                name: 'action',
                                                label: 'å®¡æ‰¹æ“ä½œ',
                                                required: true,
                                                options: [
                                                    { label: 'âœ… åŒæ„', value: 'approve' },
                                                    { label: 'âŒ æ‹’ç»', value: 'reject' },
                                                    { label: 'ğŸ”„ é©³å›ä¿®æ”¹', value: 'return' }
                                                ]
                                            },
                                            {
                                                type: 'textarea',
                                                name: 'comment',
                                                label: 'å¤„ç†æ„è§',
                                                rows: 3,
                                                placeholder: 'è¯·å¡«å†™å¤„ç†æ„è§...'
                                            },
                                            {
                                                type: 'input-file',
                                                name: 'attachments',
                                                label: 'é™„ä»¶',
                                                multiple: true,
                                                accept: '.pdf,.doc,.docx,.jpg,.png'
                                            }
                                        ],
                                        actions: [
                                            {
                                                type: 'button',
                                                label: 'æäº¤å¤„ç†',
                                                level: 'primary',
                                                actionType: 'submit'
                                            },
                                            {
                                                type: 'button',
                                                label: 'ä¿å­˜è‰ç¨¿',
                                                level: 'info',
                                                actionType: 'ajax',
                                                api: 'POST:/api/workflow/user-approval/1/draft'
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                type: 'panel',
                                title: 'å¤„ç†å†å²',
                                body: {
                                    type: 'timeline',
                                    source: '${history}',
                                    itemTitleTpl: '${processor} - ${action}',
                                    itemDetailTpl: '${comment}<br/><small style="color: #999;">${processedAt}</small>'
                                }
                            }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('å·¥ä½œæµå±å¹•å·²ç”Ÿæˆ', 'success');
        }

        // åŠ è½½ä»ªè¡¨æ¿æ¨¡æ¿
        function loadDashboard() {
            currentSchema = {
                type: 'page',
                title: 'DDDæ•°æ®ä»ªè¡¨æ¿',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'ğŸ¯ æ¬¢è¿ä½¿ç”¨DDDå¹³å°æ•°æ®ä»ªè¡¨æ¿'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '24',
                                    label: 'ğŸ“ æ´»è·ƒé¡¹ç›®',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '156',
                                    label: 'ğŸ—ï¸ é¢†åŸŸæ¨¡å‹',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '89',
                                    label: 'âš¡ èšåˆæ ¹',
                                    color: '#fa8c16'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '234',
                                    label: 'ğŸ’ å€¼å¯¹è±¡',
                                    color: '#722ed1'
                                }
                            }
                        ]
                    },
                    {
                        type: 'card',
                        header: { title: 'ğŸ“ˆ é¡¹ç›®æ´»è·ƒåº¦è¶‹åŠ¿' },
                        body: 'è¿™é‡Œæ˜¯å›¾è¡¨åŒºåŸŸï¼ˆå ä½ç¬¦ï¼‰'
                    }
                ]
            };
            renderContent();
            showStatus('ä»ªè¡¨æ¿æ¨¡æ¿å·²åŠ è½½ï¼', 'success');
        }

        // åŠ è½½è¡¨å•æ¨¡æ¿
        function loadForm() {
            currentSchema = {
                type: 'page',
                title: 'ğŸ“ DDDå®ä½“é…ç½®è¡¨å•',
                body: [
                    {
                        type: 'alert',
                        level: 'info',
                        body: 'ğŸ¯ è¯·å¡«å†™é¢†åŸŸå®ä½“çš„åŸºæœ¬ä¿¡æ¯'
                    },
                    {
                        type: 'form',
                        title: 'å®ä½“åŸºæœ¬ä¿¡æ¯',
                        body: [
                            { type: 'input-text', label: 'å®ä½“åç§°', name: 'entityName', required: true, placeholder: 'ä¾‹å¦‚ï¼šUser' },
                            { type: 'input-text', label: 'å®ä½“æè¿°', name: 'description', placeholder: 'å®ä½“çš„ä¸šåŠ¡å«ä¹‰æè¿°' },
                            { type: 'select', label: 'æ‰€å±åŸŸ', name: 'domain', options: [
                                { label: 'ç”¨æˆ·åŸŸ', value: 'user' },
                                { label: 'è®¢å•åŸŸ', value: 'order' },
                                { label: 'äº§å“åŸŸ', value: 'product' },
                                { label: 'æ”¯ä»˜åŸŸ', value: 'payment' }
                            ]},
                            { type: 'select', label: 'å®ä½“ç±»å‹', name: 'entityType', options: [
                                { label: 'èšåˆæ ¹', value: 'aggregate' },
                                { label: 'å®ä½“', value: 'entity' },
                                { label: 'å€¼å¯¹è±¡', value: 'valueObject' }
                            ]},
                            { type: 'textarea', label: 'ä¸šåŠ¡è§„åˆ™', name: 'businessRules', rows: 4, placeholder: 'æè¿°è¯¥å®ä½“çš„æ ¸å¿ƒä¸šåŠ¡è§„åˆ™...' }
                        ]
                    },
                    {
                        type: 'form',
                        title: 'å±æ€§é…ç½®',
                        body: [
                            { type: 'input-text', label: 'å±æ€§åç§°', name: 'propertyName', placeholder: 'ä¾‹å¦‚ï¼šname' },
                            { type: 'select', label: 'å±æ€§ç±»å‹', name: 'propertyType', options: [
                                { label: 'String', value: 'string' },
                                { label: 'Integer', value: 'integer' },
                                { label: 'Long', value: 'long' },
                                { label: 'Boolean', value: 'boolean' },
                                { label: 'Date', value: 'date' },
                                { label: 'BigDecimal', value: 'decimal' }
                            ]},
                            { type: 'textarea', label: 'å±æ€§æè¿°', name: 'propertyDesc', rows: 2 }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('DDDè¡¨å•æ¨¡æ¿å·²åŠ è½½ï¼', 'success');
        }

        // åŠ è½½CRUDæ¨¡æ¿
        function loadCrudTemplate() {
            currentSchema = {
                type: 'page',
                title: 'ğŸ”§ DDDå®ä½“CRUDç®¡ç†',
                body: [
                    {
                        type: 'alert',
                        level: 'success',
                        body: 'ğŸ¯ é¢†åŸŸå®ä½“æ•°æ®ç®¡ç†ç•Œé¢'
                    },
                    {
                        type: 'grid',
                        columns: [
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '23',
                                    label: 'ğŸ“Š æ€»å®ä½“æ•°',
                                    color: '#1890ff'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '156',
                                    label: 'ğŸ”„ æ´»è·ƒè®°å½•',
                                    color: '#52c41a'
                                }
                            },
                            {
                                body: {
                                    type: 'stat-card',
                                    number: '5',
                                    label: 'â¸ï¸ å¾…å®¡æ ¸',
                                    color: '#faad14'
                                }
                            }
                        ]
                    },
                    {
                        type: 'crud',
                        title: 'ç”¨æˆ·å®ä½“ç®¡ç†',
                        columns: [
                            { name: 'id', label: 'ID' },
                            { name: 'name', label: 'ç”¨æˆ·å' },
                            { name: 'email', label: 'é‚®ç®±' },
                            { name: 'domain', label: 'æ‰€å±åŸŸ' },
                            { name: 'entityType', label: 'å®ä½“ç±»å‹' },
                            { name: 'status', label: 'çŠ¶æ€' },
                            { name: 'createdAt', label: 'åˆ›å»ºæ—¶é—´' },
                            { name: 'action', label: 'æ“ä½œ' }
                        ]
                    }
                ]
            };
            renderContent();
            showStatus('DDD CRUDæ¨¡æ¿å·²åŠ è½½ï¼', 'success');
        }

        // åŠ è½½DDDæ¨¡æ¿
        async function loadTemplate(templateName) {
            try {
                const response = await fetch(`./templates/${templateName}.json`);
                if (response.ok) {
                    const template = await response.json();
                    currentSchema = template;
                    
                    // æ›¿æ¢æ¨¡æ¿å˜é‡ä¸ºç¤ºä¾‹æ•°æ®
                    const mockValues = {
                        projectCount: '24',
                        domainCount: '8',
                        aggregateCount: '23',
                        entityCount: '156',
                        valueObjectCount: '89',
                        domainServiceCount: '12',
                        modelScore: '85',
                        complexityLevel: 'ä¸­',
                        couplingScore: 'ä½',
                        cohesionScore: 'é«˜',
                        startTime: '2025-01-01 08:00:00',
                        memoryUsage: '256MB',
                        onlineUsers: '15',
                        analysisTime: '2025-01-01 14:30:00',
                        modelVersion: 'v1.2.0',
                        totalIssues: '8',
                        criticalIssues: '2'
                    };
                    
                    // é€’å½’æ›¿æ¢æ¨¡æ¿å˜é‡
                    function replaceTemplateVars(obj) {
                        if (typeof obj === 'string') {
                            return obj.replace(/\$\{([^}]+)\}/g, (match, key) => mockValues[key] || match);
                        } else if (Array.isArray(obj)) {
                            return obj.map(replaceTemplateVars);
                        } else if (obj && typeof obj === 'object') {
                            const result = {};
                            for (const [key, value] of Object.entries(obj)) {
                                result[key] = replaceTemplateVars(value);
                            }
                            return result;
                        }
                        return obj;
                    }
                    
                    currentSchema = replaceTemplateVars(currentSchema);
                    
                    // æ›´æ–°schemaç¼–è¾‘å™¨
                    const schemaEditor = document.getElementById('schema-editor');
                    if (schemaEditor) {
                        schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                    }
                    
                    renderContent();
                    showStatus(`${template.title} æ¨¡æ¿å·²åŠ è½½ï¼`, 'success');
                } else {
                    showStatus(`æ¨¡æ¿ ${templateName} åŠ è½½å¤±è´¥`, 'error');
                }
            } catch (error) {
                console.error('æ¨¡æ¿åŠ è½½é”™è¯¯:', error);
                showStatus('æ¨¡æ¿åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å®æ—¶é¢„è§ˆåŠŸèƒ½å¢å¼º

        // åˆ‡æ¢å±æ€§é¢æ¿
        function togglePropertyPanel() {
            const panel = document.getElementById('property-panel');
            panel.classList.toggle('active');
            showStatus('å±æ€§é¢æ¿å·²' + (panel.classList.contains('active') ? 'æ˜¾ç¤º' : 'éšè—'), 'info');
        }

        // é€‰æ‹©ç»„ä»¶
        function selectComponent(componentElement, componentData, index) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            const previousSelected = document.querySelector('.component-editable.selected');
            if (previousSelected) {
                previousSelected.classList.remove('selected');
            }

            // è®¾ç½®æ–°çš„é€‰æ‹©
            componentElement.classList.add('selected');
            selectedComponent = componentData;
            selectedComponentIndex = index;

            // æ˜¾ç¤ºå±æ€§é¢æ¿
            showPropertyPanel(componentData, index);
            
            // å¦‚æœå±æ€§æ£€æŸ¥å™¨å·²æ‰“å¼€ï¼Œè‡ªåŠ¨åŠ è½½æ–°é€‰æ‹©ç»„ä»¶çš„å±æ€§
            if (propertyInspectorVisible) {
                loadComponentProperties(componentData);
            }
            
            // ç¡®ä¿å±æ€§é¢æ¿å¯è§
            const panel = document.getElementById('property-panel');
            if (!panel.classList.contains('active')) {
                panel.classList.add('active');
            }
        }

        // æ˜¾ç¤ºå±æ€§ç¼–è¾‘é¢æ¿
        function showPropertyPanel(component, index) {
            const propertyContent = document.getElementById('property-content');
            
            let formHTML = `
                <div class="property-form">
                    <h4>ç»„ä»¶: ${component.type}</h4>
                    <label>ç»„ä»¶ç±»å‹:</label>
                    <input type="text" value="${component.type}" readonly style="background: #f5f5f5;">
                </div>
            `;

            // æ ¹æ®ç»„ä»¶ç±»å‹æ·»åŠ ä¸åŒçš„å±æ€§ç¼–è¾‘å­—æ®µ
            if (component.type === 'alert') {
                const alertLevelSelect = createSelectWithOptions([
                    { value: 'info', text: 'ä¿¡æ¯', selected: component.level === 'info' },
                    { value: 'success', text: 'æˆåŠŸ', selected: component.level === 'success' },
                    { value: 'warning', text: 'è­¦å‘Š', selected: component.level === 'warning' },
                    { value: 'error', text: 'é”™è¯¯', selected: component.level === 'error' }
                ], 'prop-level');
                
                formHTML += `
                    <div class="property-form">
                        <label>æ¶ˆæ¯å†…å®¹:</label>
                        <input type="text" id="prop-body" value="${component.body || ''}" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹">
                    </div>
                    <div class="property-form">
                        <label>çº§åˆ«:</label>
                        <div id="level-select-container"></div>
                    </div>
                `;
                
                // åœ¨æ·»åŠ HTMLåï¼Œæ’å…¥selectå…ƒç´ 
                setTimeout(() => {
                    const container = document.getElementById('level-select-container');
                    if (container) {
                        container.appendChild(alertLevelSelect);
                    }
                }, 0);
            } else if (component.type === 'card') {
                formHTML += `
                    <div class="property-form">
                        <label>æ ‡é¢˜:</label>
                        <input type="text" id="prop-title" value="${component.header?.title || ''}" placeholder="è¾“å…¥å¡ç‰‡æ ‡é¢˜">
                    </div>
                    <div class="property-form">
                        <label>å†…å®¹:</label>
                        <textarea id="prop-body" rows="3" placeholder="è¾“å…¥å¡ç‰‡å†…å®¹">${component.body || ''}</textarea>
                    </div>
                `;
            } else if (component.type === 'stat-card') {
                formHTML += `
                    <div class="property-form">
                        <label>æ•°å€¼:</label>
                        <input type="text" id="prop-number" value="${component.number || ''}" placeholder="è¾“å…¥ç»Ÿè®¡æ•°å€¼">
                    </div>
                    <div class="property-form">
                        <label>æ ‡ç­¾:</label>
                        <input type="text" id="prop-label" value="${component.label || ''}" placeholder="è¾“å…¥ç»Ÿè®¡æ ‡ç­¾">
                    </div>
                    <div class="property-form">
                        <label>é¢œè‰²:</label>
                        <input type="color" id="prop-color" value="${component.color || '#1890ff'}">
                    </div>
                `;
            } else if (component.type === 'input-text' || component.type === 'input-email' || component.type === 'input-password') {
                formHTML += `
                    <div class="property-form">
                        <label>æ ‡ç­¾:</label>
                        <input type="text" id="prop-label" value="${component.label || ''}" placeholder="è¾“å…¥å­—æ®µæ ‡ç­¾">
                    </div>
                    <div class="property-form">
                        <label>å ä½ç¬¦:</label>
                        <input type="text" id="prop-placeholder" value="${component.placeholder || ''}" placeholder="è¾“å…¥å ä½ç¬¦æ–‡æœ¬">
                    </div>
                    <div class="property-form">
                        <label>æ˜¯å¦å¿…å¡«:</label>
                        <div id="required-select-container"></div>
                    </div>
                `;
                
                // åœ¨æ·»åŠ HTMLåï¼Œæ’å…¥requiredé€‰æ‹©æ¡†
                setTimeout(() => {
                    const requiredSelect = createSelectWithOptions([
                        { value: 'false', text: 'å¦', selected: !component.required },
                        { value: 'true', text: 'æ˜¯', selected: component.required }
                    ], 'prop-required');
                    
                    const container = document.getElementById('required-select-container');
                    if (container) {
                        container.appendChild(requiredSelect);
                    }
                }, 0);
            } else if (component.type === 'form') {
                formHTML += `
                    <div class="property-form">
                        <label>è¡¨å•æ ‡é¢˜:</label>
                        <input type="text" id="prop-title" value="${component.title || ''}" placeholder="è¾“å…¥è¡¨å•æ ‡é¢˜">
                    </div>
                `;
            } else if (component.type === 'table' || component.type === 'crud') {
                formHTML += `
                    <div class="property-form">
                        <label>è¡¨æ ¼æ ‡é¢˜:</label>
                        <input type="text" id="prop-title" value="${component.title || ''}" placeholder="è¾“å…¥è¡¨æ ¼æ ‡é¢˜">
                    </div>
                `;
            }

            formHTML += `
                <div style="margin-top: 20px;">
                    <button class="btn primary" onclick="updateComponent(${index})" style="width: 100%; margin-bottom: 8px;">âœ… æ›´æ–°ç»„ä»¶</button>
                    <button class="btn" onclick="deleteComponent(${index})" style="width: 100%; background: #ff4d4f; color: white;">ğŸ—‘ï¸ åˆ é™¤ç»„ä»¶</button>
                </div>
            `;

            propertyContent.innerHTML = formHTML;
        }

        // æ›´æ–°ç»„ä»¶
        function updateComponent(index) {
            if (index === -1 || index === null || !currentSchema.body[index]) return;

            const component = currentSchema.body[index];
            
            // æ ¹æ®ç»„ä»¶ç±»å‹æ›´æ–°å±æ€§
            if (component.type === 'alert') {
                const body = document.getElementById('prop-body')?.value;
                const level = document.getElementById('prop-level')?.value;
                if (body !== undefined) component.body = body;
                if (level) component.level = level;
            } else if (component.type === 'card') {
                const title = document.getElementById('prop-title')?.value;
                const body = document.getElementById('prop-body')?.value;
                if (title !== undefined) {
                    if (!component.header) component.header = {};
                    component.header.title = title;
                }
                if (body !== undefined) component.body = body;
            } else if (component.type === 'stat-card') {
                const number = document.getElementById('prop-number')?.value;
                const label = document.getElementById('prop-label')?.value;
                const color = document.getElementById('prop-color')?.value;
                if (number !== undefined) component.number = number;
                if (label !== undefined) component.label = label;
                if (color) component.color = color;
            } else if (['input-text', 'input-email', 'input-password'].includes(component.type)) {
                const label = document.getElementById('prop-label')?.value;
                const placeholder = document.getElementById('prop-placeholder')?.value;
                const required = document.getElementById('prop-required')?.value === 'true';
                if (label !== undefined) component.label = label;
                if (placeholder !== undefined) component.placeholder = placeholder;
                component.required = required;
            } else if (component.type === 'form' || component.type === 'table' || component.type === 'crud') {
                const title = document.getElementById('prop-title')?.value;
                if (title !== undefined) component.title = title;
            }

            // é‡æ–°æ¸²æŸ“å†…å®¹
            renderContent();
            showStatus('ç»„ä»¶å·²æ›´æ–°', 'success');
        }

        // åˆ é™¤ç»„ä»¶
        function deleteComponent(index) {
            if (index === -1 || index === null || !currentSchema.body[index]) return;
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç»„ä»¶å—ï¼Ÿ')) {
                currentSchema.body.splice(index, 1);
                renderContent();
                
                // éšè—å±æ€§é¢æ¿
                document.getElementById('property-content').innerHTML = '<p style="color: #666; text-align: center; margin-top: 40px;">é€‰æ‹©ä¸€ä¸ªç»„ä»¶æ¥ç¼–è¾‘å…¶å±æ€§</p>';
                
                showStatus('ç»„ä»¶å·²åˆ é™¤', 'success');
            }
        }

        // æ¸…ç©ºå†…å®¹
        function clearContent() {
            currentSchema.body = [];
            renderContent();
            showStatus('å†…å®¹å·²æ¸…ç©º', 'success');
        }

        // åº”ç”¨Schema
        function applySchema() {
            try {
                const schemaText = document.getElementById('schema-editor').value;
                const newSchema = JSON.parse(schemaText);
                currentSchema = newSchema;
                renderContent();
                showStatus('Schemaå·²åº”ç”¨ï¼', 'success');
            } catch (error) {
                showStatus('Schemaæ ¼å¼é”™è¯¯: ' + error.message, 'error');
            }
        }

        // è¿æ¥åç«¯
        async function connectBackend() {
            try {
                showStatus('æ­£åœ¨è¿æ¥åç«¯...', 'success');
                
                const response = await fetch('http://localhost:8100/amis/dashboard');
                if (response.ok) {
                    const result = await response.json();
                    showStatus('åç«¯è¿æ¥æˆåŠŸï¼', 'success');
                    console.log('åç«¯è¿”å›æ•°æ®:', result);
                    
                    // æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
                    console.log('å®Œæ•´åç«¯å“åº”:', JSON.stringify(result, null, 2));
                    
                    if (result.code === 200 && result.data) {
                        currentSchema = result.data;
                        console.log('ä½¿ç”¨result.dataä½œä¸ºschema:', JSON.stringify(currentSchema, null, 2));
                        
                        // æ›´æ–°schemaç¼–è¾‘å™¨
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('åç«¯æ•°æ®å·²åŠ è½½ï¼', 'success');
                    } else if (result.schema) {
                        // å…¼å®¹ç›´æ¥è¿”å›schemaçš„æ ¼å¼
                        currentSchema = result.schema;
                        console.log('ä½¿ç”¨result.schemaä½œä¸ºschema:', JSON.stringify(currentSchema, null, 2));
                        
                        // æ›´æ–°schemaç¼–è¾‘å™¨
                        const schemaEditor = document.getElementById('schema-editor');
                        if (schemaEditor) {
                            schemaEditor.value = JSON.stringify(currentSchema, null, 2);
                        }
                        
                        renderContent();
                        showStatus('åç«¯æ•°æ®å·²åŠ è½½ï¼', 'success');
                    } else {
                        showStatus('åç«¯è¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®', 'error');
                        console.log('æ•°æ®æ ¼å¼é”™è¯¯:', result);
                    }
                } else {
                    showStatus('åç«¯æœåŠ¡æœªå“åº”', 'error');
                }
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showStatus('æ— æ³•è¿æ¥åç«¯: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>

    <!-- çŠ¶æ€æ˜¾ç¤º -->
    <div id="status" class="status"></div>

    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">æ­£åœ¨åŠ è½½...</div>
        </div>
    </div>
    <!-- å±æ€§æ£€æŸ¥å™¨ -->
    <div class="property-inspector" id="propertyInspector">
        <div class="inspector-header">
            <h3>ğŸ”§ ç»„ä»¶å±æ€§æ£€æŸ¥å™¨</h3>
            <button class="close-btn" onclick="closePropertyInspector()">Ã—</button>
        </div>
        <div class="inspector-body">
            <div class="property-tabs">
                <div class="property-tab active" onclick="switchInspectorTab(this, 'basic')">åŸºç¡€</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'style')">æ ·å¼</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'data')">æ•°æ®</div>
                <div class="property-tab" onclick="switchInspectorTab(this, 'events')">äº‹ä»¶</div>
            </div>
            
            <!-- åŸºç¡€å±æ€§ -->
            <div class="tab-content active" id="basic-tab">
                <div class="inspector-section">
                    <h4>åŸºç¡€ä¿¡æ¯</h4>
                    <div class="property-item">
                        <label>ç»„ä»¶ç±»å‹</label>
                        <input type="text" id="component-type" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="property-item">
                        <label>ç»„ä»¶åç§°</label>
                        <input type="text" id="component-name" placeholder="è¾“å…¥ç»„ä»¶åç§°">
                    </div>
                    <div class="property-item">
                        <label>æ ‡é¢˜</label>
                        <input type="text" id="component-title" placeholder="è¾“å…¥æ ‡é¢˜">
                    </div>
                    <div class="property-item">
                        <label>æè¿°</label>
                        <textarea id="component-description" placeholder="è¾“å…¥æè¿°ä¿¡æ¯"></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>æ˜¾ç¤ºæ§åˆ¶</h4>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-visible">
                        <label for="component-visible">æ˜¾ç¤ºç»„ä»¶</label>
                    </div>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-disabled">
                        <label for="component-disabled">ç¦ç”¨ç»„ä»¶</label>
                    </div>
                    <div class="property-checkbox">
                        <input type="checkbox" id="component-hidden">
                        <label for="component-hidden">éšè—ç»„ä»¶</label>
                    </div>
                </div>
            </div>
            
            <!-- æ ·å¼å±æ€§ -->
            <div class="tab-content" id="style-tab">
                <div class="inspector-section">
                    <h4>å¸ƒå±€æ ·å¼</h4>
                    <div class="property-item">
                        <label>CSSç±»å</label>
                        <input type="text" id="component-class" placeholder="è¾“å…¥CSSç±»å">
                    </div>
                    <div class="property-item">
                        <label>å†…è”æ ·å¼</label>
                        <textarea id="component-style" placeholder='{"color": "red", "fontSize": "14px"}'></textarea>
                    </div>
                    <div class="property-item">
                        <label>å®½åº¦</label>
                        <input type="text" id="component-width" placeholder="auto, 100px, 50%">
                    </div>
                    <div class="property-item">
                        <label>é«˜åº¦</label>
                        <input type="text" id="component-height" placeholder="auto, 100px, 300px">
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>å¤–è§‚è®¾ç½®</h4>
                    <div class="property-item">
                        <label>èƒŒæ™¯é¢œè‰²</label>
                        <div class="color-picker-container">
                            <input type="color" id="component-bg-color" value="#ffffff">
                            <div class="color-preview" onclick="document.getElementById('component-bg-color').click()"></div>
                        </div>
                    </div>
                    <div class="property-item">
                        <label>æ–‡å­—é¢œè‰²</label>
                        <div class="color-picker-container">
                            <input type="color" id="component-text-color" value="#333333">
                            <div class="color-preview" onclick="document.getElementById('component-text-color').click()"></div>
                        </div>
                    </div>
                    <div class="property-item">
                        <label>è¾¹æ¡†</label>
                        <input type="text" id="component-border" placeholder="1px solid #ddd">
                    </div>
                    <div class="property-item">
                        <label>åœ†è§’</label>
                        <input type="text" id="component-radius" placeholder="4px">
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®ç»‘å®š -->
            <div class="tab-content" id="data-tab">
                <div class="inspector-section">
                    <h4>æ•°æ®æº</h4>
                    <div class="property-item">
                        <label>APIåœ°å€</label>
                        <input type="text" id="component-api" placeholder="/api/data">
                    </div>
                    <div class="property-item">
                        <label>æ•°æ®å­—æ®µ</label>
                        <input type="text" id="component-source" placeholder="data.items">
                    </div>
                    <div class="property-item">
                        <label>åˆå§‹æ•°æ®</label>
                        <textarea id="component-data" placeholder='{"key": "value"}'></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>å­—æ®µç»‘å®š</h4>
                    <div id="field-bindings">
                        <p style="color: #999; font-size: 13px;">ç‚¹å‡»"æ·»åŠ ç»‘å®š"åˆ›å»ºå­—æ®µæ˜ å°„</p>
                    </div>
                    <div class="binding-actions">
                        <button class="mini-btn" onclick="addFieldBinding()">æ·»åŠ ç»‘å®š</button>
                        <button class="mini-btn" onclick="clearBindings()">æ¸…ç©ºç»‘å®š</button>
                    </div>
                </div>
            </div>
            
            <!-- äº‹ä»¶å¤„ç† -->
            <div class="tab-content" id="events-tab">
                <div class="inspector-section">
                    <h4>äº¤äº’äº‹ä»¶</h4>
                    <div class="property-item">
                        <label>ç‚¹å‡»äº‹ä»¶</label>
                        <textarea id="component-onclick" placeholder="console.log('clicked')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>åŒå‡»äº‹ä»¶</label>
                        <textarea id="component-ondblclick" placeholder="console.log('double clicked')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>æ‚¬åœäº‹ä»¶</label>
                        <textarea id="component-onhover" placeholder="console.log('hovered')"></textarea>
                    </div>
                </div>
                
                <div class="inspector-section">
                    <h4>è¡¨å•äº‹ä»¶</h4>
                    <div class="property-item">
                        <label>å€¼å˜åŒ–</label>
                        <textarea id="component-onchange" placeholder="console.log('value changed:', value)"></textarea>
                    </div>
                    <div class="property-item">
                        <label>è·å¾—ç„¦ç‚¹</label>
                        <textarea id="component-onfocus" placeholder="console.log('focused')"></textarea>
                    </div>
                    <div class="property-item">
                        <label>å¤±å»ç„¦ç‚¹</label>
                        <textarea id="component-onblur" placeholder="console.log('blurred')"></textarea>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="inspector-footer" style="padding: 16px; border-top: 1px solid #e8e8e8;">
            <button class="btn" onclick="applyInspectorChanges()" style="width: 100%; margin-bottom: 8px;">åº”ç”¨æ›´æ”¹</button>
            <button class="btn" onclick="resetInspectorProperties()" style="width: 100%;">é‡ç½®å±æ€§</button>
        </div>
    </div>

    <!-- ä»£ç ç”Ÿæˆå™¨ -->
    <div class="code-generator" id="codeGenerator">
        <div class="generator-overlay">
            <div class="generator-modal">
                <div class="generator-header">
                    <h3>âš™ï¸ æ™ºèƒ½ä»£ç ç”Ÿæˆå™¨</h3>
                    <button class="close-btn" onclick="closeCodeGenerator()" style="color: white;">Ã—</button>
                </div>
                <div class="generator-body">
                    <div class="generator-sidebar">
                        <div class="generator-config">
                            <div class="config-section">
                                <h4>ğŸ¯ ç”Ÿæˆç›®æ ‡</h4>
                                <div class="config-item">
                                    <label>è¾“å‡ºç±»å‹</label>
                                    <select id="output-type" onchange="updateGeneratorOptions()">
                                        <option value="react">React ç»„ä»¶</option>
                                        <option value="vue">Vue ç»„ä»¶</option>
                                        <option value="angular">Angular ç»„ä»¶</option>
                                        <option value="html">HTML é¡µé¢</option>
                                        <option value="api">API æ¥å£</option>
                                        <option value="model">æ•°æ®æ¨¡å‹</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>æ¡†æ¶ç‰ˆæœ¬</label>
                                    <select id="framework-version">
                                        <option value="latest">æœ€æ–°ç‰ˆæœ¬</option>
                                        <option value="stable">ç¨³å®šç‰ˆæœ¬</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h4>ğŸ”§ é…ç½®é€‰é¡¹</h4>
                                <div class="config-item">
                                    <label>å‘½åé£æ ¼</label>
                                    <select id="naming-style">
                                        <option value="camelCase">é©¼å³°å‘½å</option>
                                        <option value="PascalCase">å¸•æ–¯å¡å‘½å</option>
                                        <option value="kebab-case">çŸ­æ¨ªçº¿å‘½å</option>
                                        <option value="snake_case">ä¸‹åˆ’çº¿å‘½å</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>TypeScript</label>
                                    <select id="typescript-enabled">
                                        <option value="true">å¯ç”¨</option>
                                        <option value="false">ç¦ç”¨</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label>æ ·å¼æ–¹æ¡ˆ</label>
                                    <select id="styling-solution">
                                        <option value="css-modules">CSS Modules</option>
                                        <option value="styled-components">Styled Components</option>
                                        <option value="emotion">Emotion</option>
                                        <option value="tailwind">Tailwind CSS</option>
                                        <option value="antd">Ant Design</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h4>ğŸ“¦ åŠŸèƒ½ç‰¹æ€§</h4>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-tests" checked>
                                    <label for="include-tests">åŒ…å«æµ‹è¯•æ–‡ä»¶</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-stories" checked>
                                    <label for="include-stories">åŒ…å« Storybook</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="include-docs">
                                    <label for="include-docs">ç”Ÿæˆæ–‡æ¡£</label>
                                </div>
                                <div class="property-checkbox">
                                    <input type="checkbox" id="responsive-design" checked>
                                    <label for="responsive-design">å“åº”å¼è®¾è®¡</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="generator-main">
                        <div class="generator-tabs">
                            <div class="generator-tab active" onclick="switchGeneratorTab(this, 'component')">ç»„ä»¶ä»£ç </div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'style')">æ ·å¼ä»£ç </div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'test')">æµ‹è¯•ä»£ç </div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'story')">Storyä»£ç </div>
                            <div class="generator-tab" onclick="switchGeneratorTab(this, 'api')">APIä»£ç </div>
                        </div>
                        
                        <div class="generator-content">
                            <div class="code-output">
                                <textarea class="code-editor" id="generated-code" readonly placeholder="ç”Ÿæˆçš„ä»£ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                            </div>
                            
                            <div class="generation-options">
                                <button class="generate-btn" onclick="generateCode()">ğŸš€ ç”Ÿæˆä»£ç </button>
                                <button class="btn" onclick="copyGeneratedCode()">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                                <button class="btn" onclick="downloadGeneratedCode()">ğŸ’¾ ä¸‹è½½æ–‡ä»¶</button>
                                <button class="btn" onclick="previewGenerated()">ğŸ‘€ é¢„è§ˆæ•ˆæœ</button>
                                <span style="margin-left: auto; color: #666; font-size: 12px;">
                                    ä»£ç è¡Œæ•°: <span id="code-line-count">0</span> | 
                                    æ–‡ä»¶å¤§å°: <span id="code-size">0 KB</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡å‹éªŒè¯é¢æ¿ -->
    <div class="validation-panel" id="validationPanel">
        <div class="validation-header">
            <h3>âœ… Schema æ¨¡å‹éªŒè¯å™¨</h3>
            <button class="close-btn" onclick="closeValidationPanel()" style="color: white;">Ã—</button>
        </div>
        <div class="validation-body">
            <div class="validation-stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-components">0</div>
                    <div class="stat-label">æ€»ç»„ä»¶æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-errors">0</div>
                    <div class="stat-label">é”™è¯¯</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-warnings">0</div>
                    <div class="stat-label">è­¦å‘Š</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="validation-score">100</div>
                    <div class="stat-label">è´¨é‡è¯„åˆ†</div>
                </div>
            </div>
            
            <div id="validation-results">
                <div class="validation-result">
                    <div class="result-title">âœ… éªŒè¯å®Œæˆ</div>
                    <div class="result-message">ç‚¹å‡»"å¼€å§‹éªŒè¯"æŒ‰é’®è¿›è¡Œ Schema æ¨¡å‹éªŒè¯...</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="generate-btn" onclick="validateSchema()">ğŸ” å¼€å§‹éªŒè¯</button>
                <button class="btn" onclick="exportValidationReport()">ğŸ“„ å¯¼å‡ºæŠ¥å‘Š</button>
                <button class="btn" onclick="autoFixIssues()">ğŸ”§ è‡ªåŠ¨ä¿®å¤</button>
            </div>
        </div>
    </div>

</body>
</html>
