import{a as x,t as L,d as y,e as A,s as n,R as m,f as U,h as B,dA as D,y as E,dB as W,aj as z,r as S,j as J,c as p,J as N,K as P,q as b}from"./index-SNKBwPMT.js";var T=(function(c){x(a,c);function a(){var e=c!==null&&c.apply(this,arguments)||this;return e.IFrameRef=m.createRef(),e.state={width:e.props.width||"100%",height:e.props.height||"100%"},e}return a.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},a.prototype.componentDidUpdate=function(e){var r=this.props.data;r!==e.data?this.postMessage("update",r):(this.props.width!==e.width||this.props.height!==e.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},a.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},a.prototype.validateURL=function(e){return e&&typeof e=="string"&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(e)?!0:!(e&&typeof e=="string"&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(e))},a.prototype.onMessage=function(e){var r,s,t;return U(this,void 0,void 0,function(){var i,u,v,_,w,o,C,d,f,g,l;return B(this,function(h){switch(h.label){case 0:return i=this.props,u=i.events,v=i.onEvent,_=i.onAction,w=i.data,typeof((r=e?.data)===null||r===void 0?void 0:r.type)!="string"?[2]:(o=z(e.data.type.split(":"),2),C=o[0],d=o[1],C!=="amis"||!d?[2]:d==="resize"&&e.data.data?(this.setState({width:e.data.data.width||"100%",height:e.data.data.height||"100%"}),[3,4]):[3,1]);case 1:return f=v?.[d],f&&(!((s=f.actions)===null||s===void 0)&&s.length)?(g=D(d,{env:(t=this.props)===null||t===void 0?void 0:t.env,nativeEvent:e,data:E(w,e.data.data),scoped:this.context}),[4,W(f.actions,this,g)]):[3,3];case 2:if(h.sent(),g.prevented)return[2];h.label=3;case 3:u&&(l=u[d],l&&_(e,l,E(w,e.data.data))),h.label=4;case 4:return[2]}})})},a.prototype.onLoad=function(){var e=this.props,r=e.src,s=e.data;r&&this.postMessage("init",s)},a.prototype.reload=function(e,r){if(r)return this.receive(r);var s=this.props,t=s.src,i=s.data;t&&(this.IFrameRef.current.src=S(t,i,"| raw"))},a.prototype.receive=function(e){var r=this.props,s=r.src,t=r.data,i=E(t,e);this.postMessage("receive",i),J(s,s,t,i)&&(this.IFrameRef.current.src=S(s,i,"| raw"))},a.prototype.postMessage=function(e,r){var s,t;(t=(s=this.IFrameRef.current)===null||s===void 0?void 0:s.contentWindow)===null||t===void 0||t.postMessage({type:"amis:".concat(e),data:JSON.parse(JSON.stringify(r))},"*")},a.prototype.render=function(){var e=this.state,r=e.width,s=e.height,t=this.props,i=t.className,u=t.src,v=t.name,_=t.frameBorder,w=t.data,o=t.style,C=t.allow,d=t.sandbox,f=t.referrerpolicy,g=t.translate,l=t.id,h=t.wrapperCustomStyle,I=t.env,M=t.themeCss;t.baseControlClassName;var O=t.inDragging,j=t.classnames,R={};r!==void 0&&(R.width=r),s!==void 0&&(R.height=s),o=p(p({},R),o),O&&(o=p(p({},o),{pointerEvents:"none"}));var F=u?S(u,w,"| raw"):void 0;return this.validateURL(F)?(location.protocol==="https:"&&F&&F.startsWith("http://")&&I.notify("error",g("Iframe.invalidProtocol")),m.createElement(m.Fragment,null,m.createElement("iframe",{name:v,className:j("IFrame",i,N(p(p({},this.props),{name:"baseControlClassName",id:l,themeCss:M})),N(p(p({},this.props),{name:"wrapperCustomStyle",id:l,themeCss:h}))),frameBorder:_,style:o,ref:this.IFrameRef,onLoad:this.onLoad,src:F,allow:C,referrerPolicy:f,sandbox:d}),m.createElement(P,p({},this.props,{config:{wrapperCustomStyle:h,id:l,themeCss:M,classNames:[{key:"baseControlClassName"}]},env:I})))):m.createElement("p",null,g("Iframe.invalid"))},a.propsList=["src","className"],a.defaultProps={className:"",frameBorder:0},y([b,n("design:type",Function),n("design:paramtypes",[MessageEvent]),n("design:returntype",Promise)],a.prototype,"onMessage",null),y([b,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"onLoad",null),y([b,n("design:type",Function),n("design:paramtypes",[Object,Object]),n("design:returntype",void 0)],a.prototype,"reload",null),y([b,n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"receive",null),y([b,n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",void 0)],a.prototype,"postMessage",null),a})(m.Component),k=(function(c){x(a,c);function a(e,r){var s=c.call(this,e)||this,t=r;return t.registerComponent(s),s}return a.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),c.prototype.componentWillUnmount.call(this)},a.contextType=L,a=y([A({type:"iframe"}),n("design:paramtypes",[Object,Object])],a),a})(T);export{k as IFrameRenderer,T as default};
