import{d as Q,D as B,g as E,r as d,f as K,u as z,C as A,G as Y,e4 as O,e2 as j,_ as G,X as J,o as m,c as q,k as a,w as o,Y as N,F as I,n as M,q as c,m as i,I as f,t as x,ah as X,Z as W,L as Z,J as $,K as H,z as ee,N as ae,O as te,A as le,B as re,P as oe,y as ne,Q as ie,R as me}from"./index-BaY5TDP-.js";import{_ as se}from"./index-avjYFQiD.js";import{_ as ce}from"./DictTag-QtcI9ZjC.js";import{_ as pe}from"./ContentWrap-DKQn7kZm.js";import{_ as ue}from"./index-BAz6Gqim.js";import{d as de,b as fe}from"./formatTime-Dr6TiYYc.js";import{d as ye}from"./download-oWiM5xVU.js";import{e as we,i as ge,j as be,s as he}from"./index-B97LdofC.js";import Ce from"./ContractForm-DyS_nB0a.js";import{g as _e}from"./index-h6ObHKtQ.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";import"./Dialog-CZSXtzfQ.js";import"./index-CuAlllbQ.js";import"./index-DiJG1eDb.js";import"./index-6-r4wYJE.js";import"./ContractProductForm--_dghpLm.js";import"./index-D4G-Yxr7.js";const ke=G(Q({name:"CrmContract",__name:"index",setup(S,{expose:r}){r();const y=B(),{t:e}=E(),v=d(!0),F=d(0),C=d([]),p=K({pageNo:1,pageSize:10,sceneType:"1",name:null,customerId:null,orderDate:[],no:null}),w=d(),_=d(!1),T=d("1"),g=d([]),n=async()=>{v.value=!0;try{const t=await we(p);C.value=t.list,F.value=t.total}finally{v.value=!1}},k=()=>{p.pageNo=1,n()},P=d(),{push:s}=z();A(async()=>{await n(),g.value=await _e()});const D={message:y,t:e,loading:v,total:F,list:C,queryParams:p,queryFormRef:w,exportLoading:_,activeName:T,customerList:g,handleTabClick:t=>{p.sceneType=t.paneName,k()},getList:n,handleQuery:k,resetQuery:()=>{w.value.resetFields(),k()},formRef:P,openForm:(t,h)=>{P.value.open(t,h)},handleDelete:async t=>{try{await y.delConfirm(),await ge(t),y.success(e("common.delSuccess")),await n()}catch{}},handleExport:async()=>{try{await y.exportConfirm(),_.value=!0;const t=await be(p);ye.excel(t,"\u5408\u540C.xls")}catch{}finally{_.value=!1}},handleSubmit:async t=>{await y.confirm(`\u60A8\u786E\u5B9A\u63D0\u4EA4\u3010${t.name}\u3011\u5BA1\u6838\u5417\uFF1F`),await he(t.id),y.success("\u63D0\u4EA4\u5BA1\u6838\u6210\u529F\uFF01"),await n()},handleProcessDetail:t=>{s({name:"BpmProcessInstanceDetail",query:{id:t.processInstanceId}})},push:s,openDetail:t=>{s({name:"CrmContractDetail",params:{id:t}})},openCustomerDetail:t=>{s({name:"CrmCustomerDetail",params:{id:t}})},openContactDetail:t=>{s({name:"CrmContactDetail",params:{id:t}})},openBusinessDetail:t=>{s({name:"CrmBusinessDetail",params:{id:t}})},get dateFormatter(){return de},get dateFormatter2(){return fe},ContractForm:Ce,get DICT_TYPE(){return Y},get erpPriceInputFormatter(){return O},get erpPriceTableColumnFormatter(){return j}};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),[["render",function(S,r,y,e,v,F){const C=ue,p=W,w=Z,_=$,T=H,g=ee,n=ae,k=te,P=pe,s=le,D=re,t=oe,h=ne,U=ce,V=ie,L=se,b=J("hasPermi"),R=me;return m(),q(I,null,[a(C,{title:"\u3010\u5408\u540C\u3011\u5408\u540C\u7BA1\u7406\u3001\u5408\u540C\u63D0\u9192",url:"https://doc.iocoder.cn/crm/contract/"}),a(C,{title:"\u3010\u901A\u7528\u3011\u6570\u636E\u6743\u9650",url:"https://doc.iocoder.cn/crm/permission/"}),a(P,null,{default:o(()=>[a(k,{ref:"queryFormRef",inline:!0,model:e.queryParams,class:"-mb-15px","label-width":"68px"},{default:o(()=>[a(w,{label:"\u5408\u540C\u7F16\u53F7",prop:"no"},{default:o(()=>[a(p,{modelValue:e.queryParams.no,"onUpdate:modelValue":r[0]||(r[0]=l=>e.queryParams.no=l),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5408\u540C\u7F16\u53F7",onKeyup:N(e.handleQuery,["enter"])},null,8,["modelValue"])]),_:1}),a(w,{label:"\u5408\u540C\u540D\u79F0",prop:"name"},{default:o(()=>[a(p,{modelValue:e.queryParams.name,"onUpdate:modelValue":r[1]||(r[1]=l=>e.queryParams.name=l),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5408\u540C\u540D\u79F0",onKeyup:N(e.handleQuery,["enter"])},null,8,["modelValue"]),a(w,{label:"\u5BA2\u6237",prop:"customerId"},{default:o(()=>[a(T,{modelValue:e.queryParams.customerId,"onUpdate:modelValue":r[2]||(r[2]=l=>e.queryParams.customerId=l),class:"!w-240px",clearable:"","lable-key":"name",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237","value-key":"id",onKeyup:N(e.handleQuery,["enter"])},{default:o(()=>[(m(!0),q(I,null,M(e.customerList,l=>(m(),c(_,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(w,null,{default:o(()=>[a(n,{onClick:e.handleQuery},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:search"}),r[7]||(r[7]=i(" \u641C\u7D22 "))]),_:1}),a(n,{onClick:e.resetQuery},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:refresh"}),r[8]||(r[8]=i(" \u91CD\u7F6E "))]),_:1}),f((m(),c(n,{type:"primary",onClick:r[3]||(r[3]=l=>e.openForm("create"))},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:plus"}),r[9]||(r[9]=i(" \u65B0\u589E "))]),_:1})),[[b,["crm:contract:create"]]]),f((m(),c(n,{loading:e.exportLoading,plain:"",type:"success",onClick:e.handleExport},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:download"}),r[10]||(r[10]=i(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[b,["crm:contract:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(P,null,{default:o(()=>[a(D,{modelValue:e.activeName,"onUpdate:modelValue":r[4]||(r[4]=l=>e.activeName=l),onTabClick:e.handleTabClick},{default:o(()=>[a(s,{label:"\u6211\u8D1F\u8D23\u7684",name:"1"}),a(s,{label:"\u6211\u53C2\u4E0E\u7684",name:"2"}),a(s,{label:"\u4E0B\u5C5E\u8D1F\u8D23\u7684",name:"3"})]),_:1},8,["modelValue"]),f((m(),c(V,{data:e.list,"show-overflow-tooltip":!0,stripe:!0},{default:o(()=>[a(t,{align:"center",fixed:"left",label:"\u5408\u540C\u7F16\u53F7",prop:"no",width:"180"}),a(t,{align:"center",fixed:"left",label:"\u5408\u540C\u540D\u79F0",prop:"name",width:"160"},{default:o(l=>[a(h,{underline:!1,type:"primary",onClick:u=>e.openDetail(l.row.id)},{default:o(()=>[i(x(l.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{align:"center",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"120"},{default:o(l=>[a(h,{underline:!1,type:"primary",onClick:u=>e.openCustomerDetail(l.row.customerId)},{default:o(()=>[i(x(l.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{align:"center",label:"\u5546\u673A\u540D\u79F0",prop:"businessName",width:"130"},{default:o(l=>[a(h,{underline:!1,type:"primary",onClick:u=>e.openBusinessDetail(l.row.businessId)},{default:o(()=>[i(x(l.row.businessName),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{align:"center",label:"\u5408\u540C\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalPrice",width:"140",formatter:e.erpPriceTableColumnFormatter},null,8,["formatter"]),a(t,{align:"center",label:"\u4E0B\u5355\u65F6\u95F4",prop:"orderDate",width:"120",formatter:e.dateFormatter2},null,8,["formatter"]),a(t,{align:"center",label:"\u5408\u540C\u5F00\u59CB\u65F6\u95F4",prop:"startTime",width:"120",formatter:e.dateFormatter2},null,8,["formatter"]),a(t,{align:"center",label:"\u5408\u540C\u7ED3\u675F\u65F6\u95F4",prop:"endTime",width:"120",formatter:e.dateFormatter2},null,8,["formatter"]),a(t,{align:"center",label:"\u5BA2\u6237\u7B7E\u7EA6\u4EBA",prop:"contactName",width:"130"},{default:o(l=>[a(h,{underline:!1,type:"primary",onClick:u=>e.openContactDetail(l.row.signContactId)},{default:o(()=>[i(x(l.row.signContactName),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{align:"center",label:"\u516C\u53F8\u7B7E\u7EA6\u4EBA",prop:"signUserName",width:"130"}),a(t,{align:"center",label:"\u5907\u6CE8",prop:"remark",width:"200"}),a(t,{align:"center",label:"\u5DF2\u56DE\u6B3E\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalReceivablePrice",width:"140",formatter:e.erpPriceTableColumnFormatter},null,8,["formatter"]),a(t,{align:"center",label:"\u672A\u56DE\u6B3E\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalReceivablePrice",width:"140",formatter:e.erpPriceTableColumnFormatter},{default:o(l=>[i(x(e.erpPriceInputFormatter(l.row.totalPrice-l.row.totalReceivablePrice)),1)]),_:1},8,["formatter"]),a(t,{formatter:e.dateFormatter,align:"center",label:"\u6700\u540E\u8DDF\u8FDB\u65F6\u95F4",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),a(t,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"120"}),a(t,{align:"center",label:"\u6240\u5C5E\u90E8\u95E8",prop:"ownerUserDeptName",width:"100px"}),a(t,{formatter:e.dateFormatter,align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),a(t,{formatter:e.dateFormatter,align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(t,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"120"}),a(t,{align:"center",fixed:"right",label:"\u5408\u540C\u72B6\u6001",prop:"auditStatus",width:"120"},{default:o(l=>[a(U,{type:e.DICT_TYPE.CRM_AUDIT_STATUS,value:l.row.auditStatus},null,8,["type","value"])]),_:1}),a(t,{fixed:"right",label:"\u64CD\u4F5C",width:"250"},{default:o(l=>[l.row.auditStatus===0?f((m(),c(n,{key:0,link:"",type:"primary",onClick:u=>e.openForm("update",l.row.id)},{default:o(()=>r[11]||(r[11]=[i(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[b,["crm:contract:update"]]]):X("",!0),l.row.auditStatus===0?f((m(),c(n,{key:1,link:"",type:"primary",onClick:u=>e.handleSubmit(l.row)},{default:o(()=>r[12]||(r[12]=[i(" \u63D0\u4EA4\u5BA1\u6838 ")])),_:2},1032,["onClick"])),[[b,["crm:contract:update"]]]):f((m(),c(n,{key:2,link:"",type:"primary",onClick:u=>e.handleProcessDetail(l.row)},{default:o(()=>r[13]||(r[13]=[i(" \u67E5\u770B\u5BA1\u6279 ")])),_:2},1032,["onClick"])),[[b,["crm:contract:update"]]]),f((m(),c(n,{link:"",type:"primary",onClick:u=>e.openDetail(l.row.id)},{default:o(()=>r[14]||(r[14]=[i(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[b,["crm:contract:query"]]]),f((m(),c(n,{link:"",type:"danger",onClick:u=>e.handleDelete(l.row.id)},{default:o(()=>r[15]||(r[15]=[i(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[b,["crm:contract:delete"]]])]),_:1})]),_:1},8,["data"])),[[R,e.loading]]),a(L,{limit:e.queryParams.pageSize,"onUpdate:limit":r[5]||(r[5]=l=>e.queryParams.pageSize=l),page:e.queryParams.pageNo,"onUpdate:page":r[6]||(r[6]=l=>e.queryParams.pageNo=l),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1}),a(e.ContractForm,{ref:"formRef",onSuccess:e.getList},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/contract/index.vue"]]);export{ke as default};
