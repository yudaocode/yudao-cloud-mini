import{d as O,p as E,r as n,C as M,G as N,U as F,aA as Q,bJ as q,_ as z,o as f,q as _,cc as L,w as r,k as l,m as p,Y as j,c as J,F as K,n as R,I as B,t as x,Z as G,L as Z,J as $,K as W,z as H,N as X,O as ee,ai as ae,P as le,ak as te,Q as oe,R as ie}from"./index-BaY5TDP-.js";import{_ as re}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{_ as ue}from"./index-avjYFQiD.js";import{_ as se}from"./DictTag-QtcI9ZjC.js";import{E as de}from"./el-image-Bg-CwbDE.js";import{h as me}from"./tree-z7HkrWVC.js";import{g as pe}from"./category-B7jjsMOS.js";import{a as ce}from"./combinationActivity-BFjeGiax.js";import{f as ve}from"./formatter-DdccBgw4.js";import{d as he,f as fe}from"./formatTime-Dr6TiYYc.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";const ge=z(O({name:"CombinationTableSelect",__name:"CombinationTableSelect",props:{multiple:E.bool.def(!1)},emits:["change"],setup(D,{expose:t,emit:C}){const a=n(0),m=n([]),k=n(!1),c=n(!1),d=n({pageNo:1,pageSize:10,name:null,status:void 0}),V=e=>{s.value=[],o.value={},u.value=!1,h.value=!1,e&&e.length>0&&(s.value=[...e],o.value=Object.fromEntries(e.map(i=>[i.id,!0]))),c.value=!0,g()};t({open:V});const v=async()=>{k.value=!0;try{const e=await ce(d.value);m.value=e.list,a.value=e.total,m.value.forEach(i=>o.value[i.id]=o.value[i.id]||!1),y()}finally{k.value=!1}},g=()=>{d.value={pageNo:1,pageSize:10,name:"",createTime:[]},v()},u=n(!1),h=n(!1),s=n([]),o=n({}),P=n(),b=C,S=(e,i,Y)=>{if(e)s.value.push(i),o.value[i.id]=!0;else{const A=T(i);A>-1&&(s.value.splice(A,1),o.value[i.id]=!1,u.value=!1)}Y&&y()},T=e=>s.value.findIndex(i=>i.id===e.id),y=()=>{u.value=m.value.every(e=>o.value[e.id]),h.value=!u.value&&m.value.some(e=>o.value[e.id])},w=n(),I=n();M(async()=>{await v(),w.value=await pe({}),I.value=me(w.value,"id","parentId")});const U={total:a,list:m,loading:k,dialogVisible:c,queryParams:d,open:V,getList:v,handleQuery:()=>{d.value.pageNo=1,v()},resetQuery:g,formatCombinationPrice:e=>{const i=Math.min(...e.map(Y=>Y.combinationPrice));return`\uFFE5${Q(i)}`},isCheckAll:u,isIndeterminate:h,checkedActivitys:s,checkedStatus:o,selectedActivityId:P,handleSingleSelected:e=>{b(q,e),c.value=!1,P.value=e.id},handleEmitChange:()=>{c.value=!1,b(q,[...s.value])},emits:b,handleCheckAll:e=>{u.value=e,h.value=!1,m.value.forEach(i=>S(e,i,!1))},handleCheckOne:S,findCheckedIndex:T,calculateIsCheckAll:y,categoryList:w,categoryTreeList:I,get fenToYuanFormat(){return ve},get DICT_TYPE(){return N},get getIntDictOptions(){return F},get dateFormatter(){return he},get formatDate(){return fe}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),[["render",function(D,t,C,a,m,k){const c=G,d=Z,V=$,v=W,g=H,u=X,h=ee,s=ae,o=le,P=te,b=de,S=se,T=oe,y=ue,w=ne,I=re,U=ie;return f(),_(I,{modelValue:a.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>a.dialogVisible=e),appendToBody:!0,title:"\u9009\u62E9\u6D3B\u52A8",width:"70%"},L({default:r(()=>[l(w,null,{default:r(()=>[l(h,{ref:"queryFormRef",inline:!0,model:a.queryParams,class:"-mb-15px","label-width":"68px"},{default:r(()=>[l(d,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:r(()=>[l(c,{modelValue:a.queryParams.name,"onUpdate:modelValue":t[0]||(t[0]=e=>a.queryParams.name=e),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",clearable:"",onKeyup:j(a.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:r(()=>[l(v,{modelValue:a.queryParams.status,"onUpdate:modelValue":t[1]||(t[1]=e=>a.queryParams.status=e),placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001",clearable:"",class:"!w-240px"},{default:r(()=>[(f(!0),J(K,null,R(a.getIntDictOptions(a.DICT_TYPE.COMMON_STATUS),e=>(f(),_(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:r(()=>[l(u,{onClick:a.handleQuery},{default:r(()=>[l(g,{class:"mr-5px",icon:"ep:search"}),t[8]||(t[8]=p(" \u641C\u7D22 "))]),_:1}),l(u,{onClick:a.resetQuery},{default:r(()=>[l(g,{class:"mr-5px",icon:"ep:refresh"}),t[9]||(t[9]=p(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),B((f(),_(T,{data:a.list,"show-overflow-tooltip":""},{default:r(()=>[C.multiple?(f(),_(o,{key:0,width:"55"},{header:r(()=>[l(s,{modelValue:a.isCheckAll,"onUpdate:modelValue":t[2]||(t[2]=e=>a.isCheckAll=e),indeterminate:a.isIndeterminate,onChange:a.handleCheckAll},null,8,["modelValue","indeterminate"])]),default:r(({row:e})=>[l(s,{modelValue:a.checkedStatus[e.id],"onUpdate:modelValue":i=>a.checkedStatus[e.id]=i,onChange:i=>a.handleCheckOne(i,e,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(f(),_(o,{key:1,label:"#",width:"55"},{default:r(({row:e})=>[l(P,{value:e.id,modelValue:a.selectedActivityId,"onUpdate:modelValue":t[3]||(t[3]=i=>a.selectedActivityId=i),onChange:i=>a.handleSingleSelected(e)},{default:r(()=>t[10]||(t[10]=[p(" \xA0 ")])),_:2},1032,["value","modelValue","onChange"])]),_:1})),l(o,{label:"\u6D3B\u52A8\u7F16\u53F7",prop:"id","min-width":"80"}),l(o,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name","min-width":"140"}),l(o,{label:"\u6D3B\u52A8\u65F6\u95F4","min-width":"210"},{default:r(e=>[p(x(a.formatDate(e.row.startTime,"YYYY-MM-DD"))+" ~ "+x(a.formatDate(e.row.endTime,"YYYY-MM-DD")),1)]),_:1}),l(o,{label:"\u5546\u54C1\u56FE\u7247",prop:"spuName","min-width":"80"},{default:r(e=>[l(b,{src:e.row.picUrl,class:"h-40px w-40px","preview-src-list":[e.row.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),l(o,{label:"\u5546\u54C1\u6807\u9898",prop:"spuName","min-width":"300"}),l(o,{label:"\u539F\u4EF7",prop:"marketPrice","min-width":"100",formatter:a.fenToYuanFormat},null,8,["formatter"]),l(o,{label:"\u62FC\u56E2\u4EF7",prop:"seckillPrice","min-width":"100"},{default:r(e=>[p(x(a.formatCombinationPrice(e.row.products)),1)]),_:1}),l(o,{label:"\u5F00\u56E2\u7EC4\u6570",prop:"groupCount","min-width":"100"}),l(o,{label:"\u6210\u56E2\u7EC4\u6570",prop:"groupSuccessCount","min-width":"100"}),l(o,{label:"\u8D2D\u4E70\u6B21\u6570",prop:"recordCount","min-width":"100"}),l(o,{label:"\u6D3B\u52A8\u72B6\u6001",align:"center",prop:"status","min-width":"100"},{default:r(e=>[l(S,{type:a.DICT_TYPE.COMMON_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),l(o,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:a.dateFormatter,width:"180px"},null,8,["formatter"])]),_:1},8,["data"])),[[U,a.loading]]),l(y,{limit:a.queryParams.pageSize,"onUpdate:limit":t[4]||(t[4]=e=>a.queryParams.pageSize=e),page:a.queryParams.pageNo,"onUpdate:page":t[5]||(t[5]=e=>a.queryParams.pageNo=e),total:a.total,onPagination:a.getList},null,8,["limit","page","total"])]),_:1})]),_:2},[C.multiple?{name:"footer",fn:r(()=>[l(u,{type:"primary",onClick:a.handleEmitChange},{default:r(()=>t[11]||(t[11]=[p("\u786E \u5B9A")])),_:1}),l(u,{onClick:t[6]||(t[6]=e=>a.dialogVisible=!1)},{default:r(()=>t[12]||(t[12]=[p("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/combination/components/CombinationTableSelect.vue"]]);export{ge as default};
