import{d as q,g as A,D as j,r as s,f as z,b as B,au as J,e3 as K,e4 as M,_ as Z,o as n,c as w,k as l,w as r,q as V,m as T,ah as G,I as Q,F as L,n as N,Z as W,L as H,v as X,M as Y,z as $,N as ee,J as ae,K as le,cq as re,E as oe,A as te,B as ue,cf as de,O as ie,R as se}from"./index-BaY5TDP-.js";import{_ as me}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{S as O}from"./index-BCNlL1Hh.js";import ce from"./SaleReturnItemForm-B-uWB9Ah.js";import{C as fe}from"./index-DV7H_W_F.js";import{A as pe}from"./index-hc6npfaY.js";import be from"./SaleOrderReturnEnableList-TiNRaZeV.js";import{g as ve}from"./index-CuAlllbQ.js";import"./index-DMn3OXs3.js";import"./index-B0TWi7A6.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-DoNPyGwW.js";import"./formatTime-Dr6TiYYc.js";import"./index-CJwxK5Qx.js";const _e=Z(q({name:"SaleReturnForm",__name:"SaleReturnForm",emits:["success"],setup(E,{expose:o,emit:C}){const{t:a}=A(),P=j(),I=s(!1),m=s(""),t=s(!1),u=s(""),d=s({id:void 0,customerId:void 0,accountId:void 0,saleUserId:void 0,returnTime:void 0,remark:void 0,fileUrl:"",discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,orderNo:void 0,items:[],no:void 0}),y=z({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u9000\u8D27\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),p=B(()=>u.value==="detail"),c=s(),f=s([]),b=s([]),v=s([]),k=s("item"),D=s();J(()=>d.value,e=>{if(!e)return;const i=e.items.reduce((F,x)=>F+x.totalPrice,0),S=e.discountPercent!=null?K(i,e.discountPercent/100):0;d.value.totalPrice=i-S+e.otherPrice},{deep:!0});const g=async(e,i)=>{if(I.value=!0,m.value=a("action."+e),u.value=e,h(),i){t.value=!0;try{d.value=await O.getSaleReturn(i)}finally{t.value=!1}}f.value=await fe.getCustomerSimpleList(),v.value=await ve(),b.value=await pe.getAccountSimpleList();const S=b.value.find(F=>F.defaultStatus);S&&(d.value.accountId=S.id)};o({open:g});const _=s(),U=C,h=()=>{var e;d.value={id:void 0,customerId:void 0,accountId:void 0,saleUserId:void 0,returnTime:void 0,remark:void 0,fileUrl:void 0,discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,items:[]},(e=c.value)==null||e.resetFields()},R={t:a,message:P,dialogVisible:I,dialogTitle:m,formLoading:t,formType:u,formData:d,formRules:y,disabled:p,formRef:c,customerList:f,accountList:b,userList:v,subTabsName:k,itemFormRef:D,open:g,saleOrderReturnEnableListRef:_,openSaleOrderReturnEnableList:()=>{_.value.open()},handleSaleOrderChange:e=>{d.value.orderId=e.id,d.value.orderNo=e.no,d.value.customerId=e.customerId,d.value.accountId=e.accountId,d.value.saleUserId=e.saleUserId,d.value.discountPercent=e.discountPercent,d.value.remark=e.remark,d.value.fileUrl=e.fileUrl,e.items.forEach(i=>{i.count=i.outCount-i.returnCount,i.orderItemId=i.id,i.id=void 0}),d.value.items=e.items.filter(i=>i.count>0)},emit:U,submitForm:async()=>{await c.value.validate(),await D.value.validate(),t.value=!0;try{const e=d.value;u.value==="create"?(await O.createSaleReturn(e),P.success(a("common.createSuccess"))):(await O.updateSaleReturn(e),P.success(a("common.updateSuccess"))),I.value=!1,U("success")}finally{t.value=!1}},resetForm:h,SaleReturnItemForm:ce,get erpPriceInputFormatter(){return M},SaleOrderReturnEnableList:be};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),[["render",function(E,o,C,a,P,I){const m=W,t=H,u=X,d=Y,y=$,p=ee,c=ae,f=le,b=re,v=oe,k=te,D=ue,g=ne,_=de,U=ie,h=me,R=se;return n(),w(L,null,[l(h,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":o[14]||(o[14]=e=>a.dialogVisible=e),width:"1440"},{footer:r(()=>[a.disabled?G("",!0):(n(),V(p,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:r(()=>o[16]||(o[16]=[T(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(p,{onClick:o[13]||(o[13]=e=>a.dialogVisible=!1)},{default:r(()=>o[17]||(o[17]=[T("\u53D6 \u6D88")])),_:1})]),default:r(()=>[Q((n(),V(U,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:r(()=>[l(v,{gutter:20},{default:r(()=>[l(u,{span:8},{default:r(()=>[l(t,{label:"\u9000\u8D27\u5355\u53F7",prop:"no"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":o[0]||(o[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u9000\u8D27\u65F6\u95F4",prop:"returnTime"},{default:r(()=>[l(d,{modelValue:a.formData.returnTime,"onUpdate:modelValue":o[1]||(o[1]=e=>a.formData.returnTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9000\u8D27\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u5173\u8054\u8BA2\u5355",prop:"orderNo"},{default:r(()=>[l(m,{modelValue:a.formData.orderNo,"onUpdate:modelValue":o[2]||(o[2]=e=>a.formData.orderNo=e),readonly:""},{append:r(()=>[l(p,{onClick:a.openSaleOrderReturnEnableList},{default:r(()=>[l(y,{icon:"ep:search"}),o[15]||(o[15]=T(" \u9009\u62E9 "))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u5BA2\u6237",prop:"customerId"},{default:r(()=>[l(f,{modelValue:a.formData.customerId,"onUpdate:modelValue":o[3]||(o[3]=e=>a.formData.customerId=e),clearable:"",filterable:"",disabled:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"!w-1/1"},{default:r(()=>[(n(!0),w(L,null,N(a.customerList,e=>(n(),V(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u9500\u552E\u4EBA\u5458",prop:"saleUserId"},{default:r(()=>[l(f,{modelValue:a.formData.saleUserId,"onUpdate:modelValue":o[4]||(o[4]=e=>a.formData.saleUserId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u9500\u552E\u4EBA\u5458",class:"!w-1/1"},{default:r(()=>[(n(!0),w(L,null,N(a.userList,e=>(n(),V(c,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:16},{default:r(()=>[l(t,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[l(m,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":o[5]||(o[5]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:r(()=>[l(b,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":o[6]||(o[6]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(g,null,{default:r(()=>[l(D,{modelValue:a.subTabsName,"onUpdate:modelValue":o[7]||(o[7]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:r(()=>[l(k,{label:"\u9000\u8D27\u4EA7\u54C1\u6E05\u5355",name:"item"},{default:r(()=>[l(a.SaleReturnItemForm,{ref:"itemFormRef",items:a.formData.items,disabled:a.disabled},null,8,["items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{gutter:20},{default:r(()=>[l(u,{span:8},{default:r(()=>[l(t,{label:"\u4F18\u60E0\u7387\uFF08%\uFF09",prop:"discountPercent"},{default:r(()=>[l(_,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":o[8]||(o[8]=e=>a.formData.discountPercent=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u7387",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u9000\u6B3E\u4F18\u60E0",prop:"discountPrice"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.discountPrice,"onUpdate:modelValue":o[9]||(o[9]=e=>a.formData.discountPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u4F18\u60E0\u540E\u91D1\u989D"},{default:r(()=>[l(m,{disabled:"","model-value":a.formData.totalPrice-a.formData.otherPrice,formatter:a.erpPriceInputFormatter},null,8,["model-value","formatter"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u5176\u5B83\u8D39\u7528",prop:"otherPrice"},{default:r(()=>[l(_,{modelValue:a.formData.otherPrice,"onUpdate:modelValue":o[10]||(o[10]=e=>a.formData.otherPrice=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u5176\u5B83\u8D39\u7528",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u7ED3\u7B97\u8D26\u6237",prop:"accountId"},{default:r(()=>[l(f,{modelValue:a.formData.accountId,"onUpdate:modelValue":o[11]||(o[11]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:r(()=>[(n(!0),w(L,null,N(a.accountList,e=>(n(),V(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:r(()=>[l(t,{label:"\u5E94\u9000\u91D1\u989D",prop:"totalPrice"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":o[12]||(o[12]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[R,a.formLoading]])]),_:1},8,["title","modelValue"]),l(a.SaleOrderReturnEnableList,{ref:"saleOrderReturnEnableListRef",onSuccess:a.handleSaleOrderChange},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/sale/return/SaleReturnForm.vue"]]);export{_e as default};
