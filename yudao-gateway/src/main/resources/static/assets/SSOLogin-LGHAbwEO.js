import{bz as O,d as j,S as C,u as P,r as k,f as q,b as N,a as R,au as B,_ as J,I as E,ag as G,o as y,c as _,k as c,w as u,j as H,m as b,F as K,n as M,q as Q,t as W,a_ as z,A as X,B as Y,ai as Z,cd as $,L as ee,N as se,O as ae}from"./index-BaY5TDP-.js";import{u as oe,L as I,a as te}from"./LoginFormTitle-Rxr-yfvU.js";const re={class:"form-cont"},ne={key:0},ie={key:1},le=J(j({name:"SSOLogin",__name:"SSOLogin",setup(x,{expose:o}){o();const i=C(),{currentRoute:a}=P(),{getLoginState:h,setLoginState:S}=oe(),g=k({name:"",logo:""}),e=q({responseType:"",clientId:"",redirectUri:"",state:"",scopes:[]}),v=N(()=>R(h)===I.SSO),d=q({scopes:[]}),p=k(!1),f=async()=>{if(i.query.client_id===void 0)return;if(e.responseType=i.query.response_type,e.clientId=i.query.client_id,e.redirectUri=i.query.redirect_uri,e.state=i.query.state,i.query.scope&&(e.scopes=i.query.scope.split(" ")),e.scopes.length>0){const s=await m(!0,e.scopes,[]);if(s)return void(location.href=s)}const t=await(l=e.clientId,O.get({url:"/system/oauth2/authorize?clientId="+l}));var l;let r;if(g.value=t.client,e.scopes.length>0){r=[];for(const s of t.scopes)e.scopes.indexOf(s.key)>=0&&r.push(s)}else{r=t.scopes;for(const s of r)e.scopes.push(s.key)}for(const s of r)s.value&&d.scopes.push(s.key)},m=(t,l,r)=>((s,A,T,U,V,D,F)=>{const L={};for(const w of D)L[w]=!0;for(const w of F)L[w]=!1;return O.post({url:"/system/oauth2/authorize",headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{response_type:s,client_id:A,redirect_uri:T,state:U,auto_approve:V,scope:JSON.stringify(L)}})})(e.responseType,e.clientId,e.redirectUri,e.state,t,l,r);B(()=>a.value,t=>{t.name==="SSOLogin"&&(S(I.SSO),f())},{immediate:!0});const n={route:i,currentRoute:a,getLoginState:h,setLoginState:S,client:g,queryParams:e,ssoVisible:v,formData:d,formLoading:p,init:f,handleAuthorize:async t=>{let l,r;t?(l=d.scopes,r=e.scopes.filter(s=>l.indexOf(s)===-1)):(l=[],r=e.scopes),p.value=!0;try{const s=await m(!1,l,r);if(!s)return;location.href=s}finally{p.value=!1}},doAuthorize:m,formatScope:t=>{switch(t){case"user.read":return"\u8BBF\u95EE\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";case"user.write":return"\u4FEE\u6539\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";default:return t}},LoginFormTitle:te};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),[["render",function(x,o,i,a,h,S){const g=X,e=Y,v=Z,d=$,p=ee,f=se,m=ae;return E((y(),_("div",re,[c(a.LoginFormTitle,{style:{width:"100%"}}),c(e,{class:"form",style:{float:"none"},value:"uname"},{default:u(()=>[c(g,{label:a.client.name,name:"uname"},null,8,["label"])]),_:1}),H("div",null,[c(m,{model:a.formData,class:"login-form"},{default:u(()=>[o[4]||(o[4]=b(" \u6B64\u7B2C\u4E09\u65B9\u5E94\u7528\u8BF7\u6C42\u83B7\u5F97\u4EE5\u4E0B\u6743\u9650\uFF1A ")),c(p,{prop:"scopes"},{default:u(()=>[c(d,{modelValue:a.formData.scopes,"onUpdate:modelValue":o[0]||(o[0]=n=>a.formData.scopes=n)},{default:u(()=>[(y(!0),_(K,null,M(a.queryParams.scopes,n=>(y(),Q(v,{key:n,value:n,style:{display:"block","margin-bottom":"-10px"}},{default:u(()=>[b(W(a.formatScope(n)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(p,{class:"w-1/1"},{default:u(()=>[c(f,{loading:a.formLoading,class:"w-6/10",type:"primary",onClick:o[1]||(o[1]=z(n=>a.handleAuthorize(!0),["prevent"]))},{default:u(()=>[a.formLoading?(y(),_("span",ie,"\u6388 \u6743 \u4E2D...")):(y(),_("span",ne,"\u540C\u610F\u6388\u6743"))]),_:1},8,["loading"]),c(f,{class:"w-3/10",onClick:o[2]||(o[2]=z(n=>a.handleAuthorize(!1),["prevent"]))},{default:u(()=>o[3]||(o[3]=[b("\u62D2\u7EDD")])),_:1})]),_:1})]),_:1},8,["model"])])],512)),[[G,a.ssoVisible]])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/Login/components/SSOLogin.vue"]]);export{le as default};
