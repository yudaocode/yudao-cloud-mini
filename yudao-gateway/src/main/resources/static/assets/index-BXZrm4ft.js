import{d as E,g as U,D as V,u as Q,r as b,f as z,C as A,G as Y,U as K,_ as B,X as G,o as t,c as D,k as l,w as o,Y as O,F,n as M,q as d,m,I as f,t as X,ah as T,Z as W,L as Z,J as H,K as $,z as ee,N as ae,O as le,P as re,d6 as oe,d7 as ne,d8 as te,Q as se,R as ie}from"./index-BaY5TDP-.js";import{_ as ue}from"./index-avjYFQiD.js";import{_ as de}from"./DictTag-QtcI9ZjC.js";import{_ as me}from"./ContentWrap-DKQn7kZm.js";import{_ as pe}from"./index-BAz6Gqim.js";import{c as ce}from"./permission-DVIdBhA5.js";import fe from"./JobForm-CoHFrrs2.js";import ye from"./JobDetail-DSqh1eCZ.js";import{d as be}from"./download-oWiM5xVU.js";import{b as he,e as ge,d as _e,f as we,r as Pe}from"./index-BZWgf_eG.js";import{f as C}from"./constants-CEEr2azc.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";import"./Dialog-CZSXtzfQ.js";import"./el-descriptions-item-CRF_CO88.js";import"./el-timeline-item-BFYwlQ-d.js";import"./formatTime-Dr6TiYYc.js";const ke=B(E({name:"InfraJob",__name:"index",setup(I,{expose:a}){a();const{t:_}=U(),e=V(),{push:N}=Q(),v=b(!0),h=b(0),w=b([]),c=z({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),x=b(),P=b(!1),s=async()=>{v.value=!0;try{const r=await he(c);w.value=r.list,h.value=r.total}finally{v.value=!1}},i=()=>{c.pageNo=1,s()},q=b(),k=async r=>{try{await e.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+r.name+"?",_("common.reminder")),await Pe(r.id),e.success("\u6267\u884C\u6210\u529F"),await s()}catch{}},p=b(),j=r=>{p.value.open(r)},g=r=>{N(r&&r>0?"/job/job-log?id="+r:"/job/job-log")};A(()=>{s()});const S={t:_,message:e,push:N,loading:v,total:h,list:w,queryParams:c,queryFormRef:x,exportLoading:P,getList:s,handleQuery:i,resetQuery:()=>{x.value.resetFields(),i()},handleExport:async()=>{try{await e.exportConfirm(),P.value=!0;const r=await ge(c);be.excel(r,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{P.value=!1}},formRef:q,openForm:(r,u)=>{q.value.open(r,u)},handleChangeStatus:async r=>{try{const u=r.status===C.STOP?"\u5F00\u542F":"\u5173\u95ED";await e.confirm("\u786E\u8BA4\u8981"+u+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+r.id+'"\u7684\u6570\u636E\u9879?',_("common.reminder"));const R=r.status===C.STOP?C.NORMAL:C.STOP;await _e(r.id,R),e.success(u+"\u6210\u529F"),await s()}catch{}},handleDelete:async r=>{try{await e.delConfirm(),await we(r),e.success(_("common.delSuccess")),await s()}catch{}},handleCommand:(r,u)=>{switch(r){case"handleRun":k(u);break;case"openDetail":j(u.id);break;case"handleJobLog":g(u==null?void 0:u.id)}},handleRun:k,detailRef:p,openDetail:j,handleJobLog:g,get DICT_TYPE(){return Y},get getIntDictOptions(){return K},get checkPermi(){return ce},JobForm:fe,JobDetail:ye,get InfraJobStatusEnum(){return C}};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),[["render",function(I,a,_,e,N,v){const h=pe,w=W,c=Z,x=H,P=$,s=ee,i=ae,q=le,k=me,p=re,j=de,g=oe,S=ne,r=te,u=se,R=ue,y=G("hasPermi"),L=ie;return t(),D(F,null,[l(h,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),l(h,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),l(h,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),l(k,null,{default:o(()=>[l(q,{class:"-mb-15px",model:e.queryParams,ref:"queryFormRef",inline:!0,"label-width":"100px"},{default:o(()=>[l(c,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:o(()=>[l(w,{modelValue:e.queryParams.name,"onUpdate:modelValue":a[0]||(a[0]=n=>e.queryParams.name=n),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:O(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(c,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:o(()=>[l(P,{modelValue:e.queryParams.status,"onUpdate:modelValue":a[1]||(a[1]=n=>e.queryParams.status=n),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:o(()=>[(t(!0),D(F,null,M(e.getIntDictOptions(e.DICT_TYPE.INFRA_JOB_STATUS),n=>(t(),d(x,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:o(()=>[l(w,{modelValue:e.queryParams.handlerName,"onUpdate:modelValue":a[2]||(a[2]=n=>e.queryParams.handlerName=n),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:O(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(c,null,{default:o(()=>[l(i,{onClick:e.handleQuery},{default:o(()=>[l(s,{icon:"ep:search",class:"mr-5px"}),a[7]||(a[7]=m(" \u641C\u7D22"))]),_:1}),l(i,{onClick:e.resetQuery},{default:o(()=>[l(s,{icon:"ep:refresh",class:"mr-5px"}),a[8]||(a[8]=m(" \u91CD\u7F6E"))]),_:1}),f((t(),d(i,{type:"primary",plain:"",onClick:a[3]||(a[3]=n=>e.openForm("create"))},{default:o(()=>[l(s,{icon:"ep:plus",class:"mr-5px"}),a[9]||(a[9]=m(" \u65B0\u589E "))]),_:1})),[[y,["infra:job:create"]]]),f((t(),d(i,{type:"success",plain:"",onClick:e.handleExport,loading:e.exportLoading},{default:o(()=>[l(s,{icon:"ep:download",class:"mr-5px"}),a[10]||(a[10]=m(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[y,["infra:job:export"]]]),f((t(),d(i,{type:"info",plain:"",onClick:a[4]||(a[4]=n=>e.handleJobLog())},{default:o(()=>[l(s,{icon:"ep:zoom-in",class:"mr-5px"}),a[11]||(a[11]=m(" \u6267\u884C\u65E5\u5FD7 "))]),_:1})),[[y,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),l(k,null,{default:o(()=>[f((t(),d(u,{data:e.list},{default:o(()=>[l(p,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),l(p,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),l(p,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:o(n=>[l(j,{type:e.DICT_TYPE.INFRA_JOB_STATUS,value:n.row.status},null,8,["type","value"])]),_:1}),l(p,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),l(p,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),l(p,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),l(p,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:o(n=>[f((t(),d(i,{type:"primary",link:"",onClick:J=>e.openForm("update",n.row.id)},{default:o(()=>a[12]||(a[12]=[m(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),f((t(),d(i,{type:"primary",link:"",onClick:J=>e.handleChangeStatus(n.row)},{default:o(()=>[m(X(n.row.status===e.InfraJobStatusEnum.STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[y,["infra:job:update"]]]),f((t(),d(i,{type:"danger",link:"",onClick:J=>e.handleDelete(n.row.id)},{default:o(()=>a[13]||(a[13]=[m(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[y,["infra:job:delete"]]]),f((t(),d(r,{onCommand:J=>e.handleCommand(J,n.row)},{dropdown:o(()=>[l(S,null,{default:o(()=>[e.checkPermi(["infra:job:trigger"])?(t(),d(g,{key:0,command:"handleRun"},{default:o(()=>a[15]||(a[15]=[m(" \u6267\u884C\u4E00\u6B21 ")])),_:1})):T("",!0),e.checkPermi(["infra:job:query"])?(t(),d(g,{key:1,command:"openDetail"},{default:o(()=>a[16]||(a[16]=[m(" \u4EFB\u52A1\u8BE6\u7EC6 ")])),_:1})):T("",!0),e.checkPermi(["infra:job:query"])?(t(),d(g,{key:2,command:"handleJobLog"},{default:o(()=>a[17]||(a[17]=[m(" \u8C03\u5EA6\u65E5\u5FD7 ")])),_:1})):T("",!0)]),_:1})]),default:o(()=>[l(i,{type:"primary",link:""},{default:o(()=>[l(s,{icon:"ep:d-arrow-right"}),a[14]||(a[14]=m(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[y,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[L,e.loading]]),l(R,{total:e.total,page:e.queryParams.pageNo,"onUpdate:page":a[5]||(a[5]=n=>e.queryParams.pageNo=n),limit:e.queryParams.pageSize,"onUpdate:limit":a[6]||(a[6]=n=>e.queryParams.pageSize=n),onPagination:e.getList},null,8,["total","page","limit"])]),_:1}),l(e.JobForm,{ref:"formRef",onSuccess:e.getList},null,512),l(e.JobDetail,{ref:"detailRef"},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/infra/job/index.vue"]]);export{ke as default};
