import{_ as z}from"./ContentWrap-DKQn7kZm.js";import{d as J,u as Q,S as W,as as X,r as i,at as E,au as Y,C as Z,av as G,D as H,ao as K,a as k,_ as $,q as _,w as V,o as d,j as o,k as y,t as C,c as L,n as ee,a2 as N,F as ae,m as T,ah as D,I as te,ag as se,z as re,N as oe}from"./index-BaY5TDP-.js";import{g as ie,u as F,c as A,d as le}from"./index-CnMIW1kt.js";import{a as ne}from"./index-BeYJ8u62.js";import{C as me}from"./index-D7iZxFey.js";import{g as pe}from"./index-CuAlllbQ.js";import{a as R,B as ue,b as ce}from"./constants-CEEr2azc.js";import de from"./BasicInfo-BjG2vZLU.js";import fe from"./FormDesign-COvCBFQr.js";import ve from"./ProcessDesign-D9ffGEQs.js";import{u as we}from"./tagsView-lnAkwTv2.js";import ye from"./ExtraSettings-CpJtbjIL.js";import"./index-uy0_B-js.js";import"./Dialog-CZSXtzfQ.js";import"./tree-z7HkrWVC.js";import"./index-dK17nfjs.js";import"./el-avatar-DZsRbb7z.js";import"./formCreate-Dy2BGZHq.js";import"./index-F23GdmKV.js";import"./bpmn-embedded-Bxfb97Hp.js";import"./XTextButton-Cf-hbTFF.js";import"./XButton-BcV39lfk.js";import"./consts-vgsb8q48.js";import"./utils-DQEYWnsS.js";import"./index-ZFL2ufyC.js";import"./index-BCN8BzfC.js";import"./el-tree-select-DphqCDCz.js";import"./index-C7Vgvn4F.js";import"./index-D-_5jDBN.js";import"./index-RbAZqEQx.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-D-US79ui.js";import"./el-drawer-r3cMvY4i.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-l60I0Cke.js";import"./formatTime-Dr6TiYYc.js";import"./SimpleModelDesign-DrDgEbbE.js";import"./simple-process-designer-DviJ9JIp.js";import"./el-space-B4pGZPiv.js";import"./download-oWiM5xVU.js";const xe=J({__name:"index",setup(O,{expose:s}){s();const l=Q(),{delView:e}=we(),x=W(),n=H(),g=X(),p=i(),f=i(),r=i(),m=i(),v=async()=>{var a;await((a=p.value)==null?void 0:a.validate())},h=async()=>{var a;await((a=f.value)==null?void 0:a.validate())},b=async()=>{var a;await((a=r.value)==null?void 0:a.validate())},u=i(-1),q=[{title:"\u57FA\u672C\u4FE1\u606F",validator:v},{title:"\u8868\u5355\u8BBE\u8BA1",validator:h},{title:"\u6D41\u7A0B\u8BBE\u8BA1",validator:b},{title:"\u66F4\u591A\u8BBE\u7F6E",validator:null}],t=i({id:void 0,name:"",key:"",category:void 0,icon:void 0,description:"",type:R.BPMN,formType:ue.NORMAL,formId:"",formCustomCreatePath:"",formCustomViewPath:"",visible:!0,startUserType:void 0,startUserIds:[],managerUserIds:[],allowCancelRunningProcess:!0,processIdRule:{enable:!1,prefix:"",infix:"",postfix:"",length:5},autoApprovalType:ce.NONE,titleSetting:{enable:!1,title:""},summarySetting:{enable:!1,summary:[]}}),w=i();E("processData",w),E("modelData",t);const U=i([]),B=i([]),I=i([]),P=async()=>{var c;const a=x.params.id;a?(t.value=await ie(a),t.value.startUserType=((c=t.value.startUserIds)==null?void 0:c.length)>0?1:0,x.params.type==="copy"&&(delete t.value.id,t.value.name+="\u526F\u672C",t.value.key+="_copy")):(t.value.startUserType=0,t.value.managerUserIds.push(g.getUser.id)),U.value=await ne(),B.value=await me.getCategorySimpleList(),I.value=await pe(),u.value=0,m.value.initData()};Y(async()=>t.value.type,()=>{t.value.type===R.BPMN?w.value=t.value.bpmnXml:t.value.type===R.SIMPLE&&(w.value=t.value.simpleModel),console.log("\u52A0\u8F7D\u6D41\u7A0B\u6570\u636E",w.value)},{immediate:!0});const S=async()=>{try{try{await v()}catch{throw u.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await h()}catch{throw u.value=1,new Error("\u8BF7\u5B8C\u5584\u81EA\u5B9A\u4E49\u8868\u5355\u4FE1\u606F")}try{await b()}catch{throw u.value=2,new Error("\u8BF7\u8BBE\u8BA1\u6D41\u7A0B")}return!0}catch(a){throw a}},M=async()=>{try{t.value.id||await n.confirm("\u662F\u5426\u786E\u8BA4\u53D1\u5E03\u8BE5\u6D41\u7A0B\uFF1F"),await S();const a={...t.value};if(t.value.id)await F(a);else{const c=await A(a);t.value.id=c.id}await le(t.value.id),n.success("\u53D1\u5E03\u6210\u529F"),await l.push({name:"BpmModel"})}catch(a){console.error("\u53D1\u5E03\u5931\u8D25:",a),n.warning(a.message||"\u53D1\u5E03\u5931\u8D25")}};Z(async()=>{await P()}),G(()=>{p.value=null,f.value=null,r.value=null});const j={router:l,delView:e,route:x,message:n,userStore:g,basicInfoRef:p,formDesignRef:f,processDesignRef:r,extraSettingsRef:m,validateBasic:v,validateForm:h,validateProcess:b,currentStep:u,steps:q,formData:t,processData:w,formList:U,categoryList:B,userList:I,initData:P,validateAllSteps:S,handleSave:async()=>{try{await S();const a={...t.value};if(t.value.id){await F(a);try{await n.confirm("\u4FEE\u6539\u6D41\u7A0B\u6210\u529F\uFF0C\u662F\u5426\u53D1\u5E03\u6D41\u7A0B\uFF1F"),await M()}catch{}}else{t.value.id=await A(a);try{await n.confirm("\u6D41\u7A0B\u521B\u5EFA\u6210\u529F\uFF0C\u662F\u5426\u7EE7\u7EED\u7F16\u8F91\uFF1F"),await K(),e(k(l.currentRoute)),await l.push({name:"BpmModelUpdate",params:{id:t.value.id}})}catch{e(k(l.currentRoute)),await l.push({name:"BpmModel"})}}}catch(a){console.error("\u4FDD\u5B58\u5931\u8D25:",a),n.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},handleDeploy:M,handleStepClick:async a=>{try{console.log("index",a),a!==0&&await v(),a!==1&&await h(),a!==2&&await b(),u.value=a}catch(c){console.error("\u6B65\u9AA4\u5207\u6362\u5931\u8D25:",c),n.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}},handleBack:()=>{e(k(l.currentRoute)),l.push({name:"BpmModel"})},BasicInfo:de,FormDesign:fe,ProcessDesign:ve,ExtraSettings:ye};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),ge={class:"mx-auto"},he={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},be={class:"w-200px flex items-center overflow-hidden"},De=["title"],Se={class:"flex-1 flex items-center justify-center h-full"},ke={class:"w-400px flex items-center justify-between h-full"},_e=["onClick"],Ve={class:"text-16px font-bold whitespace-nowrap"},Ce={class:"w-200px flex items-center justify-end gap-2"},Le={class:"mt-50px"},Re={key:0,class:"mx-auto w-560px"},Ue={key:1,class:"mx-auto w-560px"},Be={class:"mx-auto w-700px"},Ie=$(xe,[["render",function(O,s,l,e,x,n){const g=re,p=oe,f=z;return d(),_(f,null,{default:V(()=>[o("div",ge,[o("div",he,[o("div",be,[y(g,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:e.handleBack}),o("span",{class:"ml-10px text-16px truncate",title:e.formData.name||"\u521B\u5EFA\u6D41\u7A0B"},C(e.formData.name||"\u521B\u5EFA\u6D41\u7A0B"),9,De)]),o("div",Se,[o("div",ke,[(d(),L(ae,null,ee(e.steps,(r,m)=>o("div",{key:m,class:N(["flex items-center cursor-pointer mx-15px relative h-full",[e.currentStep===m?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:v=>e.handleStepClick(m)},[o("div",{class:N(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[e.currentStep===m?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},C(m+1),3),o("span",Ve,C(r.title),1)],10,_e)),64))])]),o("div",Ce,[e.route.params.id?(d(),_(p,{key:0,type:"success",onClick:e.handleDeploy},{default:V(()=>s[4]||(s[4]=[T("\u53D1 \u5E03")])),_:1})):D("",!0),y(p,{type:"primary",onClick:e.handleSave},{default:V(()=>s[5]||(s[5]=[T("\u4FDD \u5B58")])),_:1})])]),o("div",Le,[e.currentStep===0?(d(),L("div",Re,[y(e.BasicInfo,{modelValue:e.formData,"onUpdate:modelValue":s[0]||(s[0]=r=>e.formData=r),categoryList:e.categoryList,userList:e.userList,ref:"basicInfoRef"},null,8,["modelValue","categoryList","userList"])])):D("",!0),e.currentStep===1?(d(),L("div",Ue,[y(e.FormDesign,{modelValue:e.formData,"onUpdate:modelValue":s[1]||(s[1]=r=>e.formData=r),formList:e.formList,ref:"formDesignRef"},null,8,["modelValue","formList"])])):D("",!0),e.currentStep===2?(d(),_(e.ProcessDesign,{key:2,modelValue:e.formData,"onUpdate:modelValue":s[2]||(s[2]=r=>e.formData=r),ref:"processDesignRef"},null,8,["modelValue"])):D("",!0),te(o("div",Be,[y(e.ExtraSettings,{modelValue:e.formData,"onUpdate:modelValue":s[3]||(s[3]=r=>e.formData=r),ref:"extraSettingsRef"},null,8,["modelValue"])],512),[[se,e.currentStep===3]])])])]),_:1})}],["__scopeId","data-v-0288d24b"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/model/form/index.vue"]]);export{Ie as default};
