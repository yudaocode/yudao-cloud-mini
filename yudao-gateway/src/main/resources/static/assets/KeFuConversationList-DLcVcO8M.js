import{d as Y,D as F,$ as O,r as c,b as P,eL as K,au as U,C as X,av as z,_ as A,X as V,o as _,q,w as I,j as n,t as T,c as R,F as G,n as N,a2 as $,a_ as C,k as u,I as M,aF as B,m as k,ag as E,et as H,z as J,b1 as Q}from"./index-BaY5TDP-.js";import{E as W}from"./el-avatar-DZsRbb7z.js";import{u as Z,K as l,a as j}from"./kefu-CpQb7Flh.js";import{u as ee}from"./emoji-D4-VYurZ.js";import{c as ae}from"./formatTime-Dr6TiYYc.js";const se={class:"color-[#999] font-bold my-10px"},te=["onClick","onContextmenu"],ne={class:"flex justify-center items-center w-100%"},ie={class:"flex justify-center items-center w-50px h-50px"},oe={class:"ml-10px w-100%"},le={class:"flex justify-between items-center w-100%"},re={class:"username"},ce={class:"color-[#999]",style:{"font-size":"13px"}},ue={class:"last-message flex items-center color-[#999]"},de=A(Y({name:"KeFuConversationList",__name:"KeFuConversationList",emits:["change"],setup(D,{expose:t,emit:S}){const e=F(),y=O(),d=Z(),{replaceEmoji:g}=ee(),m=c(-1),i=P(()=>y.getCollapse),f=c(new Map),p=()=>{var s;(s=d.getConversationList)==null||s.forEach(o=>{f.value.set(o.id,ae(o.lastMessageTime,"YYYY-MM-DD"))})};t({calculationLastMessageTime:p});const a=S,x=P(()=>(s,o)=>{switch(s){case l.SYSTEM:return"[\u7CFB\u7EDF\u6D88\u606F]";case l.VIDEO:return"[\u89C6\u9891\u6D88\u606F]";case l.IMAGE:return"[\u56FE\u7247\u6D88\u606F]";case l.PRODUCT:return"[\u5546\u54C1\u6D88\u606F]";case l.ORDER:return"[\u8BA2\u5355\u6D88\u606F]";case l.VOICE:return"[\u8BED\u97F3\u6D88\u606F]";case l.TEXT:return g(K(o).text||o);default:return""}}),h=c(!1),b=c({}),r=c({}),v=()=>{h.value=!1};U(h,s=>{s?document.body.addEventListener("click",v):document.body.removeEventListener("click",v)});const w=c();X(()=>{w.value=setInterval(p,1e4)}),z(()=>{clearInterval(w.value)});const L={message:e,appStore:y,kefuStore:d,replaceEmoji:g,activeConversationId:m,collapse:i,lastMessageTimeMap:f,calculationLastMessageTime:p,emits:a,openRightMessage:s=>{m.value!==s.id&&(m.value=s.id,a("change",s))},getConversationDisplayText:x,showRightMenu:h,rightMenuStyle:b,rightClickConversation:r,rightClick:(s,o)=>{r.value=o,h.value=!0,b.value={top:s.clientY-110+"px",left:i.value?s.clientX-80+"px":s.clientX-210+"px"}},closeRightMenu:v,updateConversationPinned:async s=>{await j.updateConversationPinned({id:r.value.id,adminPinned:s}),e.notifySuccess(s?"\u7F6E\u9876\u6210\u529F":"\u53D6\u6D88\u7F6E\u9876\u6210\u529F"),v(),await d.updateConversation(r.value.id)},deleteConversation:async()=>{await e.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u4F1A\u8BDD\u5417\uFF1F"),await j.deleteConversation(r.value.id),v(),d.deleteConversation(r.value.id)},timer:w};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),[["render",function(D,t,S,e,y,d){const g=W,m=H,i=J,f=Q,p=V("dompurify-html");return _(),q(f,{class:"kefu pt-5px h-100%",width:"260px"},{default:I(()=>[n("div",se," \u4F1A\u8BDD\u8BB0\u5F55("+T(e.kefuStore.getConversationList.length)+") ",1),(_(!0),R(G,null,N(e.kefuStore.getConversationList,a=>(_(),R("div",{key:a.id,class:$([{active:a.id===e.activeConversationId,pinned:a.adminPinned},"kefu-conversation px-10px flex items-center"]),onClick:x=>e.openRightMessage(a),onContextmenu:C(x=>e.rightClick(x,a),["prevent"])},[n("div",ne,[n("div",ie,[u(m,{hidden:a.adminUnreadMessageCount===0,max:99,value:a.adminUnreadMessageCount},{default:I(()=>[u(g,{src:a.userAvatar,alt:"avatar"},null,8,["src"])]),_:2},1032,["hidden","value"])]),n("div",oe,[n("div",le,[n("span",re,T(a.userNickname),1),n("span",ce,T(e.lastMessageTimeMap.get(a.id)??"\u8BA1\u7B97\u4E2D"),1)]),M(n("div",ue,null,512),[[p,e.getConversationDisplayText(a.lastMessageContentType,a.lastMessageContent)]])])])],42,te))),128)),M(n("ul",{style:B(e.rightMenuStyle),class:"right-menu-ul"},[M(n("li",{class:"flex items-center",onClick:t[0]||(t[0]=C(a=>e.updateConversationPinned(!0),["stop"]))},[u(i,{class:"mr-5px",icon:"ep:top"}),t[2]||(t[2]=k(" \u7F6E\u9876\u4F1A\u8BDD "))],512),[[E,!e.rightClickConversation.adminPinned]]),M(n("li",{class:"flex items-center",onClick:t[1]||(t[1]=C(a=>e.updateConversationPinned(!1),["stop"]))},[u(i,{class:"mr-5px",icon:"ep:bottom"}),t[3]||(t[3]=k(" \u53D6\u6D88\u7F6E\u9876 "))],512),[[E,e.rightClickConversation.adminPinned]]),n("li",{class:"flex items-center",onClick:C(e.deleteConversation,["stop"])},[u(i,{class:"mr-5px",color:"red",icon:"ep:delete"}),t[4]||(t[4]=k(" \u5220\u9664\u4F1A\u8BDD "))]),n("li",{class:"flex items-center",onClick:C(e.closeRightMenu,["stop"])},[u(i,{class:"mr-5px",color:"red",icon:"ep:close"}),t[5]||(t[5]=k(" \u53D6\u6D88 "))])],4),[[E,e.showRightMenu]])]),_:1})}],["__scopeId","data-v-f4d55ab7"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/kefu/components/KeFuConversationList.vue"]]);export{de as default};
