import{d as A,g as Y,D as F,r as y,f as N,ax as b,ao as M,G,U as j,az as E,_ as z,o as u,q as m,w as o,k as i,m as s,I as Z,c as k,F as I,n as x,t as L,ah as n,Z as B,L as H,ak as J,al as K,cf as Q,M as W,O as X,N as $,R as ee}from"./index-BaY5TDP-.js";import{_ as te}from"./Dialog-CZSXtzfQ.js";import{a as ae,c as le,u as oe}from"./couponTemplate-C5oFUT2R.js";import{i as h,j as U,k as f}from"./constants-CEEr2azc.js";import ie from"./SpuShowcase-DyUON5OE.js";import re from"./ProductCategorySelect-ClWAu1VZ.js";import"./el-image-Bg-CwbDE.js";import"./spu-BVX48OKx.js";import"./SpuTableSelect-CD92PVLd.js";import"./ContentWrap-DKQn7kZm.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./el-tree-select-DphqCDCz.js";import"./tree-z7HkrWVC.js";import"./category-B7jjsMOS.js";const ue=z(A({name:"CouponTemplateForm",__name:"CouponTemplateForm",emits:["success"],setup(q,{expose:t,emit:w}){const{t:e}=Y(),V=F(),D=y(!1),g=y(""),r=y(!1),c=y(""),l=y({id:void 0,name:void 0,discountType:h.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:U.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:f.ALL.scope,description:void 0,productScopeValues:[],productCategoryIds:[],productSpuIds:[]}),p=N({name:[{required:!0,message:"\u4F18\u60E0\u5238\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountType:[{required:!0,message:"\u4F18\u60E0\u5238\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],discountPrice:[{required:!0,message:"\u4F18\u60E0\u5238\u9762\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountPercent:[{required:!0,message:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],discountLimitPrice:[{required:!0,message:"\u6700\u591A\u4F18\u60E0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],usePrice:[{required:!0,message:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeType:[{required:!0,message:"\u9886\u53D6\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],totalCount:[{required:!0,message:"\u53D1\u653E\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],takeLimitCount:[{required:!0,message:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],validityType:[{required:!0,message:"\u6709\u6548\u671F\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],validTimes:[{required:!0,message:"\u56FA\u5B9A\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],fixedStartTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],fixedEndTerm:[{required:!0,message:"\u5F00\u59CB\u9886\u53D6\u5929\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),T=y(),S=async(d,R)=>{if(D.value=!0,g.value=e("action."+d),c.value=d,C(),R){r.value=!0;try{const v=await ae(R);l.value={...v,discountPrice:b(v.discountPrice),discountPercent:v.discountPercent!==void 0?v.discountPercent/10:void 0,discountLimitPrice:b(v.discountLimitPrice),usePrice:b(v.usePrice),validTimes:[v.validStartTime,v.validEndTime]},await _()}finally{r.value=!1}}};t({open:S});const P=w,C=()=>{var d;l.value={id:void 0,name:void 0,description:void 0,discountType:h.PRICE.type,discountPrice:void 0,discountPercent:void 0,discountLimitPrice:void 0,usePrice:void 0,takeType:1,totalCount:void 0,takeLimitCount:void 0,validityType:U.DATE.type,validTimes:[],validStartTime:void 0,validEndTime:void 0,fixedStartTerm:void 0,fixedEndTerm:void 0,productScope:f.ALL.scope,productScopeValues:[],productSpuIds:[],productCategoryIds:[]},(d=T.value)==null||d.resetFields()},_=async()=>{switch(l.value.productScope){case f.SPU.scope:l.value.productSpuIds=l.value.productScopeValues;break;case f.CATEGORY.scope:await M(()=>{let d=l.value.productScopeValues;Array.isArray(d)&&d.length>0&&(d=d[0]),l.value.productCategoryIds=d})}};function a(d){switch(l.value.productScope){case f.SPU.scope:d.productScopeValues=l.value.productSpuIds;break;case f.CATEGORY.scope:d.productScopeValues=Array.isArray(l.value.productCategoryIds)?l.value.productCategoryIds:[l.value.productCategoryIds]}}const O={t:e,message:V,dialogVisible:D,dialogTitle:g,formLoading:r,formType:c,formData:l,formRules:p,formRef:T,open:S,emit:P,submitForm:async()=>{if(T&&await T.value.validate()){r.value=!0;try{const d={...l.value,discountPrice:E(l.value.discountPrice),discountPercent:l.value.discountPercent!==void 0?10*l.value.discountPercent:void 0,discountLimitPrice:E(l.value.discountLimitPrice),usePrice:E(l.value.usePrice),validStartTime:l.value.validTimes&&l.value.validTimes.length===2?l.value.validTimes[0]:void 0,validEndTime:l.value.validTimes&&l.value.validTimes.length===2?l.value.validTimes[1]:void 0,totalCount:l.value.takeType===1?l.value.totalCount:-1,takeLimitCount:l.value.takeType===1?l.value.takeLimitCount:-1};a(d),c.value==="create"?(await le(d),V.success(e("common.createSuccess"))):(await oe(d),V.success(e("common.updateSuccess"))),D.value=!1,P("success")}finally{r.value=!1}}},resetForm:C,getProductScope:_,setProductScopeValues:a,get DICT_TYPE(){return G},get getIntDictOptions(){return j},get CouponTemplateValidityTypeEnum(){return U},get PromotionDiscountTypeEnum(){return h},get PromotionProductScopeEnum(){return f},SpuShowcase:ie,ProductCategorySelect:re};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),[["render",function(q,t,w,e,V,D){const g=B,r=H,c=J,l=K,p=Q,T=W,S=X,P=$,C=te,_=ee;return u(),m(C,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[18]||(t[18]=a=>e.dialogVisible=a),title:e.dialogTitle},{footer:o(()=>[i(P,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:o(()=>t[31]||(t[31]=[s("\u786E \u5B9A")])),_:1},8,["disabled"]),i(P,{onClick:t[17]||(t[17]=a=>e.dialogVisible=!1)},{default:o(()=>t[32]||(t[32]=[s("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Z((u(),m(S,{ref:"formRef",model:e.formData,rules:e.formRules,"label-width":"140px"},{default:o(()=>[i(r,{label:"\u4F18\u60E0\u5238\u540D\u79F0",prop:"name"},{default:o(()=>[i(g,{modelValue:e.formData.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.formData.name=a),placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u540D\u79F0"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u4F18\u60E0\u5238\u63CF\u8FF0",prop:"description"},{default:o(()=>[i(g,{modelValue:e.formData.description,"onUpdate:modelValue":t[1]||(t[1]=a=>e.formData.description=a),autosize:{minRows:2,maxRows:2},clearable:!0,"show-word-limit":!0,class:"w-1/1!",maxlength:"512",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u5238\u63CF\u8FF0",type:"textarea"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u4F18\u60E0\u52B5\u7C7B\u578B",prop:"productScope"},{default:o(()=>[i(l,{modelValue:e.formData.productScope,"onUpdate:modelValue":t[2]||(t[2]=a=>e.formData.productScope=a)},{default:o(()=>[(u(!0),k(I,null,x(e.getIntDictOptions(e.DICT_TYPE.PROMOTION_PRODUCT_SCOPE),a=>(u(),m(c,{key:a.value,value:a.value},{default:o(()=>[s(L(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.formData.productScope===e.PromotionProductScopeEnum.SPU.scope?(u(),m(r,{key:0,label:"\u5546\u54C1",prop:"productSpuIds"},{default:o(()=>[i(e.SpuShowcase,{modelValue:e.formData.productSpuIds,"onUpdate:modelValue":t[3]||(t[3]=a=>e.formData.productSpuIds=a)},null,8,["modelValue"])]),_:1})):n("",!0),e.formData.productScope===e.PromotionProductScopeEnum.CATEGORY.scope?(u(),m(r,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:o(()=>[i(e.ProductCategorySelect,{modelValue:e.formData.productCategoryIds,"onUpdate:modelValue":t[4]||(t[4]=a=>e.formData.productCategoryIds=a)},null,8,["modelValue"])]),_:1})):n("",!0),i(r,{label:"\u4F18\u60E0\u7C7B\u578B",prop:"discountType"},{default:o(()=>[i(l,{modelValue:e.formData.discountType,"onUpdate:modelValue":t[5]||(t[5]=a=>e.formData.discountType=a)},{default:o(()=>[(u(!0),k(I,null,x(e.getIntDictOptions(e.DICT_TYPE.PROMOTION_DISCOUNT_TYPE),a=>(u(),m(c,{key:a.value,value:a.value},{default:o(()=>[s(L(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.formData.discountType===e.PromotionDiscountTypeEnum.PRICE.type?(u(),m(r,{key:2,label:"\u4F18\u60E0\u5238\u9762\u989D",prop:"discountPrice"},{default:o(()=>[i(p,{modelValue:e.formData.discountPrice,"onUpdate:modelValue":t[6]||(t[6]=a=>e.formData.discountPrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u91D1\u989D\uFF0C\u5355\u4F4D\uFF1A\u5143"},null,8,["modelValue"]),t[19]||(t[19]=s(" \u5143 "))]),_:1})):n("",!0),e.formData.discountType===e.PromotionDiscountTypeEnum.PERCENT.type?(u(),m(r,{key:3,label:"\u4F18\u60E0\u5238\u6298\u6263",prop:"discountPercent"},{default:o(()=>[i(p,{modelValue:e.formData.discountPercent,"onUpdate:modelValue":t[7]||(t[7]=a=>e.formData.discountPercent=a),max:9.9,min:1,precision:1,class:"mr-2 !w-400px",placeholder:"\u4F18\u60E0\u5238\u6298\u6263\u4E0D\u80FD\u5C0F\u4E8E 1 \u6298\uFF0C\u4E14\u4E0D\u53EF\u5927\u4E8E 9.9 \u6298"},null,8,["modelValue"]),t[20]||(t[20]=s(" \u6298 "))]),_:1})):n("",!0),e.formData.discountType===e.PromotionDiscountTypeEnum.PERCENT.type?(u(),m(r,{key:4,label:"\u6700\u591A\u4F18\u60E0",prop:"discountLimitPrice"},{default:o(()=>[i(p,{modelValue:e.formData.discountLimitPrice,"onUpdate:modelValue":t[8]||(t[8]=a=>e.formData.discountLimitPrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u8BF7\u8F93\u5165\u6700\u591A\u4F18\u60E0"},null,8,["modelValue"]),t[21]||(t[21]=s(" \u5143 "))]),_:1})):n("",!0),i(r,{label:"\u6EE1\u591A\u5C11\u5143\u53EF\u4EE5\u4F7F\u7528",prop:"usePrice"},{default:o(()=>[i(p,{modelValue:e.formData.usePrice,"onUpdate:modelValue":t[9]||(t[9]=a=>e.formData.usePrice=a),min:0,precision:2,class:"mr-2 !w-400px",placeholder:"\u65E0\u95E8\u69DB\u8BF7\u8BBE\u4E3A 0"},null,8,["modelValue"]),t[22]||(t[22]=s(" \u5143 "))]),_:1}),i(r,{label:"\u9886\u53D6\u65B9\u5F0F",prop:"takeType"},{default:o(()=>[i(l,{modelValue:e.formData.takeType,"onUpdate:modelValue":t[10]||(t[10]=a=>e.formData.takeType=a)},{default:o(()=>[(u(),m(c,{key:1,value:1},{default:o(()=>t[23]||(t[23]=[s("\u76F4\u63A5\u9886\u53D6")])),_:1})),(u(),m(c,{key:2,value:2},{default:o(()=>t[24]||(t[24]=[s("\u6307\u5B9A\u53D1\u653E")])),_:1})),(u(),m(c,{key:2,value:3},{default:o(()=>t[25]||(t[25]=[s("\u65B0\u4EBA\u52B5")])),_:1}))]),_:1},8,["modelValue"])]),_:1}),e.formData.takeType===1?(u(),m(r,{key:5,label:"\u53D1\u653E\u6570\u91CF",prop:"totalCount"},{default:o(()=>[i(p,{modelValue:e.formData.totalCount,"onUpdate:modelValue":t[11]||(t[11]=a=>e.formData.totalCount=a),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u53D1\u653E\u6570\u91CF\uFF0C\u6CA1\u6709\u4E4B\u540E\u4E0D\u80FD\u9886\u53D6\u6216\u53D1\u653E\uFF0C-1 \u4E3A\u4E0D\u9650\u5236"},null,8,["modelValue"]),t[26]||(t[26]=s(" \u5F20 "))]),_:1})):n("",!0),e.formData.takeType===1?(u(),m(r,{key:6,label:"\u6BCF\u4EBA\u9650\u9886\u4E2A\u6570",prop:"takeLimitCount"},{default:o(()=>[i(p,{modelValue:e.formData.takeLimitCount,"onUpdate:modelValue":t[12]||(t[12]=a=>e.formData.takeLimitCount=a),min:-1,precision:0,class:"mr-2 !w-400px",placeholder:"\u8BBE\u7F6E\u4E3A -1 \u65F6\uFF0C\u53EF\u65E0\u9650\u9886\u53D6"},null,8,["modelValue"]),t[27]||(t[27]=s(" \u5F20 "))]),_:1})):n("",!0),i(r,{label:"\u6709\u6548\u671F\u7C7B\u578B",prop:"validityType"},{default:o(()=>[i(l,{modelValue:e.formData.validityType,"onUpdate:modelValue":t[13]||(t[13]=a=>e.formData.validityType=a)},{default:o(()=>[(u(!0),k(I,null,x(e.getIntDictOptions(e.DICT_TYPE.PROMOTION_COUPON_TEMPLATE_VALIDITY_TYPE),a=>(u(),m(c,{key:a.value,value:a.value},{default:o(()=>[s(L(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.formData.validityType===e.CouponTemplateValidityTypeEnum.DATE.type?(u(),m(r,{key:7,label:"\u56FA\u5B9A\u65E5\u671F",prop:"validTimes"},{default:o(()=>[i(T,{modelValue:e.formData.validTimes,"onUpdate:modelValue":t[14]||(t[14]=a=>e.formData.validTimes=a),"default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)],type:"datetimerange","value-format":"x"},null,8,["modelValue","default-time"])]),_:1})):n("",!0),e.formData.validityType===e.CouponTemplateValidityTypeEnum.TERM.type?(u(),m(r,{key:8,label:"\u9886\u53D6\u65E5\u671F",prop:"fixedStartTerm"},{default:o(()=>[t[28]||(t[28]=s(" \u7B2C ")),i(p,{modelValue:e.formData.fixedStartTerm,"onUpdate:modelValue":t[15]||(t[15]=a=>e.formData.fixedStartTerm=a),min:0,precision:0,class:"mx-2",placeholder:"0 \u4E3A\u4ECA\u5929\u751F\u6548"},null,8,["modelValue"]),t[29]||(t[29]=s(" \u81F3 ")),i(p,{modelValue:e.formData.fixedEndTerm,"onUpdate:modelValue":t[16]||(t[16]=a=>e.formData.fixedEndTerm=a),min:0,precision:0,class:"mx-2",placeholder:"\u8BF7\u8F93\u5165\u7ED3\u675F\u5929\u6570"},null,8,["modelValue"]),t[30]||(t[30]=s(" \u5929\u6709\u6548 "))]),_:1})):n("",!0)]),_:1},8,["model","rules"])),[[_,e.formLoading]])]),_:1},8,["modelValue","title"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/coupon/template/CouponTemplateForm.vue"]]);export{ue as default};
