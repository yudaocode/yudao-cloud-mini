import{d as S,r as x,f as D,au as I,e3 as k,C as N,ey as $,e4 as y,ew as R,_ as q,I as L,o as w,q as v,w as l,k as a,c as B,F as W,n as E,ah as F,m as O,P as j,J as A,K as J,L as K,Z as Q,cf as Z,N as z,Q as G,O as H,R as M}from"./index-BaY5TDP-.js";import{S as T}from"./index-DMn3OXs3.js";import{W as X}from"./index-B0TWi7A6.js";const Y=q(S({__name:"PurchaseInItemForm",props:{items:{type:null,required:!0},disabled:{type:Boolean,required:!0}},setup(U,{expose:_}){const g=U,d=x(!1),p=x([]),C=D({warehouseId:[{required:!0,message:"\u4ED3\u5E93\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],count:[{required:!0,message:"\u4EA7\u54C1\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),u=x([]),V=x([]),P=x(void 0);I(()=>g.items,async n=>{n.forEach(o=>{var f;o.warehouseId==null&&(o.warehouseId=(f=P.value)==null?void 0:f.id),o.stockCount===null&&o.warehouseId!=null&&i(o)}),p.value=n},{immediate:!0}),I(()=>p.value,n=>{n&&n.length!==0&&n.forEach(o=>{o.totalProductPrice=k(o.productPrice,o.count),o.taxPrice=k(o.totalProductPrice,o.taxPercent/100),o.totalProductPrice!=null?o.totalPrice=o.totalProductPrice+(o.taxPrice||0):o.totalPrice=void 0})},{deep:!0});const i=async n=>{if(!n.productId)return;const o=await T.getStockCount(n.productId);n.stockCount=o||0},s=()=>u.value.validate();_({validate:s}),N(async()=>{V.value=await X.getWarehouseSimpleList(),P.value=V.value.find(n=>n.defaultStatus)});const c={props:g,formLoading:d,formData:p,formRules:C,formRef:u,warehouseList:V,defaultWarehouse:P,getSummaries:n=>{const{columns:o,data:f}=n,h=[];return o.forEach((b,m)=>{if(m!==0)if(["count","totalProductPrice","taxPrice","totalPrice"].includes(b.property)){const e=R(f.map(t=>Number(t[b.property])));h[m]=b.property==="count"?$(e):y(e)}else h[m]="";else h[m]="\u5408\u8BA1"}),h},handleAdd:()=>{p.value.push({id:void 0,productId:void 0,productUnitName:void 0,productBarCode:void 0,productPrice:void 0,stockCount:void 0,count:1,totalProductPrice:void 0,taxPercent:void 0,taxPrice:void 0,totalPrice:void 0,remark:void 0})},handleDelete:n=>{p.value.splice(n,1)},setStockCount:i,validate:s,get erpCountInputFormatter(){return $},get erpPriceInputFormatter(){return y}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),[["render",function(U,_,g,d,p,C){const u=j,V=A,P=J,i=K,s=Q,c=Z,n=z,o=G,f=H,h=M;return L((w(),v(f,{ref:"formRef",model:d.formData,rules:d.formRules,"label-width":"0px","inline-message":!0,disabled:g.disabled},{default:l(()=>[a(o,{data:d.formData,"show-summary":"","summary-method":d.getSummaries,class:"-mt-10px"},{default:l(()=>{var b,m;return[a(u,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),a(u,{label:"\u4ED3\u5E93\u540D\u79F0","min-width":"125"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.warehouseId`,rules:d.formRules.warehouseId,class:"mb-0px!"},{default:l(()=>[a(P,{modelValue:e.warehouseId,"onUpdate:modelValue":r=>e.warehouseId=r,clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u4ED3\u5E93",onChange:r=>U.onChangeWarehouse(r,e)},{default:l(()=>[(w(!0),B(W,null,E(d.warehouseList,r=>(w(),v(V,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"])]),_:1}),a(u,{label:"\u4EA7\u54C1\u540D\u79F0","min-width":"180"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.productName,"onUpdate:modelValue":t=>e.productName=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),a(u,{label:"\u5E93\u5B58","min-width":"100"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.stockCount,"onUpdate:modelValue":t=>e.stockCount=t,formatter:d.erpCountInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),a(u,{label:"\u6761\u7801","min-width":"150"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.productBarCode,"onUpdate:modelValue":t=>e.productBarCode=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),a(u,{label:"\u5355\u4F4D","min-width":"80"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.productUnitName,"onUpdate:modelValue":t=>e.productUnitName=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),((b=d.formData[0])==null?void 0:b.totalCount)!=null?(w(),v(u,{key:0,label:"\u539F\u6570\u91CF",fixed:"right","min-width":"80"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.totalCount,"onUpdate:modelValue":t=>e.totalCount=t,formatter:d.erpCountInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1})):F("",!0),((m=d.formData[0])==null?void 0:m.inCount)!=null?(w(),v(u,{key:1,label:"\u5DF2\u5165\u5E93",fixed:"right","min-width":"80"},{default:l(({row:e})=>[a(i,{class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.inCount,"onUpdate:modelValue":t=>e.inCount=t,formatter:d.erpCountInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1})):F("",!0),a(u,{label:"\u6570\u91CF",prop:"count",fixed:"right","min-width":"140"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.count`,rules:d.formRules.count,class:"mb-0px!"},{default:l(()=>[a(c,{modelValue:e.count,"onUpdate:modelValue":r=>e.count=r,"controls-position":"right",min:.001,precision:3,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),a(u,{label:"\u4EA7\u54C1\u5355\u4EF7",fixed:"right","min-width":"120"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.productPrice`,class:"mb-0px!"},{default:l(()=>[a(c,{modelValue:e.productPrice,"onUpdate:modelValue":r=>e.productPrice=r,"controls-position":"right",min:.01,precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),a(u,{label:"\u91D1\u989D",prop:"totalProductPrice",fixed:"right","min-width":"100"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.totalProductPrice`,class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.totalProductPrice,"onUpdate:modelValue":r=>e.totalProductPrice=r,formatter:d.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:1}),a(u,{label:"\u7A0E\u7387\uFF08%\uFF09",fixed:"right","min-width":"115"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.taxPercent`,class:"mb-0px!"},{default:l(()=>[a(c,{modelValue:e.taxPercent,"onUpdate:modelValue":r=>e.taxPercent=r,"controls-position":"right",min:0,precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),a(u,{label:"\u7A0E\u989D",prop:"taxPrice",fixed:"right","min-width":"120"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.taxPrice`,class:"mb-0px!"},{default:l(()=>[a(i,{prop:`${t}.taxPrice`,class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.taxPrice,"onUpdate:modelValue":r=>e.taxPrice=r,formatter:d.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:2},1032,["prop"])]),_:1}),a(u,{label:"\u7A0E\u989D\u5408\u8BA1",prop:"totalPrice",fixed:"right","min-width":"100"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.totalPrice`,class:"mb-0px!"},{default:l(()=>[a(s,{disabled:"",modelValue:e.totalPrice,"onUpdate:modelValue":r=>e.totalPrice=r,formatter:d.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:1}),a(u,{label:"\u5907\u6CE8","min-width":"150"},{default:l(({row:e,$index:t})=>[a(i,{prop:`${t}.remark`,class:"mb-0px!"},{default:l(()=>[a(s,{modelValue:e.remark,"onUpdate:modelValue":r=>e.remark=r,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),a(u,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:l(({$index:e})=>[a(n,{disabled:d.formData.length===1,onClick:t=>d.handleDelete(e),link:""},{default:l(()=>_[0]||(_[0]=[O(" \u2014 ")])),_:2},1032,["disabled","onClick"])]),_:1})]}),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[h,d.formLoading]])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/purchase/in/components/PurchaseInItemForm.vue"]]);export{Y as default};
