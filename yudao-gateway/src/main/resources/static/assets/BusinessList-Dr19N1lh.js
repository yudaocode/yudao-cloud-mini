import{d as P,D as z,r as l,f as L,u as R,au as k,e2 as S,_ as M,X as T,o as d,c as x,k as s,w as n,m as _,I as B,q as v,ah as h,t as F,F as j,z as D,N as U,E,P as O,y as Q,Q as A,R as X}from"./index-BaY5TDP-.js";import{_ as G}from"./ContentWrap-DKQn7kZm.js";import{_ as H}from"./index-avjYFQiD.js";import{b as J,g as K}from"./index-6-r4wYJE.js";import{h as V,i as W}from"./index-DiJG1eDb.js";import Y from"./BusinessForm-DKlvsT4o.js";import{B as N}from"./index-BlslFSYd.js";import Z from"./BusinessListModal-6XoY13Ne.js";import"./index-DrSdAlug.js";import"./Dialog-CZSXtzfQ.js";import"./index-n6shePIl.js";import"./index-h6ObHKtQ.js";import"./index-CuAlllbQ.js";import"./BusinessProductForm-FoZjzksq.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-D4G-Yxr7.js";const $=M(P({name:"CrmBusinessList",__name:"BusinessList",props:{bizType:{type:Number,required:!0},bizId:{type:Number,required:!0},customerId:{type:Number,required:!1},contactId:{type:Number,required:!1}},setup(q,{expose:t}){t();const c=z(),e=q,f=l(!0),C=l(0),u=l([]),r=L({pageNo:1,pageSize:10,customerId:void 0,contactId:void 0}),b=async()=>{f.value=!0;try{r.customerId=void 0,r.contactId=void 0;let a={list:[],total:0};switch(e.bizType){case N.CRM_CUSTOMER:r.customerId=e.bizId,a=await K(r);break;case N.CRM_CONTACT:r.contactId=e.bizId,a=await J(r);break;default:return}u.value=a.list,C.value=a.total}finally{f.value=!1}},o=()=>{r.pageNo=1,b()},y=l(),{push:g}=R(),I=l(),p=l();k(()=>[e.bizId,e.bizType],()=>{o()},{immediate:!0,deep:!0});const m={message:c,props:e,loading:f,total:C,list:u,queryParams:r,getList:b,handleQuery:o,formRef:y,openForm:()=>{y.value.open("create",null,e.customerId,e.contactId)},push:g,openDetail:a=>{g({name:"CrmBusinessDetail",params:{id:a}})},businessModalRef:I,openBusinessModal:()=>{I.value.open()},createContactBusinessList:async a=>{const i={contactId:e.bizId,businessIds:a};p.value.getSelectionRows().forEach(w=>{i.businessIds.push(w.id)}),await V(i),c.success("\u5173\u8054\u5546\u673A\u6210\u529F"),o()},businessRef:p,deleteContactBusinessList:async()=>{const a={contactId:e.bizId,businessIds:p.value.getSelectionRows().map(i=>i.id)};if(a.businessIds.length===0)return c.error("\u672A\u9009\u62E9\u5546\u673A");await W(a),c.success("\u53D6\u5173\u5546\u673A\u6210\u529F"),o()},BusinessForm:Y,BusinessListModal:Z,get erpPriceTableColumnFormatter(){return S}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),[["render",function(q,t,c,e,f,C){const u=D,r=U,b=E,o=O,y=Q,g=A,I=H,p=G,m=T("hasPermi"),a=X;return d(),x(j,null,[s(b,{justify:"end"},{default:n(()=>[s(r,{onClick:e.openForm},{default:n(()=>[s(u,{class:"mr-5px",icon:"ep:opportunity"}),t[2]||(t[2]=_(" \u521B\u5EFA\u5546\u673A "))]),_:1}),e.queryParams.contactId?B((d(),v(r,{key:0,onClick:e.openBusinessModal},{default:n(()=>[s(u,{class:"mr-5px",icon:"ep:circle-plus"}),t[3]||(t[3]=_("\u5173\u8054 "))]),_:1})),[[m,["crm:contact:create-business"]]]):h("",!0),e.queryParams.contactId?B((d(),v(r,{key:1,onClick:e.deleteContactBusinessList},{default:n(()=>[s(u,{class:"mr-5px",icon:"ep:remove"}),t[4]||(t[4]=_("\u89E3\u9664\u5173\u8054 "))]),_:1})),[[m,["crm:contact:delete-business"]]]):h("",!0)]),_:1}),s(p,{class:"mt-10px"},{default:n(()=>[B((d(),v(g,{ref:"businessRef",data:e.list,stripe:!0,"show-overflow-tooltip":!0},{default:n(()=>[e.queryParams.contactId?(d(),v(o,{key:0,type:"selection",width:"55"})):h("",!0),s(o,{label:"\u5546\u673A\u540D\u79F0",fixed:"left",align:"center",prop:"name"},{default:n(i=>[s(y,{type:"primary",underline:!1,onClick:w=>e.openDetail(i.row.id)},{default:n(()=>[_(F(i.row.name),1)]),_:2},1032,["onClick"])]),_:1}),s(o,{label:"\u5546\u673A\u91D1\u989D",align:"center",prop:"price",formatter:e.erpPriceTableColumnFormatter},null,8,["formatter"]),s(o,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName"}),s(o,{label:"\u5546\u673A\u7EC4",align:"center",prop:"statusTypeName"}),s(o,{label:"\u5546\u673A\u9636\u6BB5",align:"center",prop:"statusName"})]),_:1},8,["data"])),[[a,e.loading]]),s(I,{total:e.total,page:e.queryParams.pageNo,"onUpdate:page":t[0]||(t[0]=i=>e.queryParams.pageNo=i),limit:e.queryParams.pageSize,"onUpdate:limit":t[1]||(t[1]=i=>e.queryParams.pageSize=i),onPagination:e.getList},null,8,["total","page","limit"])]),_:1}),s(e.BusinessForm,{ref:"formRef",onSuccess:e.getList},null,512),s(e.BusinessListModal,{ref:"businessModalRef","customer-id":e.props.customerId,onSuccess:e.createContactBusinessList},null,8,["customer-id"])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/business/components/BusinessList.vue"]]);export{$ as default};
