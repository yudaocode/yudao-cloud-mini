import{d as P,D as F,r as w,ca as K,au as $,C as H,e6 as Z,e7 as J,ar as Q,aG as W,_ as X,o as C,q as R,w as r,j as c,k as t,m as S,ah as V,c as b,F as N,n as U,t as A,a2 as Y,I as ee,a_ as D,ag as ae,z as te,N as ne,Z as ie,b8 as se,bs as oe,b1 as le}from"./index-BaY5TDP-.js";import{E as re}from"./el-drawer-r3cMvY4i.js";import{E as ce}from"./el-empty-wTPt5q4m.js";import{C as _}from"./index-C2SngFyG.js";import ve from"./RoleRepository-BxJ_dL-w.js";import{r as ue}from"./gpt-WhTktY3S.js";import"./RoleHeader-DMeV7Zuv.js";import"./RoleList-CDc3DjHg.js";import"./ChatRoleForm-CkDSrpdx.js";import"./Dialog-CZSXtzfQ.js";import"./constants-CEEr2azc.js";import"./index-Cz_ljQ_t.js";import"./RoleCategoryList-C66gfOgI.js";const de={class:"h-100%"},pe={class:"conversation-list"},Ce={key:0,class:"conversation-item classify-title"},me=["onClick","onMouseover"],he={class:"title-wrapper"},ye=["src"],fe={class:"title"},we={class:"button-wrapper"},ge={class:"tool-box"},ke=X(P({__name:"ConversationList",props:{activeId:{type:String||null,required:!0}},emits:["onConversationCreate","onConversationClick","onConversationClear","onConversationDelete"],setup(O,{expose:s,emit:B}){const e=F(),M=w(""),v=w(null),m=w(null),n=w([]),g=w({}),I=w(!1),h=w(),u=O,d=B,T=async a=>{const l=n.value.filter(p=>p.id===a);d("onConversationClick",l[0])&&(v.value=a)},o=async()=>{try{if(h.value=setTimeout(()=>{I.value=!0},50),n.value=await _.getChatConversationMyList(),n.value.sort((a,l)=>l.createTime-a.createTime),n.value.length===0)return v.value=null,void(g.value={});g.value=await i(n.value)}finally{h.value&&clearTimeout(h.value),I.value=!1}},i=async a=>{const l={\u7F6E\u9876:[],\u4ECA\u5929:[],\u4E00\u5929\u524D:[],\u4E09\u5929\u524D:[],\u4E03\u5929\u524D:[],\u4E09\u5341\u5929\u524D:[]},p=Date.now(),k=864e5,E=3*k,q=7*k,G=30*k;for(const f of a){if(f.pinned){l.\u7F6E\u9876.push(f);continue}const x=p-f.createTime;x<k?l.\u4ECA\u5929.push(f):x<E?l.\u4E00\u5929\u524D.push(f):x<q?l.\u4E09\u5929\u524D.push(f):x<G?l.\u4E03\u5929\u524D.push(f):l.\u4E09\u5341\u5929\u524D.push(f)}return l},y=async()=>{const a=await _.createChatConversationMy({});await o(),await T(a),d("onConversationCreate")},z=w(!1),{activeId:L}=K(u);$(L,async(a,l)=>{v.value=a}),s({createConversation:y}),H(async()=>{await o(),u.activeId?v.value=u.activeId:n.value.length&&(v.value=n.value[0].id,await d("onConversationClick",n.value[0]))});const j={message:e,searchName:M,activeConversationId:v,hoverConversationId:m,conversationList:n,conversationMap:g,loading:I,loadingTime:h,props:u,emits:d,searchConversation:async a=>{if(M.value.trim().length){const l=n.value.filter(p=>p.title.includes(M.value.trim()));g.value=await i(l)}else g.value=await i(n.value)},handleConversationClick:T,getChatConversationList:o,getConversationGroupByCreateTime:i,createConversation:y,updateConversationTitle:async a=>{const{value:l}=await Q.prompt("\u4FEE\u6539\u6807\u9898",{inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",inputValue:a.title});await _.updateChatConversationMy({id:a.id,title:l}),e.success("\u91CD\u547D\u540D\u6210\u529F"),await o();const p=n.value.filter(k=>k.id===a.id);p.length>0&&v.value===p[0].id&&d("onConversationClick",p[0])},deleteChatConversation:async a=>{try{await e.delConfirm(`\u662F\u5426\u786E\u8BA4\u5220\u9664\u5BF9\u8BDD - ${a.title}?`),await _.deleteChatConversationMy(a.id),e.success("\u5BF9\u8BDD\u5DF2\u5220\u9664"),await o(),d("onConversationDelete",a)}catch{}},handleClearConversation:async()=>{try{await e.confirm("\u786E\u8BA4\u540E\u5BF9\u8BDD\u4F1A\u5168\u90E8\u6E05\u7A7A\uFF0C\u7F6E\u9876\u7684\u5BF9\u8BDD\u9664\u5916\u3002"),await _.deleteChatConversationMyByUnpinned(),W({message:"\u64CD\u4F5C\u6210\u529F!",type:"success"}),v.value=null,await o(),d("onConversationClear")}catch{}},handleTop:async a=>{a.pinned=!a.pinned,await _.updateChatConversationMy(a),await o()},roleRepositoryOpen:z,handleRoleRepository:async()=>{z.value=!z.value},activeId:L,RoleRepository:ve,get Bottom(){return Z},get Top(){return J},get roleAvatarDefaultImg(){return ue}};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),[["render",function(O,s,B,e,M,v){const m=te,n=ne,g=ie,I=ce,h=se,u=oe,d=re,T=le;return C(),R(T,{width:"260px",class:"conversation-container h-100%"},{default:r(()=>[c("div",de,[t(n,{class:"w-1/1 btn-new-conversation",type:"primary",onClick:e.createConversation},{default:r(()=>[t(m,{icon:"ep:plus",class:"mr-5px"}),s[3]||(s[3]=S(" \u65B0\u5EFA\u5BF9\u8BDD "))]),_:1}),t(g,{modelValue:e.searchName,"onUpdate:modelValue":s[0]||(s[0]=o=>e.searchName=o),size:"large",class:"mt-10px search-input",placeholder:"\u641C\u7D22\u5386\u53F2\u8BB0\u5F55",onKeyup:e.searchConversation},{prefix:r(()=>[t(m,{icon:"ep:search"})]),_:1},8,["modelValue"]),c("div",pe,[e.loading?(C(),R(I,{key:0,description:".","v-loading":e.loading},null,8,["v-loading"])):V("",!0),(C(!0),b(N,null,U(Object.keys(e.conversationMap),o=>(C(),b("div",{key:o},[e.conversationMap[o].length?(C(),b("div",Ce,[t(h,{class:"mx-1",size:"small",tag:"b"},{default:r(()=>[S(A(o),1)]),_:2},1024)])):V("",!0),(C(!0),b(N,null,U(e.conversationMap[o],i=>(C(),b("div",{class:"conversation-item",key:i.id,onClick:y=>e.handleConversationClick(i.id),onMouseover:y=>e.hoverConversationId=i.id,onMouseout:s[1]||(s[1]=y=>e.hoverConversationId="")},[c("div",{class:Y(i.id===e.activeConversationId?"conversation active":"conversation")},[c("div",he,[c("img",{class:"avatar",src:i.roleAvatar||e.roleAvatarDefaultImg},null,8,ye),c("span",fe,A(i.title),1)]),ee(c("div",we,[t(n,{class:"btn",link:"",onClick:D(y=>e.handleTop(i),["stop"])},{default:r(()=>[i.pinned?V("",!0):(C(),R(u,{key:0,title:"\u7F6E\u9876"},{default:r(()=>[t(e.Top)]),_:1})),i.pinned?(C(),R(u,{key:1,title:"\u7F6E\u9876"},{default:r(()=>[t(e.Bottom)]),_:1})):V("",!0)]),_:2},1032,["onClick"]),t(n,{class:"btn",link:"",onClick:D(y=>e.updateConversationTitle(i),["stop"])},{default:r(()=>[t(u,{title:"\u7F16\u8F91"},{default:r(()=>[t(m,{icon:"ep:edit"})]),_:1})]),_:2},1032,["onClick"]),t(n,{class:"btn",link:"",onClick:D(y=>e.deleteChatConversation(i),["stop"])},{default:r(()=>[t(u,{title:"\u5220\u9664\u5BF9\u8BDD"},{default:r(()=>[t(m,{icon:"ep:delete"})]),_:1})]),_:2},1032,["onClick"])],512),[[ae,e.hoverConversationId===i.id]])],2)],40,me))),128))]))),128)),s[4]||(s[4]=c("div",{class:"h-160px w-100%"},null,-1))])]),c("div",ge,[c("div",{onClick:e.handleRoleRepository},[t(m,{icon:"ep:user"}),t(h,{size:"small"},{default:r(()=>s[5]||(s[5]=[S("\u89D2\u8272\u4ED3\u5E93")])),_:1})]),c("div",{onClick:e.handleClearConversation},[t(m,{icon:"ep:delete"}),t(h,{size:"small"},{default:r(()=>s[6]||(s[6]=[S("\u6E05\u7A7A\u672A\u7F6E\u9876\u5BF9\u8BDD")])),_:1})])]),t(d,{modelValue:e.roleRepositoryOpen,"onUpdate:modelValue":s[2]||(s[2]=o=>e.roleRepositoryOpen=o),title:"\u89D2\u8272\u4ED3\u5E93",size:"754px"},{default:r(()=>[t(e.RoleRepository)]),_:1},8,["modelValue"])]),_:1})}],["__scopeId","data-v-59379c6d"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/ai/chat/index/components/conversation/ConversationList.vue"]]);export{ke as default};
