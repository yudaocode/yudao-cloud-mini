import{d as Y,p as B,D as F,r as s,C as j,Q as K,ax as M,aw as _,aE as H,_ as O,o as L,q,w as i,k as a,m as b,Y as Z,I as A,ah as N,t as G,Z as J,v as W,M as X,z as $,N as ee,E as ae,P as te,R as re}from"./index-BaY5TDP-.js";import{_ as le}from"./Dialog-CZSXtzfQ.js";import{_ as oe}from"./ContentWrap-DKQn7kZm.js";import{_ as ie}from"./index-avjYFQiD.js";import{E as se}from"./el-image-Bg-CwbDE.js";import{E as ne}from"./el-tree-select-DphqCDCz.js";import{g as ue}from"./index-DqlyDc99.js";import{d as pe}from"./formatTime-Dr6TiYYc.js";import{h as de,d as ce}from"./tree-z7HkrWVC.js";import{g as me}from"./category-B7jjsMOS.js";import{d as fe,g as ge}from"./spu-BVX48OKx.js";import ve from"./SkuList-LfTbtJ44.js";import"./index-DrSdAlug.js";const ye=O(Y({name:"PromotionSpuSelect",__name:"SpuSelect",props:{isSelectSku:B.bool.def(!1),radio:B.bool.def(!1)},emits:["confirm"],setup(I,{expose:t,emit:E}){const e=I,v=F(),R=s(0),x=s([]),m=s(!1),k=s(!1),V=s(""),y=s({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),f=s([]),P=s(),n=s(),w=s(),h=s(!1),S=s(),u=s(0),p=s([]),l=async(r,o)=>{var g,Q;if(u.value!==0){if(r.id!==u.value)return v.warning("\u4F60\u5DF2\u9009\u62E9\u5546\u54C1\u8BF7\u5148\u53D6\u6D88"),void(S.value=[u.value]);if(h.value&&((g=w.value)==null?void 0:g.id)===r.id)return}if(w.value={},f.value=[],h.value=!1,(o==null?void 0:o.length)===0)return void(S.value=[]);const c=await ge(r.id);(Q=c.skus)==null||Q.forEach(d=>{d.price=_(d.price),d.marketPrice=_(d.marketPrice),d.costPrice=_(d.costPrice),d.firstBrokeragePrice=_(d.firstBrokeragePrice),d.secondBrokeragePrice=_(d.secondBrokeragePrice)}),f.value=ue(c),w.value=c,h.value=!0,S.value=[r.id]},T=E,U=()=>{V.value="\u5546\u54C1\u9009\u62E9",k.value=!0};t({open:U});const C=async()=>{m.value=!0;try{const r=await fe(y.value);x.value=r.list,R.value=r.total}finally{m.value=!1}},D=s();j(async()=>{await C();const r=await me({});D.value=de(r,"id","parentId")});const z={props:e,message:v,total:R,list:x,loading:m,dialogVisible:k,dialogTitle:V,queryParams:y,propertyList:f,spuListRef:P,skuListRef:n,spuData:w,isExpand:h,expandRowKeys:S,selectedSpuId:u,selectedSkuIds:p,selectSku:r=>{var c;const o=(c=n.value)==null?void 0:c.getSkuTableRef();if(u.value===0)return v.warning("\u8BF7\u5148\u9009\u62E9\u5546\u54C1\u518D\u9009\u62E9\u76F8\u5E94\u7684\u89C4\u683C\uFF01\uFF01\uFF01"),void(o==null?void 0:o.clearSelection());if(r.length!==0)if(e.radio){if(p.value=[r.map(g=>g.id)[0]],r.length>1)return o==null||o.clearSelection(),void(o==null?void 0:o.toggleRowSelection(r.pop(),!0))}else p.value=r.map(g=>g.id);else p.value=[]},selectSpu:r=>{var o,c;if(r.length!==0){if(u.value=r.map(g=>g.id)[0],p.value.length>0&&(p.value=[]),r.length>1)return(o=P.value)==null||o.clearSelection(),void((c=P.value)==null?void 0:c.toggleRowSelection(r.pop(),!0));l(r[0],r)}else u.value=0},expandChange:l,emits:T,confirm:()=>{u.value!==0?e.isSelectSku&&p.value.length===0?v.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1\u5C5E\u6027"):(e.isSelectSku?T("confirm",u.value,p.value):T("confirm",u.value),k.value=!1,u.value=0,p.value=[]):v.warning("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u5546\u54C1")},open:U,getList:C,handleQuery:()=>{C()},resetQuery:()=>{y.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},C()},imagePreview:r=>{H({zIndex:99999999,urlList:[r]})},categoryList:D,get SkuList(){return ve},get ElTable(){return K},get dateFormatter(){return pe},get formatToFraction(){return M},get defaultProps(){return ce}};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),[["render",function(I,t,E,e,v,R){const x=J,m=W,k=ne,V=X,y=$,f=ee,P=ae,n=te,w=se,h=ie,S=oe,u=le,p=re;return L(),q(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=l=>e.dialogVisible=l),appendToBody:!0,title:e.dialogTitle,width:"70%"},{footer:i(()=>[a(f,{type:"primary",onClick:e.confirm},{default:i(()=>t[9]||(t[9]=[b("\u786E \u5B9A")])),_:1}),a(f,{onClick:t[5]||(t[5]=l=>e.dialogVisible=!1)},{default:i(()=>t[10]||(t[10]=[b("\u53D6 \u6D88")])),_:1})]),default:i(()=>[a(S,null,{default:i(()=>[a(P,{gutter:20,class:"mb-10px"},{default:i(()=>[a(m,{span:6},{default:i(()=>[a(x,{modelValue:e.queryParams.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.queryParams.name=l),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:Z(e.handleQuery,["enter"])},null,8,["modelValue"])]),_:1}),a(m,{span:6},{default:i(()=>[a(k,{modelValue:e.queryParams.categoryId,"onUpdate:modelValue":t[1]||(t[1]=l=>e.queryParams.categoryId=l),data:e.categoryList,props:e.defaultProps,"check-strictly":"",class:"w-1/1","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),a(m,{span:6},{default:i(()=>[a(V,{modelValue:e.queryParams.createTime,"onUpdate:modelValue":t[2]||(t[2]=l=>e.queryParams.createTime=l),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),a(m,{span:6},{default:i(()=>[a(f,{onClick:e.handleQuery},{default:i(()=>[a(y,{class:"mr-5px",icon:"ep:search"}),t[7]||(t[7]=b(" \u641C\u7D22 "))]),_:1}),a(f,{onClick:e.resetQuery},{default:i(()=>[a(y,{class:"mr-5px",icon:"ep:refresh"}),t[8]||(t[8]=b(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1}),A((L(),q(e.ElTable,{ref:"spuListRef",data:e.list,"expand-row-keys":e.expandRowKeys,"row-key":"id",onExpandChange:e.expandChange,onSelectionChange:e.selectSpu},{default:i(()=>[E.isSelectSku?(L(),q(n,{key:0,type:"expand",width:"30"},{default:i(()=>[e.isExpand?(L(),q(e.SkuList,{key:0,ref:"skuListRef",isComponent:!0,isDetail:!0,"prop-form-data":e.spuData,"property-list":e.propertyList,onSelectionChange:e.selectSku},null,8,["prop-form-data","property-list"])):N("",!0)]),_:1})):N("",!0),a(n,{type:"selection",width:"55"}),a(n,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id"}),a(n,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:i(({row:l})=>[a(w,{src:l.picUrl,class:"h-30px w-30px",onClick:T=>e.imagePreview(l.picUrl)},null,8,["src","onClick"])]),_:1}),a(n,{"show-overflow-tooltip":!0,label:"\u5546\u54C1\u540D\u79F0","min-width":"300",prop:"name"}),a(n,{align:"center",label:"\u5546\u54C1\u552E\u4EF7","min-width":"90",prop:"price"},{default:i(({row:l})=>[b(G(e.formatToFraction(l.price)),1)]),_:1}),a(n,{align:"center",label:"\u9500\u91CF","min-width":"90",prop:"salesCount"}),a(n,{align:"center",label:"\u5E93\u5B58","min-width":"90",prop:"stock"}),a(n,{align:"center",label:"\u6392\u5E8F","min-width":"70",prop:"sort"}),a(n,{formatter:e.dateFormatter,align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180"},null,8,["formatter"])]),_:1},8,["data","expand-row-keys"])),[[p,e.loading]]),a(h,{limit:e.queryParams.pageSize,"onUpdate:limit":t[3]||(t[3]=l=>e.queryParams.pageSize=l),page:e.queryParams.pageNo,"onUpdate:page":t[4]||(t[4]=l=>e.queryParams.pageNo=l),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1})]),_:1},8,["modelValue","title"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/components/SpuSelect.vue"]]);export{ye as default};
