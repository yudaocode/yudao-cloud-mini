import{d as j,p as O,r as h,b as K,au as S,g as z,D as B,_ as U,o as m,c as V,n as g,q as x,w as p,j as P,k as f,m as _,t as R,F as k,I as D,Y as q,ag as L,b8 as F,an as J,J as N,K as Y,N as $,x as E,v as G}from"./index-BaY5TDP-.js";import{c as H,b as M}from"./property-Ddjv43NP.js";const Q=U(j({name:"ProductAttributes",__name:"ProductAttributes",props:{propertyList:{type:Array,default:()=>{}},isDetail:O.bool.def(!1)},emits:["success"],setup(A,{expose:s,emit:C}){s();const{t:a}=z(),b=B(),u=h(""),n=h(null),w=K(()=>e=>n.value!==null&&(n.value===e||void 0)),c=h([]),l=h([]),y=h([]),I=A;S(()=>I.propertyList,e=>{e&&(l.value=e)},{deep:!0,immediate:!0});const v=C,r=async e=>{y.value=await M(e)},t={t:a,message:b,inputValue:u,attributeIndex:n,inputVisible:w,inputRef:c,setInputRef:e=>{e!=null&&(c.value.some(i=>{var o,d;return((o=i.inputRef)==null?void 0:o.attributes.id)===((d=e.inputRef)==null?void 0:d.attributes.id)})||c.value.push(e))},attributeList:l,attributeOptions:y,props:I,handleCloseValue:(e,i)=>{var o;(o=l.value[e].values)==null||o.splice(i,1)},handleCloseProperty:e=>{var i;(i=l.value)==null||i.splice(e,1),v("success",l.value)},showInput:async e=>{n.value=e,c.value[e].focus(),await r(l.value[e].id)},emit:v,handleInputConfirm:async(e,i)=>{if(u.value){if(l.value[e].values.find(d=>d.name===u.value))return b.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u5C5E\u6027\u503C\uFF0C\u8BF7\u91CD\u8BD5"),n.value=null,void(u.value="");const o=y.value.find(d=>d.name===u.value);if(o)return n.value=null,u.value="",l.value[e].values.push({id:o.id,name:o.name}),void v("success",l.value);try{const d=await H({propertyId:i,name:u.value});l.value[e].values.push({id:d,name:u.value}),b.success(a("common.createSuccess")),v("success",l.value)}catch{b.error("\u6DFB\u52A0\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}n.value=null,u.value=""},getAttributeOptions:r};return Object.defineProperty(t,"__isScriptSetup",{enumerable:!1,value:!0}),t}}),[["render",function(A,s,C,a,b,u){const n=F,w=J,c=N,l=Y,y=$,I=E,v=G;return m(!0),V(k,null,g(a.attributeList,(r,t)=>(m(),x(v,{key:t},{default:p(()=>[P("div",null,[f(n,{class:"mx-1"},{default:p(()=>[...s[1]||(s[1]=[_("\u5C5E\u6027\u540D\uFF1A")])]),_:1}),f(w,{closable:!C.isDetail,class:"mx-1",type:"success",onClose:e=>a.handleCloseProperty(t)},{default:p(()=>[_(R(r.name),1)]),_:2},1032,["closable","onClose"])]),P("div",null,[f(n,{class:"mx-1"},{default:p(()=>[...s[2]||(s[2]=[_("\u5C5E\u6027\u503C\uFF1A")])]),_:1}),(m(!0),V(k,null,g(r.values,(e,i)=>(m(),x(w,{key:e.id,closable:!C.isDetail,class:"mx-1",onClose:o=>a.handleCloseValue(t,i)},{default:p(()=>[_(R(e.name),1)]),_:2},1032,["closable","onClose"]))),128)),D(f(l,{id:`input${t}`,ref_for:!0,ref:a.setInputRef,modelValue:a.inputValue,"onUpdate:modelValue":s[0]||(s[0]=e=>a.inputValue=e),"reserve-keyword":!1,"allow-create":"",class:"!w-30","default-first-option":"",filterable:"",size:"small",onBlur:e=>a.handleInputConfirm(t,r.id),onChange:e=>a.handleInputConfirm(t,r.id),onKeyup:q(e=>a.handleInputConfirm(t,r.id),["enter"])},{default:p(()=>[(m(!0),V(k,null,g(a.attributeOptions,e=>(m(),x(c,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:2},1032,["id","modelValue","onBlur","onChange","onKeyup"]),[[L,a.inputVisible(t)]]),D(f(y,{class:"button-new-tag ml-1",size:"small",onClick:e=>a.showInput(t)},{default:p(()=>[...s[3]||(s[3]=[_(" + \u6DFB\u52A0 ")])]),_:2},1032,["onClick"]),[[L,!a.inputVisible(t)]])]),f(I,{class:"my-10px"})]),_:2},1024))),128)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/product/spu/form/ProductAttributes.vue"]]);export{Q as default};
