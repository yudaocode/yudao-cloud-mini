import{_ as N}from"./Dialog-CZSXtzfQ.js";import{d as k,D as I,r as i,e as L,ao as O,_ as j,o as C,q as S,w as t,k as u,m as _,j as d,c as E,F as z,n as D,J as R,K as T,z as q,ai as J,y as K,bx as P,N as A}from"./index-BaY5TDP-.js";import{k as B,m as G}from"./index-h6ObHKtQ.js";import{d as H}from"./download-oWiM5xVU.js";import{g as M}from"./index-CuAlllbQ.js";const Q={class:"flex items-center my-10px"},W={class:"el-upload__tip text-center"},X={class:"el-upload__tip"},Y=j(k({name:"SystemUserImportForm",__name:"CustomerImportForm",emits:["success"],setup(h,{expose:e,emit:V}){const a=I(),b=i(!1),s=i(!1),x=i(),n=i([]),f=i(!1),m=i(),g=i([]),y=async()=>{b.value=!0,await F(),g.value=await M(),m.value=L().getUser.id};e({open:y});const v=V,w=o=>{if(o.code!==0)return a.error(o.msg),void(s.value=!1);const r=o.data;let p="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+r.createCustomerNames.length+";";for(let c of r.createCustomerNames)p+="< "+c+" >";p+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+r.updateCustomerNames.length+";";for(const c of r.updateCustomerNames)p+="< "+c+" >";p+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(r.failureCustomerNames).length+";";for(const c in r.failureCustomerNames)p+="< "+c+": "+r.failureCustomerNames[c]+" >";a.alert(p),s.value=!1,b.value=!1,v("success")},l=()=>{a.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),s.value=!1},F=async()=>{var o;n.value=[],f.value=!1,m.value=void 0,await O(),(o=x.value)==null||o.clearFiles()},U={message:a,dialogVisible:b,formLoading:s,uploadRef:x,fileList:n,updateSupport:f,ownerUserId:m,userOptions:g,open:y,submitForm:async()=>{if(n.value.length!=0){s.value=!0;try{const o=new FormData;o.append("updateSupport",String(f.value)),o.append("file",n.value[0].raw),o.append("ownerUserId",String(m.value));const r=await B(o);w(r)}catch{l()}finally{s.value=!1}}else a.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},emits:v,submitFormSuccess:w,submitFormError:l,resetForm:F,handleExceed:()=>{a.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},importTemplate:async()=>{const o=await G();H.excel(o,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),[["render",function(h,e,V,a,b,s){const x=R,n=T,f=q,m=J,g=K,y=P,v=A,w=N;return C(),S(w,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=l=>a.dialogVisible=l),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:t(()=>[u(v,{disabled:a.formLoading,type:"primary",onClick:a.submitForm},{default:t(()=>e[10]||(e[10]=[_("\u786E \u5B9A")])),_:1},8,["disabled"]),u(v,{onClick:e[3]||(e[3]=l=>a.dialogVisible=!1)},{default:t(()=>e[11]||(e[11]=[_("\u53D6 \u6D88")])),_:1})]),default:t(()=>[d("div",Q,[e[5]||(e[5]=d("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1)),u(n,{modelValue:a.ownerUserId,"onUpdate:modelValue":e[0]||(e[0]=l=>a.ownerUserId=l),class:"!w-240px",clearable:""},{default:t(()=>[(C(!0),E(z,null,D(a.userOptions,l=>(C(),S(x,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),u(y,{ref:"uploadRef","file-list":a.fileList,"onUpdate:fileList":e[2]||(e[2]=l=>a.fileList=l),"auto-upload":!1,disabled:a.formLoading,limit:1,"on-exceed":a.handleExceed,accept:".xlsx, .xls",action:"none",drag:""},{tip:t(()=>[d("div",W,[d("div",X,[u(m,{modelValue:a.updateSupport,"onUpdate:modelValue":e[1]||(e[1]=l=>a.updateSupport=l)},null,8,["modelValue"]),e[6]||(e[6]=_(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 "))]),e[8]||(e[8]=d("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),u(g,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:a.importTemplate},{default:t(()=>e[7]||(e[7]=[_(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:t(()=>[u(f,{icon:"ep:upload"}),e[9]||(e[9]=d("div",{class:"el-upload__text"},[_("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/customer/CustomerImportForm.vue"]]);export{Y as default};
