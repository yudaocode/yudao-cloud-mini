import{_ as O}from"./ContentWrap-DKQn7kZm.js";import{d as q,r as S,at as I,b4 as M,dr as U,av as K,D as V,_ as $,q as F,w as z,o as j,k as H,bk as J,ah as Q}from"./index-BaY5TDP-.js";import{g as R,i as T,a as W,b as X,c as l,d as D,e as Y,f as Z,h as ee,P as B,j as te,k as ne}from"./bpmn-embedded-Bxfb97Hp.js";import"./Dialog-CZSXtzfQ.js";import"./XTextButton-Cf-hbTFF.js";import"./XButton-BcV39lfk.js";import"./consts-vgsb8q48.js";import"./index-CuAlllbQ.js";import"./utils-DQEYWnsS.js";import"./index-ZFL2ufyC.js";import"./index-BCN8BzfC.js";import"./index-BeYJ8u62.js";import"./el-tree-select-DphqCDCz.js";import"./tree-z7HkrWVC.js";import"./index-C7Vgvn4F.js";import"./index-dK17nfjs.js";import"./index-D-_5jDBN.js";import"./index-RbAZqEQx.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./constants-CEEr2azc.js";import"./index-D-US79ui.js";import"./el-drawer-r3cMvY4i.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-l60I0Cke.js";import"./formatTime-Dr6TiYYc.js";function ae(t){return function(r,c){return(R(r)||r).button===c}(t,0)}function ie(t){var r=R(t)||t;return!!ae(t)&&(/mac/i.test(navigator.platform)?r.metaKey:r.ctrlKey)}function A(t,r,c,n,b,g,d,a,p,h,i,e){t=t||{},n.registerProvider(this),this._contextPad=n,this._modeling=b,this._elementFactory=g,this._connect=d,this._create=a,this._popupMenu=p,this._canvas=h,this._rules=i,this._translate=e,t.autoPlace!==!1&&(this._autoPlace=r.get("autoPlace",!1)),c.on("create.end",250,function(o){const m=o.context.shape;if(!ie(o)||!n.isOpen(m))return;const s=n.getEntries(m);s.replace&&s.replace.action.click(o,m)})}function L(t,r,c){const n=t.$instanceOf(r);let b=!1;const g=t.eventDefinitions||[];return ee(g,function(d){d.$type===c&&(b=!0)}),n&&b}A.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],A.prototype.getContextPadEntries=function(t){const r=this._contextPad,c=this._modeling,n=this._elementFactory,b=this._connect,g=this._create,d=this._popupMenu,a=this._canvas,p=this._rules,h=this._autoPlace,i=this._translate,e={};if(t.type==="label")return e;const o=t.businessObject;function m(v,f){b.start(v,f)}function s(v,f,u,k){function P(x,E){const C=n.createShape(l({type:v},k));g.start(x,C,{source:E})}return typeof u!="string"&&(k=u,u=i("Append {type}",{type:v.replace(/^bpmn:/,"")})),{group:"model",className:f,title:u,action:{dragstart:P,click:h?function(x,E){const C=n.createShape(l({type:v},k));h.append(E,C)}:P}}}function y(v){return function(f,u){c.splitLane(u,v),r.open(u,!0)}}if(T(o,["bpmn:Lane","bpmn:Participant"])&&W(o)){const v=X(t);l(e,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:i("Add Lane above"),action:{click:function(f,u){c.addLane(u,"top")}}}}),v.length<2&&(t.height>=120&&l(e,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:i("Divide into two Lanes"),action:{click:y(2)}}}),t.height>=180&&l(e,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:i("Divide into three Lanes"),action:{click:y(3)}}})),l(e,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:i("Add Lane below"),action:{click:function(f,u){c.addLane(u,"bottom")}}}})}D(o,"bpmn:FlowNode")&&(D(o,"bpmn:EventBasedGateway")?l(e,{"append.receive-task":s("bpmn:ReceiveTask","bpmn-icon-receive-task",i("Append ReceiveTask")),"append.message-intermediate-event":s("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",i("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":s("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",i("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":s("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",i("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":s("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",i("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):L(o,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?l(e,{"append.compensation-activity":s("bpmn:Task","bpmn-icon-task",i("Append compensation activity"),{isForCompensation:!0})}):D(o,"bpmn:EndEvent")||o.isForCompensation||L(o,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||Y(o)||l(e,{"append.end-event":s("bpmn:EndEvent","bpmn-icon-end-event-none",i("Append EndEvent")),"append.gateway":s("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",i("Append Gateway")),"append.append-task":s("bpmn:UserTask","bpmn-icon-user-task",i("Append Task")),"append.intermediate-event":s("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",i("Append Intermediate/Boundary Event"))})),d.isEmpty(t,"bpmn-replace")||l(e,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"\u4FEE\u6539\u7C7B\u578B",action:{click:function(v,f){const u=l(function(k){const P=a.getContainer(),N=r.getPad(k).html,x=P.getBoundingClientRect(),E=N.getBoundingClientRect(),C=E.top-x.top;return{x:E.left-x.left,y:C+E.height+5}}(f),{cursor:{x:v.x,y:v.y}});d.open(f,"bpmn-replace",u)}}}}),T(o,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&l(e,{"append.text-annotation":s("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:i("Connect using "+(o.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:m,dragstart:m}}}),T(o,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&l(e,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:i("Connect using DataInputAssociation"),action:{click:m,dragstart:m}}}),D(o,"bpmn:Group")&&l(e,{"append.text-annotation":s("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let _=p.allowed("elements.delete",{elements:[t]});return Z(_)&&(_=_[0]===t),_&&l(e,{delete:{group:"edit",className:"bpmn-icon-trash",title:i("Remove"),action:{click:function(){c.removeElements([t])}}}}),e};const oe={__init__:["contextPadProvider"],contextPadProvider:["type",A]};function w(t,r,c,n,b,g,d,a){B.call(this,t,r,c,n,b,g,d,a,2e3)}const G=function(){};(G.prototype=B.prototype).getPaletteEntries=function(){const t={},r=this._create,c=this._elementFactory,n=this._spaceTool,b=this._lassoTool,g=this._handTool,d=this._globalConnect,a=this._translate;function p(e,o,m,s,y){function _(f){const u=c.createShape(l({type:e},y));r.start(f,u)}const v=e.replace(/^bpmn:/,"");return{group:o,className:m,title:s||a("Create {type}",{type:v}),action:{dragstart:_,click:_}}}function h(e){const o=c.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),m=c.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:o});r.start(e,[o,m],{hints:{autoSelect:[m]}})}function i(e){r.start(e,c.createParticipantShape())}return l(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"\u6FC0\u6D3B\u6293\u624B\u5DE5\u5177",action:{click:function(e){g.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:a("Activate the lasso tool"),action:{click:function(e){b.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:a("Activate the create/remove space tool"),action:{click:function(e){n.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:a("Activate the global connect tool"),action:{click:function(e){d.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":p("bpmn:StartEvent","event","bpmn-icon-start-event-none",a("Create StartEvent")),"create.intermediate-event":p("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",a("Create Intermediate/Boundary Event")),"create.end-event":p("bpmn:EndEvent","event","bpmn-icon-end-event-none",a("Create EndEvent")),"create.exclusive-gateway":p("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",a("Create Gateway")),"create.user-task":p("bpmn:UserTask","activity","bpmn-icon-user-task",a("Create User Task")),"create.call-activity":p("bpmn:CallActivity","activity","bpmn-icon-call-activity",a("Create Call Activity")),"create.service-task":p("bpmn:ServiceTask","activity","bpmn-icon-service",a("Create Service Task")),"create.data-object":p("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",a("Create DataObjectReference")),"create.data-store":p("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",a("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:a("Create expanded SubProcess"),action:{dragstart:h,click:h}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:a("Create Pool/Participant"),action:{dragstart:i,click:i}},"create.group":p("bpmn:Group","artifact","bpmn-icon-group",a("Create Group"))}),t},w.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],w.prototype=new G,w.prototype.constructor=w;const re={__init__:["paletteProvider"],paletteProvider:["type",w]},ce=$(q({name:"BpmModelEditor",__name:"index",props:{modelId:{type:String,required:!1},modelKey:{type:String,required:!0},modelName:{type:String,required:!0},value:{type:String,required:!1}},emits:["success","init-finished"],setup(t,{expose:r,emit:c}){r();const n=t,b=c,g=V(),d=S([]),a=S(20);I("formFields",d),I("formType",a);const p=M("processData"),h=M("modelData"),i=U(),e=S(),o=S({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[oe,re]}),m=S();K(()=>{i.value=null;const y=window;y.bpmnInstances&&(y.bpmnInstances=null)});const s={props:n,emit:b,message:g,formFields:d,formType:a,xmlString:p,modelData:h,modeler:i,processDesigner:e,controlForm:o,model:m,initModeler:async y=>{m.value=h.value,i.value=y},save:async y=>{try{p.value=y,b("success",y)}catch(_){console.error("\u4FDD\u5B58\u5931\u8D25:",_),g.error("\u4FDD\u5B58\u5931\u8D25")}},get MyProcessDesigner(){return te},get MyProcessPenal(){return ne}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),[["render",function(t,r,c,n,b,g){const d=O;return j(),F(d,null,{default:z(()=>[H(n.MyProcessDesigner,J({key:"designer",modelValue:n.xmlString,"onUpdate:modelValue":r[0]||(r[0]=a=>n.xmlString=a),value:n.xmlString},n.controlForm,{keyboard:"",ref:"processDesigner",onInitFinished:n.initModeler,additionalModel:n.controlForm.additionalModel,model:n.model,onSave:n.save,"process-id":c.modelKey,"process-name":c.modelName}),null,16,["modelValue","value","additionalModel","model","process-id","process-name"]),n.modeler?(j(),F(n.MyProcessPenal,{key:"penal",bpmnModeler:n.modeler,prefix:n.controlForm.prefix,class:"process-panel",model:n.model},null,8,["bpmnModeler","prefix","model"])):Q("",!0)]),_:1})}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/model/editor/index.vue"]]);export{ce as default};
