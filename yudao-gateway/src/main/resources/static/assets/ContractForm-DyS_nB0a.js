import{d as E,g as j,D as A,r as i,f as J,au as K,e3 as z,b as R,e as M,e4 as Z,a as G,_ as H,o as n,q as v,w as o,k as l,m as q,I as Q,c as D,F as I,n as P,Z as W,L as X,v as Y,J as $,K as ee,E as ae,M as le,A as oe,B as de,cf as re,O as te,N as se,R as ue}from"./index-BaY5TDP-.js";import{_ as ie}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{g as me}from"./index-h6ObHKtQ.js";import{b as ce,c as pe,u as fe}from"./index-B97LdofC.js";import{g as ve}from"./index-CuAlllbQ.js";import{b as be}from"./index-DiJG1eDb.js";import{d as _e,a as Ve}from"./index-6-r4wYJE.js";import ge from"./ContractProductForm--_dghpLm.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-D4G-Yxr7.js";const De=H(E({__name:"ContractForm",emits:["success"],setup(x,{expose:d,emit:O}){const{t:e}=j(),U=A(),w=i(!1),p=i(""),r=i(!1),s=i(""),t=i({id:void 0,no:void 0,name:void 0,customerId:void 0,businessId:void 0,orderDate:void 0,startTime:void 0,endTime:void 0,signUserId:void 0,signContactId:void 0,ownerUserId:void 0,discountPercent:0,totalProductPrice:void 0,remark:void 0,products:[]}),f=J({name:[{required:!0,message:"\u5408\u540C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],orderDate:[{required:!0,message:"\u4E0B\u5355\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),m=i(),b=i([]),h=i([]),_=i([]),V=i([]),F=i("product"),y=i();K(()=>t.value,u=>{if(!u)return;const c=u.products.reduce((N,S)=>N+S.totalPrice,0),k=c-(u.discountPercent!=null?z(c,u.discountPercent/100):0);t.value.totalProductPrice=c,t.value.totalPrice=k},{deep:!0});const g=async(u,c)=>{if(w.value=!0,p.value=e("action."+u),s.value=u,T(),c){r.value=!0;try{t.value=await ce(c)}finally{r.value=!1}}h.value=await me(),b.value=await ve(),s.value==="create"&&(t.value.ownerUserId=M().getUser.id),V.value=await be(),_.value=await _e()};d({open:g});const C=O,T=()=>{var u;t.value={id:void 0,no:void 0,name:void 0,customerId:void 0,businessId:void 0,orderDate:void 0,startTime:void 0,endTime:void 0,signUserId:void 0,signContactId:void 0,ownerUserId:void 0,discountPercent:0,totalProductPrice:void 0,remark:void 0,products:[]},(u=m.value)==null||u.resetFields()},a=R(()=>V.value.filter(u=>u.customerId==t.value.customerId)),B=R(()=>_.value.filter(u=>u.customerId==t.value.customerId)),L={t:e,message:U,dialogVisible:w,dialogTitle:p,formLoading:r,formType:s,formData:t,formRules:f,formRef:m,userOptions:b,customerList:h,businessList:_,contactList:V,subTabsName:F,productFormRef:y,open:g,emit:C,submitForm:async()=>{if(m&&await m.value.validate()){r.value=!0,y.value.validate();try{const u=G(t.value);s.value==="create"?(await pe(u),U.success(e("common.createSuccess"))):(await fe(u),U.success(e("common.updateSuccess"))),w.value=!1,C("success")}finally{r.value=!1}}},resetForm:T,handleCustomerChange:()=>{t.value.businessId=void 0,t.value.signContactId=void 0,t.value.products=[]},handleBusinessChange:async u=>{const c=await Ve(u);c.products.forEach(k=>{k.contractPrice=k.businessPrice}),t.value.products=c.products},getContactOptions:a,getBusinessOptions:B,get erpPriceInputFormatter(){return Z},ContractProductForm:ge};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),[["render",function(x,d,O,e,U,w){const p=W,r=X,s=Y,t=$,f=ee,m=ae,b=le,h=oe,_=de,V=ne,F=re,y=te,g=se,C=ie,T=ue;return n(),v(C,{modelValue:e.dialogVisible,"onUpdate:modelValue":d[16]||(d[16]=a=>e.dialogVisible=a),title:e.dialogTitle,width:"1280"},{footer:o(()=>[l(g,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:o(()=>d[17]||(d[17]=[q("\u4FDD\u5B58")])),_:1},8,["disabled"]),l(g,{onClick:d[15]||(d[15]=a=>e.dialogVisible=!1)},{default:o(()=>d[18]||(d[18]=[q("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Q((n(),v(y,{ref:"formRef",model:e.formData,rules:e.formRules,"label-width":"120px"},{default:o(()=>[l(m,null,{default:o(()=>[l(s,{span:8},{default:o(()=>[l(r,{label:"\u5408\u540C\u7F16\u53F7",prop:"no"},{default:o(()=>[l(p,{disabled:"",modelValue:e.formData.no,"onUpdate:modelValue":d[0]||(d[0]=a=>e.formData.no=a),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u5408\u540C\u540D\u79F0",prop:"name"},{default:o(()=>[l(p,{modelValue:e.formData.name,"onUpdate:modelValue":d[1]||(d[1]=a=>e.formData.name=a),placeholder:"\u8BF7\u8F93\u5165\u5408\u540C\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:o(()=>[l(f,{modelValue:e.formData.ownerUserId,"onUpdate:modelValue":d[2]||(d[2]=a=>e.formData.ownerUserId=a),disabled:e.formType!=="create",class:"w-1/1"},{default:o(()=>[(n(!0),D(I,null,P(e.userOptions,a=>(n(),v(t,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:o(()=>[l(s,{span:8},{default:o(()=>[l(r,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:o(()=>[l(f,{modelValue:e.formData.customerId,"onUpdate:modelValue":d[3]||(d[3]=a=>e.formData.customerId=a),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1",onChange:e.handleCustomerChange},{default:o(()=>[(n(!0),D(I,null,P(e.customerList,a=>(n(),v(t,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u5546\u673A\u540D\u79F0",prop:"businessId"},{default:o(()=>[l(f,{onChange:e.handleBusinessChange,disabled:!e.formData.customerId,modelValue:e.formData.businessId,"onUpdate:modelValue":d[4]||(d[4]=a=>e.formData.businessId=a),class:"w-1/1"},{default:o(()=>[(n(!0),D(I,null,P(e.getBusinessOptions,a=>(n(),v(t,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:o(()=>[l(s,{span:8},{default:o(()=>[l(r,{label:"\u4E0B\u5355\u65E5\u671F",prop:"orderDate"},{default:o(()=>[l(b,{modelValue:e.formData.orderDate,"onUpdate:modelValue":d[5]||(d[5]=a=>e.formData.orderDate=a),placeholder:"\u9009\u62E9\u4E0B\u5355\u65E5\u671F",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u5F00\u59CB\u65F6\u95F4",prop:"startTime"},{default:o(()=>[l(b,{modelValue:e.formData.startTime,"onUpdate:modelValue":d[6]||(d[6]=a=>e.formData.startTime=a),placeholder:"\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:o(()=>[l(b,{modelValue:e.formData.endTime,"onUpdate:modelValue":d[7]||(d[7]=a=>e.formData.endTime=a),placeholder:"\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",type:"date","value-format":"x",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,null,{default:o(()=>[l(s,{span:8},{default:o(()=>[l(r,{label:"\u516C\u53F8\u7B7E\u7EA6\u4EBA",prop:"signUserId"},{default:o(()=>[l(f,{modelValue:e.formData.signUserId,"onUpdate:modelValue":d[8]||(d[8]=a=>e.formData.signUserId=a),class:"w-1/1"},{default:o(()=>[(n(!0),D(I,null,P(e.userOptions,a=>(n(),v(t,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u5BA2\u6237\u7B7E\u7EA6\u4EBA",prop:"signContactId"},{default:o(()=>[l(f,{modelValue:e.formData.signContactId,"onUpdate:modelValue":d[9]||(d[9]=a=>e.formData.signContactId=a),disabled:!e.formData.customerId,class:"w-1/1"},{default:o(()=>[(n(!0),D(I,null,P(e.getContactOptions,a=>(n(),v(t,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[l(p,{modelValue:e.formData.remark,"onUpdate:modelValue":d[10]||(d[10]=a=>e.formData.remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(V,null,{default:o(()=>[l(_,{modelValue:e.subTabsName,"onUpdate:modelValue":d[11]||(d[11]=a=>e.subTabsName=a),class:"-mt-15px -mb-10px"},{default:o(()=>[l(h,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:o(()=>[l(e.ContractProductForm,{ref:"productFormRef",products:e.formData.products,disabled:x.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:o(()=>[l(s,{span:8},{default:o(()=>[l(r,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:o(()=>[l(p,{disabled:"",modelValue:e.formData.totalProductPrice,"onUpdate:modelValue":d[12]||(d[12]=a=>e.formData.totalProductPrice=a),formatter:e.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:o(()=>[l(F,{modelValue:e.formData.discountPercent,"onUpdate:modelValue":d[13]||(d[13]=a=>e.formData.discountPercent=a),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(s,{span:8},{default:o(()=>[l(r,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"totalPrice"},{default:o(()=>[l(p,{disabled:"",modelValue:e.formData.totalPrice,"onUpdate:modelValue":d[14]||(d[14]=a=>e.formData.totalPrice=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:e.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[T,e.formLoading]])]),_:1},8,["modelValue","title"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/contract/ContractForm.vue"]]);export{De as default};
