import{bz as j,d as q,D,r as n,f as T,C as V,ao as C,a as B,_ as U,o as d,q as E,w as H,j as _,I as L,c as f,ah as S,k,m as J,N as A,R as F}from"./index-BaY5TDP-.js";import{_ as G}from"./ContentWrap-DKQn7kZm.js";import{R as O}from"./TabNews-CsSL-hHj.js";import K from"./main-US54NKSx.js";import Q from"./MsgList-Ckd30rCW.js";import{g as X}from"./index-DAG8aKkl.js";const P=g=>j.get({url:"/mp/message/page",params:g}),Y={class:"msg-div",ref:"msgDivRef"},Z={key:0},$={key:1,class:"el-table__empty-block"},ee={class:"msg-send"},W=U(q({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(g,{expose:t}){t();const I=D(),e=g,p=n(-1),m=n(!1),v=n(!0),c=n([]),s=T({pageNo:1,pageSize:14,accountId:p}),o=T({nickname:"\u7528\u6237",avatar:"/assets/profile-BiJdjH9E.jpg",accountId:p}),M=n(!1),l=n({type:O.Text,accountId:-1,articles:[]}),w=n(null),r=n(null);V(async()=>{var u,i;const a=await X(e.userId);o.nickname=((u=a.nickname)==null?void 0:u.length)>0?a.nickname:o.nickname,o.avatar=((i=o.avatar)==null?void 0:i.length)>0?a.avatar:o.avatar,p.value=a.accountId,l.value.accountId=a.accountId,N()});const b=async(a,u=null)=>{var R;m.value=!0;let i=await P(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:e.userId,accountId:a.accountId},u));const z=((R=r.value)==null?void 0:R.scrollHeight)??0,y=i.list.reverse();c.value=[...y,...c.value],m.value=!1,(y.length<s.pageSize||y.length===0)&&(v.value=!1),s.pageNo=a.pageNo,s.pageSize=a.pageSize,s.pageNo===1?await h():y.length!==0&&(await C(),z!==0&&r.value&&(r.value.scrollTop=r.value.scrollHeight-z-100))},N=()=>{b(s)},h=async()=>{await C(),r.value&&(r.value.scrollTop=r.value.scrollHeight)},x={message:I,props:e,accountId:p,loading:m,hasMore:v,list:c,queryParams:s,user:o,sendLoading:M,reply:l,replySelectRef:w,msgDivRef:r,sendMsg:async()=>{var u;if(!B(l))return;l.value.type===O.News&&l.value.articles&&l.value.articles.length>1&&(l.value.articles=[l.value.articles[0]],I.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(i=>j.post({url:"/mp/message/send",data:i}))({userId:e.userId,...l.value});M.value=!1,c.value=[...c.value,a],await h(),(u=w.value)==null||u.clear()},loadMore:()=>{s.pageNo++,b(s,null)},getPage:b,refreshChange:N,scrollToBottom:h,get WxReplySelect(){return K},MsgList:Q};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),[["render",function(g,t,I,e,p,m){const v=A,c=G,s=F;return d(),E(c,null,{default:H(()=>[_("div",Y,[L(_("div",null,null,512),[[s,e.loading]]),e.loading?S("",!0):(d(),f("div",Z,[e.hasMore?(d(),f("div",{key:0,class:"el-table__empty-block",onClick:e.loadMore},t[1]||(t[1]=[_("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1)]))):S("",!0),e.hasMore?S("",!0):(d(),f("div",$,t[2]||(t[2]=[_("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1)])))])),k(e.MsgList,{list:e.list,"account-id":e.accountId,user:e.user},null,8,["list","account-id","user"])],512),L((d(),f("div",ee,[k(e.WxReplySelect,{ref:"replySelectRef",modelValue:e.reply,"onUpdate:modelValue":t[0]||(t[0]=o=>e.reply=o)},null,8,["modelValue"]),k(v,{type:"success",class:"send-but",onClick:e.sendMsg},{default:H(()=>t[3]||(t[3]=[J("\u53D1\u9001(S)")])),_:1})])),[[s,e.sendLoading]])]),_:1})}],["__scopeId","data-v-bcccc5e5"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mp/components/wx-msg/main.vue"]]),ae=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{W,P as g,ae as m};
