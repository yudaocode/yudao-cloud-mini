import{d as N,g as O,D as S,r as s,f as C,au as j,e3 as A,e as z,e4 as E,_ as J,o as m,q as v,w as o,k as l,m as q,I as K,c as k,F as h,n as L,Z as M,L as Z,v as G,J as H,K as Q,E as W,M as X,A as Y,B as $,cf as ee,O as ae,N as le,R as oe}from"./index-BaY5TDP-.js";import{_ as re}from"./Dialog-CZSXtzfQ.js";import{_ as te}from"./ContentWrap-DKQn7kZm.js";import{a as de,c as ue,u as se}from"./index-6-r4wYJE.js";import{g as ie}from"./index-n6shePIl.js";import{g as me}from"./index-h6ObHKtQ.js";import{g as ce}from"./index-CuAlllbQ.js";import ne from"./BusinessProductForm-FoZjzksq.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-D4G-Yxr7.js";const pe=J(N({__name:"BusinessForm",emits:["success"],setup(x,{expose:r,emit:R}){const{t:a}=O(),b=S(),_=s(!1),c=s(""),t=s(!1),u=s(""),d=s({id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1}),p=C({name:[{required:!0,message:"\u5546\u673A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],statusTypeId:[{required:!0,message:"\u5546\u673A\u72B6\u6001\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),i=s(),V=s([]),P=s([]),g=s([]),F=s("product"),D=s();j(()=>d.value,e=>{if(!e)return;const n=e.products.reduce((U,B)=>U+B.totalPrice,0),T=n-(e.discountPercent!=null?A(n,e.discountPercent/100):0);d.value.totalProductPrice=n,d.value.totalPrice=T},{deep:!0});const I=async(e,n,T,U)=>{if(_.value=!0,c.value=a("action."+e),u.value=e,y(),n){t.value=!0;try{d.value=await de(n)}finally{t.value=!1}}else T&&(d.value.customerId=T,d.value.customerDefault=!0),U&&(d.value.contactId=U);g.value=await me(),P.value=await ie(),V.value=await ce(),u.value==="create"&&(d.value.ownerUserId=z().getUser.id)};r({open:I});const f=R,y=()=>{var e;d.value={id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1},(e=i.value)==null||e.resetFields()},w={t:a,message:b,dialogVisible:_,dialogTitle:c,formLoading:t,formType:u,formData:d,formRules:p,formRef:i,userOptions:V,statusTypeList:P,customerList:g,subTabsName:F,productFormRef:D,open:I,emit:f,submitForm:async()=>{if(i&&await i.value.validate()){await D.value.validate(),t.value=!0;try{const e=d.value;u.value==="create"?(await ue(e),b.success(a("common.createSuccess"))):(await se(e),b.success(a("common.updateSuccess"))),_.value=!1,f("success")}finally{t.value=!1}}},resetForm:y,BusinessProductForm:ne,get erpPriceInputFormatter(){return E}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),[["render",function(x,r,R,a,b,_){const c=M,t=Z,u=G,d=H,p=Q,i=W,V=X,P=Y,g=$,F=te,D=ee,I=ae,f=le,y=re,w=oe;return m(),v(y,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":r[11]||(r[11]=e=>a.dialogVisible=e),width:"1280"},{footer:o(()=>[l(f,{onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:o(()=>r[12]||(r[12]=[q("\u786E \u5B9A")])),_:1},8,["disabled"]),l(f,{onClick:r[10]||(r[10]=e=>a.dialogVisible=!1)},{default:o(()=>r[13]||(r[13]=[q("\u53D6 \u6D88")])),_:1})]),default:o(()=>[K((m(),v(I,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"120px"},{default:o(()=>[l(i,null,{default:o(()=>[l(u,{span:8},{default:o(()=>[l(t,{label:"\u5546\u673A\u540D\u79F0",prop:"name"},{default:o(()=>[l(c,{modelValue:a.formData.name,"onUpdate:modelValue":r[0]||(r[0]=e=>a.formData.name=e),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:o(()=>[l(p,{modelValue:a.formData.ownerUserId,"onUpdate:modelValue":r[1]||(r[1]=e=>a.formData.ownerUserId=e),disabled:a.formType!=="create",class:"w-1/1"},{default:o(()=>[(m(!0),k(h,null,L(a.userOptions,e=>(m(),v(d,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:o(()=>[l(p,{disabled:a.formData.customerDefault,modelValue:a.formData.customerId,"onUpdate:modelValue":r[2]||(r[2]=e=>a.formData.customerId=e),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1"},{default:o(()=>[(m(!0),k(h,null,L(a.customerList,e=>(m(),v(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),l(i,null,{default:o(()=>[l(u,{span:8},{default:o(()=>[l(t,{label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeId"},{default:o(()=>[l(p,{modelValue:a.formData.statusTypeId,"onUpdate:modelValue":r[3]||(r[3]=e=>a.formData.statusTypeId=e),placeholder:"\u8BF7\u9009\u62E9\u5546\u673A\u72B6\u6001\u7EC4",clearable:"",class:"w-1/1",disabled:a.formType!=="create"},{default:o(()=>[(m(!0),k(h,null,L(a.statusTypeList,e=>(m(),v(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime"},{default:o(()=>[l(V,{modelValue:a.formData.dealTime,"onUpdate:modelValue":r[4]||(r[4]=e=>a.formData.dealTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[l(c,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":r[5]||(r[5]=e=>a.formData.remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:o(()=>[l(g,{modelValue:a.subTabsName,"onUpdate:modelValue":r[6]||(r[6]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:o(()=>[l(P,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:o(()=>[l(a.BusinessProductForm,{ref:"productFormRef",products:a.formData.products,disabled:x.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(u,{span:8},{default:o(()=>[l(t,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:o(()=>[l(c,{disabled:"",modelValue:a.formData.totalProductPrice,"onUpdate:modelValue":r[7]||(r[7]=e=>a.formData.totalProductPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:o(()=>[l(D,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":r[8]||(r[8]=e=>a.formData.discountPercent=e),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(u,{span:8},{default:o(()=>[l(t,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"price"},{default:o(()=>[l(c,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":r[9]||(r[9]=e=>a.formData.totalPrice=e),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[w,a.formLoading]])]),_:1},8,["title","modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/business/BusinessForm.vue"]]);export{pe as default};
