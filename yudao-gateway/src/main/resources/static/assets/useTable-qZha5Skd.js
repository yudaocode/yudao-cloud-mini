import{_ as D}from"./Form-CB5RGX1K.js";import{r as C,ao as j,a as f,d as $,p as w,g as O,b as T,ay as W,ct as G,_ as I,o as b,c as z,k,cc as U,n as E,w as x,aS as A,q as v,m as L,t as _,ah as P,aF as H,F as J,z as K,N as Q,f as X,au as V,aG as N,ar as q}from"./index-BaY5TDP-.js";import{d as Y}from"./download-oWiM5xVU.js";const Z=$({name:"Search",__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:w.bool.def(!1),labelWidth:w.oneOfType([String,Number]).def("auto"),layout:w.string.validate(e=>["inline","bottom"].includes(e)).def("inline"),buttomPosition:w.string.validate(e=>["left","center","right"].includes(e)).def("center"),showSearch:w.bool.def(!0),showReset:w.bool.def(!0),expand:w.bool.def(!1),expandField:w.string.def(""),inline:w.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(e,{expose:a,emit:c}){a();const{t:n}=O(),d=e,h=c,m=C(!0),l=T(()=>{let r=W(d.schema);if(d.expand&&d.expandField&&!f(m)){const y=G(r,p=>p.field===d.expandField);if(y>-1){const p=r.length;r.splice(y+1,p)}}return d.layout==="inline"&&(r=r.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),r}),{register:t,elFormRef:s,methods:u}=(r=>{const y=C(),p=C(),S=async()=>{await j();const i=f(y);return i||console.error("The form is not registered. Please use the register method to register"),i},M={setProps:async(i={})=>{const o=await S();o==null||o.setProps(i),i.model&&(o==null||o.setValues(i.model))},setValues:async i=>{const o=await S();o==null||o.setValues(i)},setSchema:async i=>{const o=await S();o==null||o.setSchema(i)},addSchema:async(i,o)=>{const R=await S();R==null||R.addSchema(i,o)},delSchema:async i=>{const o=await S();o==null||o.delSchema(i)},getFormData:async()=>{const i=await S();return i==null?void 0:i.formModel}};return r&&M.setProps(r),{register:(i,o)=>{y.value=i,p.value=o},elFormRef:p,methods:M}})({model:d.model||{}}),F=T(()=>({textAlign:d.buttomPosition})),B={t:n,props:d,emit:h,visible:m,newSchema:l,register:t,elFormRef:s,methods:u,search:async()=>{var r;await((r=f(s))==null?void 0:r.validate(async y=>{if(y){const{getFormData:p}=u,S=await p();h("search",S)}}))},reset:async()=>{var p;(p=f(s))==null||p.resetFields();const{getFormData:r}=u,y=await r();h("reset",y)},bottonButtonStyle:F,setVisible:()=>{var r;(r=f(s))==null||r.resetFields(),m.value=!f(m)}};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),ee={key:0},te=I(Z,[["render",function(e,a,c,n,d,h){const m=K,l=Q,t=D;return b(),z(J,null,[k(t,{inline:c.inline,"is-col":c.isCol,"is-custom":!1,"label-width":c.labelWidth,schema:n.newSchema,class:"-mb-15px","hide-required-asterisk":"",onRegister:n.register},U({action:x(()=>[c.layout==="inline"?(b(),z("div",ee,[c.showSearch?(b(),v(l,{key:0,onClick:n.search},{default:x(()=>[k(m,{class:"mr-5px",icon:"ep:search"}),L(" "+_(n.t("common.query")),1)]),_:1})):P("",!0),c.showReset?(b(),v(l,{key:1,onClick:n.reset},{default:x(()=>[k(m,{class:"mr-5px",icon:"ep:refresh"}),L(" "+_(n.t("common.reset")),1)]),_:1})):P("",!0),c.expand?(b(),v(l,{key:2,text:"",onClick:n.setVisible},{default:x(()=>[L(_(n.t(n.visible?"common.shrink":"common.expand"))+" ",1),k(m,{icon:n.visible?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):P("",!0),A(e.$slots,"actionMore")])):P("",!0)]),_:2},[E(Object.keys(e.$slots),s=>({name:s,fn:x(()=>[A(e.$slots,s)])}))]),1032,["inline","is-col","label-width","schema","onRegister"]),c.layout==="bottom"?(b(),z("div",{key:0,style:H(n.bottonButtonStyle)},[c.showSearch?(b(),v(l,{key:0,type:"primary",onClick:n.search},{default:x(()=>[k(m,{class:"mr-5px",icon:"ep:search"}),L(" "+_(n.t("common.query")),1)]),_:1})):P("",!0),c.showReset?(b(),v(l,{key:1,onClick:n.reset},{default:x(()=>[k(m,{class:"mr-5px",icon:"ep:refresh-right"}),L(" "+_(n.t("common.reset")),1)]),_:1})):P("",!0),c.expand?(b(),v(l,{key:2,text:"",onClick:n.setVisible},{default:x(()=>[L(_(n.t(n.visible?"common.shrink":"common.expand"))+" ",1),k(m,{icon:n.visible?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):P("",!0),A(e.$slots,"actionMore")],4)):P("",!0)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/components/Search/src/Search.vue"]]),{t:g}=O(),ae=e=>{const a=X({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(e==null?void 0:e.defaultParams)||{}},loading:!0,exportLoading:!1,currentRow:null}),c=T(()=>({...a.params,pageSize:a.pageSize,pageNo:a.currentPage}));V(()=>a.currentPage,()=>{l.getList()}),V(()=>a.pageSize,()=>{a.currentPage===1||(a.currentPage=1),l.getList()});const n=C(),d=C(),h=async()=>{await j();const t=f(n);return t||console.error("The table is not registered. Please use the register method to register"),t},m=async t=>{let s=1;t instanceof Array?(s=t.length,await Promise.all(t.map(async u=>{await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(u)))}))):await((e==null?void 0:e.delListApi)&&(e==null?void 0:e.delListApi(t))),N.success(g("common.delSuccess")),a.currentPage=(a.total%a.pageSize===s||a.pageSize===1)&&a.currentPage>1?a.currentPage-1:a.currentPage,await l.getList()},l={getList:async()=>{a.loading=!0;const t=await(e==null?void 0:e.getListApi(f(c)).finally(()=>{a.loading=!1}));t&&(a.tableList=t.list,a.total=t.total??0)},setProps:async(t={})=>{const s=await h();s==null||s.setProps(t)},setColumn:async t=>{const s=await h();s==null||s.setColumn(t)},getSelections:async()=>{const t=await h();return(t==null?void 0:t.selections)||[]},setSearchParams:t=>{a.params=Object.assign(a.params,{pageSize:a.pageSize,pageNo:1,...t}),a.currentPage!==1?a.currentPage=1:l.getList()},delList:async(t,s,u=!0)=>{const F=await h();!s||F!=null&&F.selections.length?u?q.confirm(g("common.delMessage"),g("common.confirmTitle"),{confirmButtonText:g("common.ok"),cancelButtonText:g("common.cancel"),type:"warning"}).then(async()=>{await m(t)}):await m(t):N.warning(g("common.delNoData"))},exportList:async t=>{a.exportLoading=!0,q.confirm(g("common.exportMessage"),g("common.confirmTitle"),{confirmButtonText:g("common.ok"),cancelButtonText:g("common.cancel"),type:"warning"}).then(async()=>{var u;const s=await((u=e==null?void 0:e.exportListApi)==null?void 0:u.call(e,f(c)));s&&Y.excel(s,t)}).finally(()=>{a.exportLoading=!1})}};return e!=null&&e.props&&l.setProps(e.props),{register:(t,s)=>{n.value=t,d.value=s},elTableRef:d,tableObject:a,methods:l,tableMethods:l}};export{te as _,ae as u};
