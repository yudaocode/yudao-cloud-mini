import{d as D,r as g,f as R,au as w,e3 as T,C as q,e4 as F,G as N,_ as L,o as b,c as x,I as E,q as P,w as a,k as e,F as U,n as B,m as I,ah as j,P as O,J as A,K as S,L as Y,Z as G,cf as J,N as K,Q as M,O as Q,E as Z,R as z}from"./index-BaY5TDP-.js";import{_ as H}from"./DictTag-QtcI9ZjC.js";import{g as W}from"./index-D4G-Yxr7.js";import"./color-BN7ZL7BD.js";const X=L(D({__name:"BusinessProductForm",props:{products:{type:null,required:!0},disabled:{type:Boolean,required:!0}},setup(v,{expose:c}){const m=v,t=g(!1),p=g([]),V=R({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],businessPrice:[{required:!0,message:"\u5408\u540C\u4EF7\u683C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],count:[{required:!0,message:"\u4EA7\u54C1\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),u=g([]),f=g([]);w(()=>m.products,async d=>{p.value=d},{immediate:!0}),w(()=>p.value,d=>{d&&d.length!==0&&d.forEach(r=>{r.businessPrice!=null&&r.count!=null?r.totalPrice=T(r.businessPrice,r.count):r.totalPrice=void 0})},{deep:!0});const _=()=>u.value.validate();c({validate:_}),q(async()=>{f.value=await W()});const s={props:m,formLoading:t,formData:p,formRules:V,formRef:u,productList:f,handleAdd:()=>{p.value.push({id:void 0,productId:void 0,productUnit:void 0,productNo:void 0,productPrice:void 0,businessPrice:void 0,count:1})},handleDelete:d=>{p.value.splice(d,1)},onChangeProduct:(d,r)=>{const n=f.value.find(h=>h.id===d);n&&(r.productUnit=n.unit,r.productNo=n.no,r.productPrice=n.price,r.businessPrice=n.price)},validate:_,get erpPriceInputFormatter(){return F},get DICT_TYPE(){return N}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),[["render",function(v,c,m,t,p,V){const u=O,f=A,_=S,s=Y,d=G,r=H,n=J,h=K,y=M,C=Q,$=Z,k=z;return b(),x(U,null,[E((b(),P(C,{ref:"formRef",model:t.formData,rules:t.formRules,"label-width":"0px","inline-message":!0,disabled:m.disabled},{default:a(()=>[e(y,{data:t.formData,class:"-mt-10px"},{default:a(()=>[e(u,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(u,{label:"\u4EA7\u54C1\u540D\u79F0","min-width":"180"},{default:a(({row:l,$index:i})=>[e(s,{prop:`${i}.productId`,rules:t.formRules.productId,class:"mb-0px!"},{default:a(()=>[e(_,{modelValue:l.productId,"onUpdate:modelValue":o=>l.productId=o,clearable:"",filterable:"",onChange:o=>t.onChangeProduct(o,l),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1"},{default:a(()=>[(b(!0),x(U,null,B(t.productList,o=>(b(),P(f,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u6761\u7801","min-width":"150"},{default:a(({row:l})=>[e(s,{class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:l.productNo,"onUpdate:modelValue":i=>l.productNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(u,{label:"\u5355\u4F4D","min-width":"80"},{default:a(({row:l})=>[e(r,{type:t.DICT_TYPE.CRM_PRODUCT_UNIT,value:l.productUnit},null,8,["type","value"])]),_:1}),e(u,{label:"\u4EF7\u683C\uFF08\u5143\uFF09","min-width":"120"},{default:a(({row:l})=>[e(s,{class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:l.productPrice,"onUpdate:modelValue":i=>l.productPrice=i,formatter:t.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(u,{label:"\u552E\u4EF7\uFF08\u5143\uFF09",fixed:"right","min-width":"140"},{default:a(({row:l,$index:i})=>[e(s,{prop:`${i}.businessPrice`,class:"mb-0px!"},{default:a(()=>[e(n,{modelValue:l.businessPrice,"onUpdate:modelValue":o=>l.businessPrice=o,"controls-position":"right",min:.001,precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(u,{label:"\u6570\u91CF",prop:"count",fixed:"right","min-width":"120"},{default:a(({row:l,$index:i})=>[e(s,{prop:`${i}.count`,rules:t.formRules.count,class:"mb-0px!"},{default:a(()=>[e(n,{modelValue:l.count,"onUpdate:modelValue":o=>l.count=o,"controls-position":"right",min:.001,precision:3,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u5408\u8BA1",prop:"totalPrice",fixed:"right","min-width":"140"},{default:a(({row:l,$index:i})=>[e(s,{prop:`${i}.totalPrice`,class:"mb-0px!"},{default:a(()=>[e(d,{disabled:"",modelValue:l.totalPrice,"onUpdate:modelValue":o=>l.totalPrice=o,formatter:t.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:1}),e(u,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:a(({$index:l})=>[e(h,{onClick:i=>t.handleDelete(l),link:""},{default:a(()=>c[0]||(c[0]=[I("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[k,t.formLoading]]),m.disabled?j("",!0):(b(),P($,{key:0,justify:"center",class:"mt-3"},{default:a(()=>[e(h,{onClick:t.handleAdd,round:""},{default:a(()=>c[1]||(c[1]=[I("+ \u6DFB\u52A0\u4EA7\u54C1")])),_:1})]),_:1}))],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/business/components/BusinessProductForm.vue"]]);export{X as default};
