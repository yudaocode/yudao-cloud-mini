import{d as E,u as M,S as O,r as f,f as Q,C as B,D as R,g as K,G as L,U as z,ar as A,_ as H,X as J,c as q,k as l,w as t,F as v,o,n as x,q as p,Y,m as T,I,t as $,ah as j,J as G,K as X,L as Z,Z as W,M as ee,z as ae,N as le,O as re,P as te,Q as se,R as oe}from"./index-BaY5TDP-.js";import{_ as ie}from"./index-avjYFQiD.js";import{_ as ne}from"./DictTag-QtcI9ZjC.js";import{_ as ue}from"./ContentWrap-DKQn7kZm.js";import{_ as de}from"./index-BAz6Gqim.js";import{d as me}from"./formatTime-Dr6TiYYc.js";import{b as pe,c as ce}from"./index-BJQN17A_.js";import{g as fe}from"./index-CuAlllbQ.js";import{a as ye}from"./index-5lnhJJF7.js";import{p as _e}from"./index-BCN8BzfC.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";const Pe=H(E({name:"BpmProcessInstanceReport",__name:"index",setup(N,{expose:r}){r();const F=M(),{query:e}=O(),U=R(),{t:D}=K(),y=f(!0),_=f(0),P=f([]),i=f(),b=e.processDefinitionId,u=Q({pageNo:1,pageSize:10,startUserId:void 0,name:"",processDefinitionKey:e.processDefinitionKey,status:void 0,createTime:[],endTime:[],formFieldsParams:{}}),g=f(),d=f([]),c=async()=>{y.value=!0;try{const s=await pe({...u,formFieldsParams:JSON.stringify(u.formFieldsParams)});P.value=s.list,_.value=s.total}finally{y.value=!1}},h=async()=>{const s=await ye(b);i.value=n(s.formFields)},n=s=>{const m=[];return s&&s.forEach(k=>{_e(JSON.parse(k),m)}),m},S=()=>{u.pageNo=1,c()};B(async()=>{await h(),await c(),d.value=await fe()});const V={router:F,query:e,message:U,t:D,loading:y,total:_,list:P,formFields:i,processDefinitionId:b,queryParams:u,queryFormRef:g,userList:d,getList:c,getProcessDefinition:h,parseFormCreateFields:n,handleQuery:S,resetQuery:()=>{g.value.resetFields(),u.formFieldsParams={},S()},handleDetail:s=>{F.push({name:"BpmProcessInstanceDetail",query:{id:s.id}})},handleCancel:async s=>{const{value:m}=await A.prompt("\u8BF7\u8F93\u5165\u53D6\u6D88\u539F\u56E0","\u53D6\u6D88\u6D41\u7A0B",{confirmButtonText:D("common.ok"),cancelButtonText:D("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u53D6\u6D88\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});await ce(s.id,m),U.success("\u53D6\u6D88\u6210\u529F"),await c()},get DICT_TYPE(){return L},get getIntDictOptions(){return z},get dateFormatter(){return me}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),[["render",function(N,r,F,e,U,D){const y=de,_=G,P=X,i=Z,b=W,u=ee,g=ae,d=le,c=re,h=ue,n=te,S=ne,V=se,s=ie,m=J("hasPermi"),k=oe;return o(),q(v,null,[l(y,{title:"\u5DE5\u4F5C\u6D41\u624B\u518C",url:"https://doc.iocoder.cn/bpm/"}),l(h,null,{default:t(()=>[l(c,{class:"-mb-15px",model:e.queryParams,ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(i,{label:"\u53D1\u8D77\u4EBA",prop:"startUserId"},{default:t(()=>[l(P,{modelValue:e.queryParams.startUserId,"onUpdate:modelValue":r[0]||(r[0]=a=>e.queryParams.startUserId=a),placeholder:"\u8BF7\u9009\u62E9\u53D1\u8D77\u4EBA",class:"!w-240px"},{default:t(()=>[(o(!0),q(v,null,x(e.userList,a=>(o(),p(_,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name"},{default:t(()=>[l(b,{modelValue:e.queryParams.name,"onUpdate:modelValue":r[1]||(r[1]=a=>e.queryParams.name=a),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:Y(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(i,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status"},{default:t(()=>[l(P,{modelValue:e.queryParams.status,"onUpdate:modelValue":r[2]||(r[2]=a=>e.queryParams.status=a),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u72B6\u6001",clearable:"",class:"!w-240px"},{default:t(()=>[(o(!0),q(v,null,x(e.getIntDictOptions(e.DICT_TYPE.BPM_PROCESS_INSTANCE_STATUS),a=>(o(),p(_,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"\u53D1\u8D77\u65F6\u95F4",prop:"createTime"},{default:t(()=>[l(u,{modelValue:e.queryParams.createTime,"onUpdate:modelValue":r[3]||(r[3]=a=>e.queryParams.createTime=a),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),l(i,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:t(()=>[l(u,{modelValue:e.queryParams.endTime,"onUpdate:modelValue":r[4]||(r[4]=a=>e.queryParams.endTime=a),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),(o(!0),q(v,null,x(e.formFields,(a,w)=>(o(),p(i,{key:w,label:a.title,prop:a.field},{default:t(()=>[l(b,{disabled:a.type!=="input",modelValue:e.queryParams.formFieldsParams[a.field],"onUpdate:modelValue":C=>e.queryParams.formFieldsParams[a.field]=C,placeholder:`\u8BF7\u8F93\u5165${a.title}`,clearable:"",onKeyup:Y(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),l(i,null,{default:t(()=>[l(d,{onClick:e.handleQuery},{default:t(()=>[l(g,{icon:"ep:search",class:"mr-5px"}),r[7]||(r[7]=T(" \u641C\u7D22"))]),_:1}),l(d,{onClick:e.resetQuery},{default:t(()=>[l(g,{icon:"ep:refresh",class:"mr-5px"}),r[8]||(r[8]=T(" \u91CD\u7F6E"))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(h,null,{default:t(()=>[I((o(),p(V,{border:"",data:e.list},{default:t(()=>[l(n,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name",fixed:"left",width:"200"}),l(n,{label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA",align:"center",prop:"startUser.nickname",width:"120"}),l(n,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status",width:"120"},{default:t(a=>[l(S,{type:e.DICT_TYPE.BPM_PROCESS_INSTANCE_STATUS,value:a.row.status},null,8,["type","value"])]),_:1}),l(n,{label:"\u53D1\u8D77\u65F6\u95F4",align:"center",prop:"startTime",width:"180",formatter:e.dateFormatter},null,8,["formatter"]),l(n,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"endTime",width:"180",formatter:e.dateFormatter},null,8,["formatter"]),(o(!0),q(v,null,x(e.formFields,(a,w)=>(o(),p(n,{key:w,label:a.title,prop:a.field,width:"120"},{default:t(C=>[T($(C.row.formVariables[a.field]??""),1)]),_:2},1032,["label","prop"]))),128)),l(n,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"180"},{default:t(a=>[I((o(),p(d,{link:"",type:"primary",onClick:w=>e.handleDetail(a.row)},{default:t(()=>r[9]||(r[9]=[T(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[m,["bpm:process-instance:cancel"]]]),a.row.status===1?I((o(),p(d,{key:0,link:"",type:"primary",onClick:w=>e.handleCancel(a.row)},{default:t(()=>r[10]||(r[10]=[T(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[m,["bpm:process-instance:query"]]]):j("",!0)]),_:1})]),_:1},8,["data"])),[[k,e.loading]]),l(s,{total:e.total,page:e.queryParams.pageNo,"onUpdate:page":r[5]||(r[5]=a=>e.queryParams.pageNo=a),limit:e.queryParams.pageSize,"onUpdate:limit":r[6]||(r[6]=a=>e.queryParams.pageSize=a),onPagination:e.getList},null,8,["total","page","limit"])]),_:1})],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/processInstance/report/index.vue"]]);export{Pe as default};
