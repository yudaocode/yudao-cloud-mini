import{d as O,p as q,r as u,b as E,G as Q,U as D,bJ as A,_ as F,o as h,q as b,cc as z,w as o,k as a,m as f,c as Y,F as M,n as R,I as L,t as j,J,K as B,L as G,z as K,N as H,O as W,ai as X,P as Z,ak as $,Q as ee,R as le}from"./index-BaY5TDP-.js";import{_ as ae}from"./Dialog-CZSXtzfQ.js";import{_ as te}from"./ContentWrap-DKQn7kZm.js";import{_ as ie}from"./index-avjYFQiD.js";import{_ as oe}from"./DictTag-QtcI9ZjC.js";import{E as ne}from"./el-image-Bg-CwbDE.js";import{P as re}from"./index-PmeLzyKc.js";import{f as ue}from"./formatter-DdccBgw4.js";import{d as de}from"./formatTime-Dr6TiYYc.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";const se=F(O({name:"PointTableSelect",__name:"PointTableSelect",props:{multiple:q.bool.def(!1)},setup(x,{expose:t,emit:w}){const l=u(0),p=u([]),k=u(!1),c=u(!1),v=u({pageNo:1,pageSize:10,name:null,status:void 0}),C=E(()=>e=>(e.totalStock||0)-(e.stock||0)),g=e=>{s.value=[],r.value={},d.value=!1,n.value=!1,e&&e.length>0&&(s.value=[...e],r.value=Object.fromEntries(e.map(i=>[i.id,!0]))),c.value=!0,P()};t({open:g});const m=async()=>{k.value=!0;try{const e=await re.getPointActivityPage(v.value);p.value=e.list,l.value=e.total,p.value.forEach(i=>r.value[i.id]=r.value[i.id]||!1),_()}finally{k.value=!1}},P=()=>{v.value={pageNo:1,pageSize:10,name:null,status:void 0},m()},d=u(!1),n=u(!1),s=u([]),r=u({}),S=u(),y=w,V=(e,i,N)=>{if(e)s.value.push(i),r.value[i.id]=!0;else{const U=T(i);U>-1&&(s.value.splice(U,1),r.value[i.id]=!1,d.value=!1)}N&&_()},T=e=>s.value.findIndex(i=>i.id===e.id),_=()=>{d.value=p.value.every(e=>r.value[e.id]),n.value=!d.value&&p.value.some(e=>r.value[e.id])},I={total:l,list:p,loading:k,dialogVisible:c,queryParams:v,getRedeemedQuantity:C,open:g,getList:m,handleQuery:()=>{v.value.pageNo=1,m()},resetQuery:P,isCheckAll:d,isIndeterminate:n,checkedActivities:s,checkedStatus:r,selectedActivityId:S,handleSingleSelected:e=>{y(A,e),c.value=!1,S.value=e.id},handleEmitChange:()=>{c.value=!1,y(A,[...s.value])},emits:y,handleCheckAll:e=>{d.value=e,n.value=!1,p.value.forEach(i=>V(e,i,!1))},handleCheckOne:V,findCheckedIndex:T,calculateIsCheckAll:_,get fenToYuanFormat(){return ue},get DICT_TYPE(){return Q},get getIntDictOptions(){return D},get dateFormatter(){return de}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}}),[["render",function(x,t,w,l,p,k){const c=J,v=B,C=G,g=K,m=H,P=W,d=X,n=Z,s=$,r=ne,S=oe,y=ee,V=ie,T=te,_=ae,I=le;return h(),b(_,{modelValue:l.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>l.dialogVisible=e),appendToBody:!0,title:"\u9009\u62E9\u6D3B\u52A8",width:"70%"},z({default:o(()=>[a(T,null,{default:o(()=>[a(P,{ref:"queryFormRef",inline:!0,model:l.queryParams,class:"-mb-15px","label-width":"68px"},{default:o(()=>[a(C,{label:"\u6D3B\u52A8\u72B6\u6001",prop:"status"},{default:o(()=>[a(v,{modelValue:l.queryParams.status,"onUpdate:modelValue":t[0]||(t[0]=e=>l.queryParams.status=e),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D3B\u52A8\u72B6\u6001"},{default:o(()=>[(h(!0),Y(M,null,R(l.getIntDictOptions(l.DICT_TYPE.COMMON_STATUS),e=>(h(),b(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(C,null,{default:o(()=>[a(m,{onClick:l.handleQuery},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:search"}),t[7]||(t[7]=f(" \u641C\u7D22 "))]),_:1}),a(m,{onClick:l.resetQuery},{default:o(()=>[a(g,{class:"mr-5px",icon:"ep:refresh"}),t[8]||(t[8]=f(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),L((h(),b(y,{data:l.list,"show-overflow-tooltip":""},{default:o(()=>[w.multiple?(h(),b(n,{key:0,width:"55"},{header:o(()=>[a(d,{modelValue:l.isCheckAll,"onUpdate:modelValue":t[1]||(t[1]=e=>l.isCheckAll=e),indeterminate:l.isIndeterminate,onChange:l.handleCheckAll},null,8,["modelValue","indeterminate"])]),default:o(({row:e})=>[a(d,{modelValue:l.checkedStatus[e.id],"onUpdate:modelValue":i=>l.checkedStatus[e.id]=i,onChange:i=>l.handleCheckOne(i,e,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(h(),b(n,{key:1,label:"#",width:"55"},{default:o(({row:e})=>[a(s,{modelValue:l.selectedActivityId,"onUpdate:modelValue":t[2]||(t[2]=i=>l.selectedActivityId=i),value:e.id,onChange:i=>l.handleSingleSelected(e)},{default:o(()=>t[9]||(t[9]=[f(" \xA0 ")])),_:2},1032,["modelValue","value","onChange"])]),_:1})),a(n,{label:"\u6D3B\u52A8\u7F16\u53F7","min-width":"80",prop:"id"}),a(n,{label:"\u5546\u54C1\u56FE\u7247","min-width":"80",prop:"spuName"},{default:o(e=>[a(r,{"preview-src-list":[e.row.picUrl],src:e.row.picUrl,class:"h-40px w-40px","preview-teleported":""},null,8,["preview-src-list","src"])]),_:1}),a(n,{label:"\u5546\u54C1\u6807\u9898","min-width":"300",prop:"spuName"}),a(n,{formatter:l.fenToYuanFormat,label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"},null,8,["formatter"]),a(n,{label:"\u539F\u4EF7","min-width":"100",prop:"marketPrice"}),a(n,{align:"center",label:"\u6D3B\u52A8\u72B6\u6001","min-width":"100",prop:"status"},{default:o(e=>[a(S,{type:l.DICT_TYPE.COMMON_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(n,{align:"center",label:"\u5E93\u5B58","min-width":"80",prop:"stock"}),a(n,{align:"center",label:"\u603B\u5E93\u5B58","min-width":"80",prop:"totalStock"}),a(n,{align:"center",label:"\u5DF2\u5151\u6362\u6570\u91CF","min-width":"100",prop:"redeemedQuantity"},{default:o(({row:e})=>[f(j(l.getRedeemedQuantity(e)),1)]),_:1}),a(n,{formatter:l.dateFormatter,align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"])]),_:1},8,["data"])),[[I,l.loading]]),a(V,{limit:l.queryParams.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>l.queryParams.pageSize=e),page:l.queryParams.pageNo,"onUpdate:page":t[4]||(t[4]=e=>l.queryParams.pageNo=e),total:l.total,onPagination:l.getList},null,8,["limit","page","total"])]),_:1})]),_:2},[w.multiple?{name:"footer",fn:o(()=>[a(m,{type:"primary",onClick:l.handleEmitChange},{default:o(()=>t[10]||(t[10]=[f("\u786E \u5B9A")])),_:1}),a(m,{onClick:t[5]||(t[5]=e=>l.dialogVisible=!1)},{default:o(()=>t[11]||(t[11]=[f("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/point/components/PointTableSelect.vue"]]);export{se as default};
