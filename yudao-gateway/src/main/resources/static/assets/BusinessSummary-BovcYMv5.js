import{d as C,f as h,r as y,au as q,u as D,C as N,e2 as S,_ as A,o as w,c as F,k as a,w as l,I as B,q as I,m as b,t as _,F as T,l as k,P as L,y as U,Q as O,R as j}from"./index-BaY5TDP-.js";import{_ as z}from"./index-avjYFQiD.js";import{E}from"./el-skeleton-item-BYAIkmCs.js";import{_ as Q}from"./Echart-BQxFkezy.js";import{S as P}from"./funnel-B8h2f-tZ.js";import{d as R}from"./formatTime-Dr6TiYYc.js";import"./index-DrSdAlug.js";import"./echarts-DpbyC_6K.js";const X=A(C({name:"BusinessSummary",__name:"BusinessSummary",props:{queryParams:{type:null,required:!0}},setup(x,{expose:n}){const m=x,e=h({pageNo:1,pageSize:10}),u=y(!1),f=y([]),c=y(0);q(()=>m.queryParams,i=>{if(!i)return;const r={...e,...i};Object.assign(e,r)},{immediate:!0});const s=h({grid:{left:30,right:30,bottom:20,containLabel:!0},legend:{},series:[{name:"\u65B0\u589E\u5546\u673A\u6570\u91CF",type:"bar",yAxisIndex:0,data:[]},{name:"\u65B0\u589E\u5546\u673A\u91D1\u989D",type:"bar",yAxisIndex:1,data:[]}],toolbox:{feature:{dataZoom:{xAxisIndex:!1},brush:{type:["lineX","clear"]},saveAsImage:{show:!0,name:"\u65B0\u589E\u5546\u673A\u5206\u6790"}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},yAxis:[{type:"value",name:"\u65B0\u589E\u5546\u673A\u6570\u91CF",min:0,minInterval:1},{type:"value",name:"\u65B0\u589E\u5546\u673A\u91D1\u989D",min:0,minInterval:1,splitLine:{lineStyle:{type:"dotted",opacity:.7}}}],xAxis:{type:"category",name:"\u65E5\u671F",data:[]}}),p=async()=>{const i=await P.getBusinessSummaryByDate(m.queryParams);s.xAxis&&s.xAxis.data&&(s.xAxis.data=i.map(r=>r.time)),s.series&&s.series[0]&&s.series[0].data&&(s.series[0].data=i.map(r=>r.businessCreateCount)),s.series&&s.series[1]&&s.series[1].data&&(s.series[1].data=i.map(r=>r.totalPrice)),await t()},t=async()=>{const i=await P.getBusinessPageByDate(m.queryParams);f.value=i.list,c.value=i.total},{push:o}=D(),d=async()=>{u.value=!0;try{await p()}finally{u.value=!1}};n({loadData:d}),N(()=>{d()});const g={props:m,queryParams0:e,loading:u,list:f,total:c,echartsOption:s,fetchAndFill:p,getList:t,push:o,openDetail:i=>{o({name:"CrmBusinessDetail",params:{id:i}})},openCustomerDetail:i=>{o({name:"CrmCustomerDetail",params:{id:i}})},loadData:d,get erpPriceTableColumnFormatter(){return S},get dateFormatter(){return R}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),[["render",function(x,n,m,e,u,f){const c=Q,s=E,p=k,t=L,o=U,d=O,g=z,i=j;return w(),F(T,null,[a(p,{shadow:"never"},{default:l(()=>[a(s,{loading:e.loading,animated:""},{default:l(()=>[a(c,{height:500,options:e.echartsOption},null,8,["options"])]),_:1},8,["loading"])]),_:1}),a(p,{class:"mt-16px",shadow:"never"},{default:l(()=>[B((w(),I(d,{data:e.list},{default:l(()=>[a(t,{align:"center",fixed:"left",label:"\u5E8F\u53F7",type:"index",width:"80"}),a(t,{align:"center",fixed:"left",label:"\u5546\u673A\u540D\u79F0",prop:"name",width:"160"},{default:l(r=>[a(o,{underline:!1,type:"primary",onClick:v=>e.openDetail(r.row.id)},{default:l(()=>[b(_(r.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{align:"center",fixed:"left",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"120"},{default:l(r=>[a(o,{underline:!1,type:"primary",onClick:v=>e.openCustomerDetail(r.row.customerId)},{default:l(()=>[b(_(r.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),a(t,{formatter:e.erpPriceTableColumnFormatter,align:"center",label:"\u5546\u673A\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalPrice",width:"140"},null,8,["formatter"]),a(t,{formatter:e.dateFormatter,align:"center",label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime",width:"180px"},null,8,["formatter"]),a(t,{align:"center",label:"\u5907\u6CE8",prop:"remark",width:"200"}),a(t,{formatter:e.dateFormatter,align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"contactNextTime",width:"180px"},null,8,["formatter"]),a(t,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"100px"}),a(t,{align:"center",label:"\u6240\u5C5E\u90E8\u95E8",prop:"ownerUserDeptName",width:"100px"}),a(t,{formatter:e.dateFormatter,align:"center",label:"\u6700\u540E\u8DDF\u8FDB\u65F6\u95F4",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),a(t,{formatter:e.dateFormatter,align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),a(t,{formatter:e.dateFormatter,align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(t,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"100px"}),a(t,{align:"center",fixed:"right",label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeName",width:"140"}),a(t,{align:"center",fixed:"right",label:"\u5546\u673A\u9636\u6BB5",prop:"statusName",width:"120"})]),_:1},8,["data"])),[[i,e.loading]]),a(g,{limit:e.queryParams0.pageSize,"onUpdate:limit":n[0]||(n[0]=r=>e.queryParams0.pageSize=r),page:e.queryParams0.pageNo,"onUpdate:page":n[1]||(n[1]=r=>e.queryParams0.pageNo=r),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1})],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/statistics/funnel/components/BusinessSummary.vue"]]);export{X as default};
