import{f as Y,d as N,g as j,D as q,r as u,ao as z,ax as O,ay as B,az as G,_ as H,o as x,c as J,k as s,w as m,m as V,I as K,q as Q,F as W,N as X,cf as Z,P as $,R as ee}from"./index-BaY5TDP-.js";import{_ as te}from"./Dialog-CZSXtzfQ.js";import{_ as oe}from"./Form-CB5RGX1K.js";import ie from"./SpuSelect-egfD7fzC.js";import le from"./SpuAndSkuList-BPESFKMK.js";import{b as U}from"./formatTime-Dr6TiYYc.js";import{S as ae}from"./seckillConfig-CO_19uSx.js";import{r as n}from"./formRules-CMjZInfO.js";import{u as se}from"./useCrudSchemas-BQxlWSsn.js";import{g as re,c as ue,u as me}from"./seckillActivity-Cs09fUfF.js";import{b as ne}from"./spu-BVX48OKx.js";import{g as ce}from"./index-DqlyDc99.js";import"./el-virtual-list-Cbbiio1P.js";import"./el-tree-select-DphqCDCz.js";import"./el-time-select-DuQV2otj.js";import"./InputPassword-liMgUpCC.js";import"./tsxHelper-B5zJ1wt3.js";import"./ContentWrap-DKQn7kZm.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./el-image-Bg-CwbDE.js";import"./tree-z7HkrWVC.js";import"./category-B7jjsMOS.js";import"./SkuList-LfTbtJ44.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";const pe=Y({spuId:[n],name:[n],startTime:[n],endTime:[n],sort:[n],configIds:[n],totalLimitCount:[n],singleLimitCount:[n],totalStock:[n]}),de=Y([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:ae.getSimpleSeckillConfigList},table:{width:300}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:fe}=se(de),ge=H(N({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(M,{expose:t,emit:F}){const{t:e}=j(),k=q(),b=u(!1),g=u(""),c=u(!1),v=u(""),r=u(),C=u(),h=u(),o=u([]),d=u([]),_=async(i,l,p)=>{var T;const f=[],y=await ne([i]);if(y.length==0)return;o.value=[];const a=y[0],w=l===void 0?a==null?void 0:a.skus:(T=a==null?void 0:a.skus)==null?void 0:T.filter(S=>l.includes(S.id));w==null||w.forEach(S=>{let L={skuId:S.id,stock:0,seckillPrice:0};if(p!==void 0){const P=p.find(E=>E.skuId===S.id);P&&(P.seckillPrice=O(P.seckillPrice)),L=P||L}S.productConfig=L}),a.skus=w,f.push({spuId:a.id,spuDetail:a,propertyList:ce(a)}),o.value.push(a),d.value=f},I=async(i,l)=>{var p;if(b.value=!0,g.value=e("action."+i),v.value=i,await R(),l){c.value=!0;try{const f=await re(l);await _(f.spuId,(p=f.products)==null?void 0:p.map(y=>y.skuId),f.products),r.value.setValues(f)}finally{c.value=!1}}};t({open:I});const D=F,R=async()=>{o.value=[],d.value=[],await z(),r.value.getElFormRef().resetFields()},A={t:e,message:k,dialogVisible:b,dialogTitle:g,formLoading:c,formType:v,formRef:r,spuSelectRef:C,spuAndSkuListRef:h,ruleConfig:[{name:"productConfig.stock",rule:i=>i>=1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:i=>i>=.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 0.01 \uFF01\uFF01\uFF01"}],spuList:o,spuPropertyList:d,selectSpu:(i,l)=>{r.value.setValues({spuId:i}),_(i,l)},getSpuDetails:_,open:I,emit:D,submitForm:async()=>{if(r&&await r.value.getElFormRef().validate()){c.value=!0;try{const i=B(h.value.getSkuConfigs("productConfig"));i.forEach(p=>{p.seckillPrice=G(p.seckillPrice)});const l=r.value.formModel;l.products=i,v.value==="create"?(await ue(l),k.success(e("common.createSuccess"))):(await me(l),k.success(e("common.updateSuccess"))),b.value=!1,D("success")}finally{c.value=!1}}},resetForm:R,get SpuAndSkuList(){return le},get SpuSelect(){return ie},get allSchemas(){return fe},get rules(){return pe}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}}),[["render",function(M,t,F,e,k,b){const g=X,c=Z,v=$,r=oe,C=te,h=ee;return x(),J(W,null,[s(C,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=o=>e.dialogVisible=o),title:e.dialogTitle,width:"65%"},{footer:m(()=>[s(g,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:m(()=>t[4]||(t[4]=[V("\u786E \u5B9A")])),_:1},8,["disabled"]),s(g,{onClick:t[1]||(t[1]=o=>e.dialogVisible=!1)},{default:m(()=>t[5]||(t[5]=[V("\u53D6 \u6D88")])),_:1})]),default:m(()=>[K((x(),Q(r,{ref:"formRef",isCol:!0,rules:e.rules,schema:e.allSchemas.formSchema},{spuId:m(()=>[s(g,{onClick:t[0]||(t[0]=o=>e.spuSelectRef.open())},{default:m(()=>t[3]||(t[3]=[V("\u9009\u62E9\u5546\u54C1")])),_:1}),s(e.SpuAndSkuList,{ref:"spuAndSkuListRef","rule-config":e.ruleConfig,"spu-list":e.spuList,"spu-property-list-p":e.spuPropertyList},{default:m(()=>[s(v,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:m(({row:o})=>[s(c,{modelValue:o.productConfig.stock,"onUpdate:modelValue":d=>o.productConfig.stock=d,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(v,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:m(({row:o})=>[s(c,{modelValue:o.productConfig.seckillPrice,"onUpdate:modelValue":d=>o.productConfig.seckillPrice=d,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[h,e.formLoading]])]),_:1},8,["modelValue","title"]),s(e.SpuSelect,{ref:"spuSelectRef",isSelectSku:!0,onConfirm:e.selectSpu},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/seckill/activity/SeckillActivityForm.vue"]]);export{ge as default};
