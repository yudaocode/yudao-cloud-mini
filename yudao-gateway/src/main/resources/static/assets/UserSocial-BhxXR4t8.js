import{bz as f,d as P,D as R,r as h,S as x,C as N,au as j,_ as z,o as v,q as D,w as U,k as u,j as w,t as F,c as _,F as S,m as k,P as L,Q as O}from"./index-BaY5TDP-.js";import{_ as Q}from"./XTextButton-Cf-hbTFF.js";import{S as C}from"./constants-CEEr2azc.js";import{g as V}from"./profile-BO8Syfus.js";const $=["src"],A={class:"mr-5"},B=z(P({name:"UserSocial",__name:"UserSocial",props:{activeName:{type:String,required:!0}},emits:["update:activeName"],setup(q,{expose:l,emit:b}){l();const i=R(),d=h([]),o=h(),c=async()=>{var a;d.value=[];const e=await V();o.value=e;for(const s in C){const r={...C[s]};if(d.value.push(r),(a=o.value)==null?void 0:a.socialUsers){for(const y in o.value.socialUsers)if(r.type===o.value.socialUsers[y].type){r.openid=o.value.socialUsers[y].openid;break}}}},n=x(),p=b,t=()=>{const e=m("type"),a=n.query.code,s=n.query.state;a&&((r,y,I)=>f.post({url:"/system/social-user/bind",data:{type:r,code:y,state:I}}))(e,a,s).then(()=>{i.success("\u7ED1\u5B9A\u6210\u529F"),p("update:activeName","userSocial")})};function m(e){return new URL(decodeURIComponent(location.href)).searchParams.get(e)??""}N(async()=>{await c()}),j(()=>n,()=>{t()},{immediate:!0});const g={message:i,socialUsers:d,userInfo:o,initSocial:c,route:n,emit:p,bindSocial:t,getUrlValue:m,bind:e=>{const a=location.origin+"/user/profile?"+encodeURIComponent(`type=${e.type}`);((s,r)=>f.get({url:"/system/auth/social-auth-redirect?type="+s+"&redirectUri="+r}))(e.type,encodeURIComponent(a)).then(s=>{window.location.href=s})},unbind:async e=>{var a,s;await(a=e.type,s=e.openid,f.delete({url:"/system/social-user/unbind",data:{type:a,openid:s}}))&&(e.openid=void 0),i.success("\u89E3\u7ED1\u6210\u529F")}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),[["render",function(q,l,b,i,d,o){const c=L,n=Q,p=O;return v(),D(p,{data:i.socialUsers,"show-header":!1},{default:U(()=>[u(c,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),u(c,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:U(({row:t})=>[w("img",{src:t.img,alt:"",class:"h-5 align-middle"},null,8,$),w("p",A,F(t.title),1)]),_:1}),u(c,{align:"center",label:"\u64CD\u4F5C"},{default:U(({row:t})=>[t.openid?(v(),_(S,{key:0},[l[0]||(l[0]=k(" \u5DF2\u7ED1\u5B9A ")),u(n,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:m=>i.unbind(t)},null,8,["onClick"])],64)):(v(),_(S,{key:1},[l[1]||(l[1]=k(" \u672A\u7ED1\u5B9A ")),u(n,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:m=>i.bind(t)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/Profile/components/UserSocial.vue"]]);export{B as default};
