import{f as j,d as M,g as O,D as B,r as p,ao as G,ax as H,ay as J,az as K,_ as Q,o as L,c as W,k as l,w as u,m as F,I as X,q as D,ah as Y,F as Z,N as $,cf as ee,P as te,R as oe}from"./index-BaY5TDP-.js";import{_ as ie}from"./Dialog-CZSXtzfQ.js";import{_ as le}from"./Form-CB5RGX1K.js";import se from"./SpuSelect-egfD7fzC.js";import ae from"./SpuAndSkuList-BPESFKMK.js";import{r as N}from"./formRules-CMjZInfO.js";import{u as re}from"./useCrudSchemas-BQxlWSsn.js";import{P as I}from"./index-PmeLzyKc.js";import{b as ue}from"./spu-BVX48OKx.js";import{g as ne}from"./index-DqlyDc99.js";import"./el-virtual-list-Cbbiio1P.js";import"./el-tree-select-DphqCDCz.js";import"./el-time-select-DuQV2otj.js";import"./InputPassword-liMgUpCC.js";import"./tsxHelper-B5zJ1wt3.js";import"./ContentWrap-DKQn7kZm.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./el-image-Bg-CwbDE.js";import"./formatTime-Dr6TiYYc.js";import"./tree-z7HkrWVC.js";import"./category-B7jjsMOS.js";import"./SkuList-LfTbtJ44.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";const pe=j({spuId:[N],sort:[N]}),me=j([{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79EF\u5206\u5546\u57CE\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}}]),{allSchemas:ce}=re(me),de=Q(M({name:"PromotionSeckillActivityForm",__name:"PointActivityForm",emits:["success"],setup(q,{expose:i,emit:U}){const{t:e}=O(),y=B(),w=p(!1),g=p(""),n=p(!1),c=p(""),m=p(),v=p(!1),h=p(),t=p(),s=p([]),C=p([]),_=async(o,a,d)=>{var E;const f=[],V=await ue([o]);if(V.length==0)return;s.value=[];const r=V[0],b=a===void 0?r==null?void 0:r.skus:(E=r==null?void 0:r.skus)==null?void 0:E.filter(S=>a.includes(S.id));b==null||b.forEach(S=>{let P={skuId:S.id,stock:0,price:0,point:0,count:0};if(d!==void 0){const k=d.find(z=>z.skuId===S.id);k&&(k.price=H(k.price)),P=k||P}S.productConfig=P}),r.skus=b,f.push({spuId:r.id,spuDetail:r,propertyList:ne(r)}),s.value.push(r),C.value=f},A=async(o,a)=>{var d;if(w.value=!0,g.value=e("action."+o),c.value=o,await x(),a){n.value=!0;try{const f=await I.getPointActivity(a);v.value=!0,await _(f.spuId,(d=f.products)==null?void 0:d.map(V=>V.skuId),f.products),m.value.setValues(f)}finally{n.value=!1}}};i({open:A});const R=U,x=async()=>{s.value=[],C.value=[],v.value=!1,await G(),m.value.getElFormRef().resetFields()},T={t:e,message:y,dialogVisible:w,dialogTitle:g,formLoading:n,formType:c,formRef:m,isFormUpdate:v,spuSelectRef:h,spuAndSkuListRef:t,ruleConfig:[{name:"productConfig.stock",rule:o=>o>=1,message:"\u5546\u54C1\u53EF\u5151\u6362\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.point",rule:o=>o>=1,message:"\u5546\u54C1\u6240\u9700\u5151\u6362\u79EF\u5206\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.count",rule:o=>o>=1,message:"\u5546\u54C1\u53EF\u5151\u6362\u6B21\u6570\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E 1 \uFF01\uFF01\uFF01"}],spuList:s,spuPropertyList:C,selectSpu:(o,a)=>{m.value.setValues({spuId:o}),_(o,a)},getSpuDetails:_,open:A,emit:R,submitForm:async()=>{if(m&&await m.value.getElFormRef().validate()){n.value=!0;try{const o=J(t.value.getSkuConfigs("productConfig"));o.forEach(d=>{d.price=K(d.price)});const a=m.value.formModel;a.products=o,c.value==="create"?(await I.createPointActivity(a),y.success(e("common.createSuccess"))):(await I.updatePointActivity(a),y.success(e("common.updateSuccess"))),w.value=!1,R("success")}finally{n.value=!1}}},resetForm:x,get SpuAndSkuList(){return ae},get SpuSelect(){return se},get allSchemas(){return ce},get rules(){return pe}};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),[["render",function(q,i,U,e,y,w){const g=$,n=ee,c=te,m=le,v=ie,h=oe;return L(),W(Z,null,[l(v,{modelValue:e.dialogVisible,"onUpdate:modelValue":i[2]||(i[2]=t=>e.dialogVisible=t),title:e.dialogTitle,width:"65%"},{footer:u(()=>[l(g,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:u(()=>i[4]||(i[4]=[F("\u786E \u5B9A")])),_:1},8,["disabled"]),l(g,{onClick:i[1]||(i[1]=t=>e.dialogVisible=!1)},{default:u(()=>i[5]||(i[5]=[F("\u53D6 \u6D88")])),_:1})]),default:u(()=>[X((L(),D(m,{ref:"formRef",isCol:!0,rules:e.rules,schema:e.allSchemas.formSchema},{spuId:u(()=>[e.isFormUpdate?Y("",!0):(L(),D(g,{key:0,onClick:i[0]||(i[0]=t=>e.spuSelectRef.open())},{default:u(()=>i[3]||(i[3]=[F("\u9009\u62E9\u5546\u54C1")])),_:1})),l(e.SpuAndSkuList,{ref:"spuAndSkuListRef","rule-config":e.ruleConfig,"spu-list":e.spuList,"spu-property-list-p":e.spuPropertyList},{default:u(()=>[l(c,{align:"center",label:"\u53EF\u5151\u6362\u5E93\u5B58","min-width":"168"},{default:u(({row:t})=>[l(n,{modelValue:t.productConfig.stock,"onUpdate:modelValue":s=>t.productConfig.stock=s,max:t.stock,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),l(c,{align:"center",label:"\u53EF\u5151\u6362\u6B21\u6570","min-width":"168"},{default:u(({row:t})=>[l(n,{modelValue:t.productConfig.count,"onUpdate:modelValue":s=>t.productConfig.count=s,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{align:"center",label:"\u6240\u9700\u79EF\u5206","min-width":"168"},{default:u(({row:t})=>[l(n,{modelValue:t.productConfig.point,"onUpdate:modelValue":s=>t.productConfig.point=s,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{align:"center",label:"\u6240\u9700\u91D1\u989D(\u5143)","min-width":"168"},{default:u(({row:t})=>[l(n,{modelValue:t.productConfig.price,"onUpdate:modelValue":s=>t.productConfig.price=s,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[h,e.formLoading]])]),_:1},8,["modelValue","title"]),l(e.SpuSelect,{ref:"spuSelectRef",isSelectSku:!0,onConfirm:e.selectSpu},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/point/activity/PointActivityForm.vue"]]);export{de as default};
