import{bz as A,d as I,D as M,r as D,f as _,_ as U,o as Y,c as F,k as e,w as t,j as h,F as R,L as T,M as V,O as j,l as k,v as G,E as W}from"./index-BaY5TDP-.js";import{_ as q}from"./Echart-BQxFkezy.js";import{_ as z}from"./ContentWrap-DKQn7kZm.js";import{e as L,g as P,o as S,f as d,p as B}from"./formatTime-Dr6TiYYc.js";import H from"./main-DuOfDTOL.js";import"./echarts-DpbyC_6K.js";import"./index-C1v7IUC9.js";import"./tagsView-lnAkwTv2.js";const J=I({name:"MpStatistics",__name:"index",setup(O,{expose:r}){r();const g=M(),a=D([L(new Date(new Date().getTime()-6048e5)),P(new Date(new Date().getTime()-864e5))]),p=D(-1),c=D([]),o=_({color:["#67C23A","#E5323E"],legend:{data:["\u65B0\u589E\u7528\u6237","\u53D6\u6D88\u5173\u6CE8\u7684\u7528\u6237"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"\u65B0\u589E\u7528\u6237",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"\u53D6\u6D88\u5173\u6CE8\u7684\u7528\u6237",type:"bar",label:{show:!0},data:[]}]}),x=_({legend:{data:["\u7D2F\u8BA1\u7528\u6237\u91CF"]},xAxis:{type:"category",data:[]},yAxis:{minInterval:1},series:[{name:"\u7D2F\u8BA1\u7528\u6237\u91CF",data:[],type:"line",smooth:!0,label:{show:!0}}]}),m=_({color:["#67C23A","#E5323E"],legend:{data:["\u7528\u6237\u53D1\u9001\u4EBA\u6570","\u7528\u6237\u53D1\u9001\u6761\u6570"]},tooltip:{},xAxis:{data:[]},yAxis:{minInterval:1},series:[{name:"\u7528\u6237\u53D1\u9001\u4EBA\u6570",type:"line",smooth:!0,label:{show:!0},data:[]},{name:"\u7528\u6237\u53D1\u9001\u6761\u6570",type:"line",smooth:!0,label:{show:!0},data:[]}]}),l=_({color:["#67C23A","#E5323E","#E6A23C","#409EFF"],legend:{data:["\u88AB\u52A8\u56DE\u590D\u7528\u6237\u6D88\u606F\u7684\u6B21\u6570","\u5931\u8D25\u6B21\u6570","\u6700\u5927\u8017\u65F6","\u603B\u8017\u65F6"]},tooltip:{},xAxis:{data:[]},yAxis:{},series:[{name:"\u88AB\u52A8\u56DE\u590D\u7528\u6237\u6D88\u606F\u7684\u6B21\u6570",type:"bar",label:{show:!0},barGap:0,data:[]},{name:"\u5931\u8D25\u6B21\u6570",type:"bar",label:{show:!0},data:[]},{name:"\u6700\u5927\u8017\u65F6",type:"bar",label:{show:!0},data:[]},{name:"\u603B\u8017\u65F6",type:"bar",label:{show:!0},data:[]}]}),f=()=>{if(!p)return g.error("\u672A\u9009\u4E2D\u516C\u4F17\u53F7\uFF0C\u65E0\u6CD5\u7EDF\u8BA1\u6570\u636E"),!1;if(S(a.value[0],a.value[1])>=7)return g.error("\u65F6\u95F4\u95F4\u9694 7 \u5929\u4EE5\u5185\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;c.value=[];const s=S(a.value[0],a.value[1]);for(let i=0;i<=s;i++)c.value.push(d(B(a.value[0],864e5*i),"YYYY-MM-DD"));v(),y(),b(),w()},v=async()=>{o.xAxis.data=[],o.series[0].data=[],o.series[1].data=[];try{const i=await(s={accountId:p.value,date:[d(a.value[0]),d(a.value[1])]},A.get({url:"/mp/statistics/user-summary",params:s}));o.xAxis.data=c.value,c.value.forEach((u,n)=>{i.forEach(C=>{d(new Date(C.refDate),"YYYY-MM-DD").indexOf(u)!==-1&&(o.series[0].data[n]=C.newUser,o.series[1].data[n]=C.cancelUser)})})}catch{}var s},y=async()=>{x.xAxis.data=[],x.series[0].data=[];try{const i=await(s={accountId:p.value,date:[d(a.value[0]),d(a.value[1])]},A.get({url:"/mp/statistics/user-cumulate",params:s}));x.xAxis.data=c.value,i.forEach((u,n)=>{x.series[0].data[n]=u.cumulateUser})}catch{}var s},b=async()=>{m.xAxis.data=[],m.series[0].data=[],m.series[1].data=[];try{const i=await(s={accountId:p.value,date:[d(a.value[0]),d(a.value[1])]},A.get({url:"/mp/statistics/upstream-message",params:s}));m.xAxis.data=c.value,i.forEach((u,n)=>{m.series[0].data[n]=u.messageUser,m.series[1].data[n]=u.messageCount})}catch{}var s},w=async()=>{l.xAxis.data=[],l.series[0].data=[],l.series[1].data=[],l.series[2].data=[],l.series[3].data=[];try{const i=await(s={accountId:p.value,date:[d(a.value[0]),d(a.value[1])]},A.get({url:"/mp/statistics/interface-summary",params:s}));l.xAxis.data=c.value,i.forEach((u,n)=>{l.series[0].data[n]=u.callbackCount,l.series[1].data[n]=u.failCount,l.series[2].data[n]=u.maxTimeCost,l.series[3].data[n]=u.totalTimeCost})}catch{}var s},E={message:g,dateRange:a,accountId:p,xAxisDate:c,userSummaryOption:o,userCumulateOption:x,upstreamMessageOption:m,interfaceSummaryOption:l,onAccountChanged:s=>{p.value=s,f()},getSummary:f,initUserSummaryChart:v,initUserCumulateChart:y,initUpstreamMessageChart:b,interfaceSummaryChart:w,get WxAccountSelect(){return H}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),K=U(J,[["render",function(O,r,g,a,p,c){const o=T,x=V,m=j,l=z,f=q,v=k,y=G,b=W;return Y(),F(R,null,[e(l,null,{default:t(()=>[e(m,{class:"-mb-15px",ref:"queryForm",inline:!0,"label-width":"68px"},{default:t(()=>[e(o,{label:"\u516C\u4F17\u53F7",prop:"accountId"},{default:t(()=>[e(a.WxAccountSelect,{onChange:a.onAccountChanged})]),_:1}),e(o,{label:"\u65F6\u95F4\u8303\u56F4",prop:"dateRange"},{default:t(()=>[e(x,{modelValue:a.dateRange,"onUpdate:modelValue":r[0]||(r[0]=w=>a.dateRange=w),type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],onChange:a.getSummary,class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1})]),_:1},512)]),_:1}),e(l,null,{default:t(()=>[e(b,null,{default:t(()=>[e(y,{span:12,class:"card-box"},{default:t(()=>[e(v,null,{header:t(()=>r[1]||(r[1]=[h("div",null,[h("span",null,"\u7528\u6237\u589E\u51CF\u6570\u636E")],-1)])),default:t(()=>[e(f,{options:a.userSummaryOption,height:420},null,8,["options"])]),_:1})]),_:1}),e(y,{span:12,class:"card-box"},{default:t(()=>[e(v,null,{header:t(()=>r[2]||(r[2]=[h("div",null,[h("span",null,"\u7D2F\u8BA1\u7528\u6237\u6570\u636E")],-1)])),default:t(()=>[e(f,{options:a.userCumulateOption,height:420},null,8,["options"])]),_:1})]),_:1}),e(y,{span:12,class:"card-box"},{default:t(()=>[e(v,null,{header:t(()=>r[3]||(r[3]=[h("div",null,[h("span",null,"\u6D88\u606F\u6982\u51B5\u6570\u636E")],-1)])),default:t(()=>[e(f,{options:a.upstreamMessageOption,height:420},null,8,["options"])]),_:1})]),_:1}),e(y,{span:12,class:"card-box"},{default:t(()=>[e(v,null,{header:t(()=>r[4]||(r[4]=[h("div",null,[h("span",null,"\u63A5\u53E3\u5206\u6790\u6570\u636E")],-1)])),default:t(()=>[e(f,{options:a.interfaceSummaryOption,height:420},null,8,["options"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mp/statistics/index.vue"]]);export{K as default};
