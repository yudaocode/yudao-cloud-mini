import{d as Q,D as R,g as L,r as f,f as E,u as z,C as K,G as A,U as M,_ as j,X as G,o as t,c as h,k as l,w as o,F as k,n as x,q as c,Y as N,m,I as T,t as U,J,K as X,L as Z,Z as B,z as H,N as W,O as $,y as ee,P as ae,Q as le,R as re}from"./index-BaY5TDP-.js";import{_ as oe}from"./index-avjYFQiD.js";import{_ as te}from"./DictTag-QtcI9ZjC.js";import{_ as ie}from"./ContentWrap-DKQn7kZm.js";import{d as ue}from"./formatTime-Dr6TiYYc.js";import{D as O}from"./index-B4zhmfOC.js";import se from"./DeviceForm-CfIssNNN.js";import{P as S}from"./index-DK5ShDMH.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";import"./Dialog-CZSXtzfQ.js";const de=j(Q({name:"IoTDevice",__name:"index",setup(F,{expose:r}){r();const b=R(),{t:e}=L(),w=f(!0),q=f([]),y=f(0),v=E({pageNo:1,pageSize:10,deviceName:void 0,productId:void 0,deviceType:void 0,nickname:void 0,status:void 0}),d=f(),_=E({}),p=async()=>{w.value=!0;try{const i=await O.getDevicePage(v);q.value=i.list,y.value=i.total;const D=[...new Set(i.list.map(u=>u.productId))];(await Promise.all(D.map(u=>S.getProduct(u)))).forEach(u=>{_[u.id]=u.name})}finally{w.value=!1}},n=()=>{v.pageNo=1,p()},I=f(),{push:g}=z(),C=f(),s=async()=>{C.value=await S.getSimpleProductList()};K(()=>{p(),s()});const P={message:b,t:e,loading:w,list:q,total:y,queryParams:v,queryFormRef:d,productMap:_,getList:p,handleQuery:n,resetQuery:()=>{d.value.resetFields(),n()},formRef:I,openForm:(i,D)=>{I.value.open(i,D)},push:g,openDetail:i=>{g({name:"IoTDeviceDetail",params:{id:i}})},handleDelete:async i=>{try{await b.delConfirm(),await O.deleteDevice(i),b.success(e("common.delSuccess")),await p()}catch{}},products:C,getProducts:s,get DICT_TYPE(){return A},get getIntDictOptions(){return M},get dateFormatter(){return ue},DeviceForm:se};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}}),[["render",function(F,r,b,e,w,q){const y=J,v=X,d=Z,_=B,p=H,n=W,I=$,g=ie,C=ee,s=ae,P=te,i=le,D=oe,u=G("hasPermi"),Y=re;return t(),h(k,null,[l(g,null,{default:o(()=>[l(I,{class:"-mb-15px",model:e.queryParams,ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:o(()=>[l(d,{label:"\u4EA7\u54C1",prop:"productId"},{default:o(()=>[l(v,{modelValue:e.queryParams.productId,"onUpdate:modelValue":r[0]||(r[0]=a=>e.queryParams.productId=a),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1",clearable:"",class:"!w-240px"},{default:o(()=>[(t(!0),h(k,null,x(e.products,a=>(t(),c(y,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"DeviceName",prop:"deviceName"},{default:o(()=>[l(_,{modelValue:e.queryParams.deviceName,"onUpdate:modelValue":r[1]||(r[1]=a=>e.queryParams.deviceName=a),placeholder:"\u8BF7\u8F93\u5165 DeviceName",clearable:"",onKeyup:N(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u5907\u6CE8\u540D\u79F0",prop:"nickname"},{default:o(()=>[l(_,{modelValue:e.queryParams.nickname,"onUpdate:modelValue":r[2]||(r[2]=a=>e.queryParams.nickname=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u540D\u79F0",clearable:"",onKeyup:N(e.handleQuery,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),l(d,{label:"\u8BBE\u5907\u7C7B\u578B",prop:"deviceType"},{default:o(()=>[l(v,{modelValue:e.queryParams.deviceType,"onUpdate:modelValue":r[3]||(r[3]=a=>e.queryParams.deviceType=a),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u7C7B\u578B",clearable:"",class:"!w-240px"},{default:o(()=>[(t(!0),h(k,null,x(e.getIntDictOptions(e.DICT_TYPE.IOT_PRODUCT_DEVICE_TYPE),a=>(t(),c(y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"\u8BBE\u5907\u72B6\u6001",prop:"status"},{default:o(()=>[l(v,{modelValue:e.queryParams.status,"onUpdate:modelValue":r[4]||(r[4]=a=>e.queryParams.status=a),placeholder:"\u8BF7\u9009\u62E9\u8BBE\u5907\u72B6\u6001",clearable:"",class:"!w-240px"},{default:o(()=>[(t(!0),h(k,null,x(e.getIntDictOptions(e.DICT_TYPE.IOT_DEVICE_STATUS),a=>(t(),c(y,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:o(()=>[l(n,{onClick:e.handleQuery},{default:o(()=>[l(p,{icon:"ep:search",class:"mr-5px"}),r[8]||(r[8]=m(" \u641C\u7D22 "))]),_:1}),l(n,{onClick:e.resetQuery},{default:o(()=>[l(p,{icon:"ep:refresh",class:"mr-5px"}),r[9]||(r[9]=m(" \u91CD\u7F6E "))]),_:1}),T((t(),c(n,{type:"primary",plain:"",onClick:r[5]||(r[5]=a=>e.openForm("create"))},{default:o(()=>[l(p,{icon:"ep:plus",class:"mr-5px"}),r[10]||(r[10]=m(" \u65B0\u589E "))]),_:1})),[[u,["iot:device:create"]]])]),_:1})]),_:1},8,["model"])]),_:1}),l(g,null,{default:o(()=>[T((t(),c(i,{data:e.list,stripe:!0,"show-overflow-tooltip":!0},{default:o(()=>[l(s,{label:"DeviceName",align:"center",prop:"deviceName"},{default:o(a=>[l(C,{onClick:V=>e.openDetail(a.row.id)},{default:o(()=>[m(U(a.row.deviceName),1)]),_:2},1032,["onClick"])]),_:1}),l(s,{label:"\u5907\u6CE8\u540D\u79F0",align:"center",prop:"nickname"}),l(s,{label:"\u8BBE\u5907\u6240\u5C5E\u4EA7\u54C1",align:"center",prop:"productId"},{default:o(a=>[m(U(e.productMap[a.row.productId]),1)]),_:1}),l(s,{label:"\u8BBE\u5907\u7C7B\u578B",align:"center",prop:"deviceType"},{default:o(a=>[l(P,{type:e.DICT_TYPE.IOT_PRODUCT_DEVICE_TYPE,value:a.row.deviceType},null,8,["type","value"])]),_:1}),l(s,{label:"\u8BBE\u5907\u72B6\u6001",align:"center",prop:"status"},{default:o(a=>[l(P,{type:e.DICT_TYPE.IOT_DEVICE_STATUS,value:a.row.status},null,8,["type","value"])]),_:1}),l(s,{label:"\u6700\u540E\u4E0A\u7EBF\u65F6\u95F4",align:"center",prop:"lastOnlineTime",formatter:e.dateFormatter,width:"180px"},null,8,["formatter"]),l(s,{label:"\u64CD\u4F5C",align:"center","min-width":"120px"},{default:o(a=>[T((t(),c(n,{link:"",type:"primary",onClick:V=>e.openDetail(a.row.id)},{default:o(()=>r[11]||(r[11]=[m(" \u67E5\u770B ")])),_:2},1032,["onClick"])),[[u,["iot:product:query"]]]),T((t(),c(n,{link:"",type:"primary",onClick:V=>e.openForm("update",a.row.id)},{default:o(()=>r[12]||(r[12]=[m(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[u,["iot:device:update"]]]),T((t(),c(n,{link:"",type:"danger",onClick:V=>e.handleDelete(a.row.id)},{default:o(()=>r[13]||(r[13]=[m(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[u,["iot:device:delete"]]])]),_:1})]),_:1},8,["data"])),[[Y,e.loading]]),l(D,{total:e.total,page:e.queryParams.pageNo,"onUpdate:page":r[6]||(r[6]=a=>e.queryParams.pageNo=a),limit:e.queryParams.pageSize,"onUpdate:limit":r[7]||(r[7]=a=>e.queryParams.pageSize=a),onPagination:e.getList},null,8,["total","page","limit"])]),_:1}),l(e.DeviceForm,{ref:"formRef",onSuccess:e.getList},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/iot/device/index.vue"]]);export{de as default};
