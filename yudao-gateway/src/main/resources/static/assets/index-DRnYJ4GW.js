import{d as N,D,r as f,eF as J,b as k,eG as L,by as R,C as $,_ as j,o as g,c as b,k as l,j as t,w as n,m as w,t as _,F as S,n as T,q as F,an as P,Z as W,N as q,J as z,K as E,l as G}from"./index-BaY5TDP-.js";import{_ as K}from"./index-BAz6Gqim.js";import{f as Z}from"./formatTime-Dr6TiYYc.js";import{g as A}from"./index-CuAlllbQ.js";const B={class:"flex"},H={class:"flex items-center"},M={class:"flex"},Q={class:"max-h-80 overflow-auto"},X={class:"flex items-center"},Y=j(N({name:"InfraWebSocket",__name:"index",setup(C,{expose:e}){e();const i=D(),s=f("http://localhost:48080/infra/ws".replace("http","ws")+"?token="+J()),h=k(()=>x.value==="OPEN"),I=k(()=>h.value?"success":"red"),{status:x,data:r,send:c,close:m,open:p}=L(s.value,{autoReconnect:!0,heartbeat:!0}),o=f([]),y=k(()=>o.value.slice().reverse());R(()=>{if(r.value)try{if(r.value==="pong")return;const d=JSON.parse(r.value),v=d.type,u=JSON.parse(d.content);if(!v)return void i.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+r.value);if(v==="demo-message-receive")return void(u.single?o.value.push({text:`\u3010\u5355\u53D1\u3011\u7528\u6237\u7F16\u53F7(${u.fromUserId})\uFF1A${u.text}`,time:new Date().getTime()}):o.value.push({text:`\u3010\u7FA4\u53D1\u3011\u7528\u6237\u7F16\u53F7(${u.fromUserId})\uFF1A${u.text}`,time:new Date().getTime()}));if(v==="notice-push")return void o.value.push({text:`\u3010\u7CFB\u7EDF\u901A\u77E5\u3011\uFF1A${u.title}`,time:new Date().getTime()});i.error("\u672A\u5904\u7406\u6D88\u606F\uFF1A"+r.value)}catch(d){i.error("\u5904\u7406\u6D88\u606F\u53D1\u751F\u5F02\u5E38\uFF1A"+r.value),console.error(d)}});const a=f(""),O=f(""),U=f([]);$(async()=>{U.value=await A()});const V={message:i,server:s,getIsOpen:h,getTagColor:I,status:x,data:r,send:c,close:m,open:p,messageList:o,messageReverseList:y,sendText:a,sendUserId:O,handlerSend:()=>{const d=JSON.stringify({text:a.value,toUserId:O.value}),v=JSON.stringify({type:"demo-message-send",content:d});c(v),a.value=""},toggleConnectStatus:()=>{h.value?m():p()},userList:U,get formatDate(){return Z}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),[["render",function(C,e,i,s,h,I){const x=K,r=P,c=W,m=q,p=z,o=E,y=G;return g(),b(S,null,[l(x,{title:"WebSocket \u5B9E\u65F6\u901A\u4FE1",url:"https://doc.iocoder.cn/websocket/"}),t("div",B,[l(y,{gutter:12,class:"w-1/2",shadow:"always"},{header:n(()=>e[3]||(e[3]=[t("div",{class:"card-header"},[t("span",null,"\u8FDE\u63A5")],-1)])),default:n(()=>[t("div",H,[e[4]||(e[4]=t("span",{class:"mr-4 text-lg font-medium"}," \u8FDE\u63A5\u72B6\u6001: ",-1)),l(r,{color:s.getTagColor},{default:n(()=>[w(_(s.status),1)]),_:1},8,["color"])]),e[7]||(e[7]=t("hr",{class:"my-4"},null,-1)),t("div",M,[l(c,{modelValue:s.server,"onUpdate:modelValue":e[0]||(e[0]=a=>s.server=a),disabled:""},{prepend:n(()=>e[5]||(e[5]=[w("\u670D\u52A1\u5730\u5740")])),_:1},8,["modelValue"]),l(m,{type:s.getIsOpen?"danger":"primary",onClick:s.toggleConnectStatus},{default:n(()=>[w(_(s.getIsOpen?"\u5173\u95ED\u8FDE\u63A5":"\u5F00\u542F\u8FDE\u63A5"),1)]),_:1},8,["type"])]),e[8]||(e[8]=t("p",{class:"mt-4 text-lg font-medium"},"\u6D88\u606F\u8F93\u5165\u6846",-1)),e[9]||(e[9]=t("hr",{class:"my-4"},null,-1)),l(c,{modelValue:s.sendText,"onUpdate:modelValue":e[1]||(e[1]=a=>s.sendText=a),autosize:{minRows:2,maxRows:4},disabled:!s.getIsOpen,clearable:"",placeholder:"\u8BF7\u8F93\u5165\u4F60\u8981\u53D1\u9001\u7684\u6D88\u606F",type:"textarea"},null,8,["modelValue","disabled"]),l(o,{modelValue:s.sendUserId,"onUpdate:modelValue":e[2]||(e[2]=a=>s.sendUserId=a),class:"mt-4",placeholder:"\u8BF7\u9009\u62E9\u53D1\u9001\u4EBA"},{default:n(()=>[l(p,{key:"",label:"\u6240\u6709\u4EBA",value:""}),(g(!0),b(S,null,T(s.userList,a=>(g(),F(p,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(m,{disabled:!s.getIsOpen,block:"",class:"ml-2 mt-4",type:"primary",onClick:s.handlerSend},{default:n(()=>e[6]||(e[6]=[w(" \u53D1\u9001 ")])),_:1},8,["disabled"])]),_:1}),l(y,{gutter:12,class:"w-1/2",shadow:"always"},{header:n(()=>e[10]||(e[10]=[t("div",{class:"card-header"},[t("span",null,"\u6D88\u606F\u8BB0\u5F55")],-1)])),default:n(()=>[t("div",Q,[t("ul",null,[(g(!0),b(S,null,T(s.messageReverseList,a=>(g(),b("li",{key:a.time,class:"mt-2"},[t("div",X,[e[11]||(e[11]=t("span",{class:"text-primary mr-2 font-medium"},"\u6536\u5230\u6D88\u606F:",-1)),t("span",null,_(s.formatDate(a.time)),1)]),t("div",null,_(a.text),1)]))),128))])])]),_:1})])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/infra/webSocket/index.vue"]]);export{Y as default};
