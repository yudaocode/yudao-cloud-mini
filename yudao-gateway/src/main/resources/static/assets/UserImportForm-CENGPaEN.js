import{_ as F}from"./Dialog-CZSXtzfQ.js";import{d as S,D as V,r as d,ao as L,ee as k,df as w,_ as E,o as j,q as z,w as i,k as m,m as f,j as v,z as C,ai as I,y as H,bx as O,N as R}from"./index-BaY5TDP-.js";import{i as T}from"./index-CuAlllbQ.js";import{d as q}from"./download-oWiM5xVU.js";const A={class:"el-upload__tip text-center"},B={class:"el-upload__tip"},D=E(S({name:"SystemUserImportForm",__name:"UserImportForm",emits:["success"],setup(h,{expose:a,emit:U}){const e=V(),b=d(!1),o=d(!1),n=d(),_=d(),p=d([]),x=d(0),c=()=>{b.value=!0,x.value=0,p.value=[],t()};a({open:c});const g=U,t=async()=>{var r;o.value=!1,await L(),(r=n.value)==null||r.clearFiles()},y={message:e,dialogVisible:b,formLoading:o,uploadRef:n,importUrl:"http://localhost:48080/admin-api/system/user/import",uploadHeaders:_,fileList:p,updateSupport:x,open:c,submitForm:async()=>{p.value.length!=0?(_.value={Authorization:"Bearer "+k(),"tenant-id":w()},o.value=!0,n.value.submit()):e.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},emits:g,submitFormSuccess:r=>{if(r.code!==0)return e.error(r.msg),void(o.value=!1);const s=r.data;let l="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+s.createUsernames.length+";";for(let u of s.createUsernames)l+="< "+u+" >";l+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+s.updateUsernames.length+";";for(const u of s.updateUsernames)l+="< "+u+" >";l+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(s.failureUsernames).length+";";for(const u in s.failureUsernames)l+="< "+u+": "+s.failureUsernames[u]+" >";e.alert(l),o.value=!1,b.value=!1,g("success")},submitFormError:()=>{e.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),o.value=!1},resetForm:t,handleExceed:()=>{e.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},importTemplate:async()=>{const r=await T();q.excel(r,"\u7528\u6237\u5BFC\u5165\u6A21\u7248.xls")}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(h,a,U,e,b,o){const n=C,_=I,p=H,x=O,c=R,g=F;return j(),z(g,{modelValue:e.dialogVisible,"onUpdate:modelValue":a[3]||(a[3]=t=>e.dialogVisible=t),title:"\u7528\u6237\u5BFC\u5165",width:"400"},{footer:i(()=>[m(c,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:i(()=>a[8]||(a[8]=[f("\u786E \u5B9A")])),_:1},8,["disabled"]),m(c,{onClick:a[2]||(a[2]=t=>e.dialogVisible=!1)},{default:i(()=>a[9]||(a[9]=[f("\u53D6 \u6D88")])),_:1})]),default:i(()=>[m(x,{ref:"uploadRef","file-list":e.fileList,"onUpdate:fileList":a[1]||(a[1]=t=>e.fileList=t),action:e.importUrl+"?updateSupport="+e.updateSupport,"auto-upload":!1,disabled:e.formLoading,headers:e.uploadHeaders,limit:1,"on-error":e.submitFormError,"on-exceed":e.handleExceed,"on-success":e.submitFormSuccess,accept:".xlsx, .xls",drag:""},{tip:i(()=>[v("div",A,[v("div",B,[m(_,{modelValue:e.updateSupport,"onUpdate:modelValue":a[0]||(a[0]=t=>e.updateSupport=t)},null,8,["modelValue"]),a[4]||(a[4]=f(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u7528\u6237\u6570\u636E "))]),a[6]||(a[6]=v("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),m(p,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:e.importTemplate},{default:i(()=>a[5]||(a[5]=[f(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:i(()=>[m(n,{icon:"ep:upload"}),a[7]||(a[7]=v("div",{class:"el-upload__text"},[f("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),v("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","action","disabled","headers"])]),_:1},8,["modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/system/user/UserImportForm.vue"]]);export{D as default};
