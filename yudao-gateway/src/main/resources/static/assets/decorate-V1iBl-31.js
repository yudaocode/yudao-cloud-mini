import{P as k,_ as C}from"./util-BzwZ6A7L.js";import{d as L,r,f as M,u as $,C as j,a as y,D as z,aH as K,aI as w,_ as Y,q as E,w as h,ah as q,o as b,k as D,c as A,n as B,F as G,z as H,aJ as J,aK as N,al as O}from"./index-BaY5TDP-.js";import{g as X,u as Q}from"./template-xqRkEjeZ.js";import{u as U}from"./page-CKNh-pyA.js";import{u as W}from"./tagsView-lnAkwTv2.js";import"./Dialog-CZSXtzfQ.js";import"./Qrcode-BuuBon-h.js";import"./IFrame-CDjjLq2Y.js";import"./vuedraggable.umd-CVSuxhJW.js";const I="diy_page_index",Z=Y(L({name:"DiyTemplateDecorate",__name:"decorate",setup(V,{expose:v}){v();const i=r(0),e=M([{name:"\u57FA\u7840\u8BBE\u7F6E",icon:"ep:iphone"},{name:"\u9996\u9875",icon:"ep:home-filled"},{name:"\u6211\u7684",icon:"ep:user-filled"}]),c=z(),m=r(!1),s=r(),d=r(),o=r({property:""}),l=r(new Map),f=r(""),n=async a=>{m.value=!0;try{s.value=await X(a);const t="http://localhost:3000";f.value=`${t}/#/pages/index/index?templateId=${s.value.id}`}finally{m.value=!1}},u=[],_=r(u),T=a=>{l.value.set(e[i.value].name,o.value);const t=l.value.get(e[a].name);if(i.value=a,a===0)return _.value=u,void(o.value=w(t)?s.value:t);_.value=k,o.value=w(t)?s.value.pages.find(p=>p.name===e[a].name):t},F=()=>{var a;s.value={id:void 0,name:"",used:!1,usedTime:void 0,remark:"",previewPicUrls:[],property:"",pages:[]},(a=d.value)==null||a.resetFields()},x=()=>sessionStorage.setItem(I,`${i.value}`),P=()=>{const a=K(sessionStorage.getItem(I))||0;sessionStorage.removeItem(I),o.value=s.value,l.value=new Map,a!==i.value&&T(a)},{currentRoute:g}=$(),{delView:R}=W();j(async()=>{if(F(),!g.value.params.id)return c.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u9875\u9762\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void R(y(g));await n(g.value.params.id),P()});const S={selectedTemplateItem:i,templateItems:e,message:c,formLoading:m,formData:s,formRef:d,currentFormData:o,currentFormDataMap:l,previewUrl:f,getPageDetail:n,templateLibs:u,libs:_,handleTemplateItemChange:T,submitForm:async()=>{var a;if(d){m.value=!0;try{for(let t=0;t<e.length;t++){const p=l.value.get(e[t].name);t!==0?(a=o.value)!=null&&a.name.includes(e[t].name)?await U(y(o)):w(p)||await U(p):await Q(w(p)?y(s):p)}c.success("\u4FDD\u5B58\u6210\u529F")}finally{m.value=!1}}},resetForm:F,handleEditorReset:()=>x(),DIY_PAGE_INDEX_KEY:I,storePageIndex:x,recoverPageIndex:P,currentRoute:g,delView:R};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),[["render",function(V,v,i,e,c,m){const s=H,d=J,o=N,l=O,f=C;return e.formData&&!e.formLoading?(b(),E(f,{key:0,modelValue:e.currentFormData.property,"onUpdate:modelValue":v[0]||(v[0]=n=>e.currentFormData.property=n),libs:e.libs,"preview-url":e.previewUrl,"show-navigation-bar":e.selectedTemplateItem!==0,"show-page-config":e.selectedTemplateItem!==0,"show-tab-bar":e.selectedTemplateItem===0,title:e.templateItems[e.selectedTemplateItem].name,onReset:e.handleEditorReset,onSave:e.submitForm},{toolBarLeft:h(()=>[D(l,{"model-value":e.selectedTemplateItem,class:"h-full!",onChange:e.handleTemplateItemChange},{default:h(()=>[(b(!0),A(G,null,B(e.templateItems,(n,u)=>(b(),E(o,{key:u,content:n.name},{default:h(()=>[D(d,{value:u},{default:h(()=>[D(s,{icon:n.icon,size:24},null,8,["icon"])]),_:2},1032,["value"])]),_:2},1032,["content"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","libs","preview-url","show-navigation-bar","show-page-config","show-tab-bar","title"])):q("",!0)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/diy/template/decorate.vue"]]);export{Z as default};
