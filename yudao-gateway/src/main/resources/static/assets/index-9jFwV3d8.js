import{d as M,r as n,u as O,S as D,C as B,D as P,a as w,_ as I,X as $,c as x,k as i,w as t,F as V,v as j,o as c,I as H,q as f,m as v,ah as y,N as W,A,B as Q}from"./index-BaY5TDP-.js";import{g as q,_ as N}from"./index-fxekK-Kb.js";import{u as X}from"./tagsView-lnAkwTv2.js";import{a as G,u as J,l as S,r as K,p as Y}from"./index-h6ObHKtQ.js";import Z from"./CustomerForm-DOq9M5tL.js";import ee from"./CustomerDetailsInfo-C091mmyY.js";import ie from"./CustomerDetailsHeader-CV4gbuuY.js";import te from"./ContactList-CEDaV3Z_.js";import ae from"./ContractList-C_ljtvzC.js";import re from"./BusinessList-Dr19N1lh.js";import oe from"./ReceivableList-u7g8SwvX.js";import le from"./ReceivablePlanList-gsz63rbx.js";import me from"./PermissionList-CbQig5nT.js";import ue from"./TransferForm-nV8fyRSP.js";import se from"./index-CI2uGAAL.js";import{B as T}from"./index-BlslFSYd.js";import ne from"./CustomerDistributeForm-DSJMK_DW.js";import"./el-timeline-item-BFYwlQ-d.js";import"./formatTime-Dr6TiYYc.js";import"./Dialog-CZSXtzfQ.js";import"./index-Qzz5HSIB.js";import"./tree-z7HkrWVC.js";import"./index-CuAlllbQ.js";import"./ContentWrap-DKQn7kZm.js";import"./el-descriptions-item-CRF_CO88.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-DiJG1eDb.js";import"./ContactForm-DLuG_ZcF.js";import"./ContactListModal-DsE0FODx.js";import"./index-B97LdofC.js";import"./ContractForm-DyS_nB0a.js";import"./index-6-r4wYJE.js";import"./ContractProductForm--_dghpLm.js";import"./index-D4G-Yxr7.js";import"./BusinessForm-DKlvsT4o.js";import"./index-n6shePIl.js";import"./BusinessProductForm-FoZjzksq.js";import"./BusinessListModal-6XoY13Ne.js";import"./index-DcQDDeHJ.js";import"./ReceivableForm-C0pIMqYw.js";import"./index-ndAUlMgd.js";import"./ReceivablePlanForm-CXCxBqXI.js";import"./PermissionForm-jo-CjsNU.js";import"./index-C4zjco0X.js";import"./FollowUpRecordForm-C2CG18-w.js";import"./FollowUpRecordBusinessForm-B1oFy6Z2.js";import"./FollowUpRecordContactForm-BevYD0eZ.js";const ce=I(M({name:"CrmCustomerDetail",__name:"index",setup(E,{expose:a}){a();const o=n(0),e=n(!0),l=P(),{delView:k}=X(),{push:u,currentRoute:s}=O(),U=n(),m=n({}),p=async()=>{e.value=!0;try{m.value=await G(o.value),await z()}finally{e.value=!1}},L=n(),d=n(),C=n(),R=n([]),z=async()=>{if(!o.value)return;const r=await q({bizType:T.CRM_CUSTOMER,bizId:o.value});R.value=r.list},_=n(),b=()=>{k(w(s)),u({name:"CrmCustomer"})},{params:h}=D();B(()=>{if(!h.id)return l.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void b();o.value=h.id,p()});const g={customerId:o,loading:e,message:l,delView:k,push:u,currentRoute:s,permissionListRef:U,customer:m,getCustomer:p,formRef:L,openForm:()=>{var r;(r=L.value)==null||r.open("update",o.value)},handleUpdateDealStatus:async()=>{const r=!m.value.dealStatus;try{await l.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${r?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await J(o.value,r),l.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await p()}catch{}},transferFormRef:d,transfer:()=>{var r;(r=d.value)==null||r.open(o.value)},handleLock:async()=>{await l.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${m.value.name}\u3011 \u5417\uFF1F`),await S(w(o.value),!0),l.success(`\u9501\u5B9A\u5BA2\u6237\u3010${m.value.name}\u3011\u6210\u529F`),await p()},handleUnlock:async()=>{await l.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${m.value.name}\u3011 \u5417\uFF1F`),await S(w(o.value),!1),l.success(`\u89E3\u9501\u5BA2\u6237\u3010${m.value.name}\u3011\u6210\u529F`),await p()},handleReceive:async()=>{await l.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${m.value.name}\u3011 \u5417\uFF1F`),await K([w(o.value)]),l.success(`\u9886\u53D6\u5BA2\u6237\u3010${m.value.name}\u3011\u6210\u529F`),await p()},distributeForm:C,handleDistributeForm:async()=>{var r;(r=C.value)==null||r.open(o.value)},handlePutPool:async()=>{await l.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${m.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await Y(w(o.value)),l.success(`\u5BA2\u6237\u3010${m.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),b()},logList:R,getOperateLog:z,receivableListRef:_,createReceivable:r=>{var F;(F=_.value)==null||F.createReceivable(r)},close:b,params:h,CustomerForm:Z,CustomerDetailsInfo:ee,CustomerDetailsHeader:ie,ContactList:te,ContractList:ae,BusinessList:re,ReceivableList:oe,ReceivablePlanList:le,PermissionList:me,CrmTransferForm:ue,FollowUpList:se,get BizTypeEnum(){return T},CustomerDistributeForm:ne};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),[["render",function(E,a,o,e,l,k){const u=W,s=A,U=N,m=Q,p=j,L=$("hasPermi");return c(),x(V,null,[i(e.CustomerDetailsHeader,{customer:e.customer,loading:e.loading},{default:t(()=>{var d,C,R,z,_,b;return[(d=e.permissionListRef)!=null&&d.validateWrite?H((c(),f(u,{key:0,type:"primary",onClick:e.openForm},{default:t(()=>a[0]||(a[0]=[v(" \u7F16\u8F91 ")])),_:1})),[[L,["crm:customer:update"]]]):y("",!0),(C=e.permissionListRef)!=null&&C.validateOwnerUser?(c(),f(u,{key:1,type:"primary",onClick:e.transfer},{default:t(()=>a[1]||(a[1]=[v(" \u8F6C\u79FB ")])),_:1})):y("",!0),(R=e.permissionListRef)!=null&&R.validateWrite?(c(),f(u,{key:2,onClick:e.handleUpdateDealStatus},{default:t(()=>a[2]||(a[2]=[v(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")])),_:1})):y("",!0),e.customer.lockStatus&&((z=e.permissionListRef)!=null&&z.validateOwnerUser)?(c(),f(u,{key:3,onClick:e.handleUnlock},{default:t(()=>a[3]||(a[3]=[v(" \u89E3\u9501 ")])),_:1})):y("",!0),!e.customer.lockStatus&&((_=e.permissionListRef)!=null&&_.validateOwnerUser)?(c(),f(u,{key:4,onClick:e.handleLock},{default:t(()=>a[4]||(a[4]=[v(" \u9501\u5B9A ")])),_:1})):y("",!0),e.customer.ownerUserId?y("",!0):(c(),f(u,{key:5,type:"primary",onClick:e.handleReceive},{default:t(()=>a[5]||(a[5]=[v(" \u9886\u53D6")])),_:1})),e.customer.ownerUserId?y("",!0):(c(),f(u,{key:6,type:"primary",onClick:e.handleDistributeForm},{default:t(()=>a[6]||(a[6]=[v(" \u5206\u914D ")])),_:1})),e.customer.ownerUserId&&((b=e.permissionListRef)!=null&&b.validateOwnerUser)?(c(),f(u,{key:7,onClick:e.handlePutPool},{default:t(()=>a[7]||(a[7]=[v(" \u653E\u5165\u516C\u6D77 ")])),_:1})):y("",!0)]}),_:1},8,["customer","loading"]),i(p,null,{default:t(()=>[i(m,null,{default:t(()=>[i(s,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(e.FollowUpList,{"biz-id":e.customerId,"biz-type":e.BizTypeEnum.CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(s,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(e.CustomerDetailsInfo,{customer:e.customer},null,8,["customer"])]),_:1}),i(s,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(e.ContactList,{"biz-id":e.customer.id,"biz-type":e.BizTypeEnum.CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(s,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var d;return[i(e.PermissionList,{ref:"permissionListRef","biz-id":e.customer.id,"biz-type":e.BizTypeEnum.CRM_CUSTOMER,"show-action":!((d=e.permissionListRef)!=null&&d.isPool)||!1,onQuitTeam:e.close},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(s,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(e.BusinessList,{"biz-id":e.customer.id,"biz-type":e.BizTypeEnum.CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(s,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(e.ContractList,{"biz-id":e.customer.id,"biz-type":e.BizTypeEnum.CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(s,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(e.ReceivablePlanList,{"customer-id":e.customer.id,onCreateReceivable:e.createReceivable},null,8,["customer-id"]),i(e.ReceivableList,{ref:"receivableListRef","customer-id":e.customer.id},null,8,["customer-id"])]),_:1}),i(s,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(U,{"log-list":e.logList},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(e.CustomerForm,{ref:"formRef",onSuccess:e.getCustomer},null,512),i(e.CustomerDistributeForm,{ref:"distributeForm",onSuccess:e.getCustomer},null,512),i(e.CrmTransferForm,{ref:"transferFormRef","biz-type":e.BizTypeEnum.CRM_CUSTOMER,onSuccess:e.close},null,8,["biz-type"])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/customer/detail/index.vue"]]);export{ce as default};
