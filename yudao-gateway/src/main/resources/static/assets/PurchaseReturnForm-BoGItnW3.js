import{d as q,g as A,D as j,r as s,f as z,b as Z,au as B,e3 as J,e4 as K,_ as M,o as n,c as k,k as l,w as t,q as w,m as T,ah as W,I as G,F as N,n as x,Z as Q,L as H,v as X,M as Y,z as $,N as ee,J as ae,K as le,cq as te,E as oe,A as re,B as ue,cf as de,O as ie,R as se}from"./index-BaY5TDP-.js";import{_ as me}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{P as O}from"./index-AOA5K4qa.js";import ce from"./PurchaseReturnItemForm-D-Q4j5iz.js";import{S as pe}from"./index-C5eeu8k9.js";import{A as fe}from"./index-hc6npfaY.js";import be from"./PurchaseOrderReturnEnableList-D56RHXAg.js";import{g as ve}from"./index-CuAlllbQ.js";import"./index-DMn3OXs3.js";import"./index-B0TWi7A6.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-BvnoQ9hD.js";import"./formatTime-Dr6TiYYc.js";import"./index-CJwxK5Qx.js";const Pe=M(q({name:"PurchaseReturnForm",__name:"PurchaseReturnForm",emits:["success"],setup(C,{expose:o,emit:S}){const{t:a}=A(),h=j(),V=s(!1),m=s(""),r=s(!1),d=s(""),u=s({id:void 0,supplierId:void 0,accountId:void 0,returnTime:void 0,remark:void 0,fileUrl:"",discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,orderNo:void 0,items:[],no:void 0}),y=z({supplierId:[{required:!0,message:"\u4F9B\u5E94\u5546\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u9000\u8D27\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),p=Z(()=>d.value==="detail"),c=s(),f=s([]),b=s([]),v=s([]),L=s("item"),g=s();B(()=>u.value,e=>{if(!e)return;const i=e.items.reduce((F,E)=>F+E.totalPrice,0),_=e.discountPercent!=null?J(i,e.discountPercent/100):0;u.value.discountPrice=_,u.value.totalPrice=i-_+e.otherPrice},{deep:!0});const D=async(e,i)=>{if(V.value=!0,m.value=a("action."+e),d.value=e,R(),i){r.value=!0;try{u.value=await O.getPurchaseReturn(i)}finally{r.value=!1}}f.value=await pe.getSupplierSimpleList(),v.value=await ve(),b.value=await fe.getAccountSimpleList();const _=b.value.find(F=>F.defaultStatus);_&&(u.value.accountId=_.id)};o({open:D});const P=s(),I=S,R=()=>{var e;u.value={id:void 0,supplierId:void 0,accountId:void 0,returnTime:void 0,remark:void 0,fileUrl:void 0,discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,items:[]},(e=c.value)==null||e.resetFields()},U={t:a,message:h,dialogVisible:V,dialogTitle:m,formLoading:r,formType:d,formData:u,formRules:y,disabled:p,formRef:c,supplierList:f,accountList:b,userList:v,subTabsName:L,itemFormRef:g,open:D,purchaseOrderReturnEnableListRef:P,openPurchaseOrderReturnEnableList:()=>{P.value.open()},handlePurchaseOrderChange:e=>{u.value.orderId=e.id,u.value.orderNo=e.no,u.value.supplierId=e.supplierId,u.value.accountId=e.accountId,u.value.discountPercent=e.discountPercent,u.value.remark=e.remark,u.value.fileUrl=e.fileUrl,e.items.forEach(i=>{i.count=i.inCount-i.returnCount,i.orderItemId=i.id,i.id=void 0}),u.value.items=e.items.filter(i=>i.count>0)},emit:I,submitForm:async()=>{await c.value.validate(),await g.value.validate(),r.value=!0;try{const e=u.value;d.value==="create"?(await O.createPurchaseReturn(e),h.success(a("common.createSuccess"))):(await O.updatePurchaseReturn(e),h.success(a("common.updateSuccess"))),V.value=!1,I("success")}finally{r.value=!1}},resetForm:R,PurchaseReturnItemForm:ce,get erpPriceInputFormatter(){return K},PurchaseOrderReturnEnableList:be};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),[["render",function(C,o,S,a,h,V){const m=Q,r=H,d=X,u=Y,y=$,p=ee,c=ae,f=le,b=te,v=oe,L=re,g=ue,D=ne,P=de,I=ie,R=me,U=se;return n(),k(N,null,[l(R,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":o[13]||(o[13]=e=>a.dialogVisible=e),width:"1440"},{footer:t(()=>[a.disabled?W("",!0):(n(),w(p,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:t(()=>o[15]||(o[15]=[T(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(p,{onClick:o[12]||(o[12]=e=>a.dialogVisible=!1)},{default:t(()=>o[16]||(o[16]=[T("\u53D6 \u6D88")])),_:1})]),default:t(()=>[G((n(),w(I,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:t(()=>[l(v,{gutter:20},{default:t(()=>[l(d,{span:8},{default:t(()=>[l(r,{label:"\u9000\u8D27\u5355\u53F7",prop:"no"},{default:t(()=>[l(m,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":o[0]||(o[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u9000\u8D27\u65F6\u95F4",prop:"returnTime"},{default:t(()=>[l(u,{modelValue:a.formData.returnTime,"onUpdate:modelValue":o[1]||(o[1]=e=>a.formData.returnTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9000\u8D27\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u5173\u8054\u8BA2\u5355",prop:"orderNo"},{default:t(()=>[l(m,{modelValue:a.formData.orderNo,"onUpdate:modelValue":o[2]||(o[2]=e=>a.formData.orderNo=e),readonly:""},{append:t(()=>[l(p,{onClick:a.openPurchaseOrderReturnEnableList},{default:t(()=>[l(y,{icon:"ep:search"}),o[14]||(o[14]=T(" \u9009\u62E9 "))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u4F9B\u5E94\u5546",prop:"supplierId"},{default:t(()=>[l(f,{modelValue:a.formData.supplierId,"onUpdate:modelValue":o[3]||(o[3]=e=>a.formData.supplierId=e),clearable:"",filterable:"",disabled:"",placeholder:"\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546",class:"!w-1/1"},{default:t(()=>[(n(!0),k(N,null,x(a.supplierList,e=>(n(),w(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:16},{default:t(()=>[l(r,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[l(m,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":o[4]||(o[4]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:t(()=>[l(b,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":o[5]||(o[5]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(D,null,{default:t(()=>[l(g,{modelValue:a.subTabsName,"onUpdate:modelValue":o[6]||(o[6]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:t(()=>[l(L,{label:"\u9000\u8D27\u4EA7\u54C1\u6E05\u5355",name:"item"},{default:t(()=>[l(a.PurchaseReturnItemForm,{ref:"itemFormRef",items:a.formData.items,disabled:a.disabled},null,8,["items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{gutter:20},{default:t(()=>[l(d,{span:8},{default:t(()=>[l(r,{label:"\u4F18\u60E0\u7387\uFF08%\uFF09",prop:"discountPercent"},{default:t(()=>[l(P,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":o[7]||(o[7]=e=>a.formData.discountPercent=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u7387",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u9000\u6B3E\u4F18\u60E0",prop:"discountPrice"},{default:t(()=>[l(m,{disabled:"",modelValue:a.formData.discountPrice,"onUpdate:modelValue":o[8]||(o[8]=e=>a.formData.discountPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u4F18\u60E0\u540E\u91D1\u989D"},{default:t(()=>[l(m,{disabled:"","model-value":a.formData.totalPrice-a.formData.otherPrice,formatter:a.erpPriceInputFormatter},null,8,["model-value","formatter"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u5176\u5B83\u8D39\u7528",prop:"otherPrice"},{default:t(()=>[l(P,{modelValue:a.formData.otherPrice,"onUpdate:modelValue":o[9]||(o[9]=e=>a.formData.otherPrice=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u5176\u5B83\u8D39\u7528",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u7ED3\u7B97\u8D26\u6237",prop:"accountId"},{default:t(()=>[l(f,{modelValue:a.formData.accountId,"onUpdate:modelValue":o[10]||(o[10]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:t(()=>[(n(!0),k(N,null,x(a.accountList,e=>(n(),w(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:t(()=>[l(r,{label:"\u5E94\u9000\u91D1\u989D",prop:"totalPrice"},{default:t(()=>[l(m,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":o[11]||(o[11]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[U,a.formLoading]])]),_:1},8,["title","modelValue"]),l(a.PurchaseOrderReturnEnableList,{ref:"purchaseOrderReturnEnableListRef",onSuccess:a.handlePurchaseOrderChange},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/purchase/return/PurchaseReturnForm.vue"]]);export{Pe as default};
