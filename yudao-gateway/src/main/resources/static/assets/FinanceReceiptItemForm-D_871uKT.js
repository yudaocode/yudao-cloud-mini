import{d as L,D as I,r as b,f as U,au as k,e4 as x,ew as z,_ as F,o as S,c as N,I as A,q as v,w as l,k as e,m as V,ah as D,F as q,P as $,Z as j,L as C,cf as T,N as B,Q,O as Z,E as G,R as H}from"./index-BaY5TDP-.js";import J from"./SaleOutReceiptEnableList-jeIDbYxe.js";import K from"./SaleReturnRefundEnableList-BTGkn4MA.js";import{E}from"./constants-CEEr2azc.js";import"./Dialog-CZSXtzfQ.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./ContentWrap-DKQn7kZm.js";import"./formatTime-Dr6TiYYc.js";import"./index-CJwxK5Qx.js";import"./index-CcVF-M2f.js";import"./index-BCNlL1Hh.js";const M=F(L({__name:"FinanceReceiptItemForm",props:{items:{type:null,required:!0},customerId:{type:null,required:!0},disabled:{type:Boolean,required:!0}},setup(g,{expose:u}){const d=g,a=I(),w=b(!1),c=b([]),n=U({receiptPrice:[{required:!0,message:"\u672C\u6B21\u6536\u6B3E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),s=b([]),p=b([]);k(()=>d.items,async o=>{c.value=o},{immediate:!0});const h=b(),m=b(),P=()=>s.value.validate();u({validate:P});const R={props:d,message:a,formLoading:w,formData:c,formRules:n,formRef:s,productList:p,getSummaries:o=>{const{columns:r,data:t}=o,i=[];return r.forEach((f,_)=>{if(_!==0)if(["totalPrice","receiptedPrice","receiptPrice"].includes(f.property)){const O=z(t.map(y=>Number(y[f.property])));i[_]=x(O)}else i[_]="";else i[_]="\u5408\u8BA1"}),i},saleOutReceiptEnableListRef:h,handleOpenSaleOut:()=>{d.customerId?h.value.open(d.customerId):a.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},handleAddSaleOut:o=>{o.forEach(r=>{c.value.push({bizId:r.id,bizType:E.SALE_OUT,bizNo:r.no,totalPrice:r.totalPrice,receiptedPrice:r.receiptPrice,receiptPrice:r.totalPrice-r.receiptPrice})})},saleReturnRefundEnableListRef:m,handleOpenSaleReturn:()=>{d.customerId?m.value.open(d.customerId):a.error("\u8BF7\u9009\u62E9\u5BA2\u6237")},handleAddSaleReturn:o=>{o.forEach(r=>{c.value.push({bizId:r.id,bizType:E.SALE_RETURN,bizNo:r.no,totalPrice:-r.totalPrice,receiptedPrice:-r.refundPrice,receiptPrice:-r.totalPrice+r.refundPrice})})},handleDelete:o=>{c.value.splice(o,1)},validate:P,get erpPriceInputFormatter(){return x},SaleOutReceiptEnableList:J,SaleReturnRefundEnableList:K};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),[["render",function(g,u,d,a,w,c){const n=$,s=j,p=C,h=T,m=B,P=Q,R=Z,o=G,r=H;return S(),N(q,null,[A((S(),v(R,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"0px","inline-message":!0,disabled:d.disabled},{default:l(()=>[e(P,{data:a.formData,"show-summary":"","summary-method":a.getSummaries,class:"-mt-10px"},{default:l(()=>[e(n,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(n,{label:"\u9500\u552E\u5355\u636E\u7F16\u53F7","min-width":"200"},{default:l(({row:t})=>[e(p,{class:"mb-0px!"},{default:l(()=>[e(s,{disabled:"",modelValue:t.bizNo,"onUpdate:modelValue":i=>t.bizNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(n,{label:"\u5E94\u4ED8\u91D1\u989D",prop:"totalPrice",fixed:"right","min-width":"100"},{default:l(({row:t})=>[e(p,{class:"mb-0px!"},{default:l(()=>[e(s,{disabled:"",modelValue:t.totalPrice,"onUpdate:modelValue":i=>t.totalPrice=i,formatter:a.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(n,{label:"\u5DF2\u4ED8\u91D1\u989D",prop:"receiptedPrice",fixed:"right","min-width":"100"},{default:l(({row:t})=>[e(p,{class:"mb-0px!"},{default:l(()=>[e(s,{disabled:"",modelValue:t.receiptedPrice,"onUpdate:modelValue":i=>t.receiptedPrice=i,formatter:a.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(n,{label:"\u672C\u6B21\u6536\u6B3E",prop:"receiptPrice",fixed:"right","min-width":"115"},{default:l(({row:t,$index:i})=>[e(p,{prop:`${i}.receiptPrice`,class:"mb-0px!"},{default:l(()=>[e(h,{modelValue:t.receiptPrice,"onUpdate:modelValue":f=>t.receiptPrice=f,"controls-position":"right",precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(n,{label:"\u5907\u6CE8","min-width":"150"},{default:l(({row:t,$index:i})=>[e(p,{prop:`${i}.remark`,class:"mb-0px!"},{default:l(()=>[e(s,{modelValue:t.remark,"onUpdate:modelValue":f=>t.remark=f,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(n,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:l(({$index:t})=>[e(m,{onClick:i=>a.handleDelete(t),link:""},{default:l(()=>u[0]||(u[0]=[V("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[r,a.formLoading]]),d.disabled?D("",!0):(S(),v(o,{key:0,justify:"center",class:"mt-3"},{default:l(()=>[e(m,{onClick:a.handleOpenSaleOut,round:""},{default:l(()=>u[1]||(u[1]=[V("+ \u6DFB\u52A0\u9500\u552E\u51FA\u5E93\u5355")])),_:1}),e(m,{onClick:a.handleOpenSaleReturn,round:""},{default:l(()=>u[2]||(u[2]=[V("+ \u6DFB\u52A0\u9500\u552E\u9000\u8D27\u5355")])),_:1})]),_:1})),e(a.SaleOutReceiptEnableList,{ref:"saleOutReceiptEnableListRef",onSuccess:a.handleAddSaleOut},null,512),e(a.SaleReturnRefundEnableList,{ref:"saleReturnRefundEnableListRef",onSuccess:a.handleAddSaleReturn},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/finance/receipt/components/FinanceReceiptItemForm.vue"]]);export{M as default};
