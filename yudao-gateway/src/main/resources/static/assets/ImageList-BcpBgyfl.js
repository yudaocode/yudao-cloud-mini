import{d as O,D as x,u as E,f as U,r as l,C as z,bu as A,ad as T,_ as G,o as w,c as b,k as p,w as h,m as j,j as R,F as q,n as V,q as F,N as H,l as W}from"./index-BaY5TDP-.js";import{_ as J}from"./index-avjYFQiD.js";import{I}from"./index-BRp175ra.js";import K from"./ImageDetail-DOydnXCr.js";import Q from"./ImageCard-uC7KJqPl.js";import{A as B}from"./constants-BXWrMvZH.js";import{d as X}from"./download-oWiM5xVU.js";import"./index-DrSdAlug.js";import"./el-drawer-r3cMvY4i.js";import"./el-image-Bg-CwbDE.js";const Y={class:"task-image-list",ref:"imageListRef"},Z={class:"task-image-pagination"},$=G(O({__name:"ImageList",emits:["onRegeneration"],setup(M,{expose:t,emit:k}){const a=x(),v=E(),y=U({pageNo:1,pageSize:10}),d=l(0),o=l([]),r=l(),i=l(),g=l({}),c=l(),f=l(!1),P=l(0),_=async()=>{f.value=!0},u=async()=>{try{r.value=T.service({target:i.value,text:"\u52A0\u8F7D\u4E2D..."});const{list:e,total:s}=await I.getImagePageMy(y);o.value=e,d.value=s;const m={};o.value.forEach(n=>{n.status===B.IN_PROGRESS&&(m[n.id]=n)}),g.value=m}finally{r.value&&(r.value.close(),r.value=null)}},C=async()=>{const e=Object.keys(g.value).map(Number);if(e.length==0)return;const s=await I.getImageListMyByIds(e),m={};s.forEach(n=>{if(n.status===B.IN_PROGRESS)m[n.id]=n;else{const D=o.value.findIndex(N=>n.id===N.id);D>=0&&(o.value[D]=n)}}),g.value=m};t({getImageList:u});const L=k;z(async()=>{await u(),c.value=setInterval(async()=>{await C()},3e3)}),A(async()=>{c.value&&clearInterval(c.value)});const S={message:a,router:v,queryParams:y,pageTotal:d,imageList:o,imageListLoadingInstance:r,imageListRef:i,inProgressImageMap:g,inProgressTimer:c,isShowImageDetail:f,showImageDetailId:P,handleViewPublic:()=>{v.push({name:"AiImageSquare"})},handleDetailOpen:_,handleDetailClose:async()=>{f.value=!1},getImageList:u,refreshWatchImages:C,handleImageButtonClick:async(e,s)=>e==="more"?(P.value=s.id,void await _()):e==="delete"?(await a.confirm("\u662F\u5426\u5220\u9664\u7167\u7247?"),await I.deleteImageMy(s.id),await u(),void a.success("\u5220\u9664\u6210\u529F!")):void(e!=="download"?e!=="regeneration"||await L("onRegeneration",s):await X.image({url:s.picUrl})),handleImageMidjourneyButtonClick:async(e,s)=>{const m={id:s.id,customId:e.customId};await I.midjourneyAction(m),await u()},emits:L,ImageDetail:K,ImageCard:Q};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),[["render",function(M,t,k,a,v,y){const d=H,o=J,r=W;return w(),b(q,null,[p(r,{class:"dr-task","body-class":"task-card",shadow:"never"},{header:h(()=>[t[3]||(t[3]=j(" \u7ED8\u753B\u4EFB\u52A1 ")),p(d,{onClick:a.handleViewPublic},{default:h(()=>t[2]||(t[2]=[j("\u7ED8\u753B\u4F5C\u54C1")])),_:1})]),default:h(()=>[R("div",Y,[(w(!0),b(q,null,V(a.imageList,i=>(w(),F(a.ImageCard,{key:i.id,detail:i,onOnBtnClick:a.handleImageButtonClick,onOnMjBtnClick:a.handleImageMidjourneyButtonClick},null,8,["detail"]))),128))],512),R("div",Z,[p(o,{total:a.pageTotal,page:a.queryParams.pageNo,"onUpdate:page":t[0]||(t[0]=i=>a.queryParams.pageNo=i),limit:a.queryParams.pageSize,"onUpdate:limit":t[1]||(t[1]=i=>a.queryParams.pageSize=i),onPagination:a.getImageList},null,8,["total","page","limit"])])]),_:1}),p(a.ImageDetail,{show:a.isShowImageDetail,id:a.showImageDetailId,onHandleDrawerClose:a.handleDetailClose},null,8,["show","id"])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/ai/image/index/components/ImageList.vue"]]);export{$ as default};
