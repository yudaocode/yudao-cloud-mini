import{bz as V,d as x,g as B,D as E,r as m,f as M,G as L,U as k,_ as P,o as p,c as C,k as a,w as o,m as F,I as q,q as R,F as z,n as j,ah as O,J as A,K as Y,L as G,v as J,M as K,Z as N,cp as W,cq as Z,z as H,N as Q,E as X,O as $,R as ee}from"./index-BaY5TDP-.js";import{_ as ae}from"./Dialog-CZSXtzfQ.js";import{B as le}from"./index-BlslFSYd.js";import oe from"./FollowUpRecordBusinessForm-B1oFy6Z2.js";import te from"./FollowUpRecordContactForm-BevYD0eZ.js";import se from"./BusinessListModal-6XoY13Ne.js";import re from"./ContactListModal-DsE0FODx.js";const I={getFollowUpRecordPage:async d=>await V.get({url:"/crm/follow-up-record/page",params:d}),createFollowUpRecord:async d=>await V.post({url:"/crm/follow-up-record/create",data:d}),deleteFollowUpRecord:async d=>await V.delete({url:"/crm/follow-up-record/delete?id="+d})},S=P(x({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(d,{expose:l,emit:h}){const{t:e}=B(),T=E(),v=m(!1),D=m(""),f=m(!1),s=m({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),n=M({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=m(),g=async(r,u)=>{v.value=!0,i(),s.value.bizType=r,s.value.bizId=u};l({open:g});const y=h,U=m(),_=m(),i=()=>{var r;(r=b.value)==null||r.resetFields(),s.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}},w={t:e,message:T,dialogVisible:v,dialogTitle:D,formLoading:f,formData:s,formRules:n,formRef:b,open:g,emit:y,submitForm:async()=>{await b.value.validate(),f.value=!0;try{const r={...s.value,contactIds:s.value.contacts.map(u=>u.id),businessIds:s.value.businesses.map(u=>u.id)};await I.createFollowUpRecord(r),T.success(e("common.createSuccess")),v.value=!1,y("success")}finally{f.value=!1}},contactTableSelectRef:U,handleOpenContact:()=>{var r;(r=U.value)==null||r.open()},handleAddContact:(r,u)=>{u.forEach(c=>{s.value.contacts.some(t=>t.id===c.id)||s.value.contacts.push(c)})},businessTableSelectRef:_,handleOpenBusiness:()=>{var r;(r=_.value)==null||r.open()},handleAddBusiness:(r,u)=>{u.forEach(c=>{s.value.businesses.some(t=>t.id===c.id)||s.value.businesses.push(c)})},resetForm:i,get DICT_TYPE(){return L},get getIntDictOptions(){return k},get BizTypeEnum(){return le},FollowUpRecordBusinessForm:oe,FollowUpRecordContactForm:te,BusinessListModal:se,ContactListModal:re};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),[["render",function(d,l,h,e,T,v){const D=A,f=Y,s=G,n=J,b=K,g=N,y=W,U=Z,_=H,i=Q,w=X,r=$,u=ae,c=ee;return p(),C(z,null,[a(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[6]||(l[6]=t=>e.dialogVisible=t),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[a(i,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:o(()=>l[9]||(l[9]=[F("\u786E \u5B9A")])),_:1},8,["disabled"]),a(i,{onClick:l[5]||(l[5]=t=>e.dialogVisible=!1)},{default:o(()=>l[10]||(l[10]=[F("\u53D6 \u6D88")])),_:1})]),default:o(()=>[q((p(),R(r,{ref:"formRef",model:e.formData,rules:e.formRules,"label-width":"120px"},{default:o(()=>[a(w,null,{default:o(()=>[a(n,{span:12},{default:o(()=>[a(s,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[a(f,{modelValue:e.formData.type,"onUpdate:modelValue":l[0]||(l[0]=t=>e.formData.type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(p(!0),C(z,null,j(e.getIntDictOptions(e.DICT_TYPE.CRM_FOLLOW_UP_TYPE),t=>(p(),R(D,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(s,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[a(b,{modelValue:e.formData.nextTime,"onUpdate:modelValue":l[1]||(l[1]=t=>e.formData.nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:24},{default:o(()=>[a(s,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[a(g,{modelValue:e.formData.content,"onUpdate:modelValue":l[2]||(l[2]=t=>e.formData.content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(s,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[a(y,{modelValue:e.formData.picUrls,"onUpdate:modelValue":l[3]||(l[3]=t=>e.formData.picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:o(()=>[a(s,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[a(U,{modelValue:e.formData.fileUrls,"onUpdate:modelValue":l[4]||(l[4]=t=>e.formData.fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),e.formData.bizType==e.BizTypeEnum.CRM_CUSTOMER?(p(),R(n,{key:0,span:24},{default:o(()=>[a(s,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[a(i,{onClick:e.handleOpenContact},{default:o(()=>[a(_,{class:"mr-5px",icon:"ep:plus"}),l[7]||(l[7]=F(" \u6DFB\u52A0\u8054\u7CFB\u4EBA "))]),_:1}),a(e.FollowUpRecordContactForm,{contacts:e.formData.contacts},null,8,["contacts"])]),_:1})]),_:1})):O("",!0),e.formData.bizType==e.BizTypeEnum.CRM_CUSTOMER?(p(),R(n,{key:1,span:24},{default:o(()=>[a(s,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[a(i,{onClick:e.handleOpenBusiness},{default:o(()=>[a(_,{class:"mr-5px",icon:"ep:plus"}),l[8]||(l[8]=F(" \u6DFB\u52A0\u5546\u673A "))]),_:1}),a(e.FollowUpRecordBusinessForm,{businesses:e.formData.businesses},null,8,["businesses"])]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1},8,["model","rules"])),[[c,e.formLoading]])]),_:1},8,["modelValue"]),a(e.ContactListModal,{ref:"contactTableSelectRef","customer-id":e.formData.bizId,onSuccess:e.handleAddContact},null,8,["customer-id"]),a(e.BusinessListModal,{ref:"businessTableSelectRef","customer-id":e.formData.bizId,onSuccess:e.handleAddBusiness},null,8,["customer-id"])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/followup/FollowUpRecordForm.vue"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}));export{I as F,S as a,ue as b};
