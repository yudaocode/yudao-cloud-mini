import{d as q,g as A,D as j,r as s,f as z,b as B,au as J,e3 as K,e4 as M,_ as Q,o as n,c as T,k as l,w as r,q as y,m as N,ah as Z,I as G,F as R,n as x,Z as W,L as H,v as X,M as Y,z as $,N as ee,J as ae,K as le,cq as re,E as oe,A as te,B as ue,cf as ie,O as de,R as se}from"./index-BaY5TDP-.js";import{_ as me}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{P as S}from"./index-BVJ1S7eT.js";import ce from"./PurchaseInItemForm-CbUqW8wa.js";import{A as pe}from"./index-hc6npfaY.js";import fe from"./PurchaseOrderInEnableList-CYfh_y3T.js";import{g as be}from"./index-CuAlllbQ.js";import{S as ve}from"./index-C5eeu8k9.js";import"./index-DMn3OXs3.js";import"./index-B0TWi7A6.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-BvnoQ9hD.js";import"./formatTime-Dr6TiYYc.js";import"./index-CJwxK5Qx.js";const Pe=Q(q({name:"PurchaseInForm",__name:"PurchaseInForm",emits:["success"],setup(C,{expose:o,emit:O}){const{t:a}=A(),h=j(),V=s(!1),m=s(""),t=s(!1),i=s(""),u=s({id:void 0,supplierId:void 0,accountId:void 0,inTime:void 0,remark:void 0,fileUrl:"",discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,orderNo:void 0,items:[],no:void 0}),L=z({supplierId:[{required:!0,message:"\u4F9B\u5E94\u5546\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],inTime:[{required:!0,message:"\u5165\u5E93\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),p=B(()=>i.value==="detail"),c=s(),f=s([]),b=s([]),v=s([]),F=s("item"),I=s();J(()=>u.value,e=>{if(!e)return;const d=e.items.reduce((k,E)=>k+E.totalPrice,0),_=e.discountPercent!=null?K(d,e.discountPercent/100):0;u.value.discountPrice=_,u.value.totalPrice=d-_+e.otherPrice},{deep:!0});const g=async(e,d)=>{if(V.value=!0,m.value=a("action."+e),i.value=e,U(),d){t.value=!0;try{u.value=await S.getPurchaseIn(d)}finally{t.value=!1}}f.value=await ve.getSupplierSimpleList(),v.value=await be(),b.value=await pe.getAccountSimpleList();const _=b.value.find(k=>k.defaultStatus);_&&(u.value.accountId=_.id)};o({open:g});const P=s(),D=O,U=()=>{var e;u.value={id:void 0,supplierId:void 0,accountId:void 0,inTime:void 0,remark:void 0,fileUrl:void 0,discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,items:[]},(e=c.value)==null||e.resetFields()},w={t:a,message:h,dialogVisible:V,dialogTitle:m,formLoading:t,formType:i,formData:u,formRules:L,disabled:p,formRef:c,supplierList:f,accountList:b,userList:v,subTabsName:F,itemFormRef:I,open:g,purchaseOrderInEnableListRef:P,openPurchaseOrderInEnableList:()=>{P.value.open()},handlePurchaseOrderChange:e=>{u.value.orderId=e.id,u.value.orderNo=e.no,u.value.supplierId=e.supplierId,u.value.accountId=e.accountId,u.value.discountPercent=e.discountPercent,u.value.remark=e.remark,u.value.fileUrl=e.fileUrl,e.items.forEach(d=>{d.totalCount=d.count,d.count=d.totalCount-d.inCount,d.orderItemId=d.id,d.id=void 0}),u.value.items=e.items.filter(d=>d.count>0)},emit:D,submitForm:async()=>{await c.value.validate(),await I.value.validate(),t.value=!0;try{const e=u.value;i.value==="create"?(await S.createPurchaseIn(e),h.success(a("common.createSuccess"))):(await S.updatePurchaseIn(e),h.success(a("common.updateSuccess"))),V.value=!1,D("success")}finally{t.value=!1}},resetForm:U,PurchaseInItemForm:ce,get erpPriceInputFormatter(){return M},PurchaseOrderInEnableList:fe};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}}),[["render",function(C,o,O,a,h,V){const m=W,t=H,i=X,u=Y,L=$,p=ee,c=ae,f=le,b=re,v=oe,F=te,I=ue,g=ne,P=ie,D=de,U=me,w=se;return n(),T(R,null,[l(U,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":o[13]||(o[13]=e=>a.dialogVisible=e),width:"1440"},{footer:r(()=>[a.disabled?Z("",!0):(n(),y(p,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:r(()=>o[15]||(o[15]=[N(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(p,{onClick:o[12]||(o[12]=e=>a.dialogVisible=!1)},{default:r(()=>o[16]||(o[16]=[N("\u53D6 \u6D88")])),_:1})]),default:r(()=>[G((n(),y(D,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:r(()=>[l(v,{gutter:20},{default:r(()=>[l(i,{span:8},{default:r(()=>[l(t,{label:"\u5165\u5E93\u5355\u53F7",prop:"no"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":o[0]||(o[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u5165\u5E93\u65F6\u95F4",prop:"inTime"},{default:r(()=>[l(u,{modelValue:a.formData.inTime,"onUpdate:modelValue":o[1]||(o[1]=e=>a.formData.inTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u5165\u5E93\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u5173\u8054\u8BA2\u5355",prop:"orderNo"},{default:r(()=>[l(m,{modelValue:a.formData.orderNo,"onUpdate:modelValue":o[2]||(o[2]=e=>a.formData.orderNo=e),readonly:""},{append:r(()=>[l(p,{onClick:a.openPurchaseOrderInEnableList},{default:r(()=>[l(L,{icon:"ep:search"}),o[14]||(o[14]=N(" \u9009\u62E9 "))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u4F9B\u5E94\u5546",prop:"supplierId"},{default:r(()=>[l(f,{modelValue:a.formData.supplierId,"onUpdate:modelValue":o[3]||(o[3]=e=>a.formData.supplierId=e),clearable:"",filterable:"",disabled:"",placeholder:"\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546",class:"!w-1/1"},{default:r(()=>[(n(!0),T(R,null,x(a.supplierList,e=>(n(),y(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{span:16},{default:r(()=>[l(t,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[l(m,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":o[4]||(o[4]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:r(()=>[l(b,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":o[5]||(o[5]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(g,null,{default:r(()=>[l(I,{modelValue:a.subTabsName,"onUpdate:modelValue":o[6]||(o[6]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:r(()=>[l(F,{label:"\u5165\u5E93\u4EA7\u54C1\u6E05\u5355",name:"item"},{default:r(()=>[l(a.PurchaseInItemForm,{ref:"itemFormRef",items:a.formData.items,disabled:a.disabled},null,8,["items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{gutter:20},{default:r(()=>[l(i,{span:8},{default:r(()=>[l(t,{label:"\u4F18\u60E0\u7387\uFF08%\uFF09",prop:"discountPercent"},{default:r(()=>[l(P,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":o[7]||(o[7]=e=>a.formData.discountPercent=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u7387",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u4ED8\u6B3E\u4F18\u60E0",prop:"discountPrice"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.discountPrice,"onUpdate:modelValue":o[8]||(o[8]=e=>a.formData.discountPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u4F18\u60E0\u540E\u91D1\u989D"},{default:r(()=>[l(m,{disabled:"","model-value":a.formData.totalPrice-a.formData.otherPrice,formatter:a.erpPriceInputFormatter},null,8,["model-value","formatter"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u5176\u5B83\u8D39\u7528",prop:"otherPrice"},{default:r(()=>[l(P,{modelValue:a.formData.otherPrice,"onUpdate:modelValue":o[9]||(o[9]=e=>a.formData.otherPrice=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u5176\u5B83\u8D39\u7528",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u7ED3\u7B97\u8D26\u6237",prop:"accountId"},{default:r(()=>[l(f,{modelValue:a.formData.accountId,"onUpdate:modelValue":o[10]||(o[10]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:r(()=>[(n(!0),T(R,null,x(a.accountList,e=>(n(),y(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{span:8},{default:r(()=>[l(t,{label:"\u5E94\u4ED8\u91D1\u989D"},{default:r(()=>[l(m,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":o[11]||(o[11]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[w,a.formLoading]])]),_:1},8,["title","modelValue"]),l(a.PurchaseOrderInEnableList,{ref:"purchaseOrderInEnableListRef",onSuccess:a.handlePurchaseOrderChange},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/purchase/in/PurchaseInForm.vue"]]);export{Pe as default};
