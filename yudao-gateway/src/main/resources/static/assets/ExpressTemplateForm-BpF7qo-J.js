import{d as M,g as F,D as A,r as p,f as R,C as S,aA as y,G as O,U as q,ay as L,eK as U,_ as j,o as w,q as D,w as r,k as a,m as V,I as G,c as Y,F as $,n as z,t as H,Z as K,L as N,ak as Q,al as X,cg as Z,P as B,cf as J,N as W,Q as ee,z as ae,O as le,R as re}from"./index-BaY5TDP-.js";import{_ as te}from"./Dialog-CZSXtzfQ.js";import{a as oe,c as ue,u as se}from"./index-oo0HyGJ_.js";import{g as de}from"./index-Qzz5HSIB.js";import{d as ie}from"./tree-z7HkrWVC.js";const ne=j(M({__name:"ExpressTemplateForm",emits:["success"],setup(I,{expose:t,emit:k}){const{t:l}=F(),v=A(),E={...ie,multiple:!0},h=p(!1),n=p(""),f=p(!1),_=p(""),d=p({id:void 0,name:"",chargeMode:1,sort:0,charges:[],frees:[]}),u=new Map,i=p({startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),c=R({name:[{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],chargeMode:[{required:!0,message:"\u914D\u9001\u8BA1\u8D39\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sort:[{required:!0,message:"\u5206\u7C7B\u6392\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=p(),b=async(s,m)=>{h.value=!0,n.value=l("action."+s),_.value=s,T();try{m&&(f.value=!0,d.value=await oe(m),i.value=u.get(d.value.chargeMode),d.value.charges.forEach(C=>{C.startPrice=y(C.startPrice),C.extraPrice=y(C.extraPrice)}),d.value.frees.forEach(C=>{C.freePrice=y(C.freePrice)}))}finally{f.value=!1}};t({open:b});const P=k,T=()=>{var s;d.value={id:void 0,name:"",chargeMode:1,charges:[{areaIds:[1],startCount:2,startPrice:5,extraCount:5,extraPrice:10}],frees:[],sort:0},i.value=u.get(1),(s=g.value)==null||s.resetFields()},x=p([]),e=async()=>{u.set(1,{startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),u.set(2,{startCountTitle:"\u9996\u4EF6\u91CD\u91CF(kg)",extraCountTitle:"\u7EED\u4EF6\u91CD\u91CF(kg)",freeCountTitle:"\u5305\u90AE\u91CD\u91CF(kg)"}),u.set(3,{startCountTitle:"\u9996\u4EF6\u4F53\u79EF(m\xB3)",extraCountTitle:"\u7EED\u4EF6\u4F53\u79EF(m\xB3)",freeCountTitle:"\u5305\u90AE\u4F53\u79EF(m\xB3)"}),x.value=await de()};S(()=>{e()});const o={t:l,message:v,defaultProps2:E,dialogVisible:h,dialogTitle:n,formLoading:f,formType:_,formData:d,columnTitleMap:u,columnTitle:i,formRules:c,formRef:g,open:b,emit:P,submitForm:async()=>{if(g&&await g.value.validate()){f.value=!0;try{const s=L(d.value);s.charges.forEach(m=>{m.startPrice=U(m.startPrice),m.extraPrice=U(m.extraPrice)}),s.frees.forEach(m=>{m.freePrice=U(m.freePrice)}),_.value==="create"?(await ue(s),v.success(l("common.createSuccess"))):(await se(s),v.success(l("common.updateSuccess"))),h.value=!1,P("success")}finally{f.value=!1}}},resetForm:T,changeChargeMode:s=>{i.value=u.get(s)},areaTree:x,initData:e,addChargeArea:()=>{d.value.charges.push({areaIds:[],startCount:1,startPrice:1,extraCount:1,extraPrice:1})},deleteChargeArea:s=>{d.value.charges.splice(s,1)},addFreeArea:()=>{d.value.frees.push({areaIds:[],freeCount:1,freePrice:1})},deleteFreeArea:s=>{d.value.frees.splice(s,1)},get DICT_TYPE(){return O},get getIntDictOptions(){return q}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),[["render",function(I,t,k,l,v,E){const h=K,n=N,f=Q,_=X,d=Z,u=B,i=J,c=W,g=ee,b=ae,P=le,T=te,x=re;return w(),D(T,{title:l.dialogTitle,modelValue:l.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>l.dialogVisible=e),width:"1300px"},{footer:r(()=>[a(c,{onClick:l.submitForm,type:"primary",disabled:l.formLoading},{default:r(()=>t[11]||(t[11]=[V("\u786E \u5B9A")])),_:1},8,["disabled"]),a(c,{onClick:t[5]||(t[5]=e=>l.dialogVisible=!1)},{default:r(()=>t[12]||(t[12]=[V("\u53D6 \u6D88")])),_:1})]),default:r(()=>[G((w(),D(P,{ref:"formRef",model:l.formData,rules:l.formRules,"label-width":"80px"},{default:r(()=>[a(n,{label:"\u6A21\u677F\u540D\u79F0",prop:"name"},{default:r(()=>[a(h,{modelValue:l.formData.name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.formData.name=e),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(n,{label:"\u8BA1\u8D39\u65B9\u5F0F",prop:"chargeMode"},{default:r(()=>[a(_,{modelValue:l.formData.chargeMode,"onUpdate:modelValue":t[1]||(t[1]=e=>l.formData.chargeMode=e),onChange:l.changeChargeMode},{default:r(()=>[(w(!0),Y($,null,z(l.getIntDictOptions(l.DICT_TYPE.EXPRESS_CHARGE_MODE),e=>(w(),D(f,{key:e.value,value:e.value},{default:r(()=>[V(H(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"\u8FD0\u8D39",prop:"charges"},{default:r(()=>[a(g,{border:"",style:{width:"100%"},data:l.formData.charges},{default:r(()=>[a(u,{align:"center",label:"\u533A\u57DF",width:"360"},{default:r(({row:e})=>[a(d,{modelValue:e.areaIds,"onUpdate:modelValue":o=>e.areaIds=o,options:l.areaTree,props:l.defaultProps2,class:"w-1/1",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5730\u533A",filterable:"","collapse-tags":""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(u,{align:"center",label:l.columnTitle.startCountTitle,width:"180",prop:"startCount"},{default:r(({row:e})=>[a(i,{modelValue:e.startCount,"onUpdate:modelValue":o=>e.startCount=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(u,{width:"180",align:"center",label:"\u8FD0\u8D39(\u5143)",prop:"startPrice"},{default:r(({row:e})=>[a(i,{modelValue:e.startPrice,"onUpdate:modelValue":o=>e.startPrice=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{width:"180",align:"center",label:l.columnTitle.extraCountTitle,prop:"extraCount"},{default:r(({row:e})=>[a(i,{modelValue:e.extraCount,"onUpdate:modelValue":o=>e.extraCount=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(u,{width:"180",align:"center",label:"\u7EED\u8D39(\u5143)",prop:"extraPrice"},{default:r(({row:e})=>[a(i,{modelValue:e.extraPrice,"onUpdate:modelValue":o=>e.extraPrice=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{label:"\u64CD\u4F5C",align:"center"},{default:r(e=>[a(c,{link:"",type:"danger",onClick:o=>l.deleteChargeArea(e.$index)},{default:r(()=>t[7]||(t[7]=[V(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(n,null,{default:r(()=>[a(c,{type:"primary",plain:"",onClick:t[2]||(t[2]=e=>l.addChargeArea())},{default:r(()=>[a(b,{icon:"ep:plus",class:"mr-5px"}),t[8]||(t[8]=V(" \u6DFB\u52A0\u533A\u57DF "))]),_:1})]),_:1}),a(n,{label:"\u5305\u90AE\u533A\u57DF",prop:"frees"},{default:r(()=>[a(g,{border:"",style:{width:"100%"},data:l.formData.frees},{default:r(()=>[a(u,{align:"center",label:"\u533A\u57DF",width:"360"},{default:r(({row:e})=>[a(d,{modelValue:e.areaIds,"onUpdate:modelValue":o=>e.areaIds=o,options:l.areaTree,props:l.defaultProps2,class:"w-1/1",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B",filterable:"","collapse-tags":""},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),a(u,{align:"center",label:l.columnTitle.freeCountTitle,prop:"freeCount"},{default:r(({row:e})=>[a(i,{modelValue:e.freeCount,"onUpdate:modelValue":o=>e.freeCount=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(u,{align:"center",label:"\u5305\u90AE\u91D1\u989D\uFF08\u5143\uFF09",prop:"freePrice"},{default:r(({row:e})=>[a(i,{modelValue:e.freePrice,"onUpdate:modelValue":o=>e.freePrice=o,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(u,{label:"\u64CD\u4F5C",align:"center"},{default:r(e=>[a(c,{link:"",type:"danger",onClick:o=>l.deleteFreeArea(e.$index)},{default:r(()=>t[9]||(t[9]=[V(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(n,null,{default:r(()=>[a(c,{type:"primary",plain:"",onClick:t[3]||(t[3]=e=>l.addFreeArea())},{default:r(()=>[a(b,{icon:"ep:plus",class:"mr-5px"}),t[10]||(t[10]=V(" \u6DFB\u52A0\u533A\u57DF "))]),_:1})]),_:1}),a(n,{label:"\u6392\u5E8F",prop:"sort"},{default:r(()=>[a(i,{modelValue:l.formData.sort,"onUpdate:modelValue":t[4]||(t[4]=e=>l.formData.sort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[x,l.formLoading]])]),_:1},8,["title","modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/trade/delivery/expressTemplate/ExpressTemplateForm.vue"]]);export{ne as default};
