import{d as x,g as S,D as j,r as p,f as Y,e as M,G as N,U as A,_ as B,o as n,q as b,w as r,k as l,m as O,I as G,c as y,F as D,n as h,Z as J,L as K,v as Z,J as z,K as H,E as Q,cf as W,M as X,O as $,N as ee,R as ae}from"./index-BaY5TDP-.js";import{_ as le}from"./Dialog-CZSXtzfQ.js";import{a as re}from"./index-ndAUlMgd.js";import{a as oe,c as ue,u as de}from"./index-DcQDDeHJ.js";import{g as te}from"./index-CuAlllbQ.js";import{g as se}from"./index-h6ObHKtQ.js";import{d as ie}from"./index-B97LdofC.js";const ne=B(x({__name:"ReceivableForm",emits:["success"],setup(q,{expose:o,emit:L}){const{t:e}=S(),w=j(),R=p([]),_=p(!1),i=p(""),t=p(!1),m=p(""),u=p({}),f=Y({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],price:[{required:!0,message:"\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=p(),T=p([]),I=p([]),v=p([]),C=async(d,c,s)=>{var F;if(_.value=!0,i.value=e("action."+d),m.value=d,a(),c){t.value=!0;try{const V=await oe(c);u.value=V,await k(V.customerId),u.value.contractId=(F=V==null?void 0:V.contract)==null?void 0:F.id}finally{t.value=!1}}R.value=await te(),T.value=await se(),m.value==="create"&&(u.value.ownerUserId=M().getUser.id),s&&(u.value.customerId=s.customerId,await k(s.customerId),u.value.contractId=s.contractId,await P(s.contractId),s.id&&(u.value.planId=s.id,u.value.price=s.price,u.value.returnType=s.returnType))};o({open:C});const U=L,a=()=>{var d;u.value={},(d=g.value)==null||d.resetFields()},k=async d=>{u.value.contractId=void 0,d&&(I.value=[],I.value=await ie(d))},P=async d=>{if(u.value.planId=void 0,d){v.value=[],v.value=await re(u.value.customerId,d);const c=I.value.find(s=>s.id===d);c&&(u.value.price=c.totalPrice-c.totalReceivablePrice)}},E={t:e,message:w,userOptions:R,dialogVisible:_,dialogTitle:i,formLoading:t,formType:m,formData:u,formRules:f,formRef:g,customerList:T,contractList:I,receivablePlanList:v,open:C,emit:U,submitForm:async()=>{if(g&&await g.value.validate()){t.value=!0;try{const d=u.value;m.value==="create"?(await ue(d),w.success(e("common.createSuccess"))):(await de(d),w.success(e("common.updateSuccess"))),_.value=!1,U("success")}finally{t.value=!1}}},resetForm:a,handleCustomerChange:k,handleContractChange:P,handleReceivablePlanChange:d=>{if(!d)return;const c=v.value.find(s=>s.id===d);c&&(u.value.price=c.price,u.value.returnType=c.returnType)},get DICT_TYPE(){return N},get getIntDictOptions(){return A}};return Object.defineProperty(E,"__isScriptSetup",{enumerable:!1,value:!0}),E}}),[["render",function(q,o,L,e,w,R){const _=J,i=K,t=Z,m=z,u=H,f=Q,g=W,T=X,I=$,v=ee,C=le,U=ae;return n(),b(C,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[10]||(o[10]=a=>e.dialogVisible=a),title:e.dialogTitle},{footer:r(()=>[l(v,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:r(()=>o[11]||(o[11]=[O("\u786E \u5B9A")])),_:1},8,["disabled"]),l(v,{onClick:o[9]||(o[9]=a=>e.dialogVisible=!1)},{default:r(()=>o[12]||(o[12]=[O("\u53D6 \u6D88")])),_:1})]),default:r(()=>[G((n(),b(I,{ref:"formRef",model:e.formData,rules:e.formRules,"label-width":"100px"},{default:r(()=>[l(f,null,{default:r(()=>[l(t,{span:12},{default:r(()=>[l(i,{label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"},{default:r(()=>[l(_,{modelValue:e.formData.no,"onUpdate:modelValue":o[0]||(o[0]=a=>e.formData.no=a),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:r(()=>[l(i,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:r(()=>[l(u,{modelValue:e.formData.ownerUserId,"onUpdate:modelValue":o[1]||(o[1]=a=>e.formData.ownerUserId=a),disabled:e.formType!=="create",class:"w-1/1"},{default:r(()=>[(n(!0),y(D,null,h(e.userOptions,a=>(n(),b(m,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(f,null,{default:r(()=>[l(t,{span:12},{default:r(()=>[l(i,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:r(()=>[l(u,{modelValue:e.formData.customerId,"onUpdate:modelValue":o[2]||(o[2]=a=>e.formData.customerId=a),disabled:e.formType!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:e.handleCustomerChange},{default:r(()=>[(n(!0),y(D,null,h(e.customerList,a=>(n(),b(m,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(t,{span:12},{default:r(()=>[l(i,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:r(()=>[l(u,{modelValue:e.formData.contractId,"onUpdate:modelValue":o[3]||(o[3]=a=>e.formData.contractId=a),disabled:e.formType!=="create"||!e.formData.customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C",onChange:e.handleContractChange},{default:r(()=>[(n(!0),y(D,null,h(e.contractList,a=>(n(),b(m,{key:a.id,disabled:a.auditStatus!==20,label:a.name,value:a.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(f,null,{default:r(()=>[l(t,{span:12},{default:r(()=>[l(i,{label:"\u56DE\u6B3E\u671F\u6570",prop:"planId"},{default:r(()=>[l(u,{modelValue:e.formData.planId,"onUpdate:modelValue":o[4]||(o[4]=a=>e.formData.planId=a),disabled:e.formType!=="create"||!e.formData.contractId,class:"!w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u671F\u6570",onChange:e.handleReceivablePlanChange},{default:r(()=>[(n(!0),y(D,null,h(e.receivablePlanList,a=>(n(),b(m,{key:a.id,disabled:a.receivableId,label:"\u7B2C "+a.period+" \u671F",value:a.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(t,{span:12},{default:r(()=>[l(i,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:r(()=>[l(u,{modelValue:e.formData.returnType,"onUpdate:modelValue":o[5]||(o[5]=a=>e.formData.returnType=a),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:r(()=>[(n(!0),y(D,null,h(e.getIntDictOptions(e.DICT_TYPE.CRM_RECEIVABLE_RETURN_TYPE),a=>(n(),b(m,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,null,{default:r(()=>[l(t,{span:12},{default:r(()=>[l(i,{label:"\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:r(()=>[l(g,{modelValue:e.formData.price,"onUpdate:modelValue":o[6]||(o[6]=a=>e.formData.price=a),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:r(()=>[l(i,{label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:r(()=>[l(T,{modelValue:e.formData.returnTime,"onUpdate:modelValue":o[7]||(o[7]=a=>e.formData.returnTime=a),placeholder:"\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,null,{default:r(()=>[l(t,{span:24},{default:r(()=>[l(i,{label:"\u5907\u6CE8",prop:"remark"},{default:r(()=>[l(_,{modelValue:e.formData.remark,"onUpdate:modelValue":o[8]||(o[8]=a=>e.formData.remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[U,e.formLoading]])]),_:1},8,["modelValue","title"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/receivable/ReceivableForm.vue"]]);export{ne as default};
