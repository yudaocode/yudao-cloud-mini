import{d as L,g as R,D as A,r as m,f as I,_ as T,o,q as r,w as t,k as s,m as f,I as B,t as U,ah as x,Z as P,L as j,cC as $,b8 as q,P as E,cf as K,N,Q as O,O as Q,R as Z}from"./index-BaY5TDP-.js";import{_ as z}from"./Dialog-CZSXtzfQ.js";import{_ as G}from"./Tooltip-BVOSXOHc.js";import{b as H,B as J,c as M,u as W}from"./index-n6shePIl.js";import{h as X,d as Y}from"./tree-z7HkrWVC.js";import{g as ee}from"./index-dK17nfjs.js";const ae=T(L({__name:"BusinessStatusForm",emits:["success"],setup(F,{expose:l,emit:D}){const{t:a}=R(),g=A(),h=m(!1),y=m(""),i=m(!1),_=m(""),u=m({id:void 0,name:"",deptIds:[],statuses:[]}),v=I({name:[{required:!0,message:"\u72B6\u6001\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),c=m(),k=m([]),n=m(),S=m(!0),w=async(d,b)=>{if(h.value=!0,y.value=a("action."+d),_.value=d,C(),b){i.value=!0;try{u.value=await H(b),n.value.setCheckedKeys(u.value.deptIds),u.value.statuses.length==0&&e()}finally{i.value=!1}}else e();k.value=X(await ee())};l({open:w});const V=D,C=()=>{var d,b;S.value=!0,u.value={id:void 0,name:"",deptIds:[],statuses:[]},(d=n.value)==null||d.setCheckedNodes([]),(b=c.value)==null||b.resetFields()},e=()=>{u.value.statuses.push({name:"",percent:void 0})},p={t:a,message:g,dialogVisible:h,dialogTitle:y,formLoading:i,formType:_,formData:u,formRules:v,formRef:c,deptList:k,treeRef:n,checkStrictly:S,open:w,emit:V,submitForm:async()=>{await c.value.validate(),i.value=!0;try{const d=u.value;d.deptIds=n.value.getCheckedKeys(!1),_.value==="create"?(await M(d),g.success(a("common.createSuccess"))):(await W(d),g.success(a("common.updateSuccess"))),h.value=!1,V("success")}finally{i.value=!1}},resetForm:C,addStatus:e,deleteStatusArea:d=>{u.value.statuses.splice(d,1)},get BusinessStatusApi(){return J},get defaultProps(){return Y}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),[["render",function(F,l,D,a,g,h){const y=P,i=j,_=G,u=$,v=q,c=E,k=K,n=N,S=O,w=Q,V=z,C=Z;return o(),r(V,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=e=>a.dialogVisible=e)},{footer:t(()=>[s(n,{onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:t(()=>l[6]||(l[6]=[f("\u786E \u5B9A")])),_:1},8,["disabled"]),s(n,{onClick:l[1]||(l[1]=e=>a.dialogVisible=!1)},{default:t(()=>l[7]||(l[7]=[f("\u53D6 \u6D88")])),_:1})]),default:t(()=>[B((o(),r(w,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px"},{default:t(()=>[s(i,{label:"\u72B6\u6001\u7EC4\u540D",prop:"name"},{default:t(()=>[s(y,{modelValue:a.formData.name,"onUpdate:modelValue":l[0]||(l[0]=e=>a.formData.name=e),placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u7EC4\u540D"},null,8,["modelValue"])]),_:1}),s(i,{label:"\u5E94\u7528\u90E8\u95E8",prop:"deptIds"},{label:t(()=>[s(_,{message:"\u4E0D\u9009\u62E9\u90E8\u95E8\u65F6\uFF0C\u9ED8\u8BA4\u5168\u516C\u53F8\u751F\u6548",title:"\u5E94\u7528\u90E8\u95E8"})]),default:t(()=>[s(u,{ref:"treeRef",data:a.deptList,props:a.defaultProps,"check-strictly":!a.checkStrictly,"node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","show-checkbox":""},null,8,["data","props","check-strictly"])]),_:1}),s(i,{label:"\u9636\u6BB5\u8BBE\u7F6E",prop:"statuses"},{default:t(()=>[s(S,{border:"",style:{width:"100%"},data:a.formData.statuses.concat(a.BusinessStatusApi.DEFAULT_STATUSES)},{default:t(()=>[s(c,{align:"center",label:"\u9636\u6BB5",width:"70"},{default:t(e=>[e.row.defaultStatus?(o(),r(v,{key:1},{default:t(()=>l[3]||(l[3]=[f("\u7ED3\u675F")])),_:1})):(o(),r(v,{key:0},{default:t(()=>[f("\u9636\u6BB5 "+U(e.$index+1),1)]),_:2},1024))]),_:1}),s(c,{align:"center",label:"\u9636\u6BB5\u540D\u79F0",width:"160",prop:"name"},{default:t(({row:e})=>[e.endStatus?(o(),r(v,{key:1},{default:t(()=>[f(U(e.name),1)]),_:2},1024)):(o(),r(y,{key:0,modelValue:e.name,"onUpdate:modelValue":p=>e.name=p,placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),s(c,{width:"140",align:"center",label:"\u8D62\u5355\u7387\uFF08%\uFF09",prop:"percent"},{default:t(({row:e})=>[e.endStatus?(o(),r(v,{key:1},{default:t(()=>[f(U(e.percent),1)]),_:2},1024)):(o(),r(k,{key:0,modelValue:e.percent,"onUpdate:modelValue":p=>e.percent=p,placeholder:"\u8BF7\u8F93\u5165\u8D62\u5355\u7387","controls-position":"right",min:0,max:100,precision:2,class:"!w-1/1"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),s(c,{label:"\u64CD\u4F5C",width:"110",align:"center"},{default:t(e=>[e.row.endStatus?x("",!0):(o(),r(n,{key:0,link:"",type:"primary",onClick:p=>a.addStatus(e.$index)},{default:t(()=>l[4]||(l[4]=[f(" \u6DFB\u52A0 ")])),_:2},1032,["onClick"])),e.row.endStatus?x("",!0):(o(),r(n,{key:1,link:"",type:"danger",onClick:p=>a.deleteStatusArea(e.$index),disabled:a.formData.statuses.length<=1},{default:t(()=>l[5]||(l[5]=[f(" \u5220\u9664 ")])),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[C,a.formLoading]])]),_:1},8,["title","modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/business/status/BusinessStatusForm.vue"]]);export{ae as default};
