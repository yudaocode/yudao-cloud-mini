import{d as q,g as A,D as j,r as s,f as z,b as B,au as J,e3 as K,e4 as M,_ as Z,o as n,c as w,k as l,w as o,q as P,m as T,ah as G,I as Q,F as L,n as C,Z as W,L as H,v as X,M as Y,z as $,N as ee,J as ae,K as le,cq as oe,E as re,A as te,B as ue,cf as de,O as ie,R as se}from"./index-BaY5TDP-.js";import{_ as me}from"./Dialog-CZSXtzfQ.js";import{_ as ne}from"./ContentWrap-DKQn7kZm.js";import{S as N}from"./index-CcVF-M2f.js";import ce from"./SaleOutItemForm-B8N9THi8.js";import{C as fe}from"./index-DV7H_W_F.js";import{A as pe}from"./index-hc6npfaY.js";import be from"./SaleOrderOutEnableList-C3CUAgFZ.js";import{g as ve}from"./index-CuAlllbQ.js";import"./index-DMn3OXs3.js";import"./index-B0TWi7A6.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-DoNPyGwW.js";import"./formatTime-Dr6TiYYc.js";import"./index-CJwxK5Qx.js";const _e=Z(q({name:"SaleOutForm",__name:"SaleOutForm",emits:["success"],setup(x,{expose:r,emit:R}){const{t:a}=A(),I=j(),D=s(!1),m=s(""),t=s(!1),d=s(""),u=s({id:void 0,customerId:void 0,accountId:void 0,saleUserId:void 0,outTime:void 0,remark:void 0,fileUrl:"",discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,orderNo:void 0,items:[],no:void 0}),y=z({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],outTime:[{required:!0,message:"\u51FA\u5E93\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),p=B(()=>d.value==="detail"),c=s(),f=s([]),b=s([]),v=s([]),k=s("item"),g=s();J(()=>u.value,e=>{if(!e)return;const i=e.items.reduce((F,E)=>F+E.totalPrice,0),V=e.discountPercent!=null?K(i,e.discountPercent/100):0;u.value.discountPrice=V,u.value.totalPrice=i-V+e.otherPrice},{deep:!0});const U=async(e,i)=>{if(D.value=!0,m.value=a("action."+e),d.value=e,O(),i){t.value=!0;try{u.value=await N.getSaleOut(i)}finally{t.value=!1}}f.value=await fe.getCustomerSimpleList(),v.value=await ve(),b.value=await pe.getAccountSimpleList();const V=b.value.find(F=>F.defaultStatus);V&&(u.value.accountId=V.id)};r({open:U});const _=s(),h=R,O=()=>{var e;u.value={id:void 0,customerId:void 0,accountId:void 0,saleUserId:void 0,outTime:void 0,remark:void 0,fileUrl:void 0,discountPercent:0,discountPrice:0,totalPrice:0,otherPrice:0,items:[]},(e=c.value)==null||e.resetFields()},S={t:a,message:I,dialogVisible:D,dialogTitle:m,formLoading:t,formType:d,formData:u,formRules:y,disabled:p,formRef:c,customerList:f,accountList:b,userList:v,subTabsName:k,itemFormRef:g,open:U,saleOrderOutEnableListRef:_,openSaleOrderOutEnableList:()=>{_.value.open()},handleSaleOrderChange:e=>{u.value.orderId=e.id,u.value.orderNo=e.no,u.value.customerId=e.customerId,u.value.accountId=e.accountId,u.value.saleUserId=e.saleUserId,u.value.discountPercent=e.discountPercent,u.value.remark=e.remark,u.value.fileUrl=e.fileUrl,e.items.forEach(i=>{i.totalCount=i.count,i.count=i.totalCount-i.outCount,i.orderItemId=i.id,i.id=void 0}),u.value.items=e.items.filter(i=>i.count>0)},emit:h,submitForm:async()=>{await c.value.validate(),await g.value.validate(),t.value=!0;try{const e=u.value;d.value==="create"?(await N.createSaleOut(e),I.success(a("common.createSuccess"))):(await N.updateSaleOut(e),I.success(a("common.updateSuccess"))),D.value=!1,h("success")}finally{t.value=!1}},resetForm:O,SaleOutItemForm:ce,get erpPriceInputFormatter(){return M},SaleOrderOutEnableList:be};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}}),[["render",function(x,r,R,a,I,D){const m=W,t=H,d=X,u=Y,y=$,p=ee,c=ae,f=le,b=oe,v=re,k=te,g=ue,U=ne,_=de,h=ie,O=me,S=se;return n(),w(L,null,[l(O,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":r[14]||(r[14]=e=>a.dialogVisible=e),width:"1440"},{footer:o(()=>[a.disabled?G("",!0):(n(),P(p,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:o(()=>r[16]||(r[16]=[T(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(p,{onClick:r[13]||(r[13]=e=>a.dialogVisible=!1)},{default:o(()=>r[17]||(r[17]=[T("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Q((n(),P(h,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:o(()=>[l(v,{gutter:20},{default:o(()=>[l(d,{span:8},{default:o(()=>[l(t,{label:"\u51FA\u5E93\u5355\u53F7",prop:"no"},{default:o(()=>[l(m,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":r[0]||(r[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u51FA\u5E93\u65F6\u95F4",prop:"outTime"},{default:o(()=>[l(u,{modelValue:a.formData.outTime,"onUpdate:modelValue":r[1]||(r[1]=e=>a.formData.outTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u51FA\u5E93\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u5173\u8054\u8BA2\u5355",prop:"orderNo"},{default:o(()=>[l(m,{modelValue:a.formData.orderNo,"onUpdate:modelValue":r[2]||(r[2]=e=>a.formData.orderNo=e),readonly:""},{append:o(()=>[l(p,{onClick:a.openSaleOrderOutEnableList},{default:o(()=>[l(y,{icon:"ep:search"}),r[15]||(r[15]=T(" \u9009\u62E9 "))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u5BA2\u6237",prop:"customerId"},{default:o(()=>[l(f,{modelValue:a.formData.customerId,"onUpdate:modelValue":r[3]||(r[3]=e=>a.formData.customerId=e),clearable:"",filterable:"",disabled:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"!w-1/1"},{default:o(()=>[(n(!0),w(L,null,C(a.customerList,e=>(n(),P(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u9500\u552E\u4EBA\u5458",prop:"saleUserId"},{default:o(()=>[l(f,{modelValue:a.formData.saleUserId,"onUpdate:modelValue":r[4]||(r[4]=e=>a.formData.saleUserId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u9500\u552E\u4EBA\u5458",class:"!w-1/1"},{default:o(()=>[(n(!0),w(L,null,C(a.userList,e=>(n(),P(c,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:16},{default:o(()=>[l(t,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[l(m,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":r[5]||(r[5]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:o(()=>[l(b,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":r[6]||(r[6]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(U,null,{default:o(()=>[l(g,{modelValue:a.subTabsName,"onUpdate:modelValue":r[7]||(r[7]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:o(()=>[l(k,{label:"\u51FA\u5E93\u4EA7\u54C1\u6E05\u5355",name:"item"},{default:o(()=>[l(a.SaleOutItemForm,{ref:"itemFormRef",items:a.formData.items,disabled:a.disabled},null,8,["items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{gutter:20},{default:o(()=>[l(d,{span:8},{default:o(()=>[l(t,{label:"\u4F18\u60E0\u7387\uFF08%\uFF09",prop:"discountPercent"},{default:o(()=>[l(_,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":r[8]||(r[8]=e=>a.formData.discountPercent=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u7387",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u6536\u6B3E\u4F18\u60E0",prop:"discountPrice"},{default:o(()=>[l(m,{disabled:"",modelValue:a.formData.discountPrice,"onUpdate:modelValue":r[9]||(r[9]=e=>a.formData.discountPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u4F18\u60E0\u540E\u91D1\u989D"},{default:o(()=>[l(m,{disabled:"","model-value":a.formData.totalPrice-a.formData.otherPrice,formatter:a.erpPriceInputFormatter},null,8,["model-value","formatter"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u5176\u5B83\u8D39\u7528",prop:"otherPrice"},{default:o(()=>[l(_,{modelValue:a.formData.otherPrice,"onUpdate:modelValue":r[10]||(r[10]=e=>a.formData.otherPrice=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u5176\u5B83\u8D39\u7528",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u7ED3\u7B97\u8D26\u6237",prop:"accountId"},{default:o(()=>[l(f,{modelValue:a.formData.accountId,"onUpdate:modelValue":r[11]||(r[11]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:o(()=>[(n(!0),w(L,null,C(a.accountList,e=>(n(),P(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:o(()=>[l(t,{label:"\u5E94\u6536\u91D1\u989D"},{default:o(()=>[l(m,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":r[12]||(r[12]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[S,a.formLoading]])]),_:1},8,["title","modelValue"]),l(a.SaleOrderOutEnableList,{ref:"saleOrderOutEnableListRef",onSuccess:a.handleSaleOrderChange},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/sale/out/SaleOutForm.vue"]]);export{_e as default};
