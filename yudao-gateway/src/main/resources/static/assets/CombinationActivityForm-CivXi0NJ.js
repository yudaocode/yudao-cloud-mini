import{f as N,G as U,d as j,g as z,D as O,r as l,ao as q,ax as B,ay as Y,az as H,_ as J,o as M,c as K,k as n,w as m,m as w,I as Q,q as W,F as X,N as Z,cf as $,P as ee,R as oe}from"./index-BaY5TDP-.js";import{_ as ae}from"./Dialog-CZSXtzfQ.js";import{_ as te}from"./Form-CB5RGX1K.js";import{g as ie,c as se,u as re}from"./combinationActivity-BFjeGiax.js";import{b as x}from"./formatTime-Dr6TiYYc.js";import{r as c}from"./formRules-CMjZInfO.js";import{u as le}from"./useCrudSchemas-BQxlWSsn.js";import ue from"./SpuSelect-egfD7fzC.js";import ne from"./SpuAndSkuList-BPESFKMK.js";import{g as me}from"./index-DqlyDc99.js";import{b as ce}from"./spu-BVX48OKx.js";import"./el-virtual-list-Cbbiio1P.js";import"./el-tree-select-DphqCDCz.js";import"./el-time-select-DuQV2otj.js";import"./InputPassword-liMgUpCC.js";import"./tsxHelper-B5zJ1wt3.js";import"./tree-z7HkrWVC.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./ContentWrap-DKQn7kZm.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./el-image-Bg-CwbDE.js";import"./category-B7jjsMOS.js";import"./SkuList-LfTbtJ44.js";const pe=N({name:[c],totalLimitCount:[c],singleLimitCount:[c],startTime:[c],endTime:[c],userSize:[c],limitDuration:[c],virtualGroup:[c]}),de=N([{label:"\u62FC\u56E2\u540D\u79F0",field:"name",isSearch:!0,isTable:!1,form:{colProps:{span:24}}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:x,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:x,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u53C2\u4E0E\u4EBA\u6570",field:"userSize",isSearch:!1,form:{component:"InputNumber",labelMessage:"\u53C2\u4E0E\u4EBA\u6570\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4EBA",value:2}},{label:"\u9650\u5236\u65F6\u957F",field:"limitDuration",isSearch:!1,isTable:!1,form:{component:"InputNumber",labelMessage:"\u9650\u5236\u65F6\u957F(\u5C0F\u65F6)",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u9650\u5236\u65F6\u957F(\u5C0F\u65F6)"}}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",isSearch:!1,isTable:!1,form:{component:"InputNumber",value:0}},{label:"\u5355\u6B21\u9650\u8D2D\u6570\u91CF",field:"singleLimitCount",isSearch:!1,isTable:!1,form:{component:"InputNumber",value:0}},{label:"\u865A\u62DF\u6210\u56E2",field:"virtualGroup",dictType:U.INFRA_BOOLEAN_STRING,dictClass:"boolean",isSearch:!0,form:{component:"Radio",value:!1}},{label:"\u62FC\u56E2\u5546\u54C1",field:"spuId",isSearch:!1,form:{colProps:{span:24}}}]),{allSchemas:fe}=le(de),be=J(j({name:"PromotionCombinationActivityForm",__name:"CombinationActivityForm",emits:["success"],setup(E,{expose:o,emit:F}){const{t:e}=z(),S=O(),h=l(!1),f=l(""),p=l(!1),b=l(""),r=l(),_=l(),y=l(),i=l([]),v=l([]),I=async(a,s,u)=>{var A;const d=[],P=await ce([a]);if(P.length==0)return;i.value=[];const t=P[0],k=s===void 0?t==null?void 0:t.skus:(A=t==null?void 0:t.skus)==null?void 0:A.filter(g=>s.includes(g.id));k==null||k.forEach(g=>{let L={spuId:t.id,skuId:g.id,combinationPrice:0};if(u!==void 0){const C=u.find(G=>G.skuId===g.id);C&&(C.combinationPrice=B(C.combinationPrice)),L=C||L}g.productConfig=L}),t.skus=k,d.push({spuId:t.id,spuDetail:t,propertyList:me(t)}),i.value.push(t),v.value=d},D=async(a,s)=>{var u;if(h.value=!0,f.value=e("action."+a),b.value=a,await R(),s){p.value=!0;try{const d=await ie(s);await I(d.spuId,(u=d.products)==null?void 0:u.map(P=>P.skuId),d.products),r.value.setValues(d)}finally{p.value=!1}}};o({open:D});const R=async()=>{i.value=[],v.value=[],await q(),r.value.getElFormRef().resetFields()},T=F,V={t:e,message:S,dialogVisible:h,dialogTitle:f,formLoading:p,formType:b,formRef:r,spuSelectRef:_,spuAndSkuListRef:y,spuList:i,spuPropertyList:v,ruleConfig:[{name:"productConfig.combinationPrice",rule:a=>a>=.01,message:"\u5546\u54C1\u62FC\u56E2\u4EF7\u683C\u4E0D\u80FD\u5C0F\u4E8E0.01 \uFF01\uFF01\uFF01"}],selectSpu:(a,s)=>{r.value.setValues({spuId:a}),I(a,s)},getSpuDetails:I,open:D,resetForm:R,emit:T,submitForm:async()=>{if(r&&await r.value.getElFormRef().validate()){p.value=!0;try{const a=Y(y.value.getSkuConfigs("productConfig"));a.forEach(u=>{u.combinationPrice=H(u.combinationPrice)});const s=Y(r.value.formModel);s.products=a,b.value==="create"?(await se(s),S.success(e("common.createSuccess"))):(await re(s),S.success(e("common.updateSuccess"))),h.value=!1,T("success")}finally{p.value=!1}}},get allSchemas(){return fe},get rules(){return pe},get SpuAndSkuList(){return ne},get SpuSelect(){return ue}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),[["render",function(E,o,F,e,S,h){const f=Z,p=$,b=ee,r=te,_=ae,y=oe;return M(),K(X,null,[n(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":o[2]||(o[2]=i=>e.dialogVisible=i),title:e.dialogTitle,width:"65%"},{footer:m(()=>[n(f,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:m(()=>o[4]||(o[4]=[w("\u786E \u5B9A")])),_:1},8,["disabled"]),n(f,{onClick:o[1]||(o[1]=i=>e.dialogVisible=!1)},{default:m(()=>o[5]||(o[5]=[w("\u53D6 \u6D88")])),_:1})]),default:m(()=>[Q((M(),W(r,{ref:"formRef","is-col":!0,rules:e.rules,schema:e.allSchemas.formSchema,class:"mt-10px"},{spuId:m(()=>[n(f,{onClick:o[0]||(o[0]=i=>e.spuSelectRef.open())},{default:m(()=>o[3]||(o[3]=[w("\u9009\u62E9\u5546\u54C1")])),_:1}),n(e.SpuAndSkuList,{ref:"spuAndSkuListRef","rule-config":e.ruleConfig,"spu-list":e.spuList,"spu-property-list-p":e.spuPropertyList},{default:m(()=>[n(b,{align:"center",label:"\u62FC\u56E2\u4EF7\u683C(\u5143)","min-width":"168"},{default:m(({row:i})=>[n(p,{modelValue:i.productConfig.combinationPrice,"onUpdate:modelValue":v=>i.productConfig.combinationPrice=v,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[y,e.formLoading]])]),_:1},8,["modelValue","title"]),n(e.SpuSelect,{ref:"spuSelectRef",isSelectSku:!0,onConfirm:e.selectSpu},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/combination/activity/CombinationActivityForm.vue"]]);export{be as default};
