import{d as P,f as h,r as x,au as _,u as C,C as L,e2 as S,eu as q,_ as T,o as b,c as N,k as a,w as l,I as A,q as F,m as w,t as D,F as k,l as I,P as W,y as U,Q as O,R}from"./index-BaY5TDP-.js";import{_ as z}from"./index-avjYFQiD.js";import{E as j}from"./el-skeleton-item-BYAIkmCs.js";import{_ as E}from"./Echart-BQxFkezy.js";import{S as B}from"./funnel-B8h2f-tZ.js";import{d as Q}from"./formatTime-Dr6TiYYc.js";import"./index-DrSdAlug.js";import"./echarts-DpbyC_6K.js";const G=T(P({name:"BusinessSummary",__name:"BusinessInversionRateSummary",props:{queryParams:{type:null,required:!0}},setup(y,{expose:n}){const m=y,e=h({pageNo:1,pageSize:10}),u=x(!1),g=x([]),c=x(0);_(()=>m.queryParams,s=>{if(!s)return;const t={...e,...s};Object.assign(e,t)},{immediate:!0});const i=h({color:["#6ca2ff","#6ac9d7","#ff7474"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["\u8D62\u5355\u8F6C\u5316\u7387","\u5546\u673A\u603B\u6570","\u8D62\u5355\u5546\u673A\u6570"],bottom:"0px",itemWidth:14},grid:{top:"40px",left:"40px",right:"40px",bottom:"40px",containLabel:!0,borderColor:"#fff"},xAxis:[{type:"category",data:[],axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}}],yAxis:[{type:"value",name:"\u8D62\u5355\u8F6C\u5316\u7387",axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD",formatter:"{value}%"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}},{type:"value",name:"\u5546\u673A\u6570",axisTick:{alignWithLabel:!0,lineStyle:{width:0}},axisLabel:{color:"#BDBDBD",formatter:"{value}\u4E2A"},axisLine:{lineStyle:{color:"#BDBDBD"}},splitLine:{show:!1}}],series:[{name:"\u8D62\u5355\u8F6C\u5316\u7387",type:"line",yAxisIndex:0,data:[]},{name:"\u5546\u673A\u603B\u6570",type:"bar",yAxisIndex:1,barWidth:15,data:[]},{name:"\u8D62\u5355\u5546\u673A\u6570",type:"bar",yAxisIndex:1,barWidth:15,data:[]}]}),p=async()=>{const s=await B.getBusinessInversionRateSummaryByDate(m.queryParams);i.xAxis&&i.xAxis[0]&&i.xAxis[0].data&&(i.xAxis[0].data=s.map(t=>t.time)),i.series&&i.series[0]&&i.series[0].data&&(i.series[0].data=s.map(t=>q(t.businessWinCount,t.businessCount))),i.series&&i.series[1]&&i.series[1].data&&(i.series[1].data=s.map(t=>t.businessCount)),i.series&&i.series[2]&&i.series[2].data&&(i.series[2].data=s.map(t=>t.businessWinCount)),await r()},r=async()=>{const s=await B.getBusinessPageByDate(m.queryParams);g.value=s.list,c.value=s.total},{push:o}=C(),d=async()=>{u.value=!0;try{await p()}finally{u.value=!1}};n({loadData:d}),L(()=>{d()});const f={props:m,queryParams0:e,loading:u,list:g,total:c,echartsOption:i,fetchAndFill:p,getList:r,push:o,openDetail:s=>{o({name:"CrmBusinessDetail",params:{id:s}})},openCustomerDetail:s=>{o({name:"CrmCustomerDetail",params:{id:s}})},loadData:d,get erpPriceTableColumnFormatter(){return S},get dateFormatter(){return Q}};return Object.defineProperty(f,"__isScriptSetup",{enumerable:!1,value:!0}),f}}),[["render",function(y,n,m,e,u,g){const c=E,i=j,p=I,r=W,o=U,d=O,f=z,s=R;return b(),N(k,null,[a(p,{shadow:"never"},{default:l(()=>[a(i,{loading:e.loading,animated:""},{default:l(()=>[a(c,{height:500,options:e.echartsOption},null,8,["options"])]),_:1},8,["loading"])]),_:1}),a(p,{class:"mt-16px",shadow:"never"},{default:l(()=>[A((b(),F(d,{data:e.list},{default:l(()=>[a(r,{align:"center",fixed:"left",label:"\u5E8F\u53F7",type:"index",width:"80"}),a(r,{align:"center",fixed:"left",label:"\u5546\u673A\u540D\u79F0",prop:"name",width:"160"},{default:l(t=>[a(o,{underline:!1,type:"primary",onClick:v=>e.openDetail(t.row.id)},{default:l(()=>[w(D(t.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(r,{align:"center",fixed:"left",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"120"},{default:l(t=>[a(o,{underline:!1,type:"primary",onClick:v=>e.openCustomerDetail(t.row.customerId)},{default:l(()=>[w(D(t.row.customerName),1)]),_:2},1032,["onClick"])]),_:1}),a(r,{formatter:e.erpPriceTableColumnFormatter,align:"center",label:"\u5546\u673A\u91D1\u989D\uFF08\u5143\uFF09",prop:"totalPrice",width:"140"},null,8,["formatter"]),a(r,{formatter:e.dateFormatter,align:"center",label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime",width:"180px"},null,8,["formatter"]),a(r,{align:"center",label:"\u5907\u6CE8",prop:"remark",width:"200"}),a(r,{formatter:e.dateFormatter,align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"contactNextTime",width:"180px"},null,8,["formatter"]),a(r,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"100px"}),a(r,{align:"center",label:"\u6240\u5C5E\u90E8\u95E8",prop:"ownerUserDeptName",width:"100px"}),a(r,{formatter:e.dateFormatter,align:"center",label:"\u6700\u540E\u8DDF\u8FDB\u65F6\u95F4",prop:"contactLastTime",width:"180px"},null,8,["formatter"]),a(r,{formatter:e.dateFormatter,align:"center",label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",width:"180px"},null,8,["formatter"]),a(r,{formatter:e.dateFormatter,align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(r,{align:"center",label:"\u521B\u5EFA\u4EBA",prop:"creatorName",width:"100px"}),a(r,{align:"center",fixed:"right",label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeName",width:"140"}),a(r,{align:"center",fixed:"right",label:"\u5546\u673A\u9636\u6BB5",prop:"statusName",width:"120"})]),_:1},8,["data"])),[[s,e.loading]]),a(f,{limit:e.queryParams0.pageSize,"onUpdate:limit":n[0]||(n[0]=t=>e.queryParams0.pageSize=t),page:e.queryParams0.pageNo,"onUpdate:page":n[1]||(n[1]=t=>e.queryParams0.pageNo=t),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1})],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/statistics/funnel/components/BusinessInversionRateSummary.vue"]]);export{G as default};
