import{_ as j}from"./ContentWrap-DKQn7kZm.js";import{d as P,b4 as B,r as o,at as t,D as H,C as G,_ as L,I as X,o as y,c as h,q as M,ah as Y,k as b,w as v,m as z,j as J,F as Q,n as W,t as V,N as Z,R as $}from"./index-BaY5TDP-.js";import{_ as ee}from"./Dialog-CZSXtzfQ.js";import{_ as re}from"./simple-process-designer-DviJ9JIp.js";import{N as d,m as C,n as se}from"./consts-vgsb8q48.js";import{g as oe}from"./index-CnMIW1kt.js";import{g as te}from"./index-BeYJ8u62.js";import{h as ie}from"./tree-z7HkrWVC.js";import{g as ae}from"./index-C7Vgvn4F.js";import{g as le}from"./index-dK17nfjs.js";import{g as de}from"./index-D-_5jDBN.js";import{g as me}from"./index-CuAlllbQ.js";import{g as pe}from"./index-RbAZqEQx.js";import{B as ne}from"./constants-CEEr2azc.js";import"./el-drawer-r3cMvY4i.js";import"./el-tree-select-DphqCDCz.js";import"./el-space-B4pGZPiv.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./utils-DQEYWnsS.js";import"./index-ZFL2ufyC.js";import"./index-BCN8BzfC.js";import"./formatTime-Dr6TiYYc.js";import"./download-oWiM5xVU.js";const ue={class:"overflow-auto"},ce=L(P({name:"SimpleProcessDesigner",__name:"SimpleProcessDesigner",props:{modelId:{type:String,required:!1},modelKey:{type:String,required:!1},modelName:{type:String,required:!1},startUserIds:{type:Array,required:!1}},emits:["success"],setup(D,{expose:s,emit:m}){const e=m,n=D,i=B("processData"),a=o(!1),f=o([]),c=o(20),p=o([]),N=o([]),E=o([]),S=o([]),T=o(),O=o([]);t("formFields",f),t("formType",c),t("roleList",p),t("postList",N),t("userList",E),t("deptList",S),t("userGroupList",O),t("deptTree",T),t("startUserIds",n.startUserIds),t("tasks",[]),t("processInstance",{});const q=H(),_=o();t("processNodeTree",_);const k=o(!1);let R=[];const w=()=>{_.value||(_.value={name:"\u53D1\u8D77\u4EBA",type:d.START_USER_NODE,id:C.START_USER_NODE_ID,childNode:{id:C.END_EVENT_NODE_ID,name:"\u7ED3\u675F",type:d.END_EVENT_NODE}},A(_.value))},A=async r=>{if(r)try{i.value=r,e("success",r)}catch(l){console.error("\u4FDD\u5B58\u5931\u8D25:",l)}},g=(r,l)=>{if(r){const{type:u,showText:x,conditionNodes:I}=r;if(u==d.END_EVENT_NODE)return;u==d.START_USER_NODE&&g(r.childNode,l),u!==d.USER_TASK_NODE&&u!==d.COPY_TASK_NODE&&u!==d.CONDITION_NODE||(x||l.push(r),g(r.childNode,l)),u!=d.CONDITION_BRANCH_NODE&&u!=d.PARALLEL_BRANCH_NODE&&u!=d.INCLUSIVE_BRANCH_NODE||(I==null||I.forEach(K=>{g(K,l)}),g(r.childNode,l))}};G(async()=>{try{if(a.value=!0,n.modelId){const r=await oe(n.modelId);if(r&&(c.value=r.formType,c.value===ne.NORMAL&&r.formId)){const l=await te(r.formId);f.value=l==null?void 0:l.fields}}p.value=await ae(),N.value=await de(),E.value=await me(),S.value=await le(),T.value=ie(S.value,"id"),O.value=await pe(),i.value?_.value=i==null?void 0:i.value:w()}finally{a.value=!1}});const F=o();s({});const U={emits:e,props:n,processData:i,loading:a,formFields:f,formType:c,roleOptions:p,postOptions:N,userOptions:E,deptOptions:S,deptTreeOptions:T,userGroupOptions:O,message:q,processNodeTree:_,errorDialogVisible:k,get errorNodes(){return R},set errorNodes(r){R=r},updateModel:w,saveSimpleFlowModel:A,validateNode:g,simpleProcessModelRef:F,SimpleProcessModel:re,get NODE_DEFAULT_TEXT(){return se}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),[["render",function(D,s,m,e,n,i){const a=Z,f=ee,c=$;return X((y(),h("div",ue,[e.processNodeTree?(y(),M(e.SimpleProcessModel,{key:0,ref:"simpleProcessModelRef","flow-node":e.processNodeTree,readonly:!1,onSave:e.saveSimpleFlowModel},null,8,["flow-node"])):Y("",!0),b(f,{modelValue:e.errorDialogVisible,"onUpdate:modelValue":s[1]||(s[1]=p=>e.errorDialogVisible=p),title:"\u4FDD\u5B58\u5931\u8D25",width:"400",fullscreen:!1},{footer:v(()=>[b(a,{type:"primary",onClick:s[0]||(s[0]=p=>e.errorDialogVisible=!1)},{default:v(()=>s[2]||(s[2]=[z("\u77E5\u9053\u4E86")])),_:1})]),default:v(()=>[s[3]||(s[3]=J("div",{class:"mb-2"},"\u4EE5\u4E0B\u8282\u70B9\u5185\u5BB9\u4E0D\u5B8C\u5584\uFF0C\u8BF7\u4FEE\u6539\u540E\u4FDD\u5B58",-1)),(y(!0),h(Q,null,W(e.errorNodes,(p,N)=>(y(),h("div",{class:"mb-3 b-rounded-1 bg-gray-100 p-2 line-height-normal",key:N},V(p.name)+" : "+V(e.NODE_DEFAULT_TEXT.get(p.type)),1))),128))]),_:1},8,["modelValue"])])),[[c,e.loading]])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/components/SimpleProcessDesignerV2/src/SimpleProcessDesigner.vue"]]),_e=L(P({name:"SimpleModelDesign",__name:"SimpleModelDesign",props:{modelId:{type:String,required:!1},modelKey:{type:String,required:!1},modelName:{type:String,required:!1},startUserIds:{type:Array,required:!1}},emits:["success"],setup(D,{expose:s,emit:m}){s();const e=m,n=o(),i={emit:e,designerRef:n,handleSuccess:a=>{console.info("handleSuccess",a),a&&e("success",a)},get SimpleProcessDesigner(){return ce}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}}),[["render",function(D,s,m,e,n,i){const a=j;return y(),M(a,{bodyStyle:{padding:"20px 16px"}},{default:v(()=>[b(e.SimpleProcessDesigner,{"model-id":m.modelId,"model-key":m.modelKey,"model-name":m.modelName,onSuccess:e.handleSuccess,"start-user-ids":m.startUserIds,ref:"designerRef"},null,8,["model-id","model-key","model-name","start-user-ids"])]),_:1})}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/simple/SimpleModelDesign.vue"]]);export{_e as default};
