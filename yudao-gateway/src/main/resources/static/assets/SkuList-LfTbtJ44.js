import{d as J,p as E,r as N,au as F,ax as j,co as H,Q as R,D as $,aE as q,d_ as Q,aI as z,_ as W,o as u,c as U,q as k,w as o,k as t,F as P,n as L,j as I,t as m,ah as b,m as f,aS as Z,P as G,Z as K,cf as M,N as X}from"./index-BaY5TDP-.js";import{E as Y}from"./el-image-Bg-CwbDE.js";const ee=J({name:"SkuList",__name:"SkuList",props:{propFormData:{type:Object,default:()=>{}},propertyList:{type:Array,default:()=>[]},ruleConfig:{type:Array,default:()=>[]},isBatch:E.bool.def(!1),isDetail:E.bool.def(!1),isComponent:E.bool.def(!1),isActivityComponent:E.bool.def(!1)},emits:["selectionChange"],setup(A,{expose:V,emit:g}){const n=$(),_=A,h=N(),i=N([{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),C=()=>{const l="\u5B58\u5728\u5C5E\u6027\u5C5E\u6027\u503C\u4E3A\u7A7A\uFF0C\u8BF7\u5148\u68C0\u67E5\u5B8C\u5584\u5C5E\u6027\u503C\u540E\u91CD\u8BD5\uFF01\uFF01\uFF01";for(const d of _.propertyList)if(!d.values||z(d.values))throw n.warning(l),new Error(l)},w=N([]),S=()=>{C();let l="\u8BF7\u68C0\u67E5\u5546\u54C1\u5404\u884C\u76F8\u5173\u5C5E\u6027\u914D\u7F6E\uFF0C",d=!0;for(const p of h.value.skus){for(const s of _==null?void 0:_.ruleConfig){const c=D(p,s.name);if(!s.rule(c)){d=!1,l+=s.message;break}}if(!d)throw n.warning(l),new Error(l)}},D=(l,d)=>{const p=d.split(".");let s=l;for(const c of p){if(!s||typeof s!="object"||!(c in s)){s=void 0;break}s=s[c]}return s},a=g;F(()=>_.propFormData,l=>{l&&(h.value=l)},{deep:!0,immediate:!0});const e=l=>{const d=l.map(s=>s.values.map(c=>({propertyId:s.id,propertyName:s.name,valueId:c.id,valueName:c.name}))),p=y(d);r(l)||(h.value.skus=[]);for(const s of p){const c={properties:Array.isArray(s)?s:[s],price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0};h.value.skus.findIndex(x=>JSON.stringify(x.properties)===JSON.stringify(c.properties))===-1&&h.value.skus.push(c)}},r=l=>{const d=[];h.value.skus.forEach(s=>{var c,x;return(x=(c=s.properties)==null?void 0:c.map(B=>B.propertyId))==null?void 0:x.forEach(B=>{d.indexOf(B)===-1&&d.push(B)})});const p=l.map(s=>s.id);return d.length===p.length},y=l=>{if(l.length===0)return[];if(l.length===1)return l[0];{const d=[],p=y(l.slice(1));for(let s=0;s<l[0].length;s++)for(let c=0;c<p.length;c++)Array.isArray(p[c])?d.push([l[0][s],...p[c]]):d.push([l[0][s],p[c]]);return d}};F(()=>_.propertyList,l=>{h.value.specType&&(_.isBatch&&(i.value=[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,firstBrokeragePrice:0,secondBrokeragePrice:0}]),JSON.stringify(l)!=="[]"&&(w.value=[],l.forEach((d,p)=>{w.value.push({prop:`name${p}`,label:d.name})}),r(l)||l.some(d=>!d.values||z(d.values))||e(l)))},{deep:!0,immediate:!0});const v=N(),T=()=>v.value;V({generateTableData:e,validateSku:S,getSkuTableRef:T});const O={message:n,props:_,formData:h,skuList:i,imagePreview:l=>{q({zIndex:9999999,urlList:[l]})},batchAdd:()=>{C(),h.value.skus.forEach(l=>{Q(l,i.value[0])})},validateProperty:C,deleteSku:l=>{const d=h.value.skus.findIndex(p=>JSON.stringify(p.properties)===JSON.stringify(l.properties));h.value.skus.splice(d,1)},tableHeaders:w,validateSku:S,getValue:D,emit:a,handleSelectionChange:l=>{a("selectionChange",l)},generateTableData:e,validateData:r,build:y,activitySkuListRef:v,getSkuTableRef:T,get formatToFraction(){return j},get UploadImg(){return H},get ElTable(){return R}};return Object.defineProperty(O,"__isScriptSetup",{enumerable:!1,value:!0}),O}}),ae={style:{"font-weight":"bold",color:"#40aaff"}},le={style:{"font-weight":"bold",color:"#40aaff"}},te={style:{"font-weight":"bold",color:"#40aaff"}},ie=W(ee,[["render",function(A,V,g,n,_,h){const i=G,C=K,w=M,S=X,D=Y;return u(),U(P,null,[g.isDetail||g.isActivityComponent?b("",!0):(u(),k(n.ElTable,{key:0,data:g.isBatch?n.skuList:n.formData.skus,border:"",class:"tabNumWidth","max-height":"500",size:"small"},{default:o(()=>{var a;return[t(i,{align:"center",label:"\u56FE\u7247","min-width":"65"},{default:o(({row:e})=>[t(n.UploadImg,{modelValue:e.picUrl,"onUpdate:modelValue":r=>e.picUrl=r,height:"50px",width:"50px"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n.formData.specType&&!g.isBatch?(u(!0),U(P,{key:0},L(n.tableHeaders,(e,r)=>(u(),k(i,{key:r,label:e.label,align:"center","min-width":"120"},{default:o(({row:y})=>{var v,T;return[I("span",ae,m((T=(v=y.properties)==null?void 0:v[r])==null?void 0:T.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(i,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"168"},{default:o(({row:e})=>[t(C,{modelValue:e.barCode,"onUpdate:modelValue":r=>e.barCode=r,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u9500\u552E\u4EF7","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.price,"onUpdate:modelValue":r=>e.price=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u5E02\u573A\u4EF7","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.marketPrice,"onUpdate:modelValue":r=>e.marketPrice=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u6210\u672C\u4EF7","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.costPrice,"onUpdate:modelValue":r=>e.costPrice=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u5E93\u5B58","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.stock,"onUpdate:modelValue":r=>e.stock=r,min:0,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.weight,"onUpdate:modelValue":r=>e.weight=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.volume,"onUpdate:modelValue":r=>e.volume=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n.formData.subCommissionType?(u(),U(P,{key:1},[t(i,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.firstBrokeragePrice,"onUpdate:modelValue":r=>e.firstBrokeragePrice=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(i,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:o(({row:e})=>[t(w,{modelValue:e.secondBrokeragePrice,"onUpdate:modelValue":r=>e.secondBrokeragePrice=r,min:0,precision:2,step:.1,class:"w-100%","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})],64)):b("",!0),(a=n.formData)!=null&&a.specType?(u(),k(i,{key:2,align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"80"},{default:o(({row:e})=>[g.isBatch?(u(),k(S,{key:0,link:"",size:"small",type:"primary",onClick:n.batchAdd},{default:o(()=>V[0]||(V[0]=[f(" \u6279\u91CF\u6DFB\u52A0 ")])),_:1})):(u(),k(S,{key:1,link:"",size:"small",type:"primary",onClick:r=>n.deleteSku(e)},{default:o(()=>V[1]||(V[1]=[f("\u5220\u9664")])),_:2},1032,["onClick"]))]),_:1})):b("",!0)]}),_:1},8,["data"])),g.isDetail?(u(),k(n.ElTable,{key:1,ref:"activitySkuListRef",data:n.formData.skus,border:"","max-height":"500",size:"small",style:{width:"99%"},onSelectionChange:n.handleSelectionChange},{default:o(()=>[g.isComponent?(u(),k(i,{key:0,type:"selection",width:"45"})):b("",!0),t(i,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:o(({row:a})=>[a.picUrl?(u(),k(D,{key:0,src:a.picUrl,class:"h-50px w-50px",onClick:e=>n.imagePreview(a.picUrl)},null,8,["src","onClick"])):b("",!0)]),_:1}),n.formData.specType&&!g.isBatch?(u(!0),U(P,{key:1},L(n.tableHeaders,(a,e)=>(u(),k(i,{key:e,label:a.label,align:"center","min-width":"80"},{default:o(({row:r})=>{var y,v;return[I("span",le,m((v=(y=r.properties)==null?void 0:y[e])==null?void 0:v.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(i,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:o(({row:a})=>[f(m(a.barCode),1)]),_:1}),t(i,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(a.price),1)]),_:1}),t(i,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(a.marketPrice),1)]),_:1}),t(i,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(a.costPrice),1)]),_:1}),t(i,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:o(({row:a})=>[f(m(a.stock),1)]),_:1}),t(i,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"80"},{default:o(({row:a})=>[f(m(a.weight),1)]),_:1}),t(i,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"80"},{default:o(({row:a})=>[f(m(a.volume),1)]),_:1}),n.formData.subCommissionType?(u(),U(P,{key:2},[t(i,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(a.firstBrokeragePrice),1)]),_:1}),t(i,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(a.secondBrokeragePrice),1)]),_:1})],64)):b("",!0)]),_:1},8,["data"])):b("",!0),g.isActivityComponent?(u(),k(n.ElTable,{key:2,data:n.formData.skus,border:"","max-height":"500",size:"small",style:{width:"99%"}},{default:o(()=>[g.isComponent?(u(),k(i,{key:0,type:"selection",width:"45"})):b("",!0),t(i,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:o(({row:a})=>[t(D,{src:a.picUrl,class:"h-60px w-60px",onClick:e=>n.imagePreview(a.picUrl)},null,8,["src","onClick"])]),_:1}),n.formData.specType?(u(!0),U(P,{key:1},L(n.tableHeaders,(a,e)=>(u(),k(i,{key:e,label:a.label,align:"center","min-width":"80"},{default:o(({row:r})=>{var y,v;return[I("span",te,m((v=(y=r.properties)==null?void 0:y[e])==null?void 0:v.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(i,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:o(({row:a})=>[f(m(a.barCode),1)]),_:1}),t(i,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(n.formatToFraction(a.price)),1)]),_:1}),t(i,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(n.formatToFraction(a.marketPrice)),1)]),_:1}),t(i,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:o(({row:a})=>[f(m(n.formatToFraction(a.costPrice)),1)]),_:1}),t(i,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:o(({row:a})=>[f(m(a.stock),1)]),_:1}),Z(A.$slots,"extension")]),_:3},8,["data"])):b("",!0)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/product/spu/components/SkuList.vue"]]);export{ie as default};
