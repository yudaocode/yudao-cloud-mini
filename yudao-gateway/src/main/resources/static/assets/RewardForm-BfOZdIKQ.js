import{bz as g,d as G,g as j,D as M,r as p,f as z,aA as U,ao as B,G as K,U as Z,ay as H,eK as k,_ as J,o as c,q as v,w as o,k as l,m as R,I as Q,c as L,F as q,n as F,t as Y,ah as x,Z as W,L as X,M as $,ak as ee,al as ae,O as te,N as re,R as oe}from"./index-BaY5TDP-.js";import{_ as le}from"./Dialog-CZSXtzfQ.js";import ue from"./RewardRule-CVWz4Bbl.js";import de from"./SpuShowcase-DyUON5OE.js";import{l as C,k as n}from"./constants-CEEr2azc.js";import se from"./ProductCategorySelect-ClWAu1VZ.js";const ie=async m=>await g.get({url:"/promotion/reward-activity/page",params:m}),ce=async m=>await g.delete({url:"/promotion/reward-activity/delete?id="+m}),me=async m=>await g.put({url:"/promotion/reward-activity/close?id="+m}),N=J(G({name:"ProductBrandForm",__name:"RewardForm",emits:["success"],setup(m,{expose:t,emit:E}){const{t:e}=j(),V=M(),w=p(!1),T=p(""),u=p(!1),S=p(""),r=p({conditionType:C.PRICE.type,productScope:n.ALL.scope,rules:[]}),P=z({name:[{required:!0,message:"\u6D3B\u52A8\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],startAndEndTime:[{required:!0,message:"\u6D3B\u52A8\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionType:[{required:!0,message:"\u6761\u4EF6\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],productScope:[{required:!0,message:"\u5546\u54C1\u8303\u56F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productSpuIds:[{required:!0,message:"\u5546\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],productCategoryIds:[{required:!0,message:"\u5546\u54C1\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=p(),b=p(),D=async(d,s)=>{var i;if(w.value=!0,T.value=e("action."+d),S.value=d,a(),s){u.value=!0;try{const f=await(async y=>await g.get({url:"/promotion/reward-activity/get?id="+y}))(s);f.startAndEndTime=[f.startTime,f.endTime],(i=f.rules)==null||i.forEach(y=>{y.discountPrice=U(y.discountPrice||0),f.conditionType===C.PRICE.type&&(y.limit=U(y.limit||0))}),r.value=f,await O()}finally{u.value=!1}}};t({open:D});const I=E,a=()=>{r.value={conditionType:C.PRICE.type,productScope:n.ALL.scope,rules:[]}},O=async()=>{switch(r.value.productScope){case n.SPU.scope:r.value.productSpuIds=r.value.productScopeValues;break;case n.CATEGORY.scope:await B();let d=r.value.productScopeValues;Array.isArray(d)&&d.length===1&&(d=d[0]),r.value.productCategoryIds=d}};function A(d){switch(r.value.productScope){case n.SPU.scope:d.productScopeValues=r.value.productSpuIds;break;case n.CATEGORY.scope:d.productScopeValues=Array.isArray(r.value.productCategoryIds)?r.value.productCategoryIds:[r.value.productCategoryIds]}}const h={t:e,message:V,dialogVisible:w,dialogTitle:T,formLoading:u,formType:S,formData:r,formRules:P,formRef:_,rewardRuleRef:b,open:D,emit:I,submitForm:async()=>{var d;if(_.value&&await _.value.validate()){u.value=!0;try{(d=b.value)==null||d.setRuleCoupon();const s=H(r.value);s.startTime=s.startAndEndTime[0],s.endTime=s.startAndEndTime[1],delete s.startAndEndTime,s.rules.forEach(i=>{i.discountPrice=k(i.discountPrice||0),s.conditionType===C.PRICE.type&&(i.limit=k(i.limit||0))}),A(s),S.value==="create"?(await(async i=>await g.post({url:"/promotion/reward-activity/create",data:i}))(s),V.success(e("common.createSuccess"))):(await(async i=>await g.put({url:"/promotion/reward-activity/update",data:i}))(s),V.success(e("common.updateSuccess"))),w.value=!1,I("success")}finally{u.value=!1}}},resetForm:a,getProductScope:O,setProductScopeValues:A,RewardRule:ue,SpuShowcase:de,get DICT_TYPE(){return K},get getIntDictOptions(){return Z},get PromotionProductScopeEnum(){return n},ProductCategorySelect:se};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),[["render",function(m,t,E,e,V,w){const T=W,u=X,S=$,r=ee,P=ae,_=te,b=re,D=le,I=oe;return c(),v(D,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[9]||(t[9]=a=>e.dialogVisible=a),title:e.dialogTitle,width:"65%"},{footer:o(()=>[l(b,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:o(()=>t[10]||(t[10]=[R("\u786E \u5B9A")])),_:1},8,["disabled"]),l(b,{onClick:t[8]||(t[8]=a=>e.dialogVisible=!1)},{default:o(()=>t[11]||(t[11]=[R("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Q((c(),v(_,{ref:"formRef",model:e.formData,rules:e.formRules,"label-width":"80px"},{default:o(()=>[l(u,{label:"\u6D3B\u52A8\u540D\u79F0",prop:"name"},{default:o(()=>[l(T,{modelValue:e.formData.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.formData.name=a),placeholder:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u6D3B\u52A8\u65F6\u95F4",prop:"startAndEndTime"},{default:o(()=>[l(S,{modelValue:e.formData.startAndEndTime,"onUpdate:modelValue":t[1]||(t[1]=a=>e.formData.startAndEndTime=a),"end-placeholder":e.t("common.endTimeText"),"start-placeholder":e.t("common.startTimeText"),"range-separator":"-",type:"datetimerange","value-format":"x"},null,8,["modelValue","end-placeholder","start-placeholder"])]),_:1}),l(u,{label:"\u6761\u4EF6\u7C7B\u578B",prop:"conditionType"},{default:o(()=>[l(P,{modelValue:e.formData.conditionType,"onUpdate:modelValue":t[2]||(t[2]=a=>e.formData.conditionType=a)},{default:o(()=>[(c(!0),L(q,null,F(e.getIntDictOptions(e.DICT_TYPE.PROMOTION_CONDITION_TYPE),a=>(c(),v(r,{key:a.value,label:a.value},{default:o(()=>[R(Y(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"\u4F18\u60E0\u8BBE\u7F6E"},{default:o(()=>[l(e.RewardRule,{ref:"rewardRuleRef",modelValue:e.formData,"onUpdate:modelValue":t[3]||(t[3]=a=>e.formData=a)},null,8,["modelValue"])]),_:1}),l(u,{label:"\u6D3B\u52A8\u8303\u56F4",prop:"productScope"},{default:o(()=>[l(P,{modelValue:e.formData.productScope,"onUpdate:modelValue":t[4]||(t[4]=a=>e.formData.productScope=a)},{default:o(()=>[(c(!0),L(q,null,F(e.getIntDictOptions(e.DICT_TYPE.PROMOTION_PRODUCT_SCOPE),a=>(c(),v(r,{key:a.value,label:a.value},{default:o(()=>[R(Y(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.formData.productScope===e.PromotionProductScopeEnum.SPU.scope?(c(),v(u,{key:0,prop:"productSpuIds"},{default:o(()=>[l(e.SpuShowcase,{modelValue:e.formData.productSpuIds,"onUpdate:modelValue":t[5]||(t[5]=a=>e.formData.productSpuIds=a)},null,8,["modelValue"])]),_:1})):x("",!0),e.formData.productScope===e.PromotionProductScopeEnum.CATEGORY.scope?(c(),v(u,{key:1,label:"\u5206\u7C7B",prop:"productCategoryIds"},{default:o(()=>[l(e.ProductCategorySelect,{modelValue:e.formData.productCategoryIds,"onUpdate:modelValue":t[6]||(t[6]=a=>e.formData.productCategoryIds=a),multiple:!0},null,8,["modelValue"])]),_:1})):x("",!0),l(u,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[l(T,{modelValue:e.formData.remark,"onUpdate:modelValue":t[7]||(t[7]=a=>e.formData.remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[I,e.formLoading]])]),_:1},8,["modelValue","title"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/rewardActivity/RewardForm.vue"]]),pe=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"}));export{N as R,pe as a,me as c,ce as d,ie as g};
