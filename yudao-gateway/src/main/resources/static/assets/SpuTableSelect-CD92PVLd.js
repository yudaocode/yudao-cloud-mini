import{d as A,p as N,r as i,C as Q,bJ as E,_ as z,o as q,q as U,cc as O,w as t,k as o,m as w,Y,I as D,j,t as M,Z as H,L as R,M as B,z as F,N as J,O as K,ai as Z,P as G,ak as W,Q as X,R as $}from"./index-BaY5TDP-.js";import{_ as ee}from"./Dialog-CZSXtzfQ.js";import{_ as ae}from"./ContentWrap-DKQn7kZm.js";import{_ as le}from"./index-avjYFQiD.js";import{E as de}from"./el-image-Bg-CwbDE.js";import{E as oe}from"./el-tree-select-DphqCDCz.js";import{h as te,d as ue}from"./tree-z7HkrWVC.js";import{g as re}from"./category-B7jjsMOS.js";import{d as ie}from"./spu-BVX48OKx.js";import"./index-DrSdAlug.js";const se=z(A({name:"SpuTableSelect",__name:"SpuTableSelect",props:{multiple:N.bool.def(!1)},emits:["change"],setup(L,{expose:l,emit:b}){const e=i(0),m=i([]),V=i(!1),c=i(!1),p=i({pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]}),k=a=>{n.value=[],u.value={},s.value=!1,v.value=!1,a&&a.length>0&&(n.value=[...a],u.value=Object.fromEntries(a.map(r=>[r.id,!0]))),c.value=!0,f()};l({open:k});const h=async()=>{V.value=!0;try{const a=await ie(p.value);m.value=a.list,e.value=a.total,m.value.forEach(r=>u.value[r.id]=u.value[r.id]||!1),g()}finally{V.value=!1}},f=()=>{p.value={pageNo:1,pageSize:10,tabType:0,name:"",categoryId:null,createTime:[]},h()},s=i(!1),v=i(!1),n=i([]),u=i({}),S=i(),y=b,C=(a,r,x)=>{if(a)n.value.push(r),u.value[r.id]=!0;else{const T=I(r);T>-1&&(n.value.splice(T,1),u.value[r.id]=!1,s.value=!1)}x&&g()},I=a=>n.value.findIndex(r=>r.id===a.id),g=()=>{s.value=m.value.every(a=>u.value[a.id]),v.value=!s.value&&m.value.some(a=>u.value[a.id])},_=i(),P=i();Q(async()=>{await h(),_.value=await re({}),P.value=te(_.value,"id","parentId")});const d={total:e,list:m,loading:V,dialogVisible:c,queryParams:p,open:k,getList:h,handleQuery:()=>{p.value.pageNo=1,h()},resetQuery:f,isCheckAll:s,isIndeterminate:v,checkedSpus:n,checkedStatus:u,selectedSpuId:S,handleSingleSelected:a=>{y(E,a),c.value=!1,S.value=a.id},handleEmitChange:()=>{c.value=!1,y(E,[...n.value])},emits:y,handleCheckAll:a=>{s.value=a,v.value=!1,m.value.forEach(r=>C(a,r,!1))},handleCheckOne:C,findCheckedIndex:I,calculateIsCheckAll:g,categoryList:_,categoryTreeList:P,get defaultProps(){return ue}};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}}),[["render",function(L,l,b,e,m,V){const c=H,p=R,k=oe,h=B,f=F,s=J,v=K,n=Z,u=G,S=W,y=de,C=X,I=le,g=ae,_=ee,P=$;return q(),U(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[8]||(l[8]=d=>e.dialogVisible=d),appendToBody:!0,title:"\u9009\u62E9\u5546\u54C1",width:"70%"},O({default:t(()=>[o(g,null,{default:t(()=>[o(v,{ref:"queryFormRef",inline:!0,model:e.queryParams,class:"-mb-15px","label-width":"68px"},{default:t(()=>[o(p,{label:"\u5546\u54C1\u540D\u79F0",prop:"name"},{default:t(()=>[o(c,{modelValue:e.queryParams.name,"onUpdate:modelValue":l[0]||(l[0]=d=>e.queryParams.name=d),class:"!w-240px",clearable:"",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",onKeyup:Y(e.handleQuery,["enter"])},null,8,["modelValue"])]),_:1}),o(p,{label:"\u5546\u54C1\u5206\u7C7B",prop:"categoryId"},{default:t(()=>[o(k,{modelValue:e.queryParams.categoryId,"onUpdate:modelValue":l[1]||(l[1]=d=>e.queryParams.categoryId=d),data:e.categoryTreeList,props:e.defaultProps,"check-strictly":"",class:"!w-240px","node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5546\u54C1\u5206\u7C7B"},null,8,["modelValue","data","props"])]),_:1}),o(p,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:t(()=>[o(h,{modelValue:e.queryParams.createTime,"onUpdate:modelValue":l[2]||(l[2]=d=>e.queryParams.createTime=d),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px","end-placeholder":"\u7ED3\u675F\u65E5\u671F","start-placeholder":"\u5F00\u59CB\u65E5\u671F",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),o(p,null,{default:t(()=>[o(s,{onClick:e.handleQuery},{default:t(()=>[o(f,{class:"mr-5px",icon:"ep:search"}),l[9]||(l[9]=w(" \u641C\u7D22 "))]),_:1}),o(s,{onClick:e.resetQuery},{default:t(()=>[o(f,{class:"mr-5px",icon:"ep:refresh"}),l[10]||(l[10]=w(" \u91CD\u7F6E "))]),_:1})]),_:1})]),_:1},8,["model"]),D((q(),U(C,{data:e.list,"show-overflow-tooltip":""},{default:t(()=>[b.multiple?(q(),U(u,{key:0,width:"55"},{header:t(()=>[o(n,{modelValue:e.isCheckAll,"onUpdate:modelValue":l[3]||(l[3]=d=>e.isCheckAll=d),indeterminate:e.isIndeterminate,onChange:e.handleCheckAll},null,8,["modelValue","indeterminate"])]),default:t(({row:d})=>[o(n,{modelValue:e.checkedStatus[d.id],"onUpdate:modelValue":a=>e.checkedStatus[d.id]=a,onChange:a=>e.handleCheckOne(a,d,!0)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):(q(),U(u,{key:1,label:"#",width:"55"},{default:t(({row:d})=>[o(S,{value:d.id,modelValue:e.selectedSpuId,"onUpdate:modelValue":l[4]||(l[4]=a=>e.selectedSpuId=a),onChange:a=>e.handleSingleSelected(d)},{default:t(()=>l[11]||(l[11]=[w(" \xA0 ")])),_:2},1032,["value","modelValue","onChange"])]),_:1})),o(u,{key:"id",align:"center",label:"\u5546\u54C1\u7F16\u53F7",prop:"id","min-width":"60"}),o(u,{label:"\u5546\u54C1\u56FE","min-width":"80"},{default:t(({row:d})=>[o(y,{src:d.picUrl,class:"h-30px w-30px","preview-src-list":[d.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),o(u,{label:"\u5546\u54C1\u540D\u79F0","min-width":"200",prop:"name"}),o(u,{label:"\u5546\u54C1\u5206\u7C7B","min-width":"100",prop:"categoryId"},{default:t(({row:d})=>{var a,r;return[j("span",null,M((r=(a=e.categoryList)==null?void 0:a.find(x=>x.id===d.categoryId))==null?void 0:r.name),1)]}),_:1})]),_:1},8,["data"])),[[P,e.loading]]),o(I,{limit:e.queryParams.pageSize,"onUpdate:limit":l[5]||(l[5]=d=>e.queryParams.pageSize=d),page:e.queryParams.pageNo,"onUpdate:page":l[6]||(l[6]=d=>e.queryParams.pageNo=d),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1})]),_:2},[b.multiple?{name:"footer",fn:t(()=>[o(s,{type:"primary",onClick:e.handleEmitChange},{default:t(()=>l[12]||(l[12]=[w("\u786E \u5B9A")])),_:1}),o(s,{onClick:l[7]||(l[7]=d=>e.dialogVisible=!1)},{default:t(()=>l[13]||(l[13]=[w("\u53D6 \u6D88")])),_:1})]),key:"0"}:void 0]),1032,["modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/product/spu/components/SpuTableSelect.vue"]]);export{se as default};
