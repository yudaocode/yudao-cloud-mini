import{d as N,r as u,u as j,D as L,ao as O,a as q,_ as X,am as J,o as I,q as C,w as r,j as S,k as o,t as z,I as W,c as B,ah as F,m as M,x as $,v as G,E as H,aq as K,A as Q,B as Y,z as Z,N as ee,R as ae}from"./index-BaY5TDP-.js";import{_ as te}from"./ContentWrap-DKQn7kZm.js";import{d as oe,b as se}from"./formCreate-Dy2BGZHq.js";import{a as ie}from"./constants-CEEr2azc.js";import{m as re,C as le,F as A}from"./consts-vgsb8q48.js";import ne from"./ProcessInstanceBpmnViewer-CwVPQ6L9.js";import me from"./ProcessInstanceSimpleViewer-DBZzCdFr.js";import ce from"./ProcessInstanceTimeline-CvaFNncS.js";import{u as pe}from"./tagsView-lnAkwTv2.js";import{g as de,e as ue}from"./index-BJQN17A_.js";import{a as fe}from"./index-5lnhJJF7.js";import"./bpmn-embedded-Bxfb97Hp.js";import"./Dialog-CZSXtzfQ.js";import"./XTextButton-Cf-hbTFF.js";import"./XButton-BcV39lfk.js";import"./index-CuAlllbQ.js";import"./utils-DQEYWnsS.js";import"./index-ZFL2ufyC.js";import"./index-BCN8BzfC.js";import"./index-BeYJ8u62.js";import"./el-tree-select-DphqCDCz.js";import"./tree-z7HkrWVC.js";import"./index-C7Vgvn4F.js";import"./index-dK17nfjs.js";import"./index-D-_5jDBN.js";import"./index-RbAZqEQx.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-D-US79ui.js";import"./el-drawer-r3cMvY4i.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-l60I0Cke.js";import"./formatTime-Dr6TiYYc.js";import"./simple-process-designer-DviJ9JIp.js";import"./el-space-B4pGZPiv.js";import"./download-oWiM5xVU.js";import"./index-uy0_B-js.js";import"./el-timeline-item-BFYwlQ-d.js";import"./el-image-Bg-CwbDE.js";import"./el-avatar-DZsRbb7z.js";const ve={class:"processInstance-wrap-main"},ye={class:"text-#878c93 h-15px"},be={class:"form-scroll-area"},_e={class:"form-scroll-area"},Pe={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Ie={key:0,class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},we=X(N({name:"ProcessDefinitionDetail",__name:"ProcessDefinitionDetail",props:{selectProcessDefinition:{type:null,required:!0}},emits:["cancel"],setup(U,{expose:s,emit:b}){const e=U,g=b,w=u(!1),{push:_,currentRoute:D}=j(),v=L(),{delView:T}=pe(),y=u({rule:[],option:{},value:{}}),l=u(),p=u([]),n=u({}),P=u(null),h=u(),x=u("form"),f=u([]),V=async(a,t)=>{var m;if(p.value=[],n.value={},a.formType==10){const d=oe(a.formFields).map(i=>i.field);for(const i in t)d.includes(i)||delete t[i];se(y,a.formConf,a.formFields,t),await O(),(m=l.value)==null||m.btn.show(!1),await E(a);const c=await fe(a.id);c&&(P.value=c.bpmnXml,h.value=c.simpleModel)}else a.formCustomCreatePath&&await _({path:a.formCustomCreatePath})},E=async a=>{var t,m;try{const d=await de({processDefinitionId:a.id,activityId:re.START_USER_NODE_ID});if(!d)return void v.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(p.value=(t=d.activityNodes)==null?void 0:t.filter(i=>le.START_USER_SELECT===i.candidateStrategy),((m=p.value)==null?void 0:m.length)>0)for(const i of p.value)n.value[i.id]=[];f.value=d.activityNodes;const c=d.formFieldsPermission;c&&Object.keys(c).forEach(i=>{R(i,c[i])})}finally{}},R=(a,t)=>{var m,d,c;t===A.READ&&((m=l.value)==null||m.disabled(!0,a)),t===A.WRITE&&((d=l.value)==null||d.disabled(!1,a)),t===A.NONE&&((c=l.value)==null||c.hidden(!0,a))};s({initProcessInfo:V});const k={props:e,emit:g,processInstanceStartLoading:w,push:_,currentRoute:D,message:v,delView:T,detailForm:y,fApi:l,startUserSelectTasks:p,startUserSelectAssignees:n,bpmnXML:P,simpleJson:h,activeTab:x,activityNodes:f,initProcessInfo:V,getApprovalDetail:E,setFieldPermission:R,submitForm:async()=>{var a;if(l.value&&e.selectProcessDefinition){if(await l.value.validate(),((a=p.value)==null?void 0:a.length)>0){for(const t of p.value)if(Array.isArray(n.value[t.id])&&n.value[t.id].length===0)return v.warning(`\u8BF7\u9009\u62E9${t.name}\u7684\u5019\u9009\u4EBA`)}w.value=!0;try{await ue({processDefinitionId:e.selectProcessDefinition.id,variables:y.value.value,startUserSelectAssignees:n.value}),v.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),T(q(D)),await _({name:"BpmProcessInstanceMy"})}finally{w.value=!1}}},handleCancel:()=>{g("cancel")},selectUserConfirm:(a,t)=>{n.value[a]=t==null?void 0:t.map(m=>m.id)},get BpmModelType(){return ie},ProcessInstanceBpmnViewer:ne,ProcessInstanceSimpleViewer:me,ProcessInstanceTimeline:ce};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}}),[["render",function(U,s,b,e,g,w){const _=$,D=J("form-create"),v=G,T=H,y=K,l=Q,p=Y,n=Z,P=ee,h=te,x=ae;return I(),C(h,{bodyStyle:{padding:"10px 20px 0"}},{default:r(()=>[S("div",ve,[o(y,null,{default:r(()=>[S("div",ye,"\u6D41\u7A0B\uFF1A"+z(b.selectProcessDefinition.name),1),o(_,{class:"!my-8px"}),o(p,{modelValue:e.activeTab,"onUpdate:modelValue":s[2]||(s[2]=f=>e.activeTab=f)},{default:r(()=>[o(l,{label:"\u8868\u5355\u586B\u5199",name:"form"},{default:r(()=>[W((I(),B("div",be,[o(y,null,{default:r(()=>[o(T,null,{default:r(()=>[o(v,{span:17},{default:r(()=>[o(D,{rule:e.detailForm.rule,api:e.fApi,"onUpdate:api":s[0]||(s[0]=f=>e.fApi=f),modelValue:e.detailForm.value,"onUpdate:modelValue":s[1]||(s[1]=f=>e.detailForm.value=f),option:e.detailForm.option,onSubmit:e.submitForm},null,8,["rule","api","modelValue","option"])]),_:1}),o(v,{span:6,offset:1},{default:r(()=>[o(e.ProcessInstanceTimeline,{ref:"timelineRef","activity-nodes":e.activityNodes,"show-status-icon":!1,onSelectUserConfirm:e.selectUserConfirm},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])),[[x,e.processInstanceStartLoading]])]),_:1}),o(l,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:r(()=>[S("div",_e,[e.BpmModelType.BPMN===b.selectProcessDefinition.modelType?(I(),C(e.ProcessInstanceBpmnViewer,{key:0,"bpmn-xml":e.bpmnXML},null,8,["bpmn-xml"])):F("",!0),e.BpmModelType.SIMPLE===b.selectProcessDefinition.modelType?(I(),C(e.ProcessInstanceSimpleViewer,{key:1,"simple-json":e.simpleJson},null,8,["simple-json"])):F("",!0)])]),_:1})]),_:1},8,["modelValue"]),S("div",Pe,[e.activeTab==="form"?(I(),B("div",Ie,[o(P,{plain:"",type:"success",onClick:e.submitForm},{default:r(()=>[o(n,{icon:"ep:select"}),s[3]||(s[3]=M("\xA0 \u53D1\u8D77 "))]),_:1}),o(P,{plain:"",type:"danger",onClick:e.handleCancel},{default:r(()=>[o(n,{icon:"ep:close"}),s[4]||(s[4]=M("\xA0 \u53D6\u6D88 "))]),_:1})])):F("",!0)])]),_:1})])]),_:1})}],["__scopeId","data-v-6c5233f7"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/processInstance/create/ProcessDefinitionDetail.vue"]]);export{we as default};
