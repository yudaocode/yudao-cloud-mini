import{bz as m,d as A,g as C,D as z,r as u,f as M,b as E,au as B,e4 as J,_ as K,o as c,q as p,w as i,m as O,ah as Q,k as l,I as W,c as x,F as S,n as q,Z,L as G,v as H,M as X,J as Y,K as $,cq as ee,E as ae,A as le,B as te,cf as ie,O as re,N as oe,R as de}from"./index-BaY5TDP-.js";import{_ as ue}from"./Dialog-CZSXtzfQ.js";import{_ as se}from"./ContentWrap-DKQn7kZm.js";import ce from"./FinanceReceiptItemForm-D_871uKT.js";import{g as ne}from"./index-CuAlllbQ.js";import{A as me}from"./index-hc6npfaY.js";import{C as pe}from"./index-DV7H_W_F.js";const k={getFinanceReceiptPage:async o=>await m.get({url:"/erp/finance-receipt/page",params:o}),getFinanceReceipt:async o=>await m.get({url:"/erp/finance-receipt/get?id="+o}),createFinanceReceipt:async o=>await m.post({url:"/erp/finance-receipt/create",data:o}),updateFinanceReceipt:async o=>await m.put({url:"/erp/finance-receipt/update",data:o}),updateFinanceReceiptStatus:async(o,t)=>await m.put({url:"/erp/finance-receipt/update-status",params:{id:o,status:t}}),deleteFinanceReceipt:async o=>await m.delete({url:"/erp/finance-receipt/delete",params:{ids:o.join(",")}}),exportFinanceReceipt:async o=>await m.download({url:"/erp/finance-receipt/export-excel",params:o})},j=K(A({name:"FinanceReceiptForm",__name:"FinanceReceiptForm",emits:["success"],setup(o,{expose:t,emit:N}){const{t:a}=C(),w=z(),y=u(!1),n=u(""),r=u(!1),d=u(""),s=u({id:void 0,customerId:void 0,accountId:void 0,financeUserId:void 0,receiptTime:void 0,remark:void 0,fileUrl:"",totalPrice:0,discountPrice:0,receiptPrice:0,items:[],no:void 0}),f=M({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],receiptTime:[{required:!0,message:"\u8BA2\u5355\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=E(()=>d.value==="detail"),v=u(),_=u([]),V=u([]),D=u([]),T=u("item"),I=u();B(()=>s.value,e=>{if(!e)return;const F=e.items.reduce((h,L)=>h+L.receiptPrice,0);s.value.totalPrice=F,s.value.receiptPrice=F-e.discountPrice},{deep:!0});const P=async(e,F)=>{if(y.value=!0,n.value=a("action."+e),d.value=e,U(),F){r.value=!0;try{s.value=await k.getFinanceReceipt(F)}finally{r.value=!1}}_.value=await pe.getCustomerSimpleList(),D.value=await ne(),V.value=await me.getAccountSimpleList();const h=V.value.find(L=>L.defaultStatus);h&&(s.value.accountId=h.id)};t({open:P});const g=N,U=()=>{var e;s.value={id:void 0,customerId:void 0,accountId:void 0,financeUserId:void 0,receiptTime:void 0,remark:void 0,fileUrl:void 0,totalPrice:0,discountPrice:0,receiptPrice:0,items:[],no:void 0},(e=v.value)==null||e.resetFields()},R={t:a,message:w,dialogVisible:y,dialogTitle:n,formLoading:r,formType:d,formData:s,formRules:f,disabled:b,formRef:v,customerList:_,accountList:V,userList:D,subTabsName:T,itemFormRef:I,open:P,emit:g,submitForm:async()=>{await v.value.validate(),await I.value.validate(),r.value=!0;try{const e=s.value;d.value==="create"?(await k.createFinanceReceipt(e),w.success(a("common.createSuccess"))):(await k.updateFinanceReceipt(e),w.success(a("common.updateSuccess"))),y.value=!1,g("success")}finally{r.value=!1}},resetForm:U,FinanceReceiptItemForm:ce,get erpPriceInputFormatter(){return J}};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),[["render",function(o,t,N,a,w,y){const n=Z,r=G,d=H,s=X,f=Y,b=$,v=ee,_=ae,V=le,D=te,T=se,I=ie,P=re,g=oe,U=ue,R=de;return c(),p(U,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>a.dialogVisible=e),width:"1080"},{footer:i(()=>[a.disabled?Q("",!0):(c(),p(g,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:i(()=>t[13]||(t[13]=[O(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(g,{onClick:t[11]||(t[11]=e=>a.dialogVisible=!1)},{default:i(()=>t[14]||(t[14]=[O("\u53D6 \u6D88")])),_:1})]),default:i(()=>[W((c(),p(P,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:i(()=>[l(_,{gutter:20},{default:i(()=>[l(d,{span:8},{default:i(()=>[l(r,{label:"\u6536\u6B3E\u5355\u53F7",prop:"no"},{default:i(()=>[l(n,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":t[0]||(t[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u6536\u6B3E\u65F6\u95F4",prop:"receiptTime"},{default:i(()=>[l(s,{modelValue:a.formData.receiptTime,"onUpdate:modelValue":t[1]||(t[1]=e=>a.formData.receiptTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u6536\u6B3E\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u5BA2\u6237",prop:"customerId"},{default:i(()=>[l(b,{modelValue:a.formData.customerId,"onUpdate:modelValue":t[2]||(t[2]=e=>a.formData.customerId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"!w-1/1"},{default:i(()=>[(c(!0),x(S,null,q(a.customerList,e=>(c(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u8D22\u52A1\u4EBA\u5458",prop:"financeUserId"},{default:i(()=>[l(b,{modelValue:a.formData.financeUserId,"onUpdate:modelValue":t[3]||(t[3]=e=>a.formData.financeUserId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u8D22\u52A1\u4EBA\u5458",class:"!w-1/1"},{default:i(()=>[(c(!0),x(S,null,q(a.userList,e=>(c(),p(f,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:16},{default:i(()=>[l(r,{label:"\u5907\u6CE8",prop:"remark"},{default:i(()=>[l(n,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":t[4]||(t[4]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:i(()=>[l(v,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":t[5]||(t[5]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,null,{default:i(()=>[l(D,{modelValue:a.subTabsName,"onUpdate:modelValue":t[6]||(t[6]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:i(()=>[l(V,{label:"\u91C7\u8D2D\u5165\u5E93\u3001\u9000\u8D27\u5355",name:"item"},{default:i(()=>[l(a.FinanceReceiptItemForm,{ref:"itemFormRef","customer-id":a.formData.customerId,items:a.formData.items,disabled:a.disabled},null,8,["customer-id","items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(_,{gutter:20},{default:i(()=>[l(d,{span:8},{default:i(()=>[l(r,{label:"\u6536\u6B3E\u8D26\u6237",prop:"accountId"},{default:i(()=>[l(b,{modelValue:a.formData.accountId,"onUpdate:modelValue":t[7]||(t[7]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:i(()=>[(c(!0),x(S,null,q(a.accountList,e=>(c(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u5408\u8BA1\u6536\u6B3E",prop:"totalPrice"},{default:i(()=>[l(n,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":t[8]||(t[8]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u4F18\u60E0\u91D1\u989D",prop:"discountPrice"},{default:i(()=>[l(I,{modelValue:a.formData.discountPrice,"onUpdate:modelValue":t[9]||(t[9]=e=>a.formData.discountPrice=e),"controls-position":"right",precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u91D1\u989D",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:8},{default:i(()=>[l(r,{label:"\u5B9E\u9645\u6536\u6B3E"},{default:i(()=>[l(n,{disabled:"",modelValue:a.formData.receiptPrice,"onUpdate:modelValue":t[10]||(t[10]=e=>a.formData.receiptPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[R,a.formLoading]])]),_:1},8,["title","modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/finance/receipt/FinanceReceiptForm.vue"]]),fe=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"}));export{k as F,j as a,fe as b};
