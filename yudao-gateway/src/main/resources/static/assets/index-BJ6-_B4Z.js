import{d as F,D as S,r as s,eF as b,eG as M,au as k,eL as L,C as E,av as R,_ as y,o as K,q as x,w as I,k as f,b7 as w}from"./index-BaY5TDP-.js";import A from"./KeFuConversationList-DLcVcO8M.js";import N from"./KeFuMessageList-g61FS8dW.js";import D from"./MemberInfo-BpD6K-nP.js";import{u as G,W as _}from"./kefu-CpQb7Flh.js";import"./el-avatar-DZsRbb7z.js";import"./emoji-D4-VYurZ.js";import"./formatTime-Dr6TiYYc.js";import"./el-empty-wTPt5q4m.js";import"./el-image-Bg-CwbDE.js";import"./EmojiSelectPopover-DCYXKLfh.js";import"./PictureSelectUpload-CsCtadzn.js";import"./picture-CTjip5lJ.js";import"./ProductItem-B-fB2q4x.js";import"./OrderItem-DNgvh09i.js";import"./constants-CEEr2azc.js";import"./ProductBrowsingHistory-Bct-6M6F.js";import"./concat-C9cLR7iJ.js";import"./OrderBrowsingHistory-DfwP2eRo.js";import"./index-B6VQ3j6W.js";import"./CardTitle-Z2xLAPly.js";import"./UserBasicInfo-XwNP3Edg.js";import"./el-descriptions-item-CRF_CO88.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./el-collapse-transition-l0sNRNKZ.js";import"./Descriptions.vue_vue_type_style_index_0_scoped_aee191e8_lang-B_BAqhyt.js";import"./DescriptionsItemLabel-htYg8uGg.js";import"./UserAccountInfo-DzbKHh2V.js";import"./index-DzP0w9x-.js";import"./index-BI4JaB4e.js";const O=y(F({name:"KeFu",__name:"index",setup(C,{expose:l}){l();const i=S(),t=G(),n=s("http://localhost:48080/infra/ws".replace("http","ws")+"?token="+b()),{data:m,close:a,open:c}=M(n.value,{autoReconnect:!0,heartbeat:!0});k(()=>m.value,e=>{var o;if(e)try{if(e==="pong")return;const r=JSON.parse(e),u=r.type;if(!u)return void i.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+e);if(u===_.KEFU_MESSAGE_TYPE){const h=JSON.parse(r.content);return t.updateConversation(h.conversationId),void((o=p.value)==null?void 0:o.refreshMessageList(h))}u===_.KEFU_MESSAGE_ADMIN_READ&&t.updateConversationStatus(L(r.content))}catch(r){console.error(r)}},{immediate:!1});const p=s(),v=s(),d=s();E(()=>{t.setConversationList().then(()=>{var e;(e=d.value)==null||e.calculationLastMessageTime()}),c()}),R(()=>{a()});const g={message:i,kefuStore:t,server:n,data:m,close:a,open:c,keFuChatBoxRef:p,memberInfoRef:v,handleChange:e=>{var o,r;(o=p.value)==null||o.getNewMessageList(e),(r=v.value)==null||r.initHistory(e)},keFuConversationRef:d,get KeFuConversationList(){return A},get KeFuMessageList(){return N},get MemberInfo(){return D}};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),[["render",function(C,l,i,t,n,m){const a=w;return K(),x(a,{class:"kefu-layout"},{default:I(()=>[f(t.KeFuConversationList,{ref:"keFuConversationRef",onChange:t.handleChange},null,512),f(t.KeFuMessageList,{ref:"keFuChatBoxRef"},null,512),f(t.MemberInfo,{ref:"memberInfoRef"},null,512)]),_:1})}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/kefu/index.vue"]]);export{O as default};
