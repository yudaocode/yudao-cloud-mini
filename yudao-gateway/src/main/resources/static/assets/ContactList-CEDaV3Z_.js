import{d as N,r as p,f as P,D as R,u as k,au as L,G as B,_ as M,X as T,o as m,c as x,k as t,w as c,m as C,I as h,q as f,ah as v,t as D,F as E,z as F,N as U,E as O,P as j,y as A,Q as G,R as Q}from"./index-BaY5TDP-.js";import{_ as Y}from"./ContentWrap-DKQn7kZm.js";import{_ as X}from"./index-avjYFQiD.js";import{_ as H}from"./DictTag-QtcI9ZjC.js";import{d as J,g as K,e as V,f as W}from"./index-DiJG1eDb.js";import Z from"./ContactForm-DLuG_ZcF.js";import{B as z}from"./index-BlslFSYd.js";import $ from"./ContactListModal-DsE0FODx.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";import"./Dialog-CZSXtzfQ.js";import"./index-CuAlllbQ.js";import"./index-h6ObHKtQ.js";import"./index-Qzz5HSIB.js";import"./tree-z7HkrWVC.js";const ee=M(N({name:"CrmContactList",__name:"ContactList",props:{bizType:{type:Number,required:!0},bizId:{type:Number,required:!0},customerId:{type:Number,required:!1},businessId:{type:Number,required:!1}},setup(q,{expose:o}){o();const s=q,e=p(!0),w=p(0),S=p([]),r=P({pageNo:1,pageSize:10,customerId:void 0,businessId:void 0}),l=R(),b=async()=>{e.value=!0;try{r.customerId=void 0;let a={list:[],total:0};switch(s.bizType){case z.CRM_CUSTOMER:r.customerId=s.bizId,a=await K(r);break;case z.CRM_BUSINESS:r.businessId=s.bizId,a=await J(r);break;default:return}S.value=a.list,w.value=a.total}finally{e.value=!1}},i=()=>{r.pageNo=1,b()},y=p(),{push:I}=k(),g=p(),d=p();L(()=>[s.bizId,s.bizType],()=>{i()},{immediate:!0,deep:!0});const _={props:s,loading:e,total:w,list:S,queryParams:r,message:l,getList:b,handleQuery:i,formRef:y,openForm:()=>{y.value.open("create",void 0,s.customerId,s.businessId)},push:I,openDetail:a=>{I({name:"CrmContactDetail",params:{id:a}})},contactModalRef:g,openBusinessModal:()=>{g.value.open()},createContactBusinessList:async a=>{const u={businessId:s.bizId,contactIds:a};d.value.getSelectionRows().forEach(n=>{u.contactIds.push(n.id)}),await V(u),l.success("\u5173\u8054\u8054\u7CFB\u4EBA\u6210\u529F"),i()},contactRef:d,deleteContactBusinessList:async()=>{const a={businessId:s.bizId,contactIds:d.value.getSelectionRows().map(u=>u.id)};if(a.contactIds.length===0)return l.error("\u672A\u9009\u62E9\u8054\u7CFB\u4EBA");await W(a),l.success("\u53D6\u5173\u8054\u7CFB\u4EBA\u6210\u529F"),i()},ContactForm:Z,get DICT_TYPE(){return B},ContactListModal:$};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),[["render",function(q,o,s,e,w,S){const r=F,l=U,b=O,i=j,y=A,I=H,g=G,d=X,_=Y,a=T("hasPermi"),u=Q;return m(),x(E,null,[t(b,{justify:"end"},{default:c(()=>[t(l,{onClick:e.openForm},{default:c(()=>[t(r,{class:"mr-5px",icon:"system-uicons:contacts"}),o[2]||(o[2]=C(" \u521B\u5EFA\u8054\u7CFB\u4EBA "))]),_:1}),e.queryParams.businessId?h((m(),f(l,{key:0,onClick:e.openBusinessModal},{default:c(()=>[t(r,{class:"mr-5px",icon:"ep:circle-plus"}),o[3]||(o[3]=C(" \u5173\u8054 "))]),_:1})),[[a,["crm:contact:create-business"]]]):v("",!0),e.queryParams.businessId?h((m(),f(l,{key:1,onClick:e.deleteContactBusinessList},{default:c(()=>[t(r,{class:"mr-5px",icon:"ep:remove"}),o[4]||(o[4]=C(" \u89E3\u9664\u5173\u8054 "))]),_:1})),[[a,["crm:contact:delete-business"]]]):v("",!0)]),_:1}),t(_,{class:"mt-10px"},{default:c(()=>[h((m(),f(g,{ref:"contactRef",data:e.list,"show-overflow-tooltip":!0,stripe:!0},{default:c(()=>[e.queryParams.businessId?(m(),f(i,{key:0,type:"selection",width:"55"})):v("",!0),t(i,{align:"center",fixed:"left",label:"\u59D3\u540D",prop:"name"},{default:c(n=>[t(y,{underline:!1,type:"primary",onClick:te=>e.openDetail(n.row.id)},{default:c(()=>[C(D(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),t(i,{align:"center",label:"\u624B\u673A\u53F7",prop:"mobile"}),t(i,{align:"center",label:"\u804C\u4F4D",prop:"post"}),t(i,{align:"center",label:"\u76F4\u5C5E\u4E0A\u7EA7",prop:"parentName"}),t(i,{align:"center",label:"\u662F\u5426\u5173\u952E\u51B3\u7B56\u4EBA","min-width":"100",prop:"master"},{default:c(n=>[t(I,{type:e.DICT_TYPE.INFRA_BOOLEAN_STRING,value:n.row.master},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[u,e.loading]]),t(d,{limit:e.queryParams.pageSize,"onUpdate:limit":o[0]||(o[0]=n=>e.queryParams.pageSize=n),page:e.queryParams.pageNo,"onUpdate:page":o[1]||(o[1]=n=>e.queryParams.pageNo=n),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1}),t(e.ContactForm,{ref:"formRef",onSuccess:e.getList},null,512),s.customerId?(m(),f(e.ContactListModal,{key:0,ref:"contactModalRef","customer-id":s.customerId,onSuccess:e.createContactBusinessList},null,8,["customer-id"])):v("",!0)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/contact/components/ContactList.vue"]]);export{ee as default};
