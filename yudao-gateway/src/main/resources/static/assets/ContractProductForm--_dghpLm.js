import{d as D,r as g,f as R,au as w,e3 as T,C as q,e4 as F,G as N,_ as L,o as b,c as x,I as E,q as P,w as t,k as e,F as U,n as O,m as C,ah as j,P as A,J as S,K as Y,L as B,Z as G,cf as J,N as K,Q as M,O as Q,E as Z,R as z}from"./index-BaY5TDP-.js";import{_ as H}from"./DictTag-QtcI9ZjC.js";import{g as W}from"./index-D4G-Yxr7.js";import"./color-BN7ZL7BD.js";const X=L(D({__name:"ContractProductForm",props:{products:{type:null,required:!0},disabled:{type:Boolean,required:!0}},setup(v,{expose:s}){const m=v,o=g(!1),p=g([]),V=R({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractPrice:[{required:!0,message:"\u5408\u540C\u4EF7\u683C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],count:[{required:!0,message:"\u4EA7\u54C1\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),u=g([]),f=g([]);w(()=>m.products,async l=>{p.value=l},{immediate:!0}),w(()=>p.value,l=>{l&&l.length!==0&&l.forEach(r=>{r.contractPrice!=null&&r.count!=null?r.totalPrice=T(r.contractPrice,r.count):r.totalPrice=void 0})},{deep:!0});const _=()=>u.value.validate();s({validate:_}),q(async()=>{f.value=await W()});const n={props:m,formLoading:o,formData:p,formRules:V,formRef:u,productList:f,handleAdd:()=>{p.value.push({id:void 0,productId:void 0,productUnit:void 0,productNo:void 0,productPrice:void 0,contractPrice:void 0,count:1})},handleDelete:l=>{p.value.splice(l,1)},onChangeProduct:(l,r)=>{const c=f.value.find(h=>h.id===l);c&&(r.productUnit=c.unit,r.productNo=c.no,r.productPrice=c.price,r.contractPrice=c.price)},validate:_,get erpPriceInputFormatter(){return F},get DICT_TYPE(){return N}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),[["render",function(v,s,m,o,p,V){const u=A,f=S,_=Y,n=B,l=G,r=H,c=J,h=K,I=M,y=Q,$=Z,k=z;return b(),x(U,null,[E((b(),P(y,{ref:"formRef",model:o.formData,rules:o.formRules,"label-width":"0px","inline-message":!0,disabled:m.disabled},{default:t(()=>[e(I,{data:o.formData,class:"-mt-10px"},{default:t(()=>[e(u,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(u,{label:"\u4EA7\u54C1\u540D\u79F0","min-width":"180"},{default:t(({row:a,$index:i})=>[e(n,{prop:`${i}.productId`,rules:o.formRules.productId,class:"mb-0px!"},{default:t(()=>[e(_,{modelValue:a.productId,"onUpdate:modelValue":d=>a.productId=d,clearable:"",filterable:"",onChange:d=>o.onChangeProduct(d,a),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1"},{default:t(()=>[(b(!0),x(U,null,O(o.productList,d=>(b(),P(f,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u6761\u7801","min-width":"150"},{default:t(({row:a})=>[e(n,{class:"mb-0px!"},{default:t(()=>[e(l,{disabled:"",modelValue:a.productNo,"onUpdate:modelValue":i=>a.productNo=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(u,{label:"\u5355\u4F4D","min-width":"80"},{default:t(({row:a})=>[e(r,{type:o.DICT_TYPE.CRM_PRODUCT_UNIT,value:a.productUnit},null,8,["type","value"])]),_:1}),e(u,{label:"\u4EF7\u683C\uFF08\u5143\uFF09","min-width":"120"},{default:t(({row:a})=>[e(n,{class:"mb-0px!"},{default:t(()=>[e(l,{disabled:"",modelValue:a.productPrice,"onUpdate:modelValue":i=>a.productPrice=i,formatter:o.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(u,{label:"\u552E\u4EF7\uFF08\u5143\uFF09",fixed:"right","min-width":"140"},{default:t(({row:a,$index:i})=>[e(n,{prop:`${i}.contractPrice`,class:"mb-0px!"},{default:t(()=>[e(c,{modelValue:a.contractPrice,"onUpdate:modelValue":d=>a.contractPrice=d,"controls-position":"right",min:.001,precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(u,{label:"\u6570\u91CF",prop:"count",fixed:"right","min-width":"120"},{default:t(({row:a,$index:i})=>[e(n,{prop:`${i}.count`,rules:o.formRules.count,class:"mb-0px!"},{default:t(()=>[e(c,{modelValue:a.count,"onUpdate:modelValue":d=>a.count=d,"controls-position":"right",min:.001,precision:3,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u5408\u8BA1",prop:"totalPrice",fixed:"right","min-width":"140"},{default:t(({row:a,$index:i})=>[e(n,{prop:`${i}.totalPrice`,class:"mb-0px!"},{default:t(()=>[e(l,{disabled:"",modelValue:a.totalPrice,"onUpdate:modelValue":d=>a.totalPrice=d,formatter:o.erpPriceInputFormatter},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:1}),e(u,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:t(({$index:a})=>[e(h,{onClick:i=>o.handleDelete(a),link:""},{default:t(()=>s[0]||(s[0]=[C("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[k,o.formLoading]]),m.disabled?j("",!0):(b(),P($,{key:0,justify:"center",class:"mt-3"},{default:t(()=>[e(h,{onClick:o.handleAdd,round:""},{default:t(()=>s[1]||(s[1]=[C("+ \u6DFB\u52A0\u4EA7\u54C1")])),_:1})]),_:1}))],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/contract/components/ContractProductForm.vue"]]);export{X as default};
