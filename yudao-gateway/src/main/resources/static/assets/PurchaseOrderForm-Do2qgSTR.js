import{d as A,g as C,D as j,r as i,f as B,b as E,au as J,e3 as K,e4 as M,_ as Z,o as m,q as V,w as o,m as O,ah as Q,k as l,I as W,c as S,F as x,n as R,Z as z,L as G,v as H,M as X,J as Y,K as $,cq as ee,E as ae,A as le,B as re,cf as oe,O as de,N as te,R as ie}from"./index-BaY5TDP-.js";import{_ as ue}from"./Dialog-CZSXtzfQ.js";import{_ as se}from"./ContentWrap-DKQn7kZm.js";import{P as k}from"./index-BvnoQ9hD.js";import me from"./PurchaseOrderItemForm-CF1As15Y.js";import{S as ce}from"./index-C5eeu8k9.js";import{g as ne}from"./index-CuAlllbQ.js";import{A as pe}from"./index-hc6npfaY.js";import"./index-CJwxK5Qx.js";import"./index-DMn3OXs3.js";const fe=Z(A({name:"PurchaseOrderForm",__name:"PurchaseOrderForm",emits:["success"],setup(q,{expose:r,emit:L}){const{t:a}=C(),P=j(),g=i(!1),s=i(""),d=i(!1),t=i(""),u=i({id:void 0,supplierId:void 0,accountId:void 0,orderTime:void 0,remark:void 0,fileUrl:"",discountPercent:0,discountPrice:0,totalPrice:0,depositPrice:0,items:[],no:void 0}),D=B({supplierId:[{required:!0,message:"\u4F9B\u5E94\u5546\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],orderTime:[{required:!0,message:"\u8BA2\u5355\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=E(()=>t.value==="detail"),c=i(),n=i([]),p=i([]),w=i([]),F=i("item"),f=i();J(()=>u.value,e=>{if(!e)return;const v=e.items.reduce((T,N)=>T+N.totalPrice,0),_=e.discountPercent!=null?K(v,e.discountPercent/100):0;u.value.discountPrice=_,u.value.totalPrice=v-_},{deep:!0});const I=async(e,v)=>{if(g.value=!0,s.value=a("action."+e),t.value=e,U(),v){d.value=!0;try{u.value=await k.getPurchaseOrder(v)}finally{d.value=!1}}n.value=await ce.getSupplierSimpleList(),w.value=await ne(),p.value=await pe.getAccountSimpleList();const _=p.value.find(T=>T.defaultStatus);_&&(u.value.accountId=_.id)};r({open:I});const b=L,U=()=>{var e;u.value={id:void 0,supplierId:void 0,accountId:void 0,orderTime:void 0,remark:void 0,fileUrl:void 0,discountPercent:0,discountPrice:0,totalPrice:0,depositPrice:0,items:[]},(e=c.value)==null||e.resetFields()},y={t:a,message:P,dialogVisible:g,dialogTitle:s,formLoading:d,formType:t,formData:u,formRules:D,disabled:h,formRef:c,supplierList:n,accountList:p,userList:w,subTabsName:F,itemFormRef:f,open:I,emit:b,submitForm:async()=>{await c.value.validate(),await f.value.validate(),d.value=!0;try{const e=u.value;t.value==="create"?(await k.createPurchaseOrder(e),P.success(a("common.createSuccess"))):(await k.updatePurchaseOrder(e),P.success(a("common.updateSuccess"))),g.value=!1,b("success")}finally{d.value=!1}},resetForm:U,PurchaseOrderItemForm:me,get erpPriceInputFormatter(){return M}};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),[["render",function(q,r,L,a,P,g){const s=z,d=G,t=H,u=X,D=Y,h=$,c=ee,n=ae,p=le,w=re,F=se,f=oe,I=de,b=te,U=ue,y=ie;return m(),V(U,{title:a.dialogTitle,modelValue:a.dialogVisible,"onUpdate:modelValue":r[12]||(r[12]=e=>a.dialogVisible=e),width:"1080"},{footer:o(()=>[a.disabled?Q("",!0):(m(),V(b,{key:0,onClick:a.submitForm,type:"primary",disabled:a.formLoading},{default:o(()=>r[13]||(r[13]=[O(" \u786E \u5B9A ")])),_:1},8,["disabled"])),l(b,{onClick:r[11]||(r[11]=e=>a.dialogVisible=!1)},{default:o(()=>r[14]||(r[14]=[O("\u53D6 \u6D88")])),_:1})]),default:o(()=>[W((m(),V(I,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px",disabled:a.disabled},{default:o(()=>[l(n,{gutter:20},{default:o(()=>[l(t,{span:8},{default:o(()=>[l(d,{label:"\u8BA2\u5355\u5355\u53F7",prop:"no"},{default:o(()=>[l(s,{disabled:"",modelValue:a.formData.no,"onUpdate:modelValue":r[0]||(r[0]=e=>a.formData.no=e),placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u8BA2\u5355\u65F6\u95F4",prop:"orderTime"},{default:o(()=>[l(u,{modelValue:a.formData.orderTime,"onUpdate:modelValue":r[1]||(r[1]=e=>a.formData.orderTime=e),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u8BA2\u5355\u65F6\u95F4",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u4F9B\u5E94\u5546",prop:"supplierId"},{default:o(()=>[l(h,{modelValue:a.formData.supplierId,"onUpdate:modelValue":r[2]||(r[2]=e=>a.formData.supplierId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u4F9B\u5E94\u5546",class:"!w-1/1"},{default:o(()=>[(m(!0),S(x,null,R(a.supplierList,e=>(m(),V(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t,{span:16},{default:o(()=>[l(d,{label:"\u5907\u6CE8",prop:"remark"},{default:o(()=>[l(s,{type:"textarea",modelValue:a.formData.remark,"onUpdate:modelValue":r[3]||(r[3]=e=>a.formData.remark=e),rows:1,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u9644\u4EF6",prop:"fileUrl"},{default:o(()=>[l(c,{"is-show-tip":!1,modelValue:a.formData.fileUrl,"onUpdate:modelValue":r[4]||(r[4]=e=>a.formData.fileUrl=e),limit:1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:o(()=>[l(w,{modelValue:a.subTabsName,"onUpdate:modelValue":r[5]||(r[5]=e=>a.subTabsName=e),class:"-mt-15px -mb-10px"},{default:o(()=>[l(p,{label:"\u8BA2\u5355\u4EA7\u54C1\u6E05\u5355",name:"item"},{default:o(()=>[l(a.PurchaseOrderItemForm,{ref:"itemFormRef",items:a.formData.items,disabled:a.disabled},null,8,["items","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{gutter:20},{default:o(()=>[l(t,{span:8},{default:o(()=>[l(d,{label:"\u4F18\u60E0\u7387\uFF08%\uFF09",prop:"discountPercent"},{default:o(()=>[l(f,{modelValue:a.formData.discountPercent,"onUpdate:modelValue":r[6]||(r[6]=e=>a.formData.discountPercent=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u4F18\u60E0\u7387",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u4ED8\u6B3E\u4F18\u60E0",prop:"discountPrice"},{default:o(()=>[l(s,{disabled:"",modelValue:a.formData.discountPrice,"onUpdate:modelValue":r[7]||(r[7]=e=>a.formData.discountPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u4F18\u60E0\u540E\u91D1\u989D"},{default:o(()=>[l(s,{disabled:"",modelValue:a.formData.totalPrice,"onUpdate:modelValue":r[8]||(r[8]=e=>a.formData.totalPrice=e),formatter:a.erpPriceInputFormatter},null,8,["modelValue","formatter"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u7ED3\u7B97\u8D26\u6237",prop:"accountId"},{default:o(()=>[l(h,{modelValue:a.formData.accountId,"onUpdate:modelValue":r[9]||(r[9]=e=>a.formData.accountId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u7B97\u8D26\u6237",class:"!w-1/1"},{default:o(()=>[(m(!0),S(x,null,R(a.accountList,e=>(m(),V(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t,{span:8},{default:o(()=>[l(d,{label:"\u652F\u4ED8\u8BA2\u91D1",prop:"depositPrice"},{default:o(()=>[l(f,{modelValue:a.formData.depositPrice,"onUpdate:modelValue":r[10]||(r[10]=e=>a.formData.depositPrice=e),"controls-position":"right",min:0,precision:2,placeholder:"\u8BF7\u8F93\u5165\u652F\u4ED8\u8BA2\u91D1",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])),[[y,a.formLoading]])]),_:1},8,["title","modelValue"])}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/erp/purchase/order/PurchaseOrderForm.vue"]]);export{fe as default};
