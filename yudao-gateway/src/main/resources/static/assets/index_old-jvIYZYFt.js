import{d as E,S as O,u as J,D as K,r as i,b as N,C as Z,a as $,_ as G,am as H,o as n,c as k,k as l,I as Q,q as _,w as s,F as x,n as D,j as M,m as X,t as j,b8 as W,l as Y,v as ee,E as ae,A as se,B as te,z as le,N as re,J as oe,K as ie,L as ne,O as me,R as ue}from"./index-BaY5TDP-.js";import{_ as ce}from"./ContentWrap-DKQn7kZm.js";import{E as pe}from"./el-image-Bg-CwbDE.js";import{_ as de}from"./index-BAz6Gqim.js";import{b as fe,a as ve}from"./index-5lnhJJF7.js";import{f as ge,e as ye}from"./index-BJQN17A_.js";import{d as be,b as _e}from"./formCreate-Dy2BGZHq.js";import Se from"./ProcessInstanceBpmnViewer-CwVPQ6L9.js";import{C as he}from"./index-D7iZxFey.js";import{u as Ue}from"./tagsView-lnAkwTv2.js";import{g as we}from"./index-CuAlllbQ.js";import"./bpmn-embedded-Bxfb97Hp.js";import"./Dialog-CZSXtzfQ.js";import"./XTextButton-Cf-hbTFF.js";import"./XButton-BcV39lfk.js";import"./consts-vgsb8q48.js";import"./utils-DQEYWnsS.js";import"./index-ZFL2ufyC.js";import"./index-BCN8BzfC.js";import"./index-BeYJ8u62.js";import"./el-tree-select-DphqCDCz.js";import"./tree-z7HkrWVC.js";import"./index-C7Vgvn4F.js";import"./index-dK17nfjs.js";import"./index-D-_5jDBN.js";import"./index-RbAZqEQx.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./constants-CEEr2azc.js";import"./index-D-US79ui.js";import"./el-drawer-r3cMvY4i.js";import"./DictTag-QtcI9ZjC.js";import"./color-BN7ZL7BD.js";import"./index-l60I0Cke.js";import"./formatTime-Dr6TiYYc.js";const ke={class:"flex"},xe={class:"clearfix"},Ae={class:"el-icon-document"},Ve=G(E({name:"BpmProcessInstanceCreate",__name:"index_old",setup(z,{expose:r}){r();const R=O(),{push:e,currentRoute:B}=J(),S=K(),{delView:A}=Ue(),p=R.query.processInstanceId,h=i(!0),u=i([]),d=i(""),g=i([]),V=async()=>{h.value=!0;try{if(u.value=await he.getCategorySimpleList(),u.value.length>0&&(d.value=u.value[0].code),g.value=await fe({suspensionState:1}),(p==null?void 0:p.length)>0){const t=await ge(p);if(!t)return void S.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const m=g.value.find(L=>{var I;return L.key==((I=t.processDefinition)==null?void 0:I.key)});if(!m)return void S.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await a(m,t.formVariables)}}finally{h.value=!1}},T=N(()=>g.value.filter(t=>t.category==d.value)),f=i(),U=i({rule:[],option:{},value:{}}),y=i(),F=i(null),c=i([]),b=i({}),P=i(),w=i({}),C=i([]),a=async(t,m)=>{var L;if(y.value=t,c.value=[],b.value={},w.value={},t.formType==10){const I=be(t.formFields).map(v=>v.field);for(const v in m)I.includes(v)||delete m[v];_e(U,t.formConf,t.formFields,m);const q=await ve(t.id);if(q&&(F.value=q.bpmnXml,c.value=q.startUserSelectTasks,((L=c.value)==null?void 0:L.length)>0)){U.value.rule.push({type:"startUserSelect",props:{title:"\u6307\u5B9A\u5BA1\u6279\u4EBA"}});for(const v of c.value)b.value[v.id]=[],w.value[v.id]=[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA",trigger:"blur"}];C.value=await we()}}else t.formCustomCreatePath&&await e({path:t.formCustomCreatePath})};Z(()=>{V()});const o={route:R,push:e,currentRoute:B,message:S,delView:A,processInstanceId:p,loading:h,categoryList:u,categoryActive:d,processDefinitionList:g,getList:V,categoryProcessDefinitionList:T,fApi:f,detailForm:U,selectProcessDefinition:y,bpmnXML:F,startUserSelectTasks:c,startUserSelectAssignees:b,startUserSelectAssigneesFormRef:P,startUserSelectAssigneesFormRules:w,userList:C,handleSelect:a,submitForm:async t=>{var m;if(f.value&&y.value){((m=c.value)==null?void 0:m.length)>0&&await P.value.validate(),f.value.btn.loading(!0);try{await ye({processDefinitionId:y.value.id,variables:t,startUserSelectAssignees:b.value}),S.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),A($(B)),await e({name:"BpmProcessInstanceMy"})}finally{f.value.btn.loading(!1)}}},ProcessInstanceBpmnViewer:Se};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),[["render",function(z,r,R,e,B,S){const A=de,p=pe,h=W,u=Y,d=ee,g=ae,V=se,T=te,f=ce,U=le,y=re,F=oe,c=ie,b=ne,P=me,w=H("form-create"),C=ue;return n(),k(x,null,[l(A,{title:"\u6D41\u7A0B\u53D1\u8D77\u3001\u53D6\u6D88\u3001\u91CD\u65B0\u53D1\u8D77",url:"https://doc.iocoder.cn/bpm/process-instance/"}),e.selectProcessDefinition?(n(),_(f,{key:1},{default:s(()=>[l(u,{class:"box-card"},{default:s(()=>[M("div",xe,[M("span",Ae,"\u7533\u8BF7\u4FE1\u606F\u3010"+j(e.selectProcessDefinition.name)+"\u3011",1),l(y,{style:{float:"right"},type:"primary",onClick:r[1]||(r[1]=a=>e.selectProcessDefinition=void 0)},{default:s(()=>[l(U,{icon:"ep:delete"}),r[4]||(r[4]=X(" \u9009\u62E9\u5176\u5B83\u6D41\u7A0B "))]),_:1})]),l(d,{span:16,offset:6,style:{"margin-top":"20px"}},{default:s(()=>[l(w,{rule:e.detailForm.rule,api:e.fApi,"onUpdate:api":r[2]||(r[2]=a=>e.fApi=a),modelValue:e.detailForm.value,"onUpdate:modelValue":r[3]||(r[3]=a=>e.detailForm.value=a),option:e.detailForm.option,onSubmit:e.submitForm},{"type-startUserSelect":s(()=>[l(d,{span:24},{default:s(()=>[l(u,{class:"mb-10px"},{header:s(()=>r[5]||(r[5]=[X("\u6307\u5B9A\u5BA1\u6279\u4EBA")])),default:s(()=>[l(P,{model:e.startUserSelectAssignees,rules:e.startUserSelectAssigneesFormRules,ref:"startUserSelectAssigneesFormRef"},{default:s(()=>[(n(!0),k(x,null,D(e.startUserSelectTasks,a=>(n(),_(b,{key:a.id,label:`\u4EFB\u52A1\u3010${a.name}\u3011`,prop:a.id},{default:s(()=>[l(c,{modelValue:e.startUserSelectAssignees[a.id],"onUpdate:modelValue":o=>e.startUserSelectAssignees[a.id]=o,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA"},{default:s(()=>[(n(!0),k(x,null,D(e.userList,o=>(n(),_(F,{key:o.id,label:o.nickname,value:o.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["rule","api","modelValue","option"])]),_:1})]),_:1}),l(e.ProcessInstanceBpmnViewer,{"bpmn-xml":e.bpmnXML},null,8,["bpmn-xml"])]),_:1})):Q((n(),_(f,{key:0},{default:s(()=>[l(T,{"tab-position":"left",modelValue:e.categoryActive,"onUpdate:modelValue":r[0]||(r[0]=a=>e.categoryActive=a)},{default:s(()=>[(n(!0),k(x,null,D(e.categoryList,a=>(n(),_(V,{label:a.name,name:a.code,key:a.code},{default:s(()=>[l(g,{gutter:20},{default:s(()=>[(n(!0),k(x,null,D(e.categoryProcessDefinitionList,o=>(n(),_(d,{lg:6,sm:12,xs:24,key:o.id},{default:s(()=>[l(u,{shadow:"hover",class:"mb-20px cursor-pointer",onClick:t=>e.handleSelect(o)},{default:s(()=>[M("div",ke,[l(p,{src:o.icon,class:"w-32px h-32px"},null,8,["src"]),l(h,{class:"!ml-10px",size:"large"},{default:s(()=>[X(j(o.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[C,e.loading]])],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/processInstance/create/index_old.vue"]]);export{Ve as default};
