import{d as S,D as N,r as u,as as F,au as k,Q as W,G as x,_ as L,o as v,c as q,q as g,w as f,k as r,m as E,ah as _,I as D,F as Q,z as j,N as A,E as M,P as Y,R as B}from"./index-BaY5TDP-.js";import{_ as G}from"./DictTag-QtcI9ZjC.js";import{d as V}from"./formatTime-Dr6TiYYc.js";import{P as y,g as H,d as J,a as K}from"./index-BlslFSYd.js";import X from"./PermissionForm-jo-CjsNU.js";import"./color-BN7ZL7BD.js";import"./Dialog-CZSXtzfQ.js";import"./index-CuAlllbQ.js";const Z=L(S({name:"CrmPermissionList",__name:"PermissionList",props:{bizType:{type:Number,required:!0},bizId:{type:null,required:!0},showAction:{type:Boolean,required:!0}},emits:["quitTeam"],setup(R,{expose:t,emit:C}){const e=N(),o=R,I=u(!0),i=u([]),c=u({ownerUserId:0}),p=F(),s=async()=>{I.value=!0;try{const a=await H({bizType:o.bizType,bizId:o.bizId});i.value=a,i.value.find(l=>l.userId===p.getUser.id&&l.level===y.OWNER)&&(c.value.ownerUserId=p.getUser.id)}finally{I.value=!1}},n=u([]),T=u(),w=u(),O=()=>{var a;(a=w.value)==null||a.open("create",o.bizType,o.bizId)},U=u(!1),b=u(!1),h=u(!1);k(i,a=>{var l;if(h.value=!1,(a==null?void 0:a.length)>0){h.value=!i.value.some(m=>m.level===y.OWNER),U.value=!1,b.value=!1;const d=(l=p.getUser)==null?void 0:l.id;i.value.filter(m=>m.userId===d).forEach(m=>{m.level===y.OWNER?(U.value=!0,b.value=!0):m.level===y.WRITE&&(b.value=!0)})}else h.value=!0},{immediate:!0}),t({openForm:O,validateOwnerUser:U,validateWrite:b,isPool:h});const P=C;k(()=>o.bizId,a=>{a&&s()},{immediate:!0,deep:!0});const z={message:e,props:o,loading:I,list:i,formData:c,userStore:p,getList:s,multipleSelection:n,elTableRef:T,handleSelectionChange:a=>{var l;if(a.findIndex(d=>d.level===y.OWNER)!==-1)return e.warning("\u4E0D\u80FD\u9009\u62E9\u8D1F\u8D23\u4EBA\uFF01"),void((l=T.value)==null?void 0:l.clearSelection());n.value=a},formRef:w,handleUpdate:()=>{var a,l,d;((a=n.value)==null?void 0:a.length)!==0?((l=n.value)==null?void 0:l.length)>1?e.warning("\u7F16\u8F91\u56E2\u961F\u6210\u5458\u65F6\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\uFF01"):(d=w.value)==null||d.open0("update",o.bizType,o.bizId,n.value[0].id,n.value[0].level):e.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01")},handleDelete:async()=>{var l,d;if(((l=n.value)==null?void 0:l.length)===0)return void e.warning("\u8BF7\u5148\u9009\u62E9\u56E2\u961F\u6210\u5458\u540E\u64CD\u4F5C\uFF01");await e.delConfirm();const a=(d=n.value)==null?void 0:d.map(m=>m.id);await J(a),e.success("\u79FB\u9664\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),await s()},openForm:O,validateOwnerUser:U,validateWrite:b,isPool:h,emits:P,handleQuit:async()=>{if(i.value.find(l=>l.userId===p.getUser.id&&l.level===y.OWNER))return void e.warning("\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u9000\u51FA\u56E2\u961F\uFF01");const a=i.value.find(l=>l.userId===p.getUser.id);a&&(await K(a.id),e.success("\u9000\u51FA\u56E2\u961F\u6210\u5458\u6210\u529F\uFF01"),P("quitTeam"))},get dateFormatter(){return V},get ElTable(){return W},CrmPermissionForm:X,get DICT_TYPE(){return x}};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),[["render",function(R,t,C,e,o,I){const i=j,c=A,p=M,s=Y,n=G,T=B;return v(),q(Q,null,[C.showAction?(v(),g(p,{key:0,justify:"end"},{default:f(()=>[e.validateOwnerUser?(v(),g(c,{key:0,type:"primary",onClick:e.openForm},{default:f(()=>[r(i,{class:"mr-5px",icon:"ep:plus"}),t[0]||(t[0]=E(" \u65B0\u589E "))]),_:1})):_("",!0),e.validateOwnerUser?(v(),g(c,{key:1,onClick:e.handleUpdate},{default:f(()=>[r(i,{class:"mr-5px",icon:"ep:edit"}),t[1]||(t[1]=E(" \u7F16\u8F91 "))]),_:1})):_("",!0),e.validateOwnerUser?(v(),g(c,{key:2,onClick:e.handleDelete},{default:f(()=>[r(i,{class:"mr-5px",icon:"ep:delete"}),t[2]||(t[2]=E(" \u79FB\u9664 "))]),_:1})):_("",!0),!e.validateOwnerUser&&e.list.length>0?(v(),g(c,{key:3,type:"danger",onClick:e.handleQuit},{default:f(()=>t[3]||(t[3]=[E(" \u9000\u51FA\u56E2\u961F ")])),_:1})):_("",!0)]),_:1})):_("",!0),D((v(),g(e.ElTable,{ref:"elTableRef",data:e.list,"show-overflow-tooltip":!0,stripe:!0,class:"mt-20px",onSelectionChange:e.handleSelectionChange},{default:f(()=>[r(s,{type:"selection",width:"55"}),r(s,{align:"center",label:"\u59D3\u540D",prop:"nickname"}),r(s,{align:"center",label:"\u90E8\u95E8",prop:"deptName"}),r(s,{align:"center",label:"\u5C97\u4F4D",prop:"postNames"}),r(s,{align:"center",label:"\u6743\u9650\u7EA7\u522B",prop:"level"},{default:f(({row:w})=>[r(n,{type:e.DICT_TYPE.CRM_PERMISSION_LEVEL,value:w.level},null,8,["type","value"])]),_:1}),r(s,{formatter:e.dateFormatter,align:"center",label:"\u52A0\u5165\u65F6\u95F4",prop:"createTime"},null,8,["formatter"])]),_:1},8,["data"])),[[T,e.loading]]),r(e.CrmPermissionForm,{ref:"formRef",onSuccess:e.getList},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/crm/permission/components/PermissionList.vue"]]);export{Z as default};
