import{g as C,f as D,cP as S,eJ as T,ct as w,U as E,H as Y,h as H}from"./index-BaY5TDP-.js";import{e as y,b as I,f as A}from"./tree-z7HkrWVC.js";import{_ as M}from"./DictTag-QtcI9ZjC.js";const{t:F}=C(),g=s=>{const a=D({searchSchema:[],tableColumns:[],formSchema:[],detailSchema:[]}),o=x(s,a);a.searchSchema=o||[];const l=J(s);a.tableColumns=l||[];const t=N(s,a);a.formSchema=t;const i=U(s);return a.detailSchema=i,{allSchemas:a}},x=(s,a)=>{const o=[],l=[];y(s,t=>{var i,p,f,m;if(t!=null&&t.isSearch||(i=t.search)!=null&&i.show){let u=((p=t==null?void 0:t.search)==null?void 0:p.component)||"Input";const h=[];let e={};if(t.dictType){const n={label:"\u5168\u90E8",value:""};h.push(n),S(t.dictType).forEach(c=>{h.push(c)}),e={options:h},(f=t.search)!=null&&f.component||(u="Select")}const d=T({component:u,...t.search,field:t.field,label:((m=t.search)==null?void 0:m.label)||t.label},{componentProps:e});d.api&&l.push(async()=>{var c;const n=await d.api();if(n){const r=w(a.searchSchema,b=>b.field===d.field);r!==-1&&(a.searchSchema[r].componentProps.options=v(n,(c=d.componentProps.optionsAlias)==null?void 0:c.labelField))}}),delete d.show,o.push(d)}});for(const t of l)t();return o},J=s=>{const a=I(s,{conversion:o=>{var l;if((o==null?void 0:o.isTable)!==!1&&((l=o==null?void 0:o.table)==null?void 0:l.show)!==!1)return!o.formatter&&o.dictType&&(o.formatter=(t,i,p)=>H(M,{type:o.dictType,value:p})),{...o.table,...o}}});return A(a,o=>(o.children===void 0&&delete o.children,!!o.field))},N=(s,a)=>{const o=[],l=[];y(s,t=>{var i,p,f,m,u;if((t==null?void 0:t.isForm)!==!1&&((i=t==null?void 0:t.form)==null?void 0:i.show)!==!1){let h=((p=t==null?void 0:t.form)==null?void 0:p.component)||"Input",e="";(f=t.form)!=null&&f.value?e=(m=t.form)==null?void 0:m.value:h==="InputNumber"&&(e=0);let d={};if(t.dictType){const c=[];t.dictClass&&t.dictClass==="number"?E(t.dictType).forEach(r=>{c.push(r)}):t.dictClass&&t.dictClass==="boolean"?Y(t.dictType).forEach(r=>{c.push(r)}):S(t.dictType).forEach(r=>{c.push(r)}),d={options:c},t.form&&t.form.component||(h="Select")}const n=T({component:h,value:e,...t.form,field:t.field,label:((u=t.form)==null?void 0:u.label)||t.label},{componentProps:d});n.api&&l.push(async()=>{var r;const c=await n.api();if(c){const b=w(a.formSchema,P=>P.field===n.field);b!==-1&&(a.formSchema[b].componentProps.options=v(c,(r=n.componentProps.optionsAlias)==null?void 0:r.labelField))}}),delete n.show,o.push(n)}});for(const t of l)t();return o},U=s=>{const a=[];return y(s,o=>{var l,t,i,p,f;if((o==null?void 0:o.isDetail)!==!1&&((l=o.detail)==null?void 0:l.show)!==!1){const m={...o.detail,field:o.field,label:((t=o.detail)==null?void 0:t.label)||o.label};o.dictType&&(m.dictType=o.dictType),((i=o.detail)!=null&&i.dateFormat||o.formatter=="formatDate")&&(m.dateFormat=(p=o==null?void 0:o.detail)!=null&&p.dateFormat?(f=o==null?void 0:o.detail)==null?void 0:f.dateFormat:"YYYY-MM-DD HH:mm:ss"),delete m.show,a.push(m)}}),a},v=(s,a)=>s==null?void 0:s.map(o=>(a?o.labelField=F(o.labelField):o.label=F(o.label),o));export{g as u};
