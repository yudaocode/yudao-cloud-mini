import{d as J,r as p,C as Q,D as W,ao as X,ap as Z,G as H,_ as $,am as ee,q as D,w as r,o as I,j as o,k as a,t as h,ah as M,m as q,I as O,c as Y,ag as z,x as se,v as ae,E as te,aq as re,A as ie,B as oe,R as ne}from"./index-BaY5TDP-.js";import{_ as le}from"./ContentWrap-DKQn7kZm.js";import{E as pe}from"./el-avatar-DZsRbb7z.js";import{_ as ce}from"./DictTag-QtcI9ZjC.js";import{f as me}from"./formatTime-Dr6TiYYc.js";import{B as G,a as K}from"./constants-CEEr2azc.js";import{b as de}from"./formCreate-Dy2BGZHq.js";import{g as ue,a as fe}from"./index-BJQN17A_.js";import{g as ve}from"./index-CuAlllbQ.js";import Ie from"./ProcessInstanceBpmnViewer-CwVPQ6L9.js";import ye from"./ProcessInstanceSimpleViewer-DBZzCdFr.js";import ge from"./ProcessInstanceTaskList-CeFRwJHS.js";import be from"./ProcessInstanceOperationButton-Ba8v6l58.js";import xe from"./ProcessInstanceTimeline-CvaFNncS.js";import{F as A}from"./consts-vgsb8q48.js";import{T as S}from"./index-ZFL2ufyC.js";import"./color-BN7ZL7BD.js";import"./bpmn-embedded-Bxfb97Hp.js";import"./Dialog-CZSXtzfQ.js";import"./XTextButton-Cf-hbTFF.js";import"./XButton-BcV39lfk.js";import"./utils-DQEYWnsS.js";import"./index-BCN8BzfC.js";import"./index-BeYJ8u62.js";import"./el-tree-select-DphqCDCz.js";import"./tree-z7HkrWVC.js";import"./index-C7Vgvn4F.js";import"./index-dK17nfjs.js";import"./index-D-_5jDBN.js";import"./index-RbAZqEQx.js";import"./index-avjYFQiD.js";import"./index-DrSdAlug.js";import"./index-D-US79ui.js";import"./el-drawer-r3cMvY4i.js";import"./index-l60I0Cke.js";import"./simple-process-designer-DviJ9JIp.js";import"./el-space-B4pGZPiv.js";import"./download-oWiM5xVU.js";import"./el-image-Bg-CwbDE.js";import"./SignDialog-CdrG8uN_.js";import"./index-uy0_B-js.js";import"./el-timeline-item-BFYwlQ-d.js";const Te={class:"processInstance-wrap-main"},_e=["src"],Pe={class:"text-#878c93 h-15px"},we={class:"flex items-center gap-5 mb-10px h-40px"},Be={class:"text-26px font-bold mb-5px"},De={class:"flex items-center gap-5 mb-10px text-13px h-35px"},he={class:"bg-gray-100 h-35px rounded-3xl flex items-center p-8px gap-2 dark:color-gray-600"},Me={class:"text-#878c93"},ke={class:"form-scroll-area"},Fe={class:"form-box flex flex-col mb-30px flex-1"},Ce={key:1},Ve={class:"form-scroll-area"},Ne={class:"form-scroll-area"},Se={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Ee=$(J({name:"BpmProcessInstanceDetail",__name:"index",props:{id:{type:String,required:!0},taskId:{type:String,required:!1},activityId:{type:String,required:!1}},setup(U,{expose:c}){c();const m=U,e=W(),k=p(!1),b=p({}),d=p({}),x=p({}),T=p(),E={[S.RUNNING]:"/assets/running-Cm4KjmYZ.svg",[S.APPROVE]:"/assets/approve-BQD8ihNj.svg",[S.REJECT]:"/assets/reject-C_en7x-2.svg",[S.CANCEL]:"/assets/cancel-Cn_ivYkt.svg"},n=p(),y=p({rule:[],option:{},value:{}}),u=[],f=()=>{C(),V()},F=p(null),C=async()=>{var t,i;k.value=!0;try{const v={processInstanceId:m.id,activityId:m.activityId,taskId:m.taskId},s=await ue(v);if(!s)return void e.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(!s.processDefinition||!s.processInstance)return void e.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");if(b.value=s.processInstance,d.value=s.processDefinition,d.value.formType===G.NORMAL){const l=s.formFieldsPermission;u.splice(0),((t=y.value.rule)==null?void 0:t.length)>0?y.value.value=b.value.formVariables:de(y,d.value.formConf,d.value.formFields,b.value.formVariables),X().then(()=>{var g,L,R;(g=n.value)==null||g.btn.show(!1),(L=n.value)==null||L.resetBtn.show(!1),(R=n.value)==null||R.disabled(!0),l&&Object.keys(s.formFieldsPermission).forEach(j=>{P(j,l[j])})})}else F.value=Z(s.processDefinition.formCustomViewPath);_.value=s.activityNodes,(i=T.value)==null||i.loadTodoTask(s.todoTask)}finally{k.value=!1}},V=async()=>{var i;K.BPMN===((i=d.value)==null?void 0:i.modelType)&&(x.value={bpmnXml:""});const t=await fe(m.id);t&&(x.value=t)},_=p([]),P=(t,i)=>{var v,s,l;i===A.READ&&((v=n.value)==null||v.disabled(!0,t)),i===A.WRITE&&((s=n.value)==null||s.disabled(!1,t),u.push(t)),i===A.NONE&&((l=n.value)==null||l.hidden(!0,t))},N=p("form"),w=p([]);Q(async()=>{f(),w.value=await ve()});const B={props:m,message:e,processInstanceLoading:k,processInstance:b,processDefinition:d,processModelView:x,operationButtonRef:T,auditIconsMap:E,fApi:n,detailForm:y,writableFields:u,getDetail:f,BusinessFormComponent:F,getApprovalDetail:C,getProcessModelView:V,activityNodes:_,setFieldPermission:P,refresh:()=>{f()},activeTab:N,userOptions:w,get formatDate(){return me},get DICT_TYPE(){return H},get BpmModelType(){return K},get BpmModelFormType(){return G},ProcessInstanceBpmnViewer:Ie,ProcessInstanceSimpleViewer:ye,ProcessInstanceTaskList:ge,ProcessInstanceOperationButton:be,ProcessInstanceTimeline:xe};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),[["render",function(U,c,m,e,k,b){const d=se,x=ce,T=pe,E=ee("form-create"),n=ae,y=te,u=re,f=ie,F=oe,C=le,V=ne;return I(),D(C,{bodyStyle:{padding:"10px 20px 0"},class:"position-relative"},{default:r(()=>[o("div",Te,[a(u,null,{default:r(()=>{var _,P,N,w,B,t,i,v;return[o("img",{class:"position-absolute right-20px",width:"150",src:e.auditIconsMap[e.processInstance.status],alt:""},null,8,_e),o("div",Pe,"\u7F16\u53F7\uFF1A"+h(m.id),1),a(d,{class:"!my-8px"}),o("div",we,[o("div",Be,h(e.processInstance.name),1),e.processInstance.status?(I(),D(x,{key:0,type:e.DICT_TYPE.BPM_PROCESS_INSTANCE_STATUS,value:e.processInstance.status},null,8,["type","value"])):M("",!0)]),o("div",De,[o("div",he,[(P=(_=e.processInstance)==null?void 0:_.startUser)!=null&&P.avatar?(I(),D(T,{key:0,size:28,src:(w=(N=e.processInstance)==null?void 0:N.startUser)==null?void 0:w.avatar},null,8,["src"])):(t=(B=e.processInstance)==null?void 0:B.startUser)!=null&&t.nickname?(I(),D(T,{key:1,size:28},{default:r(()=>{var s,l;return[q(h((l=(s=e.processInstance)==null?void 0:s.startUser)==null?void 0:l.nickname.substring(0,1)),1)]}),_:1})):M("",!0),q(" "+h((v=(i=e.processInstance)==null?void 0:i.startUser)==null?void 0:v.nickname),1)]),o("div",Me,h(e.formatDate(e.processInstance.startTime))+" \u63D0\u4EA4 ",1)]),a(F,{modelValue:e.activeTab,"onUpdate:modelValue":c[2]||(c[2]=s=>e.activeTab=s)},{default:r(()=>[a(f,{label:"\u5BA1\u6279\u8BE6\u60C5",name:"form"},{default:r(()=>[o("div",ke,[a(u,null,{default:r(()=>[a(y,null,{default:r(()=>[a(n,{span:17,class:"!flex !flex-col formCol"},{default:r(()=>{var s,l;return[O((I(),Y("div",Fe,[((s=e.processDefinition)==null?void 0:s.formType)===e.BpmModelFormType.NORMAL?(I(),D(n,{key:0},{default:r(()=>[a(E,{modelValue:e.detailForm.value,"onUpdate:modelValue":c[0]||(c[0]=g=>e.detailForm.value=g),api:e.fApi,"onUpdate:api":c[1]||(c[1]=g=>e.fApi=g),option:e.detailForm.option,rule:e.detailForm.rule},null,8,["modelValue","api","option","rule"])]),_:1})):M("",!0),((l=e.processDefinition)==null?void 0:l.formType)===e.BpmModelFormType.CUSTOM?(I(),Y("div",Ce,[a(e.BusinessFormComponent,{id:e.processInstance.businessKey},null,8,["id"])])):M("",!0)])),[[V,e.processInstanceLoading]])]}),_:1}),a(n,{span:7},{default:r(()=>[a(e.ProcessInstanceTimeline,{"activity-nodes":e.activityNodes},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(f,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:r(()=>[o("div",Ve,[O(a(e.ProcessInstanceSimpleViewer,{loading:e.processInstanceLoading,"model-view":e.processModelView},null,8,["loading","model-view"]),[[z,e.processDefinition.modelType&&e.processDefinition.modelType===e.BpmModelType.SIMPLE]]),O(a(e.ProcessInstanceBpmnViewer,{loading:e.processInstanceLoading,"model-view":e.processModelView},null,8,["loading","model-view"]),[[z,e.processDefinition.modelType&&e.processDefinition.modelType===e.BpmModelType.BPMN]])])]),_:1}),a(f,{label:"\u6D41\u8F6C\u8BB0\u5F55",name:"record"},{default:r(()=>[o("div",Ne,[a(u,null,{default:r(()=>[a(e.ProcessInstanceTaskList,{loading:e.processInstanceLoading,id:m.id},null,8,["loading","id"])]),_:1})])]),_:1}),M("",!0)]),_:1},8,["modelValue"]),o("div",Se,[a(e.ProcessInstanceOperationButton,{ref:"operationButtonRef","process-instance":e.processInstance,"process-definition":e.processDefinition,userOptions:e.userOptions,"normal-form":e.detailForm,"normal-form-api":e.fApi,"writable-fields":e.writableFields,onSuccess:e.refresh},null,8,["process-instance","process-definition","userOptions","normal-form","normal-form-api"])])]}),_:1})])]),_:1})}],["__scopeId","data-v-695753a2"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/bpm/processInstance/detail/index.vue"]]);export{Ee as default};
