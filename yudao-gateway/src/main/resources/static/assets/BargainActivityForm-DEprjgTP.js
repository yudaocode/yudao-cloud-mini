import{bz as S,f as N,d as O,g as q,D as G,r as d,ax as C,ao as H,ay as J,az as F,_ as K,o as j,c as Q,k as n,w as u,m as L,I as W,q as X,F as Z,N as $,cf as ee,P as ae,R as ie}from"./index-BaY5TDP-.js";import{_ as te}from"./Dialog-CZSXtzfQ.js";import{_ as re}from"./Form-CB5RGX1K.js";import{b as B}from"./formatTime-Dr6TiYYc.js";import{r as P}from"./formRules-CMjZInfO.js";import{u as oe}from"./useCrudSchemas-BQxlWSsn.js";import se from"./SpuSelect-egfD7fzC.js";import ne from"./SpuAndSkuList-BPESFKMK.js";import{g as le}from"./index-DqlyDc99.js";import{b as ue}from"./spu-BVX48OKx.js";const ce=async v=>await S.get({url:"/promotion/bargain-activity/page",params:v}),me=async v=>await S.put({url:"/promotion/bargain-activity/close?id="+v}),pe=N({name:[P],startTime:[P],endTime:[P],helpMaxCount:[P],bargainCount:[P],singleLimitCount:[P]}),de=N([{label:"\u780D\u4EF7\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,isTable:!1,form:{colProps:{span:24}}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:B,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:B,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u780D\u4EF7\u4EBA\u6570",field:"helpMaxCount",isSearch:!1,form:{component:"InputNumber",labelMessage:"\u53C2\u4E0E\u4EBA\u6570\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4EBA",value:2}},{label:"\u6700\u5927\u5E2E\u780D\u6B21\u6570",field:"bargainCount",isSearch:!1,form:{component:"InputNumber",labelMessage:"\u53C2\u4E0E\u4EBA\u6570\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4EBA",value:2}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",isSearch:!1,form:{component:"InputNumber",labelMessage:"\u7528\u6237\u6700\u5927\u80FD\u53D1\u8D77\u780D\u4EF7\u7684\u6B21\u6570",value:0}},{label:"\u780D\u4EF7\u7684\u6700\u5C0F\u91D1\u989D",field:"randomMinPrice",isSearch:!1,isTable:!1,form:{component:"InputNumber",componentProps:{min:0,precision:2,step:.1},labelMessage:"\u7528\u6237\u6BCF\u6B21\u780D\u4EF7\u7684\u6700\u5C0F\u91D1\u989D",value:0}},{label:"\u780D\u4EF7\u7684\u6700\u5927\u91D1\u989D",field:"randomMaxPrice",isSearch:!1,isTable:!1,form:{component:"InputNumber",componentProps:{min:0,precision:2,step:.1},labelMessage:"\u7528\u6237\u6BCF\u6B21\u780D\u4EF7\u7684\u6700\u5927\u91D1\u989D",value:0}},{label:"\u780D\u4EF7\u5546\u54C1",field:"spuId",isSearch:!1,form:{colProps:{span:24}}}]),{allSchemas:fe}=oe(de),E=K(O({name:"PromotionBargainActivityForm",__name:"BargainActivityForm",emits:["success"],setup(v,{expose:r,emit:x}){const{t:e}=q(),M=G(),h=d(!1),g=d(""),c=d(!1),f=d(""),m=d(),_=d(),k=d(),t=d([]),p=d([]),V=async(a,l,i)=>{var A;const o=[],Y=await ue([a]);if(Y.length==0)return;t.value=[];const s=Y[0],w=l===void 0?s==null?void 0:s.skus:(A=s==null?void 0:s.skus)==null?void 0:A.filter(y=>l.includes(y.id));w==null||w.forEach(y=>{let I={spuId:s.id,skuId:y.id,bargainFirstPrice:1,bargainMinPrice:1,stock:1};if(i!==void 0){const b=i.find(z=>z.skuId===y.id);b&&(b.bargainFirstPrice=C(b.bargainFirstPrice),b.bargainMinPrice=C(b.bargainMinPrice)),I=b||I}y.productConfig=I}),s.skus=w,o.push({spuId:s.id,spuDetail:s,propertyList:le(s)}),t.value.push(s),p.value=o},D=async(a,l)=>{if(h.value=!0,g.value=e("action."+a),f.value=a,await T(),l){c.value=!0;try{const i=await(async o=>await S.get({url:"/promotion/bargain-activity/get?id="+o}))(l);i.randomMinPrice=C(i.randomMinPrice),i.randomMaxPrice=C(i.randomMaxPrice),await V(i.spuId,[i.skuId],[{spuId:i.spuId,skuId:i.skuId,bargainFirstPrice:i.bargainFirstPrice,bargainMinPrice:i.bargainMinPrice,stock:i.stock}]),m.value.setValues(i)}finally{c.value=!1}}};r({open:D});const T=async()=>{t.value=[],p.value=[],await H(),m.value.getElFormRef().resetFields()},R=x,U={t:e,message:M,dialogVisible:h,dialogTitle:g,formLoading:c,formType:f,formRef:m,spuSelectRef:_,spuAndSkuListRef:k,spuList:t,spuPropertyList:p,ruleConfig:[{name:"productConfig.bargainFirstPrice",rule:a=>a>0,message:"\u5546\u54C1\u780D\u4EF7\u8D77\u59CB\u4EF7\u683C\u4E0D\u80FD\u5C0F\u4E8E 0 \uFF01\uFF01\uFF01"},{name:"productConfig.bargainMinPrice",rule:a=>a>=0,message:"\u5546\u54C1\u780D\u4EF7\u5E95\u4EF7\u4E0D\u80FD\u5C0F\u4E8E 0 \uFF01\uFF01\uFF01"},{name:"productConfig.stock",rule:a=>a>=1,message:"\u5546\u54C1\u6D3B\u52A8\u5E93\u5B58\u4E0D\u80FD\u5C0F\u4E8E 1 \uFF01\uFF01\uFF01"}],selectSpu:(a,l)=>{m.value.setValues({spuId:a}),V(a,l)},getSpuDetails:V,open:D,resetForm:T,emit:R,submitForm:async()=>{if(m&&await m.value.getElFormRef().validate()){c.value=!0;try{const a=J(m.value.formModel),l=k.value.getSkuConfigs("productConfig");l.forEach(o=>{o.bargainFirstPrice=F(o.bargainFirstPrice),o.bargainMinPrice=F(o.bargainMinPrice)}),a.randomMinPrice=F(a.randomMinPrice),a.randomMaxPrice=F(a.randomMaxPrice);const i={...a,...l[0]};f.value==="create"?(await(async o=>await S.post({url:"/promotion/bargain-activity/create",data:o}))(i),M.success(e("common.createSuccess"))):(await(async o=>await S.put({url:"/promotion/bargain-activity/update",data:o}))(i),M.success(e("common.updateSuccess"))),h.value=!1,R("success")}finally{c.value=!1}}},get allSchemas(){return fe},get rules(){return pe},get SpuAndSkuList(){return ne},get SpuSelect(){return se}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),[["render",function(v,r,x,e,M,h){const g=$,c=ee,f=ae,m=re,_=te,k=ie;return j(),Q(Z,null,[n(_,{modelValue:e.dialogVisible,"onUpdate:modelValue":r[2]||(r[2]=t=>e.dialogVisible=t),title:e.dialogTitle,width:"65%"},{footer:u(()=>[n(g,{disabled:e.formLoading,type:"primary",onClick:e.submitForm},{default:u(()=>r[4]||(r[4]=[L("\u786E \u5B9A")])),_:1},8,["disabled"]),n(g,{onClick:r[1]||(r[1]=t=>e.dialogVisible=!1)},{default:u(()=>r[5]||(r[5]=[L("\u53D6 \u6D88")])),_:1})]),default:u(()=>[W((j(),X(m,{ref:"formRef","is-col":!0,rules:e.rules,schema:e.allSchemas.formSchema,class:"mt-10px"},{spuId:u(()=>[n(g,{onClick:r[0]||(r[0]=t=>e.spuSelectRef.open())},{default:u(()=>r[3]||(r[3]=[L("\u9009\u62E9\u5546\u54C1")])),_:1}),n(e.SpuAndSkuList,{ref:"spuAndSkuListRef","rule-config":e.ruleConfig,"spu-list":e.spuList,"spu-property-list-p":e.spuPropertyList},{default:u(()=>[n(f,{align:"center",label:"\u780D\u4EF7\u8D77\u59CB\u4EF7\u683C(\u5143)","min-width":"168"},{default:u(({row:t})=>[n(c,{modelValue:t.productConfig.bargainFirstPrice,"onUpdate:modelValue":p=>t.productConfig.bargainFirstPrice=p,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(f,{align:"center",label:"\u780D\u4EF7\u5E95\u4EF7(\u5143)","min-width":"168"},{default:u(({row:t})=>[n(c,{modelValue:t.productConfig.bargainMinPrice,"onUpdate:modelValue":p=>t.productConfig.bargainMinPrice=p,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(f,{align:"center",label:"\u6D3B\u52A8\u5E93\u5B58","min-width":"168"},{default:u(({row:t})=>[n(c,{modelValue:t.productConfig.stock,"onUpdate:modelValue":p=>t.productConfig.stock=p,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[k,e.formLoading]])]),_:1},8,["modelValue","title"]),n(e.SpuSelect,{ref:"spuSelectRef",isSelectSku:!0,radio:!0,onConfirm:e.selectSpu},null,512)],64)}],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/promotion/bargain/activity/BargainActivityForm.vue"]]),ge=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}));export{E as B,ge as a,me as c,ce as g};
