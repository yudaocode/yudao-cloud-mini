import{d as M,D as z,r as s,f as j,C as B,a as A,e as $,G,aA as H,aw as K,_ as J,X as Z,o as i,c as U,k as r,w as t,F as N,n as V,q as m,I as P,ag as X,m as w,j as O,t as T,M as W,L as ee,J as ae,K as re,Z as te,z as le,N as oe,O as ie,v as se,E as ue,P as ne,an as pe,Q as ce,R as de}from"./index-BaY5TDP-.js";import{_ as me}from"./index-avjYFQiD.js";import{_ as ye}from"./DictTag-QtcI9ZjC.js";import{E as fe}from"./el-image-Bg-CwbDE.js";import{_ as ve}from"./ContentWrap-DKQn7kZm.js";import{_ as ge}from"./index-BAz6Gqim.js";import{f as be,e as _e}from"./index-B6VQ3j6W.js";import{a as Pe}from"./index-BuoBEkWu.js";import{f as we}from"./formatter-DdccBgw4.js";import{S as he}from"./index-DYEmSFQB.js";import{d as ke}from"./formatTime-Dr6TiYYc.js";import{D as Se}from"./constants-CEEr2azc.js";import xe from"./OrderPickUpForm-C4J0zak9.js";import"./index-DrSdAlug.js";import"./color-BN7ZL7BD.js";import"./CountTo-DJpCwbFz.js";import"./Dialog-CZSXtzfQ.js";import"./index-BkPsSfnc.js";import"./el-timeline-item-BFYwlQ-d.js";import"./el-descriptions-item-CRF_CO88.js";import"./OrderUpdateRemarkForm-DFb8OYLH.js";import"./OrderDeliveryForm-qOqRbOq-.js";import"./index-MboYiMOx.js";import"./OrderUpdateAddressForm-C6NV58p8.js";import"./el-tree-select-DphqCDCz.js";import"./index-Qzz5HSIB.js";import"./tree-z7HkrWVC.js";import"./OrderUpdatePriceForm-xnJ7vqWL.js";import"./tagsView-lnAkwTv2.js";const Ue={class:"mr-10px"},Te={class:"flex flex-col flex-wrap gap-1"},qe=J(M({name:"PickUpOrder",__name:"index",setup(Q,{expose:l}){l();const v=z(),e=s(""),E=s([]),h=s(""),g=s(!0),D=s(2),b=s([]),q=s(),k={pageNo:1,pageSize:10,createTime:void 0,deliveryType:Se.PICK_UP.type,pickUpStoreId:-1},c=s({...k}),I=j({queryParam:"no"}),y=s(),C=s(!1),S=s(!0),_=s([{value:"no",label:"\u8BA2\u5355\u53F7"},{value:"userId",label:"\u7528\u6237UID"},{value:"userNickname",label:"\u7528\u6237\u6635\u79F0"},{value:"userMobile",label:"\u7528\u6237\u7535\u8BDD"}]),F=async()=>{g.value=!0;try{y.value=await be(A(c));const o=await _e(A(c));b.value=o.list,D.value=o.total}finally{g.value=!1}},u=async()=>{c.value.pageNo=1,await F()},d=s([]),Y=async()=>{d.value=await Pe();const o=$().getUser.id;d.value=d.value.filter(p=>{var a;return(a=p.verifyUserIds)==null?void 0:a.includes(o)})},x=s(),L=async()=>{h.value=e.value.readable.getReader();let o="";for(;;){const{value:p,done:a}=await h.value.read();if(a){h.value.releaseLock();break}const n=new TextDecoder().decode(p);if(o=`${o}${n}`,n.includes("\r")){let f=o.replace("\r","");o="",console.log(`\u4E8C\u7EF4\u7801\u6570\u636E:${f}`),x.value.open(f)}}};B(async()=>{if(await Y(),d.value.length===0)return v.error("\u5F53\u524D\u767B\u5F55\u4EBA\u6CA1\u7ED1\u5B9A\u4EFB\u4F55\u81EA\u63D0\u70B9"),g.value=!1,void(S.value=!0);c.value.pickUpStoreId=d.value[0].id,S.value=!1,await F()});const R={message:v,port:e,ports:E,reader:h,loading:g,total:D,list:b,queryFormRef:q,INIT_QUERY_PARAMS:k,queryParams:c,queryType:I,summary:y,serialPort:C,isUse:S,dynamicSearchList:_,inputChangeSelect:o=>{var p;(p=_.value.filter(a=>a.value!==o))==null||p.forEach(a=>{c.value.hasOwnProperty(a.value)&&delete c.value[a.value]})},getList:F,handleQuery:u,resetQuery:()=>{var o;(o=q.value)==null||o.resetFields(),c.value={...k},d.value.length>0&&(c.value.pickUpStoreId=d.value[0].id),u()},pickUpStoreList:d,getPickUpStoreList:Y,pickUpForm:x,handlePickup:()=>{x.value.open()},connectToSerialPort:async()=>{try{if(!("serial"in navigator)||navigator.serial==null||typeof navigator.serial!="object"||!("requestPort"in navigator.serial))return void v.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u626B\u7801\u67AA\u8FDE\u63A5\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668\u91CD\u8BD5");e.value=await navigator.serial.requestPort(),E.value=await navigator.serial.getPorts(),await e.value.open({baudRate:9600,dataBits:8,stopBits:2}),v.success("\u6210\u529F\u8FDE\u63A5\u626B\u7801\u67AA"),C.value=!0,L()}catch(o){console.log("Error connecting to serial port:",o)}},readData:L,cutPort:async()=>{e.value!==""?(await h.value.cancel(),await e.value.close(),e.value="",console.log("\u65AD\u5F00\u626B\u7801\u67AA\u8FDE\u63A5"),v.success("\u5DF2\u6210\u529F\u65AD\u5F00\u626B\u7801\u67AA\u8FDE\u63A5"),C.value=!1):v.warning("\u8BF7\u5148\u8FDE\u63A5\u6216\u6253\u5F00\u626B\u7801\u67AA")},get DICT_TYPE(){return G},get fenToYuan(){return H},get floatToFixed2(){return K},get fenToYuanFormat(){return we},SummaryCard:he,get dateFormatter(){return ke},OrderPickUpForm:xe};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),[["render",function(Q,l,v,e,E,h){const g=ge,D=W,b=ee,q=ae,k=re,c=te,I=le,y=oe,C=ie,S=ve,_=se,F=ue,u=ne,d=fe,Y=pe,x=ye,L=ce,R=me,o=Z("hasPermi"),p=de;return i(),U(N,null,[r(g,{title:"\u3010\u4EA4\u6613\u3011\u4EA4\u6613\u8BA2\u5355",url:"https://doc.iocoder.cn/mall/trade-order/"}),r(g,{title:"\u3010\u4EA4\u6613\u3011\u8D2D\u7269\u8F66",url:"https://doc.iocoder.cn/mall/trade-cart/"}),r(S,null,{default:t(()=>[r(C,{ref:"queryFormRef",inline:!0,model:e.queryParams,class:"-mb-15px","label-width":"68px"},{default:t(()=>[r(b,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:t(()=>[r(D,{modelValue:e.queryParams.createTime,"onUpdate:modelValue":l[0]||(l[0]=a=>e.queryParams.createTime=a),"default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-280px","end-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4","start-placeholder":"\u81EA\u5B9A\u4E49\u65F6\u95F4",type:"daterange","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","default-time"])]),_:1}),r(b,{label:"\u81EA\u63D0\u95E8\u5E97",prop:"pickUpStoreId"},{default:t(()=>[r(k,{modelValue:e.queryParams.pickUpStoreId,"onUpdate:modelValue":l[1]||(l[1]=a=>e.queryParams.pickUpStoreId=a),class:"!w-280px",placeholder:"\u5168\u90E8",onChange:e.handleQuery},{default:t(()=>[(i(!0),U(N,null,V(e.pickUpStoreList,a=>(i(),m(q,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(b,{label:"\u805A\u5408\u641C\u7D22"},{default:t(()=>[P(r(c,{modelValue:e.queryParams[e.queryType.queryParam],"onUpdate:modelValue":l[3]||(l[3]=a=>e.queryParams[e.queryType.queryParam]=a),class:"!w-280px",clearable:"",placeholder:"\u8BF7\u8F93\u5165",type:e.queryType.queryParam==="userId"?"number":"text"},{prepend:t(()=>[r(k,{modelValue:e.queryType.queryParam,"onUpdate:modelValue":l[2]||(l[2]=a=>e.queryType.queryParam=a),class:"!w-110px",placeholder:"\u5168\u90E8",onChange:e.inputChangeSelect},{default:t(()=>[(i(!0),U(N,null,V(e.dynamicSearchList,a=>(i(),m(q,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","type"]),[[X,!0]])]),_:1}),r(b,null,{default:t(()=>[r(y,{onClick:e.handleQuery},{default:t(()=>[r(I,{class:"mr-5px",icon:"ep:search"}),l[6]||(l[6]=w(" \u641C\u7D22 "))]),_:1}),r(y,{onClick:e.resetQuery},{default:t(()=>[r(I,{class:"mr-5px",icon:"ep:refresh"}),l[7]||(l[7]=w(" \u91CD\u7F6E "))]),_:1}),P((i(),m(y,{onClick:e.handlePickup,type:"success",plain:"",disabled:e.isUse},{default:t(()=>[r(I,{class:"mr-5px",icon:"ep:check"}),l[8]||(l[8]=w(" \u6838\u9500 "))]),_:1},8,["disabled"])),[[o,["trade:order:pick-up"]]]),r(y,{type:"primary",onClick:e.connectToSerialPort,disabled:e.serialPort||e.isUse},{default:t(()=>l[9]||(l[9]=[w(" \u8FDE\u63A5\u626B\u63CF\u67AA ")])),_:1},8,["disabled"]),r(y,{type:"danger",onClick:e.cutPort,disabled:!e.serialPort||e.isUse},{default:t(()=>l[10]||(l[10]=[w(" \u65AD\u5F00\u626B\u63CF\u67AA ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),r(F,{gutter:16,class:"summary"},{default:t(()=>[P((i(),m(_,{sm:6,xs:12},{default:t(()=>{var a;return[r(e.SummaryCard,{title:"\u8BA2\u5355\u6570\u91CF",icon:"icon-park-outline:transaction-order","icon-color":"bg-blue-100","icon-bg-color":"text-blue-500",value:((a=e.summary)==null?void 0:a.orderCount)||0},null,8,["value"])]}),_:1})),[[p,e.loading]]),P((i(),m(_,{sm:6,xs:12},{default:t(()=>{var a;return[r(e.SummaryCard,{title:"\u8BA2\u5355\u91D1\u989D",icon:"streamline:money-cash-file-dollar-common-money-currency-cash-file","icon-color":"bg-purple-100","icon-bg-color":"text-purple-500",prefix:"\uFFE5",decimals:2,value:e.fenToYuan(((a=e.summary)==null?void 0:a.orderPayPrice)||0)},null,8,["value"])]}),_:1})),[[p,e.loading]]),P((i(),m(_,{sm:6,xs:12},{default:t(()=>{var a;return[r(e.SummaryCard,{title:"\u9000\u6B3E\u5355\u6570",icon:"heroicons:receipt-refund","icon-color":"bg-yellow-100","icon-bg-color":"text-yellow-500",value:((a=e.summary)==null?void 0:a.afterSaleCount)||0},null,8,["value"])]}),_:1})),[[p,e.loading]]),P((i(),m(_,{sm:6,xs:12},{default:t(()=>{var a;return[r(e.SummaryCard,{title:"\u9000\u6B3E\u91D1\u989D",icon:"ri:refund-2-line","icon-color":"bg-green-100","icon-bg-color":"text-green-500",prefix:"\uFFE5",decimals:2,value:e.fenToYuan(((a=e.summary)==null?void 0:a.afterSalePrice)||0)},null,8,["value"])]}),_:1})),[[p,e.loading]])]),_:1}),r(S,null,{default:t(()=>[P((i(),m(L,{data:e.list},{default:t(()=>[r(u,{label:"\u8BA2\u5355\u53F7",align:"center",prop:"no","min-width":"180"}),r(u,{label:"\u7528\u6237\u4FE1\u606F",align:"center",prop:"user.nickname","min-width":"80"}),r(u,{label:"\u63A8\u8350\u4EBA\u4FE1\u606F",align:"center",prop:"brokerageUser.nickname","min-width":"100"}),r(u,{label:"\u5546\u54C1\u4FE1\u606F",align:"center",prop:"spuName","min-width":"300"},{default:t(({row:a})=>[(i(!0),U(N,null,V(a.items,n=>(i(),U("div",{class:"flex items-center",key:n.id},[r(d,{src:n.picUrl,class:"mr-10px h-30px w-30px flex-shrink-0","preview-src-list":[n.picUrl],"preview-teleported":""},null,8,["src","preview-src-list"]),O("span",Ue,T(n.spuName),1),O("div",Te,[(i(!0),U(N,null,V(n.properties,f=>(i(),m(Y,{key:f.propertyId,class:"mr-10px"},{default:t(()=>[w(T(f.propertyName)+": "+T(f.valueName),1)]),_:2},1024))),128)),O("span",null,T(e.floatToFixed2(n.price))+" \u5143 x "+T(n.count),1)])]))),128))]),_:1}),r(u,{label:"\u5B9E\u4ED8\u91D1\u989D(\u5143)",align:"center",prop:"payPrice","min-width":"110",formatter:e.fenToYuanFormat},null,8,["formatter"]),r(u,{label:"\u6838\u9500\u5458",align:"center",prop:"storeStaffName","min-width":"70"}),r(u,{label:"\u6838\u9500\u95E8\u5E97",align:"center",prop:"pickUpStoreId","min-width":"80"},{default:t(({row:a})=>{var n;return[w(T((n=e.pickUpStoreList.find(f=>f.id===a.pickUpStoreId))==null?void 0:n.name),1)]}),_:1}),r(u,{label:"\u652F\u4ED8\u72B6\u6001",align:"center",prop:"payStatus","min-width":"80"},{default:t(({row:a})=>[r(x,{type:e.DICT_TYPE.INFRA_BOOLEAN_STRING,value:a.payStatus||!1},null,8,["type","value"])]),_:1}),r(u,{align:"center",label:"\u8BA2\u5355\u72B6\u6001",prop:"status",width:"120"},{default:t(({row:a})=>[r(x,{type:e.DICT_TYPE.TRADE_ORDER_STATUS,value:a.status},null,8,["type","value"])]),_:1}),r(u,{label:"\u4E0B\u5355\u65F6\u95F4",align:"center",prop:"createTime","min-width":"170",formatter:e.dateFormatter},null,8,["formatter"])]),_:1},8,["data"])),[[p,e.loading]]),r(R,{limit:e.queryParams.pageSize,"onUpdate:limit":l[4]||(l[4]=a=>e.queryParams.pageSize=a),page:e.queryParams.pageNo,"onUpdate:page":l[5]||(l[5]=a=>e.queryParams.pageNo=a),total:e.total,onPagination:e.getList},null,8,["limit","page","total"])]),_:1}),r(e.OrderPickUpForm,{ref:"pickUpForm",onSuccess:e.getList},null,512)],64)}],["__scopeId","data-v-f7448627"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/views/mall/trade/delivery/pickUpOrder/index.vue"]]);export{qe as default};
