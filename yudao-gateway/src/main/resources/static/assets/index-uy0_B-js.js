import{d as w,g as N,D as j,r as o,b as P,_ as D,o as x,q as C,w as u,k as c,m as F,I as E,cC as R,v as T,cm as q,E as O,N as z,R as A}from"./index-BaY5TDP-.js";import{_ as B}from"./Dialog-CZSXtzfQ.js";import{_ as G}from"./ContentWrap-DKQn7kZm.js";import{h as H,d as J}from"./tree-z7HkrWVC.js";import{g as K}from"./index-dK17nfjs.js";import{g as M}from"./index-CuAlllbQ.js";const Q=D(w({name:"UserSelectForm",__name:"index",emits:["confirm"],setup(S,{expose:l,emit:U}){const e=U,{t:b}=N(),h=j(),p=o([]),m=o([]),t=o([]),i=o([]),d=o([]),f=o(!1),v=o(!1),_=o(),r=P(()=>[...t.value.filter(a=>d.value.includes(a.id)),...i.value.filter(a=>!d.value.includes(a.id))]),y=async(a,s)=>{_.value=a,k();const n=await K();m.value=n,p.value=H(n),t.value=await M(),i.value=[...t.value],d.value=(s==null?void 0:s.map(g=>g.id))||[],f.value=!0},L=(a,s)=>{const n=[a];return s.filter(g=>g.parentId===a).forEach(g=>{n.push(...L(g.id,s))}),n},I=async a=>{v.value=!0;try{if(!a)return void(i.value=[...t.value]);const s=L(a,m.value);i.value=t.value.filter(n=>s.includes(n.deptId))}finally{v.value=!1}},k=()=>{p.value=[],m.value=[],t.value=[],i.value=[],d.value=[]};l({open:y});const V={emit:e,t:b,message:h,deptTree:p,deptList:m,userList:t,filteredUserList:i,selectedUserIdList:d,dialogVisible:f,formLoading:v,activityId:_,transferUserList:r,open:y,getChildDeptIds:L,filterUserList:I,submitForm:async()=>{try{h.success(b("common.updateSuccess")),f.value=!1;const a=t.value.filter(s=>d.value.includes(s.id));e("confirm",_.value,a)}finally{}},resetForm:k,handleNodeClick:a=>{I(a.id)},get defaultProps(){return J}};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),[["render",function(S,l,U,e,b,h){const p=R,m=G,t=T,i=q,d=O,f=z,v=B,_=A;return x(),C(v,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[2]||(l[2]=r=>e.dialogVisible=r),title:"\u4EBA\u5458\u9009\u62E9",width:"800"},{footer:u(()=>{var r;return[c(f,{disabled:e.formLoading||!((r=e.selectedUserIdList)!=null&&r.length),type:"primary",onClick:e.submitForm},{default:u(()=>l[3]||(l[3]=[F(" \u786E \u5B9A ")])),_:1},8,["disabled"]),c(f,{onClick:l[1]||(l[1]=y=>e.dialogVisible=!1)},{default:u(()=>l[4]||(l[4]=[F("\u53D6 \u6D88")])),_:1})]}),default:u(()=>[E((x(),C(d,{class:"gap2"},{default:u(()=>[c(t,{span:6},{default:u(()=>[c(m,{class:"h-1/1"},{default:u(()=>[c(p,{ref:"treeRef",data:e.deptTree,"expand-on-click-node":!1,props:e.defaultProps,"default-expand-all":"","highlight-current":"","node-key":"id",onNodeClick:e.handleNodeClick},null,8,["data","props"])]),_:1})]),_:1}),c(t,{span:17},{default:u(()=>[c(i,{modelValue:e.selectedUserIdList,"onUpdate:modelValue":l[0]||(l[0]=r=>e.selectedUserIdList=r),titles:["\u672A\u9009","\u5DF2\u9009"],filterable:"","filter-placeholder":"\u641C\u7D22\u6210\u5458",data:e.transferUserList,props:{label:"nickname",key:"id"}},null,8,["modelValue","data"])]),_:1})]),_:1})),[[_,e.formLoading]])]),_:1},8,["modelValue"])}],["__scopeId","data-v-1faf8e86"],["__file","/Users/steven/00/500_code/520_github/yudao-ui-admin-vue3/src/components/UserSelectForm/index.vue"]]);export{Q as _};
